function extend(e,t){for(var n in t)e[n]=t[n]}function isInstanceOf(e,t){for(;typeof e=="object";){if(e.constructor===t)return!0;e=e._super}return!1}var b2BoundValues=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BoundValues.prototype.__constructor=function(){this.lowerValues=[],this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=[],this.upperValues[0]=0,this.upperValues[1]=0},b2BoundValues.prototype.__varz=function(){},b2BoundValues.prototype.lowerValues=null,b2BoundValues.prototype.upperValues=null;var b2PairManager=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2PairManager.prototype.__constructor=function(){this.m_pairs=[],this.m_pairBuffer=[],this.m_pairBufferCount=this.m_pairCount=0,this.m_freePair=null},b2PairManager.prototype.__varz=function(){},b2PairManager.prototype.AddPair=function(e,t){var n=e.pairs[t];return n!=null?n:(this.m_freePair==null&&(this.m_freePair=new b2Pair,this.m_pairs.push(this.m_freePair)),n=this.m_freePair,this.m_freePair=n.next,n.proxy1=e,n.proxy2=t,n.status=0,n.userData=null,n.next=null,e.pairs[t]=n,t.pairs[e]=n,++this.m_pairCount,n)},b2PairManager.prototype.RemovePair=function(e,t){var n=e.pairs[t];if(n==null)return null;var r=n.userData;return delete e.pairs[t],delete t.pairs[e],n.next=this.m_freePair,n.proxy1=null,n.proxy2=null,n.userData=null,n.status=0,this.m_freePair=n,--this.m_pairCount,r},b2PairManager.prototype.Find=function(e,t){return e.pairs[t]},b2PairManager.prototype.ValidateBuffer=function(){},b2PairManager.prototype.ValidateTable=function(){},b2PairManager.prototype.Initialize=function(e){this.m_broadPhase=e},b2PairManager.prototype.AddBufferedPair=function(e,t){var n=this.AddPair(e,t);n.IsBuffered()==0&&(n.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount]=n,++this.m_pairBufferCount),n.ClearRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer()},b2PairManager.prototype.RemoveBufferedPair=function(e,t){var n=this.Find(e,t);n!=null&&(n.IsBuffered()==0&&(n.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount]=n,++this.m_pairBufferCount),n.SetRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer())},b2PairManager.prototype.Commit=function(e){var t=0;for(t=0;t<this.m_pairBufferCount;++t){var n=this.m_pairBuffer[t];n.ClearBuffered();var r=n.proxy1,i=n.proxy2;n.IsRemoved()||n.IsFinal()==0&&e(r.userData,i.userData)}this.m_pairBufferCount=0,b2BroadPhase.s_validate&&this.ValidateTable()},b2PairManager.prototype.m_broadPhase=null,b2PairManager.prototype.m_pairs=null,b2PairManager.prototype.m_freePair=null,b2PairManager.prototype.m_pairCount=0,b2PairManager.prototype.m_pairBuffer=null,b2PairManager.prototype.m_pairBufferCount=0;var b2TimeStep=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TimeStep.prototype.__constructor=function(){},b2TimeStep.prototype.__varz=function(){},b2TimeStep.prototype.Set=function(e){this.dt=e.dt,this.inv_dt=e.inv_dt,this.positionIterations=e.positionIterations,this.velocityIterations=e.velocityIterations,this.warmStarting=e.warmStarting},b2TimeStep.prototype.dt=null,b2TimeStep.prototype.inv_dt=null,b2TimeStep.prototype.dtRatio=null,b2TimeStep.prototype.velocityIterations=0,b2TimeStep.prototype.positionIterations=0,b2TimeStep.prototype.warmStarting=null;var b2Controller=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Controller.prototype.__constructor=function(){},b2Controller.prototype.__varz=function(){},b2Controller.prototype.Step=function(){},b2Controller.prototype.Draw=function(){},b2Controller.prototype.AddBody=function(e){var t=new b2ControllerEdge;t.controller=this,t.body=e,t.nextBody=m_bodyList,t.prevBody=null,m_bodyList=t,t.nextBody&&(t.nextBody.prevBody=t),m_bodyCount++,t.nextController=e.m_controllerList,t.prevController=null,e.m_controllerList=t,t.nextController&&(t.nextController.prevController=t),e.m_controllerCount++},b2Controller.prototype.RemoveBody=function(e){for(var t=e.m_controllerList;t&&t.controller!=this;)t=t.nextController;t.prevBody&&(t.prevBody.nextBody=t.nextBody),t.nextBody&&(t.nextBody.prevBody=t.prevBody),t.nextController&&(t.nextController.prevController=t.prevController),t.prevController&&(t.prevController.nextController=t.nextController),m_bodyList==t&&(m_bodyList=t.nextBody),e.m_controllerList==t&&(e.m_controllerList=t.nextController),e.m_controllerCount--,m_bodyCount--},b2Controller.prototype.Clear=function(){for(;m_bodyList;)this.RemoveBody(m_bodyList.body)},b2Controller.prototype.GetNext=function(){return this.m_next},b2Controller.prototype.GetWorld=function(){return this.m_world},b2Controller.prototype.GetBodyList=function(){return m_bodyList},b2Controller.prototype.m_next=null,b2Controller.prototype.m_prev=null,b2Controller.prototype.m_world=null;var b2GravityController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GravityController.prototype,b2Controller.prototype),b2GravityController.prototype._super=b2Controller.prototype,b2GravityController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2GravityController.prototype.__varz=function(){},b2GravityController.prototype.Step=function(){var e=null,t=null,n=null,r=0,i=null,s=null,o=null,u=0,a=0,f=0;u=null;if(this.invSqr)for(e=m_bodyList;e;e=e.nextBody){t=e.body,n=t.GetWorldCenter(),r=t.GetMass();for(i=m_bodyList;i!=e;i=i.nextBody)s=i.body,o=s.GetWorldCenter(),u=o.x-n.x,a=o.y-n.y,f=u*u+a*a,f<Number.MIN_VALUE||(u=new b2Vec2(u,a),u.Multiply(this.G/f/Math.sqrt(f)*r*s.GetMass()),t.IsAwake()&&t.ApplyForce(u,n),u.Multiply(-1),s.IsAwake()&&s.ApplyForce(u,o))}else for(e=m_bodyList;e;e=e.nextBody){t=e.body,n=t.GetWorldCenter(),r=t.GetMass();for(i=m_bodyList;i!=e;i=i.nextBody)s=i.body,o=s.GetWorldCenter(),u=o.x-n.x,a=o.y-n.y,f=u*u+a*a,f<Number.MIN_VALUE||(u=new b2Vec2(u,a),u.Multiply(this.G/f*r*s.GetMass()),t.IsAwake()&&t.ApplyForce(u,n),u.Multiply(-1),s.IsAwake()&&s.ApplyForce(u,o))}},b2GravityController.prototype.G=1,b2GravityController.prototype.invSqr=!0;var b2DestructionListener=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DestructionListener.prototype.__constructor=function(){},b2DestructionListener.prototype.__varz=function(){},b2DestructionListener.prototype.SayGoodbyeJoint=function(){},b2DestructionListener.prototype.SayGoodbyeFixture=function(){};var b2ContactEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactEdge.prototype.__constructor=function(){},b2ContactEdge.prototype.__varz=function(){},b2ContactEdge.prototype.other=null,b2ContactEdge.prototype.contact=null,b2ContactEdge.prototype.prev=null,b2ContactEdge.prototype.next=null;var b2EdgeChainDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2EdgeChainDef.prototype.__constructor=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},b2EdgeChainDef.prototype.__varz=function(){},b2EdgeChainDef.prototype.vertices=null,b2EdgeChainDef.prototype.vertexCount=null,b2EdgeChainDef.prototype.isALoop=null;var b2Vec2=function(e,t){arguments.length==2&&(this.x=e,this.y=t)};b2Vec2.Make=function(e,t){return new b2Vec2(e,t)},b2Vec2.prototype.SetZero=function(){this.y=this.x=0},b2Vec2.prototype.Set=function(e,t){this.x=e,this.y=t},b2Vec2.prototype.SetV=function(e){this.x=e.x,this.y=e.y},b2Vec2.prototype.GetNegative=function(){return new b2Vec2(-this.x,-this.y)},b2Vec2.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},b2Vec2.prototype.Copy=function(){return new b2Vec2(this.x,this.y)},b2Vec2.prototype.Add=function(e){this.x+=e.x,this.y+=e.y},b2Vec2.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y},b2Vec2.prototype.Multiply=function(e){this.x*=e,this.y*=e},b2Vec2.prototype.MulM=function(e){var t=this.x;this.x=e.col1.x*t+e.col2.x*this.y,this.y=e.col1.y*t+e.col2.y*this.y},b2Vec2.prototype.MulTM=function(e){var t=b2Math.Dot(this,e.col1);this.y=b2Math.Dot(this,e.col2),this.x=t},b2Vec2.prototype.CrossVF=function(e){var t=this.x;this.x=e*this.y,this.y=-e*t},b2Vec2.prototype.CrossFV=function(e){var t=this.x;this.x=-e*this.y,this.y=e*t},b2Vec2.prototype.MinV=function(e){this.x=this.x<e.x?this.x:e.x,this.y=this.y<e.y?this.y:e.y},b2Vec2.prototype.MaxV=function(e){this.x=this.x>e.x?this.x:e.x,this.y=this.y>e.y?this.y:e.y},b2Vec2.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},b2Vec2.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},b2Vec2.prototype.Normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);if(e<Number.MIN_VALUE)return 0;var t=1/e;return this.x*=t,this.y*=t,e},b2Vec2.prototype.IsValid=function(){return b2Math.IsValid(this.x)&&b2Math.IsValid(this.y)},b2Vec2.prototype.x=0,b2Vec2.prototype.y=0;var b2Vec3=function(e,t,n){arguments.length==3&&(this.x=e,this.y=t,this.z=n)};b2Vec3.prototype.SetZero=function(){this.x=this.y=this.z=0},b2Vec3.prototype.Set=function(e,t,n){this.x=e,this.y=t,this.z=n},b2Vec3.prototype.SetV=function(e){this.x=e.x,this.y=e.y,this.z=e.z},b2Vec3.prototype.GetNegative=function(){return new b2Vec3(-this.x,-this.y,-this.z)},b2Vec3.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},b2Vec3.prototype.Copy=function(){return new b2Vec3(this.x,this.y,this.z)},b2Vec3.prototype.Add=function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},b2Vec3.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},b2Vec3.prototype.Multiply=function(e){this.x*=e,this.y*=e,this.z*=e},b2Vec3.prototype.x=0,b2Vec3.prototype.y=0,b2Vec3.prototype.z=0;var b2DistanceProxy=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceProxy.prototype.__constructor=function(){},b2DistanceProxy.prototype.__varz=function(){},b2DistanceProxy.prototype.Set=function(e){switch(e.GetType()){case b2Shape.e_circleShape:this.m_vertices=Array(1),this.m_vertices[0]=e.m_p,this.m_count=1,this.m_radius=e.m_radius;break;case b2Shape.e_polygonShape:this.m_vertices=e.m_vertices,this.m_count=e.m_vertexCount,this.m_radius=e.m_radius;break;default:b2Settings.b2Assert(!1)}},b2DistanceProxy.prototype.GetSupport=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},b2DistanceProxy.prototype.GetSupportVertex=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},b2DistanceProxy.prototype.GetVertex=function(e){return b2Settings.b2Assert(0<=e&&e<this.m_count),this.m_vertices[e]},b2DistanceProxy.prototype.m_vertices=null,b2DistanceProxy.prototype.m_count=0,b2DistanceProxy.prototype.m_radius=null;var b2ContactFactory=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactFactory.prototype.__constructor=function(e){this.m_allocator=e,this.InitializeRegisters()},b2ContactFactory.prototype.__varz=function(){},b2ContactFactory.prototype.AddType=function(e,t,n,r){this.m_registers[n][r].createFcn=e,this.m_registers[n][r].destroyFcn=t,this.m_registers[n][r].primary=!0,n!=r&&(this.m_registers[r][n].createFcn=e,this.m_registers[r][n].destroyFcn=t,this.m_registers[r][n].primary=!1)},b2ContactFactory.prototype.InitializeRegisters=function(){this.m_registers=Array(b2Shape.e_shapeTypeCount);for(var e=0;e<b2Shape.e_shapeTypeCount;e++){this.m_registers[e]=Array(b2Shape.e_shapeTypeCount);for(var t=0;t<b2Shape.e_shapeTypeCount;t++)this.m_registers[e][t]=new b2ContactRegister}this.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape),this.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_circleShape),this.AddType(b2PolygonContact.Create,b2PolygonContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_polygonShape),this.AddType(b2EdgeAndCircleContact.Create,b2EdgeAndCircleContact.Destroy,b2Shape.e_edgeShape,b2Shape.e_circleShape),this.AddType(b2PolyAndEdgeContact.Create,b2PolyAndEdgeContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_edgeShape)},b2ContactFactory.prototype.Create=function(e,t){var n=e.GetType(),r=t.GetType();return n=this.m_registers[n][r],n.pool?(r=n.pool,n.pool=r.m_next,n.poolCount--,r.Reset(e,t),r):(r=n.createFcn,r!=null?(n.primary?(r=r(this.m_allocator),r.Reset(e,t)):(r=r(this.m_allocator),r.Reset(t,e)),r):null)},b2ContactFactory.prototype.Destroy=function(e){e.m_manifold.m_pointCount>0&&(e.m_fixtureA.m_body.SetAwake(!0),e.m_fixtureB.m_body.SetAwake(!0));var t=e.m_fixtureA.GetType(),n=e.m_fixtureB.GetType();t=this.m_registers[t][n],t.poolCount++,e.m_next=t.pool,t.pool=e,t=t.destroyFcn,t(e,this.m_allocator)},b2ContactFactory.prototype.m_registers=null,b2ContactFactory.prototype.m_allocator=null;var b2ConstantAccelController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2ConstantAccelController.prototype,b2Controller.prototype),b2ConstantAccelController.prototype._super=b2Controller.prototype,b2ConstantAccelController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2ConstantAccelController.prototype.__varz=function(){this.A=new b2Vec2(0,0)},b2ConstantAccelController.prototype.Step=function(e){e=new b2Vec2(this.A.x*e.dt,this.A.y*e.dt);for(var t=m_bodyList;t;t=t.nextBody){var n=t.body;n.IsAwake()&&n.SetLinearVelocity(new b2Vec2(n.GetLinearVelocity().x+e.x,n.GetLinearVelocity().y+e.y))}},b2ConstantAccelController.prototype.A=new b2Vec2(0,0);var b2SeparationFunction=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SeparationFunction.prototype.__constructor=function(){},b2SeparationFunction.prototype.__varz=function(){this.m_localPoint=new b2Vec2,this.m_axis=new b2Vec2},b2SeparationFunction.e_points=1,b2SeparationFunction.e_faceA=2,b2SeparationFunction.e_faceB=4,b2SeparationFunction.prototype.Initialize=function(e,t,n,r,i){this.m_proxyA=t,this.m_proxyB=r,t=e.count,b2Settings.b2Assert(0<t&&t<3);var s,o,u,a;if(t==1)this.m_type=b2SeparationFunction.e_points,s=this.m_proxyA.GetVertex(e.indexA[0]),o=this.m_proxyB.GetVertex(e.indexB[0]),a=s,u=n.R,s=n.position.x+(u.col1.x*a.x+u.col2.x*a.y),n=n.position.y+(u.col1.y*a.x+u.col2.y*a.y),a=o,u=i.R,o=i.position.x+(u.col1.x*a.x+u.col2.x*a.y),i=i.position.y+(u.col1.y*a.x+u.col2.y*a.y),this.m_axis.x=o-s,this.m_axis.y=i-n,this.m_axis.Normalize();else{if(e.indexB[0]==e.indexB[1])this.m_type=b2SeparationFunction.e_faceA,t=this.m_proxyA.GetVertex(e.indexA[0]),r=this.m_proxyA.GetVertex(e.indexA[1]),o=this.m_proxyB.GetVertex(e.indexB[0]),this.m_localPoint.x=.5*(t.x+r.x),this.m_localPoint.y=.5*(t.y+r.y),this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(r,t),1),this.m_axis.Normalize(),a=this.m_axis,u=n.R,t=u.col1.x*a.x+u.col2.x*a.y,r=u.col1.y*a.x+u.col2.y*a.y,a=this.m_localPoint,u=n.R,s=n.position.x+(u.col1.x*a.x+u.col2.x*a.y),n=n.position.y+(u.col1.y*a.x+u.col2.y*a.y),a=o,u=i.R,o=i.position.x+(u.col1.x*a.x+u.col2.x*a.y),i=i.position.y+(u.col1.y*a.x+u.col2.y*a.y),e=(o-s)*t+(i-n)*r;else if(e.indexA[0]==e.indexA[0])this.m_type=b2SeparationFunction.e_faceB,u=this.m_proxyB.GetVertex(e.indexB[0]),a=this.m_proxyB.GetVertex(e.indexB[1]),s=this.m_proxyA.GetVertex(e.indexA[0]),this.m_localPoint.x=.5*(u.x+a.x),this.m_localPoint.y=.5*(u.y+a.y),this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(a,u),1),this.m_axis.Normalize(),a=this.m_axis,u=i.R,t=u.col1.x*a.x+u.col2.x*a.y,r=u.col1.y*a.x+u.col2.y*a.y,a=this.m_localPoint,u=i.R,o=i.position.x+(u.col1.x*a.x+u.col2.x*a.y),i=i.position.y+(u.col1.y*a.x+u.col2.y*a.y),a=s,u=n.R,s=n.position.x+(u.col1.x*a.x+u.col2.x*a.y),n=n.position.y+(u.col1.y*a.x+u.col2.y*a.y),e=(s-o)*t+(n-i)*r;else{t=this.m_proxyA.GetVertex(e.indexA[0]),r=this.m_proxyA.GetVertex(e.indexA[1]),u=this.m_proxyB.GetVertex(e.indexB[0]),a=this.m_proxyB.GetVertex(e.indexB[1]),b2Math.MulX(n,s),s=b2Math.MulMV(n.R,b2Math.SubtractVV(r,t)),b2Math.MulX(i,o),e=b2Math.MulMV(i.R,b2Math.SubtractVV(a,u)),i=s.x*s.x+s.y*s.y,o=e.x*e.x+e.y*e.y;var f=b2Math.SubtractVV(e,s);n=s.x*f.x+s.y*f.y,f=e.x*f.x+e.y*f.y,s=s.x*e.x+s.y*e.y;var l=i*o-s*s;e=0,l!=0&&(e=b2Math.Clamp((s*f-n*o)/l,0,1)),(s*e+f)/o<0&&(e=b2Math.Clamp((s-n)/i,0,1)),s=new b2Vec2,s.x=t.x+e*(r.x-t.x),s.y=t.y+e*(r.y-t.y),o=new b2Vec2,o.x=u.x+e*(a.x-u.x),o.y=u.y+e*(a.y-u.y),e==0||e==1?(this.m_type=b2SeparationFunction.e_faceB,this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(a,u),1),this.m_axis.Normalize(),this.m_localPoint=o):(this.m_type=b2SeparationFunction.e_faceA,this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(r,t),1),this.m_localPoint=s)}e<0&&this.m_axis.NegativeSelf()}},b2SeparationFunction.prototype.Evaluate=function(e,t){var n,r,i;switch(this.m_type){case b2SeparationFunction.e_points:return n=b2Math.MulTMV(e.R,this.m_axis),r=b2Math.MulTMV(t.R,this.m_axis.GetNegative()),n=this.m_proxyA.GetSupportVertex(n),r=this.m_proxyB.GetSupportVertex(r),n=b2Math.MulX(e,n),r=b2Math.MulX(t,r),i=(r.x-n.x)*this.m_axis.x+(r.y-n.y)*this.m_axis.y;case b2SeparationFunction.e_faceA:return i=b2Math.MulMV(e.R,this.m_axis),n=b2Math.MulX(e,this.m_localPoint),r=b2Math.MulTMV(t.R,i.GetNegative()),r=this.m_proxyB.GetSupportVertex(r),r=b2Math.MulX(t,r),i=(r.x-n.x)*i.x+(r.y-n.y)*i.y;case b2SeparationFunction.e_faceB:return i=b2Math.MulMV(t.R,this.m_axis),r=b2Math.MulX(t,this.m_localPoint),n=b2Math.MulTMV(e.R,i.GetNegative()),n=this.m_proxyA.GetSupportVertex(n),n=b2Math.MulX(e,n),i=(n.x-r.x)*i.x+(n.y-r.y)*i.y;default:return b2Settings.b2Assert(!1),0}},b2SeparationFunction.prototype.m_proxyA=null,b2SeparationFunction.prototype.m_proxyB=null,b2SeparationFunction.prototype.m_type=0,b2SeparationFunction.prototype.m_localPoint=new b2Vec2,b2SeparationFunction.prototype.m_axis=new b2Vec2;var b2DynamicTreePair=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreePair.prototype.__constructor=function(){},b2DynamicTreePair.prototype.__varz=function(){},b2DynamicTreePair.prototype.proxyA=null,b2DynamicTreePair.prototype.proxyB=null;var b2ContactConstraintPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactConstraintPoint.prototype.__constructor=function(){},b2ContactConstraintPoint.prototype.__varz=function(){this.localPoint=new b2Vec2,this.rA=new b2Vec2,this.rB=new b2Vec2},b2ContactConstraintPoint.prototype.localPoint=new b2Vec2,b2ContactConstraintPoint.prototype.rA=new b2Vec2,b2ContactConstraintPoint.prototype.rB=new b2Vec2,b2ContactConstraintPoint.prototype.normalImpulse=null,b2ContactConstraintPoint.prototype.tangentImpulse=null,b2ContactConstraintPoint.prototype.normalMass=null,b2ContactConstraintPoint.prototype.tangentMass=null,b2ContactConstraintPoint.prototype.equalizedMass=null,b2ContactConstraintPoint.prototype.velocityBias=null;var b2ControllerEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ControllerEdge.prototype.__constructor=function(){},b2ControllerEdge.prototype.__varz=function(){},b2ControllerEdge.prototype.controller=null,b2ControllerEdge.prototype.body=null,b2ControllerEdge.prototype.prevBody=null,b2ControllerEdge.prototype.nextBody=null,b2ControllerEdge.prototype.prevController=null,b2ControllerEdge.prototype.nextController=null;var b2DistanceInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceInput.prototype.__constructor=function(){},b2DistanceInput.prototype.__varz=function(){},b2DistanceInput.prototype.proxyA=null,b2DistanceInput.prototype.proxyB=null,b2DistanceInput.prototype.transformA=null,b2DistanceInput.prototype.transformB=null,b2DistanceInput.prototype.useRadii=null;var b2Settings=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Settings.prototype.__constructor=function(){},b2Settings.prototype.__varz=function(){},b2Settings.b2MixFriction=function(e,t){return Math.sqrt(e*t)},b2Settings.b2MixRestitution=function(e,t){return e>t?e:t},b2Settings.b2Assert=function(e){if(!e)throw"Assertion Failed"},b2Settings.VERSION="2.1alpha",b2Settings.USHRT_MAX=65535,b2Settings.b2_pi=Math.PI,b2Settings.b2_maxManifoldPoints=2,b2Settings.b2_aabbExtension=.1,b2Settings.b2_aabbMultiplier=2,b2Settings.b2_polygonRadius=2*b2Settings.b2_linearSlop,b2Settings.b2_linearSlop=.005,b2Settings.b2_angularSlop=2/180*b2Settings.b2_pi,b2Settings.b2_toiSlop=8*b2Settings.b2_linearSlop,b2Settings.b2_maxTOIContactsPerIsland=32,b2Settings.b2_maxTOIJointsPerIsland=32,b2Settings.b2_velocityThreshold=1,b2Settings.b2_maxLinearCorrection=.2,b2Settings.b2_maxAngularCorrection=8/180*b2Settings.b2_pi,b2Settings.b2_maxTranslation=2,b2Settings.b2_maxTranslationSquared=b2Settings.b2_maxTranslation*b2Settings.b2_maxTranslation,b2Settings.b2_maxRotation=.5*b2Settings.b2_pi,b2Settings.b2_maxRotationSquared=b2Settings.b2_maxRotation*b2Settings.b2_maxRotation,b2Settings.b2_contactBaumgarte=.2,b2Settings.b2_timeToSleep=.5,b2Settings.b2_linearSleepTolerance=.01,b2Settings.b2_angularSleepTolerance=2/180*b2Settings.b2_pi;var b2Proxy=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Proxy.prototype.__constructor=function(){},b2Proxy.prototype.__varz=function(){this.lowerBounds=Array(2),this.upperBounds=Array(2),this.pairs={}},b2Proxy.prototype.IsValid=function(){return this.overlapCount!=b2BroadPhase.b2_invalid},b2Proxy.prototype.lowerBounds=Array(2),b2Proxy.prototype.upperBounds=Array(2),b2Proxy.prototype.overlapCount=0,b2Proxy.prototype.timeStamp=0,b2Proxy.prototype.pairs={},b2Proxy.prototype.next=null,b2Proxy.prototype.userData=null;var b2Point=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Point.prototype.__constructor=function(){},b2Point.prototype.__varz=function(){this.p=new b2Vec2},b2Point.prototype.Support=function(){return this.p},b2Point.prototype.GetFirstVertex=function(){return this.p},b2Point.prototype.p=new b2Vec2;var b2WorldManifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2WorldManifold.prototype.__constructor=function(){this.m_points=Array(b2Settings.b2_maxManifoldPoints);for(var e=0;e<b2Settings.b2_maxManifoldPoints;e++)this.m_points[e]=new b2Vec2},b2WorldManifold.prototype.__varz=function(){this.m_normal=new b2Vec2},b2WorldManifold.prototype.Initialize=function(e,t,n,r,i){if(e.m_pointCount!=0){var s=0,o,u,a,f,l,c,h;switch(e.m_type){case b2Manifold.e_circles:u=t.R,o=e.m_localPoint,s=t.position.x+u.col1.x*o.x+u.col2.x*o.y,t=t.position.y+u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_points[0].m_localPoint,e=r.position.x+u.col1.x*o.x+u.col2.x*o.y,r=r.position.y+u.col1.y*o.x+u.col2.y*o.y,o=e-s,u=r-t,a=o*o+u*u,a>Number.MIN_VALUE*Number.MIN_VALUE?(a=Math.sqrt(a),this.m_normal.x=o/a,this.m_normal.y=u/a):(this.m_normal.x=1,this.m_normal.y=0),o=t+n*this.m_normal.y,r-=i*this.m_normal.y,this.m_points[0].x=.5*(s+n*this.m_normal.x+(e-i*this.m_normal.x)),this.m_points[0].y=.5*(o+r);break;case b2Manifold.e_faceA:u=t.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=t.R,o=e.m_localPoint,l=t.position.x+u.col1.x*o.x+u.col2.x*o.y,c=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=a,this.m_normal.y=f;for(s=0;s<e.m_pointCount;s++)u=r.R,o=e.m_points[s].m_localPoint,h=r.position.x+u.col1.x*o.x+u.col2.x*o.y,o=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(n-(h-l)*a-(o-c)*f-i)*a,this.m_points[s].y=o+.5*(n-(h-l)*a-(o-c)*f-i)*f;break;case b2Manifold.e_faceB:u=r.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_localPoint,l=r.position.x+u.col1.x*o.x+u.col2.x*o.y,c=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=-a,this.m_normal.y=-f;for(s=0;s<e.m_pointCount;s++)u=t.R,o=e.m_points[s].m_localPoint,h=t.position.x+u.col1.x*o.x+u.col2.x*o.y,o=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(i-(h-l)*a-(o-c)*f-n)*a,this.m_points[s].y=o+.5*(i-(h-l)*a-(o-c)*f-n)*f}}},b2WorldManifold.prototype.m_normal=new b2Vec2,b2WorldManifold.prototype.m_points=null;var b2RayCastOutput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2RayCastOutput.prototype.__constructor=function(){},b2RayCastOutput.prototype.__varz=function(){this.normal=new b2Vec2},b2RayCastOutput.prototype.normal=new b2Vec2,b2RayCastOutput.prototype.fraction=null;var b2ConstantForceController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2ConstantForceController.prototype,b2Controller.prototype),b2ConstantForceController.prototype._super=b2Controller.prototype,b2ConstantForceController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2ConstantForceController.prototype.__varz=function(){this.F=new b2Vec2(0,0)},b2ConstantForceController.prototype.Step=function(){for(var e=m_bodyList;e;e=e.nextBody){var t=e.body;t.IsAwake()&&t.ApplyForce(this.F,t.GetWorldCenter())}},b2ConstantForceController.prototype.F=new b2Vec2(0,0);var b2MassData=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2MassData.prototype.__constructor=function(){},b2MassData.prototype.__varz=function(){this.center=new b2Vec2(0,0)},b2MassData.prototype.mass=0,b2MassData.prototype.center=new b2Vec2(0,0),b2MassData.prototype.I=0;var b2DynamicTree=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTree.prototype.__constructor=function(){this.m_freeList=this.m_root=null,this.m_insertionCount=this.m_path=0},b2DynamicTree.prototype.__varz=function(){},b2DynamicTree.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e}return new b2DynamicTreeNode},b2DynamicTree.prototype.FreeNode=function(e){e.parent=this.m_freeList,this.m_freeList=e},b2DynamicTree.prototype.InsertLeaf=function(e){++this.m_insertionCount;if(this.m_root==null)this.m_root=e,this.m_root.parent=null;else{var t=e.aabb.GetCenter(),n=this.m_root;if(n.IsLeaf()==0)do{var r=n.child1;n=n.child2,n=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-t.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-t.y)<Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-t.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-t.y)?r:n}while(n.IsLeaf()==0);t=n.parent,r=this.AllocateNode(),r.parent=t,r.userData=null,r.aabb.Combine(e.aabb,n.aabb);if(t){n.parent.child1==n?t.child1=r:t.child2=r,r.child1=n,r.child2=e,n.parent=r,e.parent=r;do{if(t.aabb.Contains(r.aabb))break;t.aabb.Combine(t.child1.aabb,t.child2.aabb),r=t,t=t.parent}while(t)}else r.child1=n,r.child2=e,n.parent=r,this.m_root=e.parent=r}},b2DynamicTree.prototype.RemoveLeaf=function(e){if(e==this.m_root)this.m_root=null;else{var t=e.parent,n=t.parent;e=t.child1==e?t.child2:t.child1;if(n){n.child1==t?n.child1=e:n.child2=e,e.parent=n;for(this.FreeNode(t);n;){t=n.aabb,n.aabb=b2AABB.Combine(n.child1.aabb,n.child2.aabb);if(t.Contains(n.aabb))break;n=n.parent}}else this.m_root=e,e.parent=null,this.FreeNode(t)}},b2DynamicTree.prototype.CreateProxy=function(e,t){var n=this.AllocateNode(),r=b2Settings.b2_aabbExtension,i=b2Settings.b2_aabbExtension;return n.aabb.lowerBound.x=e.lowerBound.x-r,n.aabb.lowerBound.y=e.lowerBound.y-i,n.aabb.upperBound.x=e.upperBound.x+r,n.aabb.upperBound.y=e.upperBound.y+i,n.userData=t,this.InsertLeaf(n),n},b2DynamicTree.prototype.DestroyProxy=function(e){this.RemoveLeaf(e),this.FreeNode(e)},b2DynamicTree.prototype.MoveProxy=function(e,t,n){b2Settings.b2Assert(e.IsLeaf());if(e.aabb.Contains(t))return!1;this.RemoveLeaf(e);var r=b2Settings.b2_aabbExtension+b2Settings.b2_aabbMultiplier*(n.x>0?n.x:-n.x);return n=b2Settings.b2_aabbExtension+b2Settings.b2_aabbMultiplier*(n.y>0?n.y:-n.y),e.aabb.lowerBound.x=t.lowerBound.x-r,e.aabb.lowerBound.y=t.lowerBound.y-n,e.aabb.upperBound.x=t.upperBound.x+r,e.aabb.upperBound.y=t.upperBound.y+n,this.InsertLeaf(e),!0},b2DynamicTree.prototype.Rebalance=function(e){if(this.m_root!=null)for(var t=0;t<e;t++){for(var n=this.m_root,r=0;n.IsLeaf()==0;)n=this.m_path>>r&1?n.child2:n.child1,r=r+1&31;++this.m_path,this.RemoveLeaf(n),this.InsertLeaf(n)}},b2DynamicTree.prototype.GetFatAABB=function(e){return e.aabb},b2DynamicTree.prototype.GetUserData=function(e){return e.userData},b2DynamicTree.prototype.Query=function(e,t){if(this.m_root!=null){var n=[],r=0;for(n[r++]=this.m_root;r>0;){var i=n[--r];if(i.aabb.TestOverlap(t))if(i.IsLeaf()){if(!e(i))break}else n[r++]=i.child1,n[r++]=i.child2}}},b2DynamicTree.prototype.RayCast=function(e,t){if(this.m_root!=null){var n=t.p1,r=t.p2,i=b2Math.SubtractVV(n,r);i.Normalize(),i=b2Math.CrossFV(1,i);var s=b2Math.AbsV(i),o=t.maxFraction,u=new b2AABB,a;a=n.x+o*(r.x-n.x),o=n.y+o*(r.y-n.y),u.lowerBound.x=Math.min(n.x,a),u.lowerBound.y=Math.min(n.y,o),u.upperBound.x=Math.max(n.x,a),u.upperBound.y=Math.max(n.y,o);var f=[],l=0;for(f[l++]=this.m_root;l>0;){a=f[--l];if(a.aabb.TestOverlap(u)!=0){o=a.aabb.GetCenter();var c=a.aabb.GetExtents();if(!(Math.abs(i.x*(n.x-o.x)+i.y*(n.y-o.y))-s.x*c.x-s.y*c.y>0))if(a.IsLeaf()){o=new b2RayCastInput,o.p1=t.p1,o.p2=t.p2,o.maxFraction=t.maxFraction,o=e(o,a);if(o==0)break;a=n.x+o*(r.x-n.x),o=n.y+o*(r.y-n.y),u.lowerBound.x=Math.min(n.x,a),u.lowerBound.y=Math.min(n.y,o),u.upperBound.x=Math.max(n.x,a),u.upperBound.y=Math.max(n.y,o)}else f[l++]=a.child1,f[l++]=a.child2}}}},b2DynamicTree.prototype.m_root=null,b2DynamicTree.prototype.m_freeList=null,b2DynamicTree.prototype.m_path=0,b2DynamicTree.prototype.m_insertionCount=0;var b2JointEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2JointEdge.prototype.__constructor=function(){},b2JointEdge.prototype.__varz=function(){},b2JointEdge.prototype.other=null,b2JointEdge.prototype.joint=null,b2JointEdge.prototype.prev=null,b2JointEdge.prototype.next=null;var b2RayCastInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2RayCastInput.prototype.__constructor=function(e,t,n){e&&this.p1.SetV(e),t&&this.p2.SetV(t),n&&(this.maxFraction=n)},b2RayCastInput.prototype.__varz=function(){this.p1=new b2Vec2,this.p2=new b2Vec2},b2RayCastInput.prototype.p1=new b2Vec2,b2RayCastInput.prototype.p2=new b2Vec2,b2RayCastInput.prototype.maxFraction=null;var Features=function(){this.__varz(),this.__constructor.apply(this,arguments)};Features.prototype.__constructor=function(){},Features.prototype.__varz=function(){},Features.prototype.__defineGetter__("referenceEdge",function(){return this._referenceEdge}),Features.prototype.__defineSetter__("referenceEdge",function(e){this._referenceEdge=e,this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}),Features.prototype.__defineGetter__("incidentEdge",function(){return this._incidentEdge}),Features.prototype.__defineSetter__("incidentEdge",function(e){this._incidentEdge=e,this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}),Features.prototype.__defineGetter__("incidentVertex",function(){return this._incidentVertex}),Features.prototype.__defineSetter__("incidentVertex",function(e){this._incidentVertex=e,this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}),Features.prototype.__defineGetter__("flip",function(){return this._flip}),Features.prototype.__defineSetter__("flip",function(e){this._flip=e,this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}),Features.prototype._referenceEdge=0,Features.prototype._incidentEdge=0,Features.prototype._incidentVertex=0,Features.prototype._flip=0,Features.prototype._m_id=null;var b2FilterData=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2FilterData.prototype.__constructor=function(){},b2FilterData.prototype.__varz=function(){this.categoryBits=1,this.maskBits=65535},b2FilterData.prototype.Copy=function(){var e=new b2FilterData;return e.categoryBits=this.categoryBits,e.maskBits=this.maskBits,e.groupIndex=this.groupIndex,e},b2FilterData.prototype.categoryBits=1,b2FilterData.prototype.maskBits=65535,b2FilterData.prototype.groupIndex=0;var b2AABB=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2AABB.prototype.__constructor=function(){},b2AABB.prototype.__varz=function(){this.lowerBound=new b2Vec2,this.upperBound=new b2Vec2},b2AABB.Combine=function(e,t){var n=new b2AABB;return n.Combine(e,t),n},b2AABB.prototype.IsValid=function(){var e=this.upperBound.y-this.lowerBound.y;return e=(e=this.upperBound.x-this.lowerBound.x>=0&&e>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},b2AABB.prototype.GetCenter=function(){return new b2Vec2((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},b2AABB.prototype.GetExtents=function(){return new b2Vec2((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},b2AABB.prototype.Contains=function(e){return this.lowerBound.x<=e.lowerBound.x&&this.lowerBound.y<=e.lowerBound.y&&e.upperBound.x<=this.upperBound.x&&e.upperBound.y<=this.upperBound.y},b2AABB.prototype.RayCast=function(e,t){var n=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=t.p1.x,s=t.p1.y,o=t.p2.x-t.p1.x,u=t.p2.y-t.p1.y,a=Math.abs(u),f=e.normal,l;if(Math.abs(o)<Number.MIN_VALUE){if(i<this.lowerBound.x||this.upperBound.x<i)return!1}else{l=1/o,o=(this.lowerBound.x-i)*l,i=(this.upperBound.x-i)*l,l=-1,o>i&&(l=o,o=i,i=l,l=1),o>n&&(f.x=l,f.y=0,n=o),r=Math.min(r,i);if(n>r)return!1}if(a<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{l=1/u,o=(this.lowerBound.y-s)*l,i=(this.upperBound.y-s)*l,l=-1,o>i&&(l=o,o=i,i=l,l=1),o>n&&(f.y=l,f.x=0,n=o),r=Math.min(r,i);if(n>r)return!1}return e.fraction=n,!0},b2AABB.prototype.TestOverlap=function(e){var t=e.lowerBound.y-this.upperBound.y,n=this.lowerBound.y-e.upperBound.y;return e.lowerBound.x-this.upperBound.x>0||t>0?!1:this.lowerBound.x-e.upperBound.x>0||n>0?!1:!0},b2AABB.prototype.Combine=function(e,t){this.lowerBound.x=Math.min(e.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(e.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(e.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(e.upperBound.y,t.upperBound.y)},b2AABB.prototype.lowerBound=new b2Vec2,b2AABB.prototype.upperBound=new b2Vec2;var b2Jacobian=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Jacobian.prototype.__constructor=function(){},b2Jacobian.prototype.__varz=function(){this.linearA=new b2Vec2,this.linearB=new b2Vec2},b2Jacobian.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},b2Jacobian.prototype.Set=function(e,t,n,r){this.linearA.SetV(e),this.angularA=t,this.linearB.SetV(n),this.angularB=r},b2Jacobian.prototype.Compute=function(e,t,n,r){return this.linearA.x*e.x+this.linearA.y*e.y+this.angularA*t+(this.linearB.x*n.x+this.linearB.y*n.y)+this.angularB*r},b2Jacobian.prototype.linearA=new b2Vec2,b2Jacobian.prototype.angularA=null,b2Jacobian.prototype.linearB=new b2Vec2,b2Jacobian.prototype.angularB=null;var b2Bound=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Bound.prototype.__constructor=function(){},b2Bound.prototype.__varz=function(){},b2Bound.prototype.IsLower=function(){return(this.value&1)==0},b2Bound.prototype.IsUpper=function(){return(this.value&1)==1},b2Bound.prototype.Swap=function(e){var t=this.value,n=this.proxy,r=this.stabbingCount;this.value=e.value,this.proxy=e.proxy,this.stabbingCount=e.stabbingCount,e.value=t,e.proxy=n,e.stabbingCount=r},b2Bound.prototype.value=0,b2Bound.prototype.proxy=null,b2Bound.prototype.stabbingCount=0;var b2SimplexVertex=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SimplexVertex.prototype.__constructor=function(){},b2SimplexVertex.prototype.__varz=function(){},b2SimplexVertex.prototype.Set=function(e){this.wA.SetV(e.wA),this.wB.SetV(e.wB),this.w.SetV(e.w),this.a=e.a,this.indexA=e.indexA,this.indexB=e.indexB},b2SimplexVertex.prototype.wA=null,b2SimplexVertex.prototype.wB=null,b2SimplexVertex.prototype.w=null,b2SimplexVertex.prototype.a=null,b2SimplexVertex.prototype.indexA=0,b2SimplexVertex.prototype.indexB=0;var b2Mat22=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Mat22.prototype.__constructor=function(){this.col1.x=this.col2.y=1},b2Mat22.prototype.__varz=function(){this.col1=new b2Vec2,this.col2=new b2Vec2},b2Mat22.FromAngle=function(e){var t=new b2Mat22;return t.Set(e),t},b2Mat22.FromVV=function(e,t){var n=new b2Mat22;return n.SetVV(e,t),n},b2Mat22.prototype.Set=function(e){var t=Math.cos(e);e=Math.sin(e),this.col1.x=t,this.col2.x=-e,this.col1.y=e,this.col2.y=t},b2Mat22.prototype.SetVV=function(e,t){this.col1.SetV(e),this.col2.SetV(t)},b2Mat22.prototype.Copy=function(){var e=new b2Mat22;return e.SetM(this),e},b2Mat22.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2)},b2Mat22.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y},b2Mat22.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},b2Mat22.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},b2Mat22.prototype.GetInverse=function(e){var t=this.col1.x,n=this.col2.x,r=this.col1.y,i=this.col2.y,s=t*i-n*r;return s!=0&&(s=1/s),e.col1.x=s*i,e.col2.x=-s*n,e.col1.y=-s*r,e.col2.y=s*t,e},b2Mat22.prototype.Solve=function(e,t,n){var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},b2Mat22.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},b2Mat22.prototype.col1=new b2Vec2,b2Mat22.prototype.col2=new b2Vec2;var b2SimplexCache=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SimplexCache.prototype.__constructor=function(){},b2SimplexCache.prototype.__varz=function(){this.indexA=Array(3),this.indexB=Array(3)},b2SimplexCache.prototype.metric=null,b2SimplexCache.prototype.count=0,b2SimplexCache.prototype.indexA=Array(3),b2SimplexCache.prototype.indexB=Array(3);var b2Shape=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Shape.prototype.__constructor=function(){this.m_type=b2Shape.e_unknownShape,this.m_radius=b2Settings.b2_linearSlop},b2Shape.prototype.__varz=function(){},b2Shape.TestOverlap=function(e,t,n,r){var i=new b2DistanceInput;return i.proxyA=new b2DistanceProxy,i.proxyA.Set(e),i.proxyB=new b2DistanceProxy,i.proxyB.Set(n),i.transformA=t,i.transformB=r,i.useRadii=!0,e=new b2SimplexCache,e.count=0,t=new b2DistanceOutput,b2Distance.Distance(t,e,i),t.distance<10*Number.MIN_VALUE},b2Shape.e_hitCollide=1,b2Shape.e_missCollide=0,b2Shape.e_startsInsideCollide=-1,b2Shape.e_unknownShape=-1,b2Shape.e_circleShape=0,b2Shape.e_polygonShape=1,b2Shape.e_edgeShape=2,b2Shape.e_shapeTypeCount=3,b2Shape.prototype.Copy=function(){return null},b2Shape.prototype.Set=function(e){this.m_radius=e.m_radius},b2Shape.prototype.GetType=function(){return this.m_type},b2Shape.prototype.TestPoint=function(){return!1},b2Shape.prototype.RayCast=function(){return!1},b2Shape.prototype.ComputeAABB=function(){},b2Shape.prototype.ComputeMass=function(){},b2Shape.prototype.ComputeSubmergedArea=function(){return 0},b2Shape.prototype.m_type=0,b2Shape.prototype.m_radius=null;var b2Segment=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Segment.prototype.__constructor=function(){},b2Segment.prototype.__varz=function(){this.p1=new b2Vec2,this.p2=new b2Vec2},b2Segment.prototype.TestSegment=function(e,t,n,r){var i=n.p1,s=n.p2.x-i.x,o=n.p2.y-i.y;n=this.p2.y-this.p1.y;var u=-(this.p2.x-this.p1.x),a=100*Number.MIN_VALUE,f=-(s*n+o*u);if(f>a){var l=i.x-this.p1.x,c=i.y-this.p1.y;i=l*n+c*u;if(0<=i&&i<=r*f){r=-s*c+o*l;if(-a*f<=r&&r<=f*(1+a))return i/=f,r=Math.sqrt(n*n+u*u),n/=r,u/=r,e[0]=i,t.Set(n,u),!0}}return!1},b2Segment.prototype.Extend=function(e){this.ExtendForward(e),this.ExtendBackward(e)},b2Segment.prototype.ExtendForward=function(e){var t=this.p2.x-this.p1.x,n=this.p2.y-this.p1.y;e=Math.min(t>0?(e.upperBound.x-this.p1.x)/t:t<0?(e.lowerBound.x-this.p1.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p1.y)/n:n<0?(e.lowerBound.y-this.p1.y)/n:Number.POSITIVE_INFINITY),this.p2.x=this.p1.x+t*e,this.p2.y=this.p1.y+n*e},b2Segment.prototype.ExtendBackward=function(e){var t=-this.p2.x+this.p1.x,n=-this.p2.y+this.p1.y;e=Math.min(t>0?(e.upperBound.x-this.p2.x)/t:t<0?(e.lowerBound.x-this.p2.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p2.y)/n:n<0?(e.lowerBound.y-this.p2.y)/n:Number.POSITIVE_INFINITY),this.p1.x=this.p2.x+t*e,this.p1.y=this.p2.y+n*e},b2Segment.prototype.p1=new b2Vec2,b2Segment.prototype.p2=new b2Vec2;var b2ContactRegister=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactRegister.prototype.__constructor=function(){},b2ContactRegister.prototype.__varz=function(){},b2ContactRegister.prototype.createFcn=null,b2ContactRegister.prototype.destroyFcn=null,b2ContactRegister.prototype.primary=null,b2ContactRegister.prototype.pool=null,b2ContactRegister.prototype.poolCount=0;var b2DebugDraw=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DebugDraw.prototype.__constructor=function(){this.m_drawFlags=0},b2DebugDraw.prototype.__varz=function(){},b2DebugDraw.e_shapeBit=1,b2DebugDraw.e_jointBit=2,b2DebugDraw.e_aabbBit=4,b2DebugDraw.e_pairBit=8,b2DebugDraw.e_centerOfMassBit=16,b2DebugDraw.e_controllerBit=32,b2DebugDraw.prototype.SetFlags=function(e){this.m_drawFlags=e},b2DebugDraw.prototype.GetFlags=function(){return this.m_drawFlags},b2DebugDraw.prototype.AppendFlags=function(e){this.m_drawFlags|=e},b2DebugDraw.prototype.ClearFlags=function(e){this.m_drawFlags&=~e},b2DebugDraw.prototype.SetSprite=function(e){this.m_sprite=e},b2DebugDraw.prototype.GetSprite=function(){return this.m_sprite},b2DebugDraw.prototype.SetDrawScale=function(e){this.m_drawScale=e},b2DebugDraw.prototype.GetDrawScale=function(){return this.m_drawScale},b2DebugDraw.prototype.SetLineThickness=function(e){this.m_lineThickness=e},b2DebugDraw.prototype.GetLineThickness=function(){return this.m_lineThickness},b2DebugDraw.prototype.SetAlpha=function(e){this.m_alpha=e},b2DebugDraw.prototype.GetAlpha=function(){return this.m_alpha},b2DebugDraw.prototype.SetFillAlpha=function(e){this.m_fillAlpha=e},b2DebugDraw.prototype.GetFillAlpha=function(){return this.m_fillAlpha},b2DebugDraw.prototype.SetXFormScale=function(e){this.m_xformScale=e},b2DebugDraw.prototype.GetXFormScale=function(){return this.m_xformScale},b2DebugDraw.prototype.Clear=function(){this.m_sprite.clearRect(0,0,this.m_sprite.canvas.width,this.m_sprite.canvas.height)},b2DebugDraw.prototype.Y=function(e){return this.m_sprite.canvas.height-e},b2DebugDraw.prototype.ToWorldPoint=function(e){return new b2Vec2(e.x/this.m_drawScale,this.Y(e.y)/this.m_drawScale)},b2DebugDraw.prototype.ColorStyle=function(e,t){return"rgba("+e.r+", "+e.g+", "+e.b+", "+t+")"},b2DebugDraw.prototype.DrawPolygon=function(e,t,n){this.m_sprite.graphics.lineStyle(this.m_lineThickness,n.color,this.m_alpha),this.m_sprite.graphics.moveTo(e[0].x*this.m_drawScale,e[0].y*this.m_drawScale);for(n=1;n<t;n++)this.m_sprite.graphics.lineTo(e[n].x*this.m_drawScale,e[n].y*this.m_drawScale);this.m_sprite.graphics.lineTo(e[0].x*this.m_drawScale,e[0].y*this.m_drawScale)},b2DebugDraw.prototype.DrawSolidPolygon=function(e,t,n){this.m_sprite.strokeSyle=this.ColorStyle(n,this.m_alpha),this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.fillStyle=this.ColorStyle(n,this.m_fillAlpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(e[0].x*this.m_drawScale,this.Y(e[0].y*this.m_drawScale));for(n=1;n<t;n++)this.m_sprite.lineTo(e[n].x*this.m_drawScale,this.Y(e[n].y*this.m_drawScale));this.m_sprite.lineTo(e[0].x*this.m_drawScale,this.Y(e[0].y*this.m_drawScale)),this.m_sprite.fill(),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawCircle=function(e,t,n){this.m_sprite.graphics.lineStyle(this.m_lineThickness,n.color,this.m_alpha),this.m_sprite.graphics.drawCircle(e.x*this.m_drawScale,e.y*this.m_drawScale,t*this.m_drawScale)},b2DebugDraw.prototype.DrawSolidCircle=function(e,t,n,r){this.m_sprite.strokeSyle=this.ColorStyle(r,this.m_alpha),this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.fillStyle=this.ColorStyle(r,this.m_fillAlpha),this.m_sprite.beginPath(),this.m_sprite.arc(e.x*this.m_drawScale,this.Y(e.y*this.m_drawScale),t*this.m_drawScale,0,Math.PI*2,!0),this.m_sprite.fill(),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawSegment=function(e,t,n){this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.strokeSyle=this.ColorStyle(n,this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(e.x*this.m_drawScale,this.Y(e.y*this.m_drawScale)),this.m_sprite.lineTo(t.x*this.m_drawScale,this.Y(t.y*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawTransform=function(e){this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.strokeSyle=this.ColorStyle(new b2Color(255,0,0),this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(e.position.x*this.m_drawScale,this.Y(e.position.y*this.m_drawScale)),this.m_sprite.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*this.m_drawScale,this.Y((e.position.y+this.m_xformScale*e.R.col1.y)*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath(),this.m_sprite.strokeSyle=this.ColorStyle(new b2Color(0,255,0),this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(e.position.x*this.m_drawScale,this.Y(e.position.y*this.m_drawScale)),this.m_sprite.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*this.m_drawScale,this.Y((e.position.y+this.m_xformScale*e.R.col2.y)*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.m_drawFlags=0,b2DebugDraw.prototype.m_sprite=null,b2DebugDraw.prototype.m_drawScale=1,b2DebugDraw.prototype.m_lineThickness=1,b2DebugDraw.prototype.m_alpha=1,b2DebugDraw.prototype.m_fillAlpha=1,b2DebugDraw.prototype.m_xformScale=1;var b2Sweep=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Sweep.prototype.__constructor=function(){},b2Sweep.prototype.__varz=function(){this.localCenter=new b2Vec2,this.c0=new b2Vec2,this.c=new b2Vec2},b2Sweep.prototype.Set=function(e){this.localCenter.SetV(e.localCenter),this.c0.SetV(e.c0),this.c.SetV(e.c),this.a0=e.a0,this.a=e.a,this.t0=e.t0},b2Sweep.prototype.Copy=function(){var e=new b2Sweep;return e.localCenter.SetV(this.localCenter),e.c0.SetV(this.c0),e.c.SetV(this.c),e.a0=this.a0,e.a=this.a,e.t0=this.t0,e},b2Sweep.prototype.GetTransform=function(e,t){e.position.x=(1-t)*this.c0.x+t*this.c.x,e.position.y=(1-t)*this.c0.y+t*this.c.y,e.R.Set((1-t)*this.a0+t*this.a);var n=e.R;e.position.x-=n.col1.x*this.localCenter.x+n.col2.x*this.localCenter.y,e.position.y-=n.col1.y*this.localCenter.x+n.col2.y*this.localCenter.y},b2Sweep.prototype.Advance=function(e){if(this.t0<e&&1-this.t0>Number.MIN_VALUE){var t=(e-this.t0)/(1-this.t0);this.c0.x=(1-t)*this.c0.x+t*this.c.x,this.c0.y=(1-t)*this.c0.y+t*this.c.y,this.a0=(1-t)*this.a0+t*this.a,this.t0=e}},b2Sweep.prototype.localCenter=new b2Vec2,b2Sweep.prototype.c0=new b2Vec2,b2Sweep.prototype.c=new b2Vec2,b2Sweep.prototype.a0=null,b2Sweep.prototype.a=null,b2Sweep.prototype.t0=null;var b2DistanceOutput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceOutput.prototype.__constructor=function(){},b2DistanceOutput.prototype.__varz=function(){this.pointA=new b2Vec2,this.pointB=new b2Vec2},b2DistanceOutput.prototype.pointA=new b2Vec2,b2DistanceOutput.prototype.pointB=new b2Vec2,b2DistanceOutput.prototype.distance=null,b2DistanceOutput.prototype.iterations=0;var b2Mat33=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Mat33.prototype.__constructor=function(e,t,n){!e&&!t&&!n?(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero()):(this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n))},b2Mat33.prototype.__varz=function(){this.col1=new b2Vec3,this.col2=new b2Vec3,this.col3=new b2Vec3},b2Mat33.prototype.SetVVV=function(e,t,n){this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n)},b2Mat33.prototype.Copy=function(){return new b2Mat33(this.col1,this.col2,this.col3)},b2Mat33.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2),this.col3.SetV(e.col3)},b2Mat33.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col1.z+=e.col1.z,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y,this.col2.z+=e.col2.z,this.col3.x+=e.col3.x,this.col3.y+=e.col3.y,this.col3.z+=e.col3.z},b2Mat33.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},b2Mat33.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},b2Mat33.prototype.Solve22=function(e,t,n){var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},b2Mat33.prototype.Solve33=function(e,t,n,r){var i=this.col1.x,s=this.col1.y,o=this.col1.z,u=this.col2.x,a=this.col2.y,f=this.col2.z,l=this.col3.x,c=this.col3.y,h=this.col3.z,p=i*(a*h-f*c)+s*(f*l-u*h)+o*(u*c-a*l);return p!=0&&(p=1/p),e.x=p*(t*(a*h-f*c)+n*(f*l-u*h)+r*(u*c-a*l)),e.y=p*(i*(n*h-r*c)+s*(r*l-t*h)+o*(t*c-n*l)),e.z=p*(i*(a*r-f*n)+s*(f*t-u*r)+o*(u*n-a*t)),e},b2Mat33.prototype.col1=new b2Vec3,b2Mat33.prototype.col2=new b2Vec3,b2Mat33.prototype.col3=new b2Vec3;var b2PositionSolverManifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2PositionSolverManifold.prototype.__constructor=function(){this.m_normal=new b2Vec2,this.m_separations=Array(b2Settings.b2_maxManifoldPoints),this.m_points=Array(b2Settings.b2_maxManifoldPoints);for(var e=0;e<b2Settings.b2_maxManifoldPoints;e++)this.m_points[e]=new b2Vec2},b2PositionSolverManifold.prototype.__varz=function(){},b2PositionSolverManifold.circlePointA=new b2Vec2,b2PositionSolverManifold.circlePointB=new b2Vec2,b2PositionSolverManifold.prototype.Initialize=function(e){b2Settings.b2Assert(e.pointCount>0);var t=0,n,r,i,s,o;switch(e.type){case b2Manifold.e_circles:i=e.bodyA.m_xf.R,r=e.localPoint,t=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),n=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyB.m_xf.R,r=e.points[0].localPoint,s=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),i=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),r=s-t,o=i-n;var u=r*r+o*o;u>Number.MIN_VALUE*Number.MIN_VALUE?(u=Math.sqrt(u),this.m_normal.x=r/u,this.m_normal.y=o/u):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(t+s),this.m_points[0].y=.5*(n+i),this.m_separations[0]=r*this.m_normal.x+o*this.m_normal.y-e.radius;break;case b2Manifold.e_faceA:i=e.bodyA.m_xf.R,r=e.localPlaneNormal,this.m_normal.x=i.col1.x*r.x+i.col2.x*r.y,this.m_normal.y=i.col1.y*r.x+i.col2.y*r.y,i=e.bodyA.m_xf.R,r=e.localPoint,s=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),o=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyB.m_xf.R;for(t=0;t<e.pointCount;++t)r=e.points[t].localPoint,n=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),r=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),this.m_separations[t]=(n-s)*this.m_normal.x+(r-o)*this.m_normal.y-e.radius,this.m_points[t].x=n,this.m_points[t].y=r;break;case b2Manifold.e_faceB:i=e.bodyB.m_xf.R,r=e.localPlaneNormal,this.m_normal.x=i.col1.x*r.x+i.col2.x*r.y,this.m_normal.y=i.col1.y*r.x+i.col2.y*r.y,i=e.bodyB.m_xf.R,r=e.localPoint,s=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),o=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyA.m_xf.R;for(t=0;t<e.pointCount;++t)r=e.points[t].localPoint,n=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),r=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),this.m_separations[t]=(n-s)*this.m_normal.x+(r-o)*this.m_normal.y-e.radius,this.m_points[t].Set(n,r);this.m_normal.x*=-1,this.m_normal.y*=-1}},b2PositionSolverManifold.prototype.m_normal=null,b2PositionSolverManifold.prototype.m_points=null,b2PositionSolverManifold.prototype.m_separations=null;var b2OBB=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2OBB.prototype.__constructor=function(){},b2OBB.prototype.__varz=function(){this.R=new b2Mat22,this.center=new b2Vec2,this.extents=new b2Vec2},b2OBB.prototype.R=new b2Mat22,b2OBB.prototype.center=new b2Vec2,b2OBB.prototype.extents=new b2Vec2;var b2Pair=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Pair.prototype.__constructor=function(){},b2Pair.prototype.__varz=function(){},b2Pair.b2_nullProxy=b2Settings.USHRT_MAX,b2Pair.e_pairBuffered=1,b2Pair.e_pairRemoved=2,b2Pair.e_pairFinal=4,b2Pair.prototype.SetBuffered=function(){this.status|=b2Pair.e_pairBuffered},b2Pair.prototype.ClearBuffered=function(){this.status&=~b2Pair.e_pairBuffered},b2Pair.prototype.IsBuffered=function(){return(this.status&b2Pair.e_pairBuffered)==b2Pair.e_pairBuffered},b2Pair.prototype.SetRemoved=function(){this.status|=b2Pair.e_pairRemoved},b2Pair.prototype.ClearRemoved=function(){this.status&=~b2Pair.e_pairRemoved},b2Pair.prototype.IsRemoved=function(){return(this.status&b2Pair.e_pairRemoved)==b2Pair.e_pairRemoved},b2Pair.prototype.SetFinal=function(){this.status|=b2Pair.e_pairFinal},b2Pair.prototype.IsFinal=function(){return(this.status&b2Pair.e_pairFinal)==b2Pair.e_pairFinal},b2Pair.prototype.userData=null,b2Pair.prototype.proxy1=null,b2Pair.prototype.proxy2=null,b2Pair.prototype.next=null,b2Pair.prototype.status=0;var b2FixtureDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2FixtureDef.prototype.__constructor=function(){this.userData=this.shape=null,this.friction=.2,this.density=this.restitution=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},b2FixtureDef.prototype.__varz=function(){this.filter=new b2FilterData},b2FixtureDef.prototype.shape=null,b2FixtureDef.prototype.userData=null,b2FixtureDef.prototype.friction=null,b2FixtureDef.prototype.restitution=null,b2FixtureDef.prototype.density=null,b2FixtureDef.prototype.isSensor=null,b2FixtureDef.prototype.filter=new b2FilterData;var b2ContactID=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactID.prototype.__constructor=function(){this.features._m_id=this},b2ContactID.prototype.__varz=function(){this.features=new Features},b2ContactID.prototype.Set=function(e){key=e._key},b2ContactID.prototype.Copy=function(){var e=new b2ContactID;return e.key=key,e},b2ContactID.prototype.__defineSetter__("key",function(){return this._key}),b2ContactID.prototype.__defineSetter__("key",function(e){this._key=e,this.features._referenceEdge=this._key&255,this.features._incidentEdge=(this._key&65280)>>8&255,this.features._incidentVertex=(this._key&16711680)>>16&255,this.features._flip=(this._key&4278190080)>>24&255}),b2ContactID.prototype._key=0,b2ContactID.prototype.features=new Features;var b2Transform=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Transform.prototype.__constructor=function(e,t){e&&(this.position.SetV(e),this.R.SetM(t))},b2Transform.prototype.__varz=function(){this.position=new b2Vec2,this.R=new b2Mat22},b2Transform.prototype.Initialize=function(e,t){this.position.SetV(e),this.R.SetM(t)},b2Transform.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},b2Transform.prototype.Set=function(e){this.position.SetV(e.position),this.R.SetM(e.R)},b2Transform.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},b2Transform.prototype.position=new b2Vec2,b2Transform.prototype.R=new b2Mat22;var b2EdgeShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2EdgeShape.prototype,b2Shape.prototype),b2EdgeShape.prototype._super=b2Shape.prototype,b2EdgeShape.prototype.__constructor=function(e,t){this._super.__constructor.apply(this,[]),this.m_type=b2Shape.e_edgeShape,this.m_nextEdge=this.m_prevEdge=null,this.m_v1=e,this.m_v2=t,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-b2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-b2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-b2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-b2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},b2EdgeShape.prototype.__varz=function(){this.s_supportVec=new b2Vec2,this.m_v1=new b2Vec2,this.m_v2=new b2Vec2,this.m_coreV1=new b2Vec2,this.m_coreV2=new b2Vec2,this.m_normal=new b2Vec2,this.m_direction=new b2Vec2,this.m_cornerDir1=new b2Vec2,this.m_cornerDir2=new b2Vec2},b2EdgeShape.prototype.SetPrevEdge=function(e,t,n,r){this.m_prevEdge=e,this.m_coreV1=t,this.m_cornerDir1=n,this.m_cornerConvex1=r},b2EdgeShape.prototype.SetNextEdge=function(e,t,n,r){this.m_nextEdge=e,this.m_coreV2=t,this.m_cornerDir2=n,this.m_cornerConvex2=r},b2EdgeShape.prototype.TestPoint=function(){return!1},b2EdgeShape.prototype.RayCast=function(e,t,n){var r,i=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y;r=n.R;var o=n.position.x+(r.col1.x*this.m_v1.x+r.col2.x*this.m_v1.y),u=n.position.y+(r.col1.y*this.m_v1.x+r.col2.y*this.m_v1.y),a=n.position.y+(r.col1.y*this.m_v2.x+r.col2.y*this.m_v2.y)-u;n=-(n.position.x+(r.col1.x*this.m_v2.x+r.col2.x*this.m_v2.y)-o),r=100*Number.MIN_VALUE;var f=-(i*a+s*n);if(f>r){o=t.p1.x-o;var l=t.p1.y-u;u=o*a+l*n;if(0<=u&&u<=t.maxFraction*f){t=-i*l+s*o;if(-r*f<=t&&t<=f*(1+r))return u/=f,e.fraction=u,t=Math.sqrt(a*a+n*n),e.normal.x=a/t,e.normal.y=n/t,!0}}return!1},b2EdgeShape.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y),i=t.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y),s=t.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y);n=t.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y),r<s?(e.lowerBound.x=r,e.upperBound.x=s):(e.lowerBound.x=s,e.upperBound.x=r),i<n?(e.lowerBound.y=i,e.upperBound.y=n):(e.lowerBound.y=n,e.upperBound.y=i)},b2EdgeShape.prototype.ComputeMass=function(e){e.mass=0,e.center.SetV(this.m_v1),e.I=0},b2EdgeShape.prototype.ComputeSubmergedArea=function(e,t,n,r){var i=new b2Vec2(e.x*t,e.y*t),s=b2Math.MulX(n,this.m_v1);n=b2Math.MulX(n,this.m_v2);var o=b2Math.Dot(e,s)-t;e=b2Math.Dot(e,n)-t;if(o>0){if(e>0)return 0;s.x=-e/(o-e)*s.x+o/(o-e)*n.x,s.y=-e/(o-e)*s.y+o/(o-e)*n.y}else e>0&&(n.x=-e/(o-e)*s.x+o/(o-e)*n.x,n.y=-e/(o-e)*s.y+o/(o-e)*n.y);return r.x=(i.x+s.x+n.x)/3,r.y=(i.y+s.y+n.y)/3,.5*((s.x-i.x)*(n.y-i.y)-(s.y-i.y)*(n.x-i.x))},b2EdgeShape.prototype.GetLength=function(){return this.m_length},b2EdgeShape.prototype.GetVertex1=function(){return this.m_v1},b2EdgeShape.prototype.GetVertex2=function(){return this.m_v2},b2EdgeShape.prototype.GetCoreVertex1=function(){return this.m_coreV1},b2EdgeShape.prototype.GetCoreVertex2=function(){return this.m_coreV2},b2EdgeShape.prototype.GetNormalVector=function(){return this.m_normal},b2EdgeShape.prototype.GetDirectionVector=function(){return this.m_direction},b2EdgeShape.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},b2EdgeShape.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},b2EdgeShape.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},b2EdgeShape.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},b2EdgeShape.prototype.GetFirstVertex=function(e){var t=e.R;return new b2Vec2(e.position.x+(t.col1.x*this.m_coreV1.x+t.col2.x*this.m_coreV1.y),e.position.y+(t.col1.y*this.m_coreV1.x+t.col2.y*this.m_coreV1.y))},b2EdgeShape.prototype.GetNextEdge=function(){return this.m_nextEdge},b2EdgeShape.prototype.GetPrevEdge=function(){return this.m_prevEdge},b2EdgeShape.prototype.Support=function(e,t,n){var r=e.R,i=e.position.x+(r.col1.x*this.m_coreV1.x+r.col2.x*this.m_coreV1.y),s=e.position.y+(r.col1.y*this.m_coreV1.x+r.col2.y*this.m_coreV1.y),o=e.position.x+(r.col1.x*this.m_coreV2.x+r.col2.x*this.m_coreV2.y);return e=e.position.y+(r.col1.y*this.m_coreV2.x+r.col2.y*this.m_coreV2.y),i*t+s*n>o*t+e*n?(this.s_supportVec.x=i,this.s_supportVec.y=s):(this.s_supportVec.x=o,this.s_supportVec.y=e),this.s_supportVec},b2EdgeShape.prototype.s_supportVec=new b2Vec2,b2EdgeShape.prototype.m_v1=new b2Vec2,b2EdgeShape.prototype.m_v2=new b2Vec2,b2EdgeShape.prototype.m_coreV1=new b2Vec2,b2EdgeShape.prototype.m_coreV2=new b2Vec2,b2EdgeShape.prototype.m_length=null,b2EdgeShape.prototype.m_normal=new b2Vec2,b2EdgeShape.prototype.m_direction=new b2Vec2,b2EdgeShape.prototype.m_cornerDir1=new b2Vec2,b2EdgeShape.prototype.m_cornerDir2=new b2Vec2,b2EdgeShape.prototype.m_cornerConvex1=null,b2EdgeShape.prototype.m_cornerConvex2=null,b2EdgeShape.prototype.m_nextEdge=null,b2EdgeShape.prototype.m_prevEdge=null;var b2BuoyancyController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2BuoyancyController.prototype,b2Controller.prototype),b2BuoyancyController.prototype._super=b2Controller.prototype,b2BuoyancyController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2BuoyancyController.prototype.__varz=function(){this.normal=new b2Vec2(0,-1),this.velocity=new b2Vec2(0,0)},b2BuoyancyController.prototype.Step=function(){if(m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var e=m_bodyList;e;e=e.nextBody){var t=e.body;if(t.IsAwake()!=0){for(var n=new b2Vec2,r=new b2Vec2,i=0,s=0,o=t.GetFixtureList();o;o=o.GetNext()){var u=new b2Vec2,a=o.GetShape().ComputeSubmergedArea(this.normal,this.offset,t.GetTransform(),u);i+=a,n.x+=a*u.x,n.y+=a*u.y,s+=a*1,r.x+=a*u.x*1,r.y+=a*u.y*1}n.x/=i,n.y/=i,r.x/=s,r.y/=s,i<Number.MIN_VALUE||(s=this.gravity.GetNegative(),s.Multiply(this.density*i),t.ApplyForce(s,r),r=t.GetLinearVelocityFromWorldPoint(n),r.Subtract(this.velocity),r.Multiply(-this.linearDrag*i),t.ApplyForce(r,n),t.ApplyTorque(-t.GetInertia()/t.GetMass()*i*t.GetAngularVelocity()*this.angularDrag))}}}},b2BuoyancyController.prototype.Draw=function(e){var t=new b2Vec2,n=new b2Vec2;t.x=this.normal.x*this.offset+this.normal.y*1e3,t.y=this.normal.y*this.offset-this.normal.x*1e3,n.x=this.normal.x*this.offset-this.normal.y*1e3,n.y=this.normal.y*this.offset+this.normal.x*1e3;var r=new b2Color(0,0,1);e.DrawSegment(t,n,r)},b2BuoyancyController.prototype.normal=new b2Vec2(0,-1),b2BuoyancyController.prototype.offset=0,b2BuoyancyController.prototype.density=0,b2BuoyancyController.prototype.velocity=new b2Vec2(0,0),b2BuoyancyController.prototype.linearDrag=2,b2BuoyancyController.prototype.angularDrag=1,b2BuoyancyController.prototype.useDensity=!1,b2BuoyancyController.prototype.useWorldGravity=!0,b2BuoyancyController.prototype.gravity=null;var b2Body=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Body.prototype.__constructor=function(e,t){this.m_flags=0,e.bullet&&(this.m_flags|=b2Body.e_bulletFlag),e.fixedRotation&&(this.m_flags|=b2Body.e_fixedRotationFlag),e.allowSleep&&(this.m_flags|=b2Body.e_allowSleepFlag),e.awake&&(this.m_flags|=b2Body.e_awakeFlag),e.active&&(this.m_flags|=b2Body.e_activeFlag),this.m_world=t,this.m_xf.position.SetV(e.position),this.m_xf.R.Set(e.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=e.angle;var n=this.m_xf.R,r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_contactList=this.m_controllerList=this.m_jointList=null,this.m_controllerCount=0,this.m_next=this.m_prev=null,this.m_linearVelocity.SetV(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_force.Set(0,0),this.m_sleepTime=this.m_torque=0,this.m_type=e.type,this.m_type==b2Body.b2_dynamicBody?this.m_invMass=this.m_mass=1:this.m_invMass=this.m_mass=0,this.m_invI=this.m_I=0,this.m_inertiaScale=e.inertiaScale,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0},b2Body.prototype.__varz=function(){this.m_xf=new b2Transform,this.m_sweep=new b2Sweep,this.m_linearVelocity=new b2Vec2,this.m_force=new b2Vec2},b2Body.b2_staticBody=0,b2Body.b2_kinematicBody=1,b2Body.b2_dynamicBody=2,b2Body.s_xf1=new b2Transform,b2Body.e_islandFlag=1,b2Body.e_awakeFlag=2,b2Body.e_allowSleepFlag=4,b2Body.e_bulletFlag=8,b2Body.e_fixedRotationFlag=16,b2Body.e_activeFlag=32,b2Body.prototype.connectEdges=function(e,t,n){var r=Math.atan2(t.GetDirectionVector().y,t.GetDirectionVector().x);n=b2Math.MulFV(Math.tan((r-n)*.5),t.GetDirectionVector()),n=b2Math.SubtractVV(n,t.GetNormalVector()),n=b2Math.MulFV(b2Settings.b2_toiSlop,n),n=b2Math.AddVV(n,t.GetVertex1());var i=b2Math.AddVV(e.GetDirectionVector(),t.GetDirectionVector());i.Normalize();var s=b2Math.Dot(e.GetDirectionVector(),t.GetNormalVector())>0;return e.SetNextEdge(t,n,i,s),t.SetPrevEdge(e,n,i,s),r},b2Body.prototype.SynchronizeFixtures=function(){var e=b2Body.s_xf1;e.R.Set(this.m_sweep.a0);var t=e.R,n=this.m_sweep.localCenter;e.position.x=this.m_sweep.c0.x-(t.col1.x*n.x+t.col2.x*n.y),e.position.y=this.m_sweep.c0.y-(t.col1.y*n.x+t.col2.y*n.y),n=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.Synchronize(n,e,this.m_xf)},b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var e=this.m_xf.R,t=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(e.col1.x*t.x+e.col2.x*t.y),this.m_xf.position.y=this.m_sweep.c.y-(e.col1.y*t.x+e.col2.y*t.y)},b2Body.prototype.ShouldCollide=function(e){if(this.m_type!=b2Body.b2_dynamicBody&&e.m_type!=b2Body.b2_dynamicBody)return!1;for(var t=this.m_jointList;t;t=t.next)if(t.other==e&&t.joint.m_collideConnected==0)return!1;return!0},b2Body.prototype.Advance=function(e){this.m_sweep.Advance(e),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},b2Body.prototype.CreateFixture=function(e){if(this.m_world.IsLocked()==1)return null;var t=new b2Fixture;return t.Create(this,this.m_xf,e),this.m_flags&b2Body.e_activeFlag&&t.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf),t.m_next=this.m_fixtureList,this.m_fixtureList=t,++this.m_fixtureCount,t.m_body=this,t.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=b2World.e_newFixture,t},b2Body.prototype.CreateFixture2=function(e,t){var n=new b2FixtureDef;return n.shape=e,n.density=t,this.CreateFixture(n)},b2Body.prototype.DestroyFixture=function(e){if(this.m_world.IsLocked()!=1){for(var t=this.m_fixtureList,n=null;t!=null;){if(t==e){n?n.m_next=e.m_next:this.m_fixtureList=e.m_next;break}n=t,t=t.m_next}for(t=this.m_contactList;t;){n=t.contact,t=t.next;var r=n.GetFixtureA(),i=n.GetFixtureB();(e==r||e==i)&&this.m_world.m_contactManager.Destroy(n)}this.m_flags&b2Body.e_activeFlag&&e.DestroyProxy(this.m_world.m_contactManager.m_broadPhase),e.Destroy(),e.m_body=null,e.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},b2Body.prototype.SetPositionAndAngle=function(e,t){var n;if(this.m_world.IsLocked()!=1){this.m_xf.R.Set(t),this.m_xf.position.SetV(e),n=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=t,r=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(r,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},b2Body.prototype.SetTransform=function(e){this.SetPositionAndAngle(e.position,e.GetAngle())},b2Body.prototype.GetTransform=function(){return this.m_xf},b2Body.prototype.GetPosition=function(){return this.m_xf.position},b2Body.prototype.SetPosition=function(e){this.SetPositionAndAngle(e,this.GetAngle())},b2Body.prototype.GetAngle=function(){return this.m_sweep.a},b2Body.prototype.SetAngle=function(e){this.SetPositionAndAngle(this.GetPosition(),e)},b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c},b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},b2Body.prototype.SetLinearVelocity=function(e){this.m_type!=b2Body.b2_staticBody&&this.m_linearVelocity.SetV(e)},b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},b2Body.prototype.SetAngularVelocity=function(e){this.m_type!=b2Body.b2_staticBody&&(this.m_angularVelocity=e)},b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},b2Body.prototype.GetDefinition=function(){var e=new b2BodyDef;return e.type=this.GetType(),e.allowSleep=(this.m_flags&b2Body.e_allowSleepFlag)==b2Body.e_allowSleepFlag,e.angle=this.GetAngle(),e.angularDamping=this.m_angularDamping,e.angularVelocity=this.m_angularVelocity,e.fixedRotation=(this.m_flags&b2Body.e_fixedRotationFlag)==b2Body.e_fixedRotationFlag,e.bullet=(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag,e.awake=(this.m_flags&b2Body.e_awakeFlag)==b2Body.e_awakeFlag,e.linearDamping=this.m_linearDamping,e.linearVelocity.SetV(this.GetLinearVelocity()),e.position=this.GetPosition(),e.userData=this.GetUserData(),e},b2Body.prototype.ApplyForce=function(e,t){this.m_type==b2Body.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x)},b2Body.prototype.ApplyTorque=function(e){this.m_type==b2Body.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_torque+=e)},b2Body.prototype.ApplyImpulse=function(e,t){this.m_type==b2Body.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x))},b2Body.prototype.Split=function(e){for(var t=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),r=this.GetWorldCenter(),i=this.m_world.CreateBody(this.GetDefinition()),s,o=this.m_fixtureList;o;)if(e(o)){var u=o.m_next;s?s.m_next=u:this.m_fixtureList=u,this.m_fixtureCount--,o.m_next=i.m_fixtureList,i.m_fixtureList=o,i.m_fixtureCount++,o.m_body=i,o=u}else s=o,o=o.m_next;return this.ResetMassData(),i.ResetMassData(),s=this.GetWorldCenter(),e=i.GetWorldCenter(),s=b2Math.AddVV(t,b2Math.CrossFV(n,b2Math.SubtractVV(s,r))),t=b2Math.AddVV(t,b2Math.CrossFV(n,b2Math.SubtractVV(e,r))),this.SetLinearVelocity(s),i.SetLinearVelocity(t),this.SetAngularVelocity(n),i.SetAngularVelocity(n),this.SynchronizeFixtures(),i.SynchronizeFixtures(),i},b2Body.prototype.Merge=function(e){var t;for(t=e.m_fixtureList;t;){var n=t.m_next;e.m_fixtureCount--,t.m_next=this.m_fixtureList,this.m_fixtureList=t,this.m_fixtureCount++,t.m_body=i,t=n}r.m_fixtureCount=0;var r=this,i=e;r.GetWorldCenter(),i.GetWorldCenter(),r.GetLinearVelocity().Copy(),i.GetLinearVelocity().Copy(),r.GetAngularVelocity(),i.GetAngularVelocity(),r.ResetMassData(),this.SynchronizeFixtures()},b2Body.prototype.GetMass=function(){return this.m_mass},b2Body.prototype.GetInertia=function(){return this.m_I},b2Body.prototype.GetMassData=function(e){e.mass=this.m_mass,e.I=this.m_I,e.center.SetV(this.m_sweep.localCenter)},b2Body.prototype.SetMassData=function(e){b2Settings.b2Assert(this.m_world.IsLocked()==0);if(this.m_world.IsLocked()!=1&&this.m_type==b2Body.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&(this.m_flags&b2Body.e_fixedRotationFlag)==0&&(this.m_I=e.I-this.m_mass*(e.center.x*e.center.x+e.center.y*e.center.y),this.m_invI=1/this.m_I);var t=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e.center),this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-t.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-t.x)}},b2Body.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,this.m_sweep.localCenter.SetZero();if(this.m_type!=b2Body.b2_staticBody&&this.m_type!=b2Body.b2_kinematicBody){for(var e=b2Vec2.Make(0,0),t=this.m_fixtureList;t;t=t.m_next)if(t.m_density!=0){var n=t.GetMassData();this.m_mass+=n.mass,e.x+=n.center.x*n.mass,e.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):this.m_invMass=this.m_mass=1,this.m_I>0&&(this.m_flags&b2Body.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(e.x*e.x+e.y*e.y),this.m_I*=this.m_inertiaScale,b2Settings.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0,t=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(e),this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-t.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-t.x)}},b2Body.prototype.GetWorldPoint=function(e){var t=this.m_xf.R;return e=new b2Vec2(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y),e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,e},b2Body.prototype.GetWorldVector=function(e){return b2Math.MulMV(this.m_xf.R,e)},b2Body.prototype.GetLocalPoint=function(e){return b2Math.MulXT(this.m_xf,e)},b2Body.prototype.GetLocalVector=function(e){return b2Math.MulTMV(this.m_xf.R,e)},b2Body.prototype.GetLinearVelocityFromWorldPoint=function(e){return new b2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},b2Body.prototype.GetLinearVelocityFromLocalPoint=function(e){var t=this.m_xf.R;return e=new b2Vec2(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y),e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,new b2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},b2Body.prototype.SetLinearDamping=function(e){this.m_linearDamping=e},b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},b2Body.prototype.SetAngularDamping=function(e){this.m_angularDamping=e},b2Body.prototype.SetType=function(e){if(this.m_type!=e){this.m_type=e,this.ResetMassData(),this.m_type==b2Body.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(e=this.m_contactList;e;e=e.next)e.contact.FlagForFiltering()}},b2Body.prototype.GetType=function(){return this.m_type},b2Body.prototype.SetBullet=function(e){e?this.m_flags|=b2Body.e_bulletFlag:this.m_flags&=~b2Body.e_bulletFlag},b2Body.prototype.IsBullet=function(){return(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag},b2Body.prototype.SetSleepingAllowed=function(e){e?this.m_flags|=b2Body.e_allowSleepFlag:(this.m_flags&=~b2Body.e_allowSleepFlag,this.SetAwake(!0))},b2Body.prototype.SetAwake=function(e){e?(this.m_flags|=b2Body.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~b2Body.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},b2Body.prototype.IsAwake=function(){return(this.m_flags&b2Body.e_awakeFlag)==b2Body.e_awakeFlag},b2Body.prototype.SetFixedRotation=function(e){e?this.m_flags|=b2Body.e_fixedRotationFlag:this.m_flags&=~b2Body.e_fixedRotationFlag,this.ResetMassData()},b2Body.prototype.IsFixedRotation=function(){return(this.m_flags&b2Body.e_fixedRotationFlag)==b2Body.e_fixedRotationFlag},b2Body.prototype.SetActive=function(e){if(e!=this.IsActive()){var t;if(e){this.m_flags|=b2Body.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.CreateProxy(e,this.m_xf)}else{this.m_flags&=~b2Body.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.DestroyProxy(e);for(e=this.m_contactList;e;)t=e,e=e.next,this.m_world.m_contactManager.Destroy(t.contact);this.m_contactList=null}}},b2Body.prototype.IsActive=function(){return(this.m_flags&b2Body.e_activeFlag)==b2Body.e_activeFlag},b2Body.prototype.IsSleepingAllowed=function(){return(this.m_flags&b2Body.e_allowSleepFlag)==b2Body.e_allowSleepFlag},b2Body.prototype.GetFixtureList=function(){return this.m_fixtureList},b2Body.prototype.GetJointList=function(){return this.m_jointList},b2Body.prototype.GetControllerList=function(){return this.m_controllerList},b2Body.prototype.GetContactList=function(){return this.m_contactList},b2Body.prototype.GetNext=function(){return this.m_next},b2Body.prototype.GetUserData=function(){return this.m_userData},b2Body.prototype.SetUserData=function(e){this.m_userData=e},b2Body.prototype.GetWorld=function(){return this.m_world},b2Body.prototype.m_flags=0,b2Body.prototype.m_type=0,b2Body.prototype.m_islandIndex=0,b2Body.prototype.m_xf=new b2Transform,b2Body.prototype.m_sweep=new b2Sweep,b2Body.prototype.m_linearVelocity=new b2Vec2,b2Body.prototype.m_angularVelocity=null,b2Body.prototype.m_force=new b2Vec2,b2Body.prototype.m_torque=null,b2Body.prototype.m_world=null,b2Body.prototype.m_prev=null,b2Body.prototype.m_next=null,b2Body.prototype.m_fixtureList=null,b2Body.prototype.m_fixtureCount=0,b2Body.prototype.m_controllerList=null,b2Body.prototype.m_controllerCount=0,b2Body.prototype.m_jointList=null,b2Body.prototype.m_contactList=null,b2Body.prototype.m_mass=null,b2Body.prototype.m_invMass=null,b2Body.prototype.m_I=null,b2Body.prototype.m_invI=null,b2Body.prototype.m_inertiaScale=null,b2Body.prototype.m_linearDamping=null,b2Body.prototype.m_angularDamping=null,b2Body.prototype.m_sleepTime=null,b2Body.prototype.m_userData=null;var b2ContactImpulse=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactImpulse.prototype.__constructor=function(){},b2ContactImpulse.prototype.__varz=function(){this.normalImpulses=Array(b2Settings.b2_maxManifoldPoints),this.tangentImpulses=Array(b2Settings.b2_maxManifoldPoints)},b2ContactImpulse.prototype.normalImpulses=Array(b2Settings.b2_maxManifoldPoints),b2ContactImpulse.prototype.tangentImpulses=Array(b2Settings.b2_maxManifoldPoints);var b2TensorDampingController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2TensorDampingController.prototype,b2Controller.prototype),b2TensorDampingController.prototype._super=b2Controller.prototype,b2TensorDampingController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2TensorDampingController.prototype.__varz=function(){this.T=new b2Mat22},b2TensorDampingController.prototype.SetAxisAligned=function(e,t){this.T.col1.x=-e,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-t,this.maxTimestep=e>0||t>0?1/Math.max(e,t):0},b2TensorDampingController.prototype.Step=function(e){e=e.dt;if(!(e<=Number.MIN_VALUE)){e>this.maxTimestep&&this.maxTimestep>0&&(e=this.maxTimestep);for(var t=m_bodyList;t;t=t.nextBody){var n=t.body;if(n.IsAwake()){var r=n.GetWorldVector(b2Math.MulMV(this.T,n.GetLocalVector(n.GetLinearVelocity())));n.SetLinearVelocity(new b2Vec2(n.GetLinearVelocity().x+r.x*e,n.GetLinearVelocity().y+r.y*e))}}}},b2TensorDampingController.prototype.T=new b2Mat22,b2TensorDampingController.prototype.maxTimestep=0;var b2ManifoldPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ManifoldPoint.prototype.__constructor=function(){this.Reset()},b2ManifoldPoint.prototype.__varz=function(){this.m_localPoint=new b2Vec2,this.m_id=new b2ContactID},b2ManifoldPoint.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_tangentImpulse=this.m_normalImpulse=0,this.m_id.key=0},b2ManifoldPoint.prototype.Set=function(e){this.m_localPoint.SetV(e.m_localPoint),this.m_normalImpulse=e.m_normalImpulse,this.m_tangentImpulse=e.m_tangentImpulse,this.m_id.Set(e.m_id)},b2ManifoldPoint.prototype.m_localPoint=new b2Vec2,b2ManifoldPoint.prototype.m_normalImpulse=null,b2ManifoldPoint.prototype.m_tangentImpulse=null,b2ManifoldPoint.prototype.m_id=new b2ContactID;var b2PolygonShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolygonShape.prototype,b2Shape.prototype),b2PolygonShape.prototype._super=b2Shape.prototype,b2PolygonShape.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.m_type=b2Shape.e_polygonShape,this.m_centroid=new b2Vec2,this.m_vertices=[],this.m_normals=[]},b2PolygonShape.prototype.__varz=function(){},b2PolygonShape.AsArray=function(e,t){var n=new b2PolygonShape;return n.SetAsArray(e,t),n},b2PolygonShape.AsVector=function(e,t){var n=new b2PolygonShape;return n.SetAsVector(e,t),n},b2PolygonShape.AsBox=function(e,t){var n=new b2PolygonShape;return n.SetAsBox(e,t),n},b2PolygonShape.AsOrientedBox=function(e,t,n,r){var i=new b2PolygonShape;return i.SetAsOrientedBox(e,t,n,r),i},b2PolygonShape.AsEdge=function(e,t){var n=new b2PolygonShape;return n.SetAsEdge(e,t),n},b2PolygonShape.ComputeCentroid=function(e,t){for(var n=new b2Vec2,r=0,i=1/3,s=0;s<t;++s){var o=e[s],u=s+1<t?e[parseInt(s+1)]:e[0],a=.5*((o.x-0)*(u.y-0)-(o.y-0)*(u.x-0));r+=a,n.x+=a*i*(0+o.x+u.x),n.y+=a*i*(0+o.y+u.y)}return n.x*=1/r,n.y*=1/r,n},b2PolygonShape.ComputeOBB=function(e,t,n){var r=0,i=Array(n+1);for(r=0;r<n;++r)i[r]=t[r];i[n]=i[0],t=Number.MAX_VALUE;for(r=1;r<=n;++r){var s=i[parseInt(r-1)],o=i[r].x-s.x,u=i[r].y-s.y,a=Math.sqrt(o*o+u*u);o/=a,u/=a;for(var f=-u,l=o,c=a=Number.MAX_VALUE,h=-Number.MAX_VALUE,p=-Number.MAX_VALUE,d=0;d<n;++d){var v=i[d].x-s.x,m=i[d].y-s.y,g=o*v+u*m;v=f*v+l*m,g<a&&(a=g),v<c&&(c=v),g>h&&(h=g),v>p&&(p=v)}d=(h-a)*(p-c),d<.95*t&&(t=d,e.R.col1.x=o,e.R.col1.y=u,e.R.col2.x=f,e.R.col2.y=l,o=.5*(a+h),u=.5*(c+p),f=e.R,e.center.x=s.x+(f.col1.x*o+f.col2.x*u),e.center.y=s.y+(f.col1.y*o+f.col2.y*u),e.extents.x=.5*(h-a),e.extents.y=.5*(p-c))}},b2PolygonShape.s_mat=new b2Mat22,b2PolygonShape.prototype.Validate=function(){return!1},b2PolygonShape.prototype.Reserve=function(e){for(var t=this.m_vertices.length;t<e;t++)this.m_vertices[t]=new b2Vec2,this.m_normals[t]=new b2Vec2},b2PolygonShape.prototype.Copy=function(){var e=new b2PolygonShape;return e.Set(this),e},b2PolygonShape.prototype.Set=function(e){this._super.Set.apply(this,[e]);if(isInstanceOf(e,b2PolygonShape)){this.m_centroid.SetV(e.m_centroid),this.m_vertexCount=e.m_vertexCount,this.Reserve(this.m_vertexCount);for(var t=0;t<this.m_vertexCount;t++)this.m_vertices[t].SetV(e.m_vertices[t]),this.m_normals[t].SetV(e.m_normals[t])}},b2PolygonShape.prototype.SetAsArray=function(e,t){for(var n=[],r=0,i=null;i=e[r];r++)n.push(i);this.SetAsVector(n,t)},b2PolygonShape.prototype.SetAsVector=function(e,t){typeof t=="undefined"&&(t=e.length),b2Settings.b2Assert(2<=t),this.m_vertexCount=t,this.Reserve(t);var n=0;for(n=0;n<this.m_vertexCount;n++)this.m_vertices[n].SetV(e[n]);for(n=0;n<this.m_vertexCount;++n){var r=b2Math.SubtractVV(this.m_vertices[n+1<this.m_vertexCount?n+1:0],this.m_vertices[n]);b2Settings.b2Assert(r.LengthSquared()>Number.MIN_VALUE),this.m_normals[n].SetV(b2Math.CrossVF(r,1)),this.m_normals[n].Normalize()}this.m_centroid=b2PolygonShape.ComputeCentroid(this.m_vertices,this.m_vertexCount)},b2PolygonShape.prototype.SetAsBox=function(e,t){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},b2PolygonShape.prototype.SetAsOrientedBox=function(e,t,n,r){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=n,e=new b2Transform,e.position=n,e.R.Set(r);for(n=0;n<this.m_vertexCount;++n)this.m_vertices[n]=b2Math.MulX(e,this.m_vertices[n]),this.m_normals[n]=b2Math.MulMV(e.R,this.m_normals[n])},b2PolygonShape.prototype.SetAsEdge=function(e,t){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(e),this.m_vertices[1].SetV(t),this.m_centroid.x=.5*(e.x+t.x),this.m_centroid.y=.5*(e.y+t.y),this.m_normals[0]=b2Math.CrossVF(b2Math.SubtractVV(t,e),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},b2PolygonShape.prototype.TestPoint=function(e,t){var n;n=e.R;for(var r=t.x-e.position.x,i=t.y-e.position.y,s=r*n.col1.x+i*n.col1.y,o=r*n.col2.x+i*n.col2.y,u=0;u<this.m_vertexCount;++u){n=this.m_vertices[u],r=s-n.x,i=o-n.y,n=this.m_normals[u];if(n.x*r+n.y*i>0)return!1}return!0},b2PolygonShape.prototype.RayCast=function(e,t,n){var r=0,i=t.maxFraction,s,o,u,a;s=t.p1.x-n.position.x,o=t.p1.y-n.position.y,u=n.R;var f=s*u.col1.x+o*u.col1.y,l=s*u.col2.x+o*u.col2.y;s=t.p2.x-n.position.x,o=t.p2.y-n.position.y,u=n.R,t=s*u.col1.x+o*u.col1.y-f,u=s*u.col2.x+o*u.col2.y-l;for(var c=-1,h=0;h<this.m_vertexCount;++h){a=this.m_vertices[h],s=a.x-f,o=a.y-l,a=this.m_normals[h],s=a.x*s+a.y*o,o=a.x*t+a.y*u;if(o==0){if(s<0)return!1}else o<0&&s<r*o?(r=s/o,c=h):o>0&&s<i*o&&(i=s/o);if(i<r-Number.MIN_VALUE)return!1}return c>=0?(e.fraction=r,u=n.R,a=this.m_normals[c],e.normal.x=u.col1.x*a.x+u.col2.x*a.y,e.normal.y=u.col1.y*a.x+u.col2.y*a.y,!0):!1},b2PolygonShape.prototype.ComputeAABB=function(e,t){for(var n=t.R,r=this.m_vertices[0],i=t.position.x+(n.col1.x*r.x+n.col2.x*r.y),s=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),o=i,u=s,a=1;a<this.m_vertexCount;++a){r=this.m_vertices[a];var f=t.position.x+(n.col1.x*r.x+n.col2.x*r.y);r=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),i=i<f?i:f,s=s<r?s:r,o=o>f?o:f,u=u>r?u:r}e.lowerBound.x=i-this.m_radius,e.lowerBound.y=s-this.m_radius,e.upperBound.x=o+this.m_radius,e.upperBound.y=u+this.m_radius},b2PolygonShape.prototype.ComputeMass=function(e,t){if(this.m_vertexCount==2)e.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),e.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),e.mass=0,e.I=0;else{for(var n=0,r=0,i=0,s=0,o=1/3,u=0;u<this.m_vertexCount;++u){var a=this.m_vertices[u],f=u+1<this.m_vertexCount?this.m_vertices[parseInt(u+1)]:this.m_vertices[0],l=a.x-0,c=a.y-0,h=f.x-0,p=f.y-0,d=l*p-c*h,v=.5*d;i+=v,n+=v*o*(0+a.x+f.x),r+=v*o*(0+a.y+f.y),a=l,c=c,h=h,p=p,s+=d*(o*(.25*(a*a+h*a+h*h)+(0*a+0*h))+0+(o*(.25*(c*c+p*c+p*p)+(0*c+0*p))+0))}e.mass=t*i,n*=1/i,r*=1/i,e.center.Set(n,r),e.I=t*s}},b2PolygonShape.prototype.ComputeSubmergedArea=function(e,t,n,r){var i=b2Math.MulTMV(n.R,e),s=t-b2Math.Dot(e,n.position),o=[],u=0,a=-1;t=-1;var f=!1;for(e=e=0;e<this.m_vertexCount;++e){o[e]=b2Math.Dot(i,this.m_vertices[e])-s;var l=o[e]<-Number.MIN_VALUE;e>0&&(l?f||(a=e-1,u++):f&&(t=e-1,u++)),f=l}switch(u){case 0:return f?(e=new b2MassData,this.ComputeMass(e,1),r.SetV(b2Math.MulX(n,e.center)),e.mass):0;case 1:a==-1?a=this.m_vertexCount-1:t=this.m_vertexCount-1}e=(a+1)%this.m_vertexCount,i=(t+1)%this.m_vertexCount,s=(0-o[a])/(o[e]-o[a]),o=(0-o[t])/(o[i]-o[t]),a=new b2Vec2(this.m_vertices[a].x*(1-s)+this.m_vertices[e].x*s,this.m_vertices[a].y*(1-s)+this.m_vertices[e].y*s),t=new b2Vec2(this.m_vertices[t].x*(1-o)+this.m_vertices[i].x*o,this.m_vertices[t].y*(1-o)+this.m_vertices[i].y*o),o=0,s=new b2Vec2,u=this.m_vertices[e];for(e=e;e!=i;)e=(e+1)%this.m_vertexCount,f=e==i?t:this.m_vertices[e],l=.5*((u.x-a.x)*(f.y-a.y)-(u.y-a.y)*(f.x-a.x)),o+=l,s.x+=l*(a.x+u.x+f.x)/3,s.y+=l*(a.y+u.y+f.y)/3,u=f;return s.Multiply(1/o),r.SetV(b2Math.MulX(n,s)),o},b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount},b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices},b2PolygonShape.prototype.GetNormals=function(){return this.m_normals},b2PolygonShape.prototype.GetSupport=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},b2PolygonShape.prototype.GetSupportVertex=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},b2PolygonShape.prototype.m_centroid=null,b2PolygonShape.prototype.m_vertices=null,b2PolygonShape.prototype.m_normals=null,b2PolygonShape.prototype.m_vertexCount=0;var b2Fixture=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Fixture.prototype.__constructor=function(){this.m_aabb=new b2AABB,this.m_shape=this.m_next=this.m_body=this.m_userData=null,this.m_restitution=this.m_friction=this.m_density=0},b2Fixture.prototype.__varz=function(){this.m_filter=new b2FilterData},b2Fixture.prototype.Create=function(e,t,n){this.m_userData=n.userData,this.m_friction=n.friction,this.m_restitution=n.restitution,this.m_body=e,this.m_next=null,this.m_filter=n.filter.Copy(),this.m_isSensor=n.isSensor,this.m_shape=n.shape.Copy(),this.m_density=n.density},b2Fixture.prototype.Destroy=function(){this.m_shape=null},b2Fixture.prototype.CreateProxy=function(e,t){this.m_shape.ComputeAABB(this.m_aabb,t),this.m_proxy=e.CreateProxy(this.m_aabb,this)},b2Fixture.prototype.DestroyProxy=function(e){this.m_proxy!=null&&(e.DestroyProxy(this.m_proxy),this.m_proxy=null)},b2Fixture.prototype.Synchronize=function(e,t,n){if(this.m_proxy){var r=new b2AABB,i=new b2AABB;this.m_shape.ComputeAABB(r,t),this.m_shape.ComputeAABB(i,n),this.m_aabb.Combine(r,i),t=b2Math.SubtractVV(n.position,t.position),e.MoveProxy(this.m_proxy,this.m_aabb,t)}},b2Fixture.prototype.GetType=function(){return this.m_shape.GetType()},b2Fixture.prototype.GetShape=function(){return this.m_shape},b2Fixture.prototype.SetSensor=function(e){if(this.m_isSensor!=e){this.m_isSensor=e;if(this.m_body!=null)for(e=this.m_body.GetContactList();e;){var t=e.contact,n=t.GetFixtureA(),r=t.GetFixtureB();(n==this||r==this)&&t.SetSensor(n.IsSensor()||r.IsSensor()),e=e.next}}},b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},b2Fixture.prototype.SetFilterData=function(e){this.m_filter=e.Copy();if(!this.m_body)for(e=this.m_body.GetContactList();e;){var t=e.contact,n=t.GetFixtureA(),r=t.GetFixtureB();(n==this||r==this)&&t.FlagForFiltering(),e=e.next}},b2Fixture.prototype.GetFilterData=function(){return this.m_filter.Copy()},b2Fixture.prototype.GetBody=function(){return this.m_body},b2Fixture.prototype.GetNext=function(){return this.m_next},b2Fixture.prototype.GetUserData=function(){return this.m_userData},b2Fixture.prototype.SetUserData=function(e){this.m_userData=e},b2Fixture.prototype.TestPoint=function(e){return this.m_shape.TestPoint(this.m_body.GetTransform(),e)},b2Fixture.prototype.RayCast=function(e,t){return this.m_shape.RayCast(e,t,this.m_body.GetTransform())},b2Fixture.prototype.GetMassData=function(e){return e==null&&(e=new b2MassData),this.m_shape.ComputeMass(e,this.m_density),e},b2Fixture.prototype.SetDensity=function(e){this.m_density=e},b2Fixture.prototype.GetDensity=function(){return this.m_density},b2Fixture.prototype.GetFriction=function(){return this.m_friction},b2Fixture.prototype.SetFriction=function(e){this.m_friction=e},b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},b2Fixture.prototype.SetRestitution=function(e){this.m_restitution=e},b2Fixture.prototype.GetAABB=function(){return this.m_aabb},b2Fixture.prototype.m_massData=null,b2Fixture.prototype.m_aabb=null,b2Fixture.prototype.m_density=null,b2Fixture.prototype.m_next=null,b2Fixture.prototype.m_body=null,b2Fixture.prototype.m_shape=null,b2Fixture.prototype.m_friction=null,b2Fixture.prototype.m_restitution=null,b2Fixture.prototype.m_proxy=null,b2Fixture.prototype.m_filter=new b2FilterData,b2Fixture.prototype.m_isSensor=null,b2Fixture.prototype.m_userData=null;var b2DynamicTreeNode=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreeNode.prototype.__constructor=function(){},b2DynamicTreeNode.prototype.__varz=function(){this.aabb=new b2AABB},b2DynamicTreeNode.prototype.IsLeaf=function(){return this.child1==null},b2DynamicTreeNode.prototype.userData=null,b2DynamicTreeNode.prototype.aabb=new b2AABB,b2DynamicTreeNode.prototype.parent=null,b2DynamicTreeNode.prototype.child1=null,b2DynamicTreeNode.prototype.child2=null;var b2BodyDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BodyDef.prototype.__constructor=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularDamping=this.linearDamping=this.angularVelocity=0,this.awake=this.allowSleep=!0,this.bullet=this.fixedRotation=!1,this.type=b2Body.b2_staticBody,this.active=!0,this.inertiaScale=1},b2BodyDef.prototype.__varz=function(){this.position=new b2Vec2,this.linearVelocity=new b2Vec2},b2BodyDef.prototype.type=0,b2BodyDef.prototype.position=new b2Vec2,b2BodyDef.prototype.angle=null,b2BodyDef.prototype.linearVelocity=new b2Vec2,b2BodyDef.prototype.angularVelocity=null,b2BodyDef.prototype.linearDamping=null,b2BodyDef.prototype.angularDamping=null,b2BodyDef.prototype.allowSleep=null,b2BodyDef.prototype.awake=null,b2BodyDef.prototype.fixedRotation=null,b2BodyDef.prototype.bullet=null,b2BodyDef.prototype.active=null,b2BodyDef.prototype.userData=null,b2BodyDef.prototype.inertiaScale=null;var b2DynamicTreeBroadPhase=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreeBroadPhase.prototype.__constructor=function(){},b2DynamicTreeBroadPhase.prototype.__varz=function(){this.m_tree=new b2DynamicTree,this.m_moveBuffer=[],this.m_pairBuffer=[]},b2DynamicTreeBroadPhase.prototype.BufferMove=function(e){this.m_moveBuffer[this.m_moveBuffer.length]=e},b2DynamicTreeBroadPhase.prototype.UnBufferMove=function(e){this.m_moveBuffer.splice(this.m_moveBuffer.indexOf(e),1)},b2DynamicTreeBroadPhase.prototype.ComparePairs=function(){return 0},b2DynamicTreeBroadPhase.prototype.CreateProxy=function(e,t){var n=this.m_tree.CreateProxy(e,t);return++this.m_proxyCount,this.BufferMove(n),n},b2DynamicTreeBroadPhase.prototype.DestroyProxy=function(e){this.UnBufferMove(e),--this.m_proxyCount,this.m_tree.DestroyProxy(e)},b2DynamicTreeBroadPhase.prototype.MoveProxy=function(e,t,n){this.m_tree.MoveProxy(e,t,n)&&this.BufferMove(e)},b2DynamicTreeBroadPhase.prototype.TestOverlap=function(e,t){var n=this.m_tree.GetFatAABB(e),r=this.m_tree.GetFatAABB(t);return n.TestOverlap(r)},b2DynamicTreeBroadPhase.prototype.GetUserData=function(e){return this.m_tree.GetUserData(e)},b2DynamicTreeBroadPhase.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)},b2DynamicTreeBroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},b2DynamicTreeBroadPhase.prototype.UpdatePairs=function(e){for(var t=this.m_pairCount=0,n=null;n=this.m_moveBuffer[t];t++){var r=this;this.m_tree.Query(function(e){if(e==n)return!0;r.m_pairCount==r.m_pairBuffer.length&&(r.m_pairBuffer[r.m_pairCount]=new b2DynamicTreePair);var t=r.m_pairBuffer[r.m_pairCount];return t.proxyA=e<n?e:n,t.proxyB=e>=n?e:n,++r.m_pairCount,!0},this.m_tree.GetFatAABB(n))}for(t=this.m_moveBuffer.length=0;t<this.m_pairCount;){var i=this.m_pairBuffer[t],s=this.m_tree.GetUserData(i.proxyA),o=this.m_tree.GetUserData(i.proxyB);e(s,o);for(++t;t<this.m_pairCount;){s=this.m_pairBuffer[t];if(s.proxyA!=i.proxyA||s.proxyB!=i.proxyB)break;++t}}},b2DynamicTreeBroadPhase.prototype.Query=function(e,t){this.m_tree.Query(e,t)},b2DynamicTreeBroadPhase.prototype.RayCast=function(e,t){this.m_tree.RayCast(e,t)},b2DynamicTreeBroadPhase.prototype.Validate=function(){},b2DynamicTreeBroadPhase.prototype.Rebalance=function(e){this.m_tree.Rebalance(e)},b2DynamicTreeBroadPhase.prototype.m_tree=new b2DynamicTree,b2DynamicTreeBroadPhase.prototype.m_proxyCount=0,b2DynamicTreeBroadPhase.prototype.m_moveBuffer=[],b2DynamicTreeBroadPhase.prototype.m_pairBuffer=[],b2DynamicTreeBroadPhase.prototype.m_pairCount=0;var b2BroadPhase=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BroadPhase.prototype.__constructor=function(e){var t=0;this.m_pairManager.Initialize(this),this.m_worldAABB=e,this.m_proxyCount=0,this.m_bounds=[];for(t=0;t<2;t++)this.m_bounds[t]=[];t=e.upperBound.y-e.lowerBound.y,this.m_quantizationFactor.x=b2Settings.USHRT_MAX/(e.upperBound.x-e.lowerBound.x),this.m_quantizationFactor.y=b2Settings.USHRT_MAX/t,this.m_timeStamp=1,this.m_queryResultCount=0},b2BroadPhase.prototype.__varz=function(){this.m_pairManager=new b2PairManager,this.m_proxyPool=[],this.m_querySortKeys=[],this.m_queryResults=[],this.m_quantizationFactor=new b2Vec2},b2BroadPhase.BinarySearch=function(e,t,n){var r=0;for(t-=1;r<=t;){var i=Math.round((r+t)/2),s=e[i];if(s.value>n)t=i-1;else{if(!(s.value<n))return parseInt(i);r=i+1}}return parseInt(r)},b2BroadPhase.s_validate=!1,b2BroadPhase.b2_invalid=b2Settings.USHRT_MAX,b2BroadPhase.b2_nullEdge=b2Settings.USHRT_MAX,b2BroadPhase.prototype.ComputeBounds=function(e,t,n){var r=n.lowerBound.x,i=n.lowerBound.y;r=b2Math.Min(r,this.m_worldAABB.upperBound.x),i=b2Math.Min(i,this.m_worldAABB.upperBound.y),r=b2Math.Max(r,this.m_worldAABB.lowerBound.x),i=b2Math.Max(i,this.m_worldAABB.lowerBound.y);var s=n.upperBound.x;n=n.upperBound.y,s=b2Math.Min(s,this.m_worldAABB.upperBound.x),n=b2Math.Min(n,this.m_worldAABB.upperBound.y),s=b2Math.Max(s,this.m_worldAABB.lowerBound.x),n=b2Math.Max(n,this.m_worldAABB.lowerBound.y),e[0]=parseInt(this.m_quantizationFactor.x*(r-this.m_worldAABB.lowerBound.x))&b2Settings.USHRT_MAX-1,t[0]=parseInt(this.m_quantizationFactor.x*(s-this.m_worldAABB.lowerBound.x))%65535|1,e[1]=parseInt(this.m_quantizationFactor.y*(i-this.m_worldAABB.lowerBound.y))&b2Settings.USHRT_MAX-1,t[1]=parseInt(this.m_quantizationFactor.y*(n-this.m_worldAABB.lowerBound.y))%65535|1},b2BroadPhase.prototype.TestOverlapValidate=function(e,t){for(var n=0;n<2;++n){var r=this.m_bounds[n],i=r[e.lowerBounds[n]],s=r[t.upperBounds[n]];if(i.value>s.value)return!1;i=r[e.upperBounds[n]],s=r[t.lowerBounds[n]];if(i.value<s.value)return!1}return!0},b2BroadPhase.prototype.QueryAxis=function(e,t,n,r,i,s,o){n=b2BroadPhase.BinarySearch(i,s,n),r=b2BroadPhase.BinarySearch(i,s,r);for(var u=n;u<r;++u)s=i[u],s.IsLower()&&this.IncrementOverlapCount(s.proxy);if(n>0){u=n-1,s=i[u];for(var a=s.stabbingCount;a;)s=i[u],s.IsLower()&&n<=s.proxy.upperBounds[o]&&(this.IncrementOverlapCount(s.proxy),--a),--u}e[0]=n,t[0]=r},b2BroadPhase.prototype.IncrementOverlapCount=function(e){e.timeStamp<this.m_timeStamp?(e.timeStamp=this.m_timeStamp,e.overlapCount=1):(e.overlapCount=2,this.m_queryResults[this.m_queryResultCount]=e,++this.m_queryResultCount)},b2BroadPhase.prototype.IncrementTimeStamp=function(){if(this.m_timeStamp==b2Settings.USHRT_MAX){for(var e=0;e<this.m_proxyPool.length;++e)this.m_proxyPool[e].timeStamp=0;this.m_timeStamp=1}else++this.m_timeStamp},b2BroadPhase.prototype.InRange=function(e){var t,n,r,i;return t=e.lowerBound.x,n=e.lowerBound.y,t-=this.m_worldAABB.upperBound.x,n-=this.m_worldAABB.upperBound.y,r=this.m_worldAABB.lowerBound.x,i=this.m_worldAABB.lowerBound.y,r-=e.upperBound.x,i-=e.upperBound.y,t=b2Math.Max(t,r),n=b2Math.Max(n,i),b2Math.Max(t,n)<0},b2BroadPhase.prototype.CreateProxy=function(e,t){var n=0,r,i=0;r=0;if(!this.m_freeProxy){this.m_freeProxy=this.m_proxyPool[this.m_proxyCount]=new b2Proxy,this.m_freeProxy.next=null,this.m_freeProxy.timeStamp=0,this.m_freeProxy.overlapCount=b2BroadPhase.b2_invalid,this.m_freeProxy.userData=null;for(i=0;i<2;i++)r=this.m_proxyCount*2,this.m_bounds[i][r++]=new b2Bound,this.m_bounds[i][r]=new b2Bound}r=this.m_freeProxy,this.m_freeProxy=r.next,r.overlapCount=0,r.userData=t,i=2*this.m_proxyCount;var s=[],o=[];this.ComputeBounds(s,o,e);for(var u=0;u<2;++u){var a=this.m_bounds[u],f=0,l=0,c=[];c.push(f),n=[],n.push(l),this.QueryAxis(c,n,s[u],o[u],a,i,u),f=c[0],l=n[0],a.splice(l,0,a[a.length-1]),a.length--,a.splice(f,0,a[a.length-1]),a.length--,++l,c=a[f],n=a[l],c.value=s[u],c.proxy=r,n.value=o[u],n.proxy=r;var h=a[parseInt(f-1)];c.stabbingCount=f==0?0:h.stabbingCount,h=a[parseInt(l-1)],n.stabbingCount=h.stabbingCount;for(n=f;n<l;++n)h=a[n],h.stabbingCount++;for(n=f;n<i+2;++n)c=a[n],f=c.proxy,c.IsLower()?f.lowerBounds[u]=n:f.upperBounds[u]=n}++this.m_proxyCount;for(i=0;i<this.m_queryResultCount;++i)this.m_pairManager.AddBufferedPair(r,this.m_queryResults[i]);return this.m_queryResultCount=0,this.IncrementTimeStamp(),r},b2BroadPhase.prototype.DestroyProxy=function(e){for(var t,n,r=2*this.m_proxyCount,i=0;i<2;++i){var s=this.m_bounds[i],o=e.lowerBounds[i],u=e.upperBounds[i];t=s[o];var a=t.value;n=s[u];var f=n.value;s.splice(u,1),s.splice(o,1),s.push(t),s.push(n),n=r-2;for(var l=o;l<n;++l){t=s[l];var c=t.proxy;t.IsLower()?c.lowerBounds[i]=l:c.upperBounds[i]=l}n=u-1;for(o=o;o<n;++o)t=s[o],t.stabbingCount--;t=[],this.QueryAxis(t,t,a,f,s,r-2,i)}for(r=0;r<this.m_queryResultCount;++r)this.m_pairManager.RemoveBufferedPair(e,this.m_queryResults[r]);this.m_queryResultCount=0,this.IncrementTimeStamp(),e.userData=null,e.overlapCount=b2BroadPhase.b2_invalid,e.lowerBounds[0]=b2BroadPhase.b2_invalid,e.lowerBounds[1]=b2BroadPhase.b2_invalid,e.upperBounds[0]=b2BroadPhase.b2_invalid,e.upperBounds[1]=b2BroadPhase.b2_invalid,e.next=this.m_freeProxy,this.m_freeProxy=e,--this.m_proxyCount},b2BroadPhase.prototype.MoveProxy=function(e,t){var n,r=0,i=0,s=0,o,u;if(e!=null&&t.IsValid()!=0){var a=2*this.m_proxyCount,f=new b2BoundValues;this.ComputeBounds(f.lowerValues,f.upperValues,t);var l=new b2BoundValues;for(i=0;i<2;++i)o=this.m_bounds[i][e.lowerBounds[i]],l.lowerValues[i]=o.value,o=this.m_bounds[i][e.upperBounds[i]],l.upperValues[i]=o.value;for(i=0;i<2;++i){var c=this.m_bounds[i],h=e.lowerBounds[i],p=e.upperBounds[i],d=f.lowerValues[i],v=f.upperValues[i];o=c[h];var m=d-o.value;o.value=d,o=c[p];var g=v-o.value;o.value=v;if(m<0)for(s=h;s>0&&d<c[parseInt(s-1)].value;)o=c[s],u=c[parseInt(s-1)],n=u.proxy,u.stabbingCount++,u.IsUpper()==1?(this.TestOverlapBound(f,n)&&this.m_pairManager.AddBufferedPair(e,n),n=n.upperBounds,r=n[i],r++,n[i]=r,o.stabbingCount++):(n=n.lowerBounds,r=n[i],r++,n[i]=r,o.stabbingCount--),n=e.lowerBounds,r=n[i],r--,n[i]=r,o.Swap(u),--s;if(g>0)for(s=p;s<a-1&&c[parseInt(s+1)].value<=v;)o=c[s],u=c[parseInt(s+1)],n=u.proxy,u.stabbingCount++,u.IsLower()==1?(this.TestOverlapBound(f,n)&&this.m_pairManager.AddBufferedPair(e,n),n=n.lowerBounds,r=n[i],r--,n[i]=r,o.stabbingCount++):(n=n.upperBounds,r=n[i],r--,n[i]=r,o.stabbingCount--),n=e.upperBounds,r=n[i],r++,n[i]=r,o.Swap(u),s++;if(m>0)for(s=h;s<a-1&&c[parseInt(s+1)].value<=d;)o=c[s],u=c[parseInt(s+1)],n=u.proxy,u.stabbingCount--,u.IsUpper()?(this.TestOverlapBound(l,n)&&this.m_pairManager.RemoveBufferedPair(e,n),n=n.upperBounds,r=n[i],r--,n[i]=r,o.stabbingCount--):(n=n.lowerBounds,r=n[i],r--,n[i]=r,o.stabbingCount++),n=e.lowerBounds,r=n[i],r++,n[i]=r,o.Swap(u),s++;if(g<0)for(s=p;s>0&&v<c[parseInt(s-1)].value;)o=c[s],u=c[parseInt(s-1)],n=u.proxy,u.stabbingCount--,u.IsLower()==1?(this.TestOverlapBound(l,n)&&this.m_pairManager.RemoveBufferedPair(e,n),n=n.lowerBounds,r=n[i],r++,n[i]=r,o.stabbingCount--):(n=n.upperBounds,r=n[i],r++,n[i]=r,o.stabbingCount++),n=e.upperBounds,r=n[i],r--,n[i]=r,o.Swap(u),s--}}},b2BroadPhase.prototype.UpdatePairs=function(e){this.m_pairManager.Commit(e)},b2BroadPhase.prototype.TestOverlap=function(e,t){return e.lowerBounds[0]>t.upperBounds[0]?!1:t.lowerBounds[0]>e.upperBounds[0]?!1:e.lowerBounds[1]>t.upperBounds[1]?!1:t.lowerBounds[1]>e.upperBounds[1]?!1:!0},b2BroadPhase.prototype.GetUserData=function(e){return e.userData},b2BroadPhase.prototype.GetFatAABB=function(e){var t=new b2AABB;return t.lowerBound.x=this.m_worldAABB.lowerBound.x+this.m_bounds[0][e.lowerBounds[0]].value/this.m_quantizationFactor.x,t.lowerBound.y=this.m_worldAABB.lowerBound.y+this.m_bounds[1][e.lowerBounds[1]].value/this.m_quantizationFactor.y,t.upperBound.x=this.m_worldAABB.lowerBound.x+this.m_bounds[0][e.upperBounds[0]].value/this.m_quantizationFactor.x,t.upperBound.y=this.m_worldAABB.lowerBound.y+this.m_bounds[1][e.upperBounds[1]].value/this.m_quantizationFactor.y,t},b2BroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},b2BroadPhase.prototype.Query=function(e,t){var n=[],r=[];this.ComputeBounds(n,r,t);var i=[];i.push(0);var s=[];s.push(0),this.QueryAxis(i,s,n[0],r[0],this.m_bounds[0],2*this.m_proxyCount,0),this.QueryAxis(i,s,n[1],r[1],this.m_bounds[1],2*this.m_proxyCount,1);for(n=0;n<this.m_queryResultCount;++n)if(!e(this.m_queryResults[n]))break;this.m_queryResultCount=0,this.IncrementTimeStamp()},b2BroadPhase.prototype.Validate=function(){for(var e=0;e<2;++e)for(var t=this.m_bounds[e],n=2*this.m_proxyCount,r=0,i=0;i<n;++i)t[i].IsLower()==1?r++:r--},b2BroadPhase.prototype.Rebalance=function(){},b2BroadPhase.prototype.RayCast=function(e,t){var n=new b2RayCastInput;n.p1.SetV(t.p1),n.p2.SetV(t.p2),n.maxFraction=t.maxFraction;var r=(t.p2.x-t.p1.x)*this.m_quantizationFactor.x,i=(t.p2.y-t.p1.y)*this.m_quantizationFactor.y,s=r<-Number.MIN_VALUE?-1:r>Number.MIN_VALUE?1:0,o=i<-Number.MIN_VALUE?-1:i>Number.MIN_VALUE?1:0,u=this.m_quantizationFactor.x*(t.p1.x-this.m_worldAABB.lowerBound.x),a=this.m_quantizationFactor.y*(t.p1.y-this.m_worldAABB.lowerBound.y),f=[],l=[];f[0]=parseInt(u)&b2Settings.USHRT_MAX-1,f[1]=parseInt(a)&b2Settings.USHRT_MAX-1,l[0]=f[0]+1,l[1]=f[1]+1;var c=0,h=0;h=[],h.push(0);var p=[];p.push(0),this.QueryAxis(h,p,f[0],l[0],this.m_bounds[0],2*this.m_proxyCount,0),c=s>=0?p[0]-1:h[0],this.QueryAxis(h,p,f[1],l[1],this.m_bounds[1],2*this.m_proxyCount,1),h=o>=0?p[0]-1:h[0];for(f=0;f<this.m_queryResultCount;f++)n.maxFraction=e(this.m_queryResults[f],n);for(;;){p=l=0,c+=s>=0?1:-1;if(c<0||c>=this.m_proxyCount*2)break;s!=0&&(l=(this.m_bounds[0][c].value-u)/r),h+=o>=0?1:-1;if(h<0||h>=this.m_proxyCount*2)break;o!=0&&(p=(this.m_bounds[1][h].value-a)/i);for(;;)if(o==0||s!=0&&l<p){if(l>n.maxFraction)break;if(s>0?this.m_bounds[0][c].IsLower():this.m_bounds[0][c].IsUpper())f=this.m_bounds[0][c].proxy,o>=0?f.lowerBounds[1]<=h-1&&f.upperBounds[1]>=h&&(n.maxFraction=e(f,n)):f.lowerBounds[1]<=h&&f.upperBounds[1]>=h+1&&(n.maxFraction=e(f,n));if(n.maxFraction==0)break;if(s>0){c++;if(c==this.m_proxyCount*2)break}else{c--;if(c<0)break}l=(this.m_bounds[0][c].value-u)/r}else{if(p>n.maxFraction)break;if(o>0?this.m_bounds[1][h].IsLower():this.m_bounds[1][h].IsUpper())f=this.m_bounds[1][h].proxy,s>=0?f.lowerBounds[0]<=c-1&&f.upperBounds[0]>=c&&(n.maxFraction=e(f,n)):f.lowerBounds[0]<=c&&f.upperBounds[0]>=c+1&&(n.maxFraction=e(f,n));if(n.maxFraction==0)break;if(o>0){h++;if(h==this.m_proxyCount*2)break}else{h--;if(h<0)break}p=(this.m_bounds[1][h].value-a)/i}break}this.m_queryResultCount=0,this.IncrementTimeStamp()},b2BroadPhase.prototype.TestOverlapBound=function(e,t){for(var n=0;n<2;++n){var r=this.m_bounds[n],i=r[t.upperBounds[n]];if(e.lowerValues[n]>i.value)return!1;i=r[t.lowerBounds[n]];if(e.upperValues[n]<i.value)return!1}return!0},b2BroadPhase.prototype.m_pairManager=new b2PairManager,b2BroadPhase.prototype.m_proxyPool=[],b2BroadPhase.prototype.m_freeProxy=null,b2BroadPhase.prototype.m_bounds=null,b2BroadPhase.prototype.m_querySortKeys=[],b2BroadPhase.prototype.m_queryResults=[],b2BroadPhase.prototype.m_queryResultCount=0,b2BroadPhase.prototype.m_worldAABB=null,b2BroadPhase.prototype.m_quantizationFactor=new b2Vec2,b2BroadPhase.prototype.m_proxyCount=0,b2BroadPhase.prototype.m_timeStamp=0;var b2Manifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Manifold.prototype.__constructor=function(){this.m_points=Array(b2Settings.b2_maxManifoldPoints);for(var e=0;e<b2Settings.b2_maxManifoldPoints;e++)this.m_points[e]=new b2ManifoldPoint;this.m_localPlaneNormal=new b2Vec2,this.m_localPoint=new b2Vec2},b2Manifold.prototype.__varz=function(){},b2Manifold.e_circles=1,b2Manifold.e_faceA=2,b2Manifold.e_faceB=4,b2Manifold.prototype.Reset=function(){for(var e=0;e<b2Settings.b2_maxManifoldPoints;e++)this.m_points[e].Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_pointCount=this.m_type=0},b2Manifold.prototype.Set=function(e){this.m_pointCount=e.m_pointCount;for(var t=0;t<b2Settings.b2_maxManifoldPoints;t++)this.m_points[t].Set(e.m_points[t]);this.m_localPlaneNormal.SetV(e.m_localPlaneNormal),this.m_localPoint.SetV(e.m_localPoint),this.m_type=e.m_type},b2Manifold.prototype.Copy=function(){var e=new b2Manifold;return e.Set(this),e},b2Manifold.prototype.m_points=null,b2Manifold.prototype.m_localPlaneNormal=null,b2Manifold.prototype.m_localPoint=null,b2Manifold.prototype.m_type=0,b2Manifold.prototype.m_pointCount=0;var b2CircleShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2CircleShape.prototype,b2Shape.prototype),b2CircleShape.prototype._super=b2Shape.prototype,b2CircleShape.prototype.__constructor=function(e){this._super.__constructor.apply(this,[]),this.m_type=b2Shape.e_circleShape,this.m_radius=e},b2CircleShape.prototype.__varz=function(){this.m_p=new b2Vec2},b2CircleShape.prototype.Copy=function(){var e=new b2CircleShape;return e.Set(this),e},b2CircleShape.prototype.Set=function(e){this._super.Set.apply(this,[e]),isInstanceOf(e,b2CircleShape)&&this.m_p.SetV(e.m_p)},b2CircleShape.prototype.TestPoint=function(e,t){var n=e.R,r=e.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);return n=e.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y),r=t.x-r,n=t.y-n,r*r+n*n<=this.m_radius*this.m_radius},b2CircleShape.prototype.RayCast=function(e,t,n){var r=n.R,i=t.p1.x-(n.position.x+(r.col1.x*this.m_p.x+r.col2.x*this.m_p.y));n=t.p1.y-(n.position.y+(r.col1.y*this.m_p.x+r.col2.y*this.m_p.y)),r=t.p2.x-t.p1.x;var s=t.p2.y-t.p1.y,o=i*r+n*s,u=r*r+s*s,a=o*o-u*(i*i+n*n-this.m_radius*this.m_radius);return a<0||u<Number.MIN_VALUE?!1:(o=-(o+Math.sqrt(a)),0<=o&&o<=t.maxFraction*u?(o/=u,e.fraction=o,e.normal.x=i+o*r,e.normal.y=n+o*s,e.normal.Normalize(),!0):!1)},b2CircleShape.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);n=t.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y),e.lowerBound.Set(r-this.m_radius,n-this.m_radius),e.upperBound.Set(r+this.m_radius,n+this.m_radius)},b2CircleShape.prototype.ComputeMass=function(e,t){e.mass=t*b2Settings.b2_pi*this.m_radius*this.m_radius,e.center.SetV(this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},b2CircleShape.prototype.ComputeSubmergedArea=function(e,t,n,r){n=b2Math.MulX(n,this.m_p);var i=-(b2Math.Dot(e,n)-t);if(i<-this.m_radius+Number.MIN_VALUE)return 0;if(i>this.m_radius)return r.SetV(n),Math.PI*this.m_radius*this.m_radius;t=this.m_radius*this.m_radius;var s=i*i;return i=t*(Math.asin(i/this.m_radius)+Math.PI/2)+i*Math.sqrt(t-s),t=-2/3*Math.pow(t-s,1.5)/i,r.x=n.x+e.x*t,r.y=n.y+e.y*t,i},b2CircleShape.prototype.GetLocalPosition=function(){return this.m_p},b2CircleShape.prototype.SetLocalPosition=function(e){this.m_p.SetV(e)},b2CircleShape.prototype.GetRadius=function(){return this.m_radius},b2CircleShape.prototype.SetRadius=function(e){this.m_radius=e},b2CircleShape.prototype.m_p=new b2Vec2;var b2Joint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Joint.prototype.__constructor=function(e){b2Settings.b2Assert(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_next=this.m_prev=null,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=e.collideConnected,this.m_islandFlag=!1,this.m_userData=e.userData},b2Joint.prototype.__varz=function(){this.m_edgeA=new b2JointEdge,this.m_edgeB=new b2JointEdge,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2},b2Joint.Create=function(e){var t=null;switch(e.type){case b2Joint.e_distanceJoint:t=new b2DistanceJoint(e);break;case b2Joint.e_mouseJoint:t=new b2MouseJoint(e);break;case b2Joint.e_prismaticJoint:t=new b2PrismaticJoint(e);break;case b2Joint.e_revoluteJoint:t=new b2RevoluteJoint(e);break;case b2Joint.e_pulleyJoint:t=new b2PulleyJoint(e);break;case b2Joint.e_gearJoint:t=new b2GearJoint(e);break;case b2Joint.e_lineJoint:t=new b2LineJoint(e);break;case b2Joint.e_weldJoint:t=new b2WeldJoint(e);break;case b2Joint.e_frictionJoint:t=new b2FrictionJoint(e)}return t},b2Joint.Destroy=function(){},b2Joint.e_unknownJoint=0,b2Joint.e_revoluteJoint=1,b2Joint.e_prismaticJoint=2,b2Joint.e_distanceJoint=3,b2Joint.e_pulleyJoint=4,b2Joint.e_mouseJoint=5,b2Joint.e_gearJoint=6,b2Joint.e_lineJoint=7,b2Joint.e_weldJoint=8,b2Joint.e_frictionJoint=9,b2Joint.e_inactiveLimit=0,b2Joint.e_atLowerLimit=1,b2Joint.e_atUpperLimit=2,b2Joint.e_equalLimits=3,b2Joint.prototype.InitVelocityConstraints=function(){},b2Joint.prototype.SolveVelocityConstraints=function(){},b2Joint.prototype.FinalizeVelocityConstraints=function(){},b2Joint.prototype.SolvePositionConstraints=function(){return!1},b2Joint.prototype.GetType=function(){return this.m_type},b2Joint.prototype.GetAnchorA=function(){return null},b2Joint.prototype.GetAnchorB=function(){return null},b2Joint.prototype.GetReactionForce=function(){return null},b2Joint.prototype.GetReactionTorque=function(){return 0},b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},b2Joint.prototype.GetNext=function(){return this.m_next},b2Joint.prototype.GetUserData=function(){return this.m_userData},b2Joint.prototype.SetUserData=function(e){this.m_userData=e},b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},b2Joint.prototype.m_type=0,b2Joint.prototype.m_prev=null,b2Joint.prototype.m_next=null,b2Joint.prototype.m_edgeA=new b2JointEdge,b2Joint.prototype.m_edgeB=new b2JointEdge,b2Joint.prototype.m_bodyA=null,b2Joint.prototype.m_bodyB=null,b2Joint.prototype.m_islandFlag=null,b2Joint.prototype.m_collideConnected=null,b2Joint.prototype.m_userData=null,b2Joint.prototype.m_localCenterA=new b2Vec2,b2Joint.prototype.m_localCenterB=new b2Vec2,b2Joint.prototype.m_invMassA=null,b2Joint.prototype.m_invMassB=null,b2Joint.prototype.m_invIA=null,b2Joint.prototype.m_invIB=null;var b2LineJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2LineJoint.prototype,b2Joint.prototype),b2LineJoint.prototype._super=b2Joint.prototype,b2LineJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},b2LineJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_axis=new b2Vec2,this.m_perp=new b2Vec2,this.m_K=new b2Mat22,this.m_impulse=new b2Vec2},b2LineJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r,i;this.m_localCenterA.SetV(t.GetLocalCenter()),this.m_localCenterB.SetV(n.GetLocalCenter());var s=t.GetTransform();n.GetTransform(),r=t.m_xf.R;var o=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y;i=r.col1.x*o+r.col2.x*u,u=r.col1.y*o+r.col2.y*u,o=i,r=n.m_xf.R;var a=this.m_localAnchor2.x-this.m_localCenterB.x,f=this.m_localAnchor2.y-this.m_localCenterB.y;i=r.col1.x*a+r.col2.x*f,f=r.col1.y*a+r.col2.y*f,a=i,r=n.m_sweep.c.x+a-t.m_sweep.c.x-o,i=n.m_sweep.c.y+f-t.m_sweep.c.y-u,this.m_invMassA=t.m_invMass,this.m_invMassB=n.m_invMass,this.m_invIA=t.m_invI,this.m_invIB=n.m_invI,this.m_axis.SetV(b2Math.MulMV(s.R,this.m_localXAxis1)),this.m_a1=(r+o)*this.m_axis.y-(i+u)*this.m_axis.x,this.m_a2=a*this.m_axis.y-f*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(b2Math.MulMV(s.R,this.m_localYAxis1)),this.m_s1=(r+o)*this.m_perp.y-(i+u)*this.m_perp.x,this.m_s2=a*this.m_perp.y-f*this.m_perp.x,s=this.m_invMassA,o=this.m_invMassB,u=this.m_invIA,a=this.m_invIB,this.m_K.col1.x=s+o+u*this.m_s1*this.m_s1+a*this.m_s2*this.m_s2,this.m_K.col1.y=u*this.m_s1*this.m_a1+a*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=s+o+u*this.m_a1*this.m_a1+a*this.m_a2*this.m_a2,this.m_enableLimit?(r=this.m_axis.x*r+this.m_axis.y*i,b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:r<=this.m_lowerTranslation?this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitState=b2Joint.e_atLowerLimit,this.m_impulse.y=0):r>=this.m_upperTranslation?this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitState=b2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=b2Joint.e_inactiveLimit,this.m_enableMotor==0&&(this.m_motorImpulse=0),e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,r=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,i=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,s=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,t.m_linearVelocity.x-=this.m_invMassA*e,t.m_linearVelocity.y-=this.m_invMassA*r,t.m_angularVelocity-=this.m_invIA*i,n.m_linearVelocity.x+=this.m_invMassB*e,n.m_linearVelocity.y+=this.m_invMassB*r,n.m_angularVelocity+=this.m_invIB*s):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},b2LineJoint.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=t.m_linearVelocity,i=t.m_angularVelocity,s=n.m_linearVelocity,o=n.m_angularVelocity,u,a,f;this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits&&(f=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*o-this.m_a1*i)),u=this.m_motorImpulse,e=e.dt*this.m_maxMotorForce,this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+f,-e,e),f=this.m_motorImpulse-u,u=f*this.m_axis.x,e=f*this.m_axis.y,a=f*this.m_a1,f*=this.m_a2,r.x-=this.m_invMassA*u,r.y-=this.m_invMassA*e,i-=this.m_invIA*a,s.x+=this.m_invMassB*u,s.y+=this.m_invMassB*e,o+=this.m_invIB*f),e=this.m_perp.x*(s.x-r.x)+this.m_perp.y*(s.y-r.y)+this.m_s2*o-this.m_s1*i,this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit?(a=this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*o-this.m_a1*i,u=this.m_impulse.Copy(),f=this.m_K.Solve(new b2Vec2,-e,-a),this.m_impulse.Add(f),this.m_limitState==b2Joint.e_atLowerLimit?this.m_impulse.y=b2Math.Max(this.m_impulse.y,0):this.m_limitState==b2Joint.e_atUpperLimit&&(this.m_impulse.y=b2Math.Min(this.m_impulse.y,0)),e=-e-(this.m_impulse.y-u.y)*this.m_K.col2.x,this.m_impulse.x=this.m_K.col1.x!=0?e/this.m_K.col1.x+u.x:u.x,f.x=this.m_impulse.x-u.x,f.y=this.m_impulse.y-u.y,u=f.x*this.m_perp.x+f.y*this.m_axis.x,e=f.x*this.m_perp.y+f.y*this.m_axis.y,a=f.x*this.m_s1+f.y*this.m_a1,f=f.x*this.m_s2+f.y*this.m_a2):(f=this.m_K.col1.x!=0?-e/this.m_K.col1.x:0,this.m_impulse.x+=f,u=f*this.m_perp.x,e=f*this.m_perp.y,a=f*this.m_s1,f*=this.m_s2),r.x-=this.m_invMassA*u,r.y-=this.m_invMassA*e,i-=this.m_invIA*a,s.x+=this.m_invMassB*u,s.y+=this.m_invMassB*e,o+=this.m_invIB*f,t.m_linearVelocity.SetV(r),t.m_angularVelocity=i,n.m_linearVelocity.SetV(s),n.m_angularVelocity=o},b2LineJoint.prototype.SolvePositionConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.m_sweep.c,r=e.m_sweep.a,i=t.m_sweep.c,s=t.m_sweep.a,o,u,a,f,l,c=0,h=0;a=!1;var p=0,d=b2Mat22.FromAngle(r);f=b2Mat22.FromAngle(s),o=d,h=this.m_localAnchor1.x-this.m_localCenterA.x;var v=this.m_localAnchor1.y-this.m_localCenterA.y;u=o.col1.x*h+o.col2.x*v,v=o.col1.y*h+o.col2.y*v,h=u,o=f,f=this.m_localAnchor2.x-this.m_localCenterB.x,l=this.m_localAnchor2.y-this.m_localCenterB.y,u=o.col1.x*f+o.col2.x*l,l=o.col1.y*f+o.col2.y*l,f=u,o=i.x+f-n.x-h,u=i.y+l-n.y-v;if(this.m_enableLimit){this.m_axis=b2Math.MulMV(d,this.m_localXAxis1),this.m_a1=(o+h)*this.m_axis.y-(u+v)*this.m_axis.x,this.m_a2=f*this.m_axis.y-l*this.m_axis.x;var m=this.m_axis.x*o+this.m_axis.y*u;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?(p=b2Math.Clamp(m,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),c=b2Math.Abs(m),a=!0):m<=this.m_lowerTranslation?(p=b2Math.Clamp(m-this.m_lowerTranslation+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),c=this.m_lowerTranslation-m,a=!0):m>=this.m_upperTranslation&&(p=b2Math.Clamp(m-this.m_upperTranslation+b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),c=m-this.m_upperTranslation,a=!0)}return this.m_perp=b2Math.MulMV(d,this.m_localYAxis1),this.m_s1=(o+h)*this.m_perp.y-(u+v)*this.m_perp.x,this.m_s2=f*this.m_perp.y-l*this.m_perp.x,d=new b2Vec2,v=this.m_perp.x*o+this.m_perp.y*u,c=b2Math.Max(c,b2Math.Abs(v)),h=0,a?(a=this.m_invMassA,f=this.m_invMassB,l=this.m_invIA,o=this.m_invIB,this.m_K.col1.x=a+f+l*this.m_s1*this.m_s1+o*this.m_s2*this.m_s2,this.m_K.col1.y=l*this.m_s1*this.m_a1+o*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=a+f+l*this.m_a1*this.m_a1+o*this.m_a2*this.m_a2,this.m_K.Solve(d,-v,-p)):(a=this.m_invMassA,f=this.m_invMassB,l=this.m_invIA,o=this.m_invIB,p=a+f+l*this.m_s1*this.m_s1+o*this.m_s2*this.m_s2,d.x=p!=0?-v/p:0,d.y=0),p=d.x*this.m_perp.x+d.y*this.m_axis.x,a=d.x*this.m_perp.y+d.y*this.m_axis.y,v=d.x*this.m_s1+d.y*this.m_a1,d=d.x*this.m_s2+d.y*this.m_a2,n.x-=this.m_invMassA*p,n.y-=this.m_invMassA*a,r-=this.m_invIA*v,i.x+=this.m_invMassB*p,i.y+=this.m_invMassB*a,s+=this.m_invIB*d,e.m_sweep.a=r,t.m_sweep.a=s,e.SynchronizeTransform(),t.SynchronizeTransform(),c<=b2Settings.b2_linearSlop&&h<=b2Settings.b2_angularSlop},b2LineJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2LineJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2LineJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},b2LineJoint.prototype.GetReactionTorque=function(e){return e*this.m_impulse.y},b2LineJoint.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2);return t=r.x-n.x,n=r.y-n.y,e=e.GetWorldVector(this.m_localXAxis1),e.x*t+e.y*n},b2LineJoint.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s,n=t.m_sweep.c.x+o-(e.m_sweep.c.x+r),s=t.m_sweep.c.y+u-(e.m_sweep.c.y+i);var a=e.GetWorldVector(this.m_localXAxis1),f=e.m_linearVelocity,l=t.m_linearVelocity;return e=e.m_angularVelocity,t=t.m_angularVelocity,n*-e*a.y+s*e*a.x+(a.x*(l.x+ -t*u-f.x- -e*i)+a.y*(l.y+t*o-f.y-e*r))},b2LineJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2LineJoint.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},b2LineJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},b2LineJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},b2LineJoint.prototype.SetLimits=function(e,t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},b2LineJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},b2LineJoint.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},b2LineJoint.prototype.SetMotorSpeed=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},b2LineJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2LineJoint.prototype.SetMaxMotorForce=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},b2LineJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},b2LineJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},b2LineJoint.prototype.m_localAnchor1=new b2Vec2,b2LineJoint.prototype.m_localAnchor2=new b2Vec2,b2LineJoint.prototype.m_localXAxis1=new b2Vec2,b2LineJoint.prototype.m_localYAxis1=new b2Vec2,b2LineJoint.prototype.m_axis=new b2Vec2,b2LineJoint.prototype.m_perp=new b2Vec2,b2LineJoint.prototype.m_s1=null,b2LineJoint.prototype.m_s2=null,b2LineJoint.prototype.m_a1=null,b2LineJoint.prototype.m_a2=null,b2LineJoint.prototype.m_K=new b2Mat22,b2LineJoint.prototype.m_impulse=new b2Vec2,b2LineJoint.prototype.m_motorMass=null,b2LineJoint.prototype.m_motorImpulse=null,b2LineJoint.prototype.m_lowerTranslation=null,b2LineJoint.prototype.m_upperTranslation=null,b2LineJoint.prototype.m_maxMotorForce=null,b2LineJoint.prototype.m_motorSpeed=null,b2LineJoint.prototype.m_enableLimit=null,b2LineJoint.prototype.m_enableMotor=null,b2LineJoint.prototype.m_limitState=0;var b2ContactSolver=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactSolver.prototype.__constructor=function(){},b2ContactSolver.prototype.__varz=function(){this.m_step=new b2TimeStep,this.m_constraints=[]},b2ContactSolver.s_worldManifold=new b2WorldManifold,b2ContactSolver.s_psm=new b2PositionSolverManifold,b2ContactSolver.prototype.Initialize=function(e,t,n,r){var i;this.m_step.Set(e),this.m_allocator=r,e=0;for(this.m_constraintCount=n;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new b2ContactConstraint;for(e=0;e<n;++e){i=t[e],r=i.m_fixtureA;var s=i.m_fixtureB,o=r.m_shape.m_radius,u=s.m_shape.m_radius,a=r.m_body,f=s.m_body,l=i.GetManifold(),c=b2Settings.b2MixFriction(r.GetFriction(),s.GetFriction()),h=b2Settings.b2MixRestitution(r.GetRestitution(),s.GetRestitution()),p=a.m_linearVelocity.x,d=a.m_linearVelocity.y,v=f.m_linearVelocity.x,m=f.m_linearVelocity.y,g=a.m_angularVelocity,y=f.m_angularVelocity;b2Settings.b2Assert(l.m_pointCount>0),b2ContactSolver.s_worldManifold.Initialize(l,a.m_xf,o,f.m_xf,u),s=b2ContactSolver.s_worldManifold.m_normal.x,i=b2ContactSolver.s_worldManifold.m_normal.y,r=this.m_constraints[e],r.bodyA=a,r.bodyB=f,r.manifold=l,r.normal.x=s,r.normal.y=i,r.pointCount=l.m_pointCount,r.friction=c,r.restitution=h,r.localPlaneNormal.x=l.m_localPlaneNormal.x,r.localPlaneNormal.y=l.m_localPlaneNormal.y,r.localPoint.x=l.m_localPoint.x,r.localPoint.y=l.m_localPoint.y,r.radius=o+u,r.type=l.m_type;for(o=0;o<r.pointCount;++o){c=l.m_points[o],u=r.points[o],u.normalImpulse=c.m_normalImpulse,u.tangentImpulse=c.m_tangentImpulse,u.localPoint.SetV(c.m_localPoint),c=u.rA.x=b2ContactSolver.s_worldManifold.m_points[o].x-a.m_sweep.c.x,h=u.rA.y=b2ContactSolver.s_worldManifold.m_points[o].y-a.m_sweep.c.y;var b=u.rB.x=b2ContactSolver.s_worldManifold.m_points[o].x-f.m_sweep.c.x,w=u.rB.y=b2ContactSolver.s_worldManifold.m_points[o].y-f.m_sweep.c.y,E=c*i-h*s,S=b*i-w*s;E*=E,S*=S,u.normalMass=1/(a.m_invMass+f.m_invMass+a.m_invI*E+f.m_invI*S);var x=a.m_mass*a.m_invMass+f.m_mass*f.m_invMass;x+=a.m_mass*a.m_invI*E+f.m_mass*f.m_invI*S,u.equalizedMass=1/x,S=i,x=-s,E=c*x-h*S,S=b*x-w*S,E*=E,S*=S,u.tangentMass=1/(a.m_invMass+f.m_invMass+a.m_invI*E+f.m_invI*S),u.velocityBias=0,c=r.normal.x*(v+ -y*w-p- -g*h)+r.normal.y*(m+y*b-d-g*c),c<-b2Settings.b2_velocityThreshold&&(u.velocityBias+=-r.restitution*c)}r.pointCount==2&&(m=r.points[0],v=r.points[1],l=a.m_invMass,a=a.m_invI,p=f.m_invMass,f=f.m_invI,d=m.rA.x*i-m.rA.y*s,m=m.rB.x*i-m.rB.y*s,g=v.rA.x*i-v.rA.y*s,v=v.rB.x*i-v.rB.y*s,s=l+p+a*d*d+f*m*m,i=l+p+a*g*g+f*v*v,f=l+p+a*d*g+f*m*v,s*s<100*(s*i-f*f)?(r.K.col1.Set(s,f),r.K.col2.Set(f,i),r.K.GetInverse(r.normalMass)):r.pointCount=1)}},b2ContactSolver.prototype.InitVelocityConstraints=function(e){for(var t=0;t<this.m_constraintCount;++t){var n=this.m_constraints[t],r=n.bodyA,i=n.bodyB,s=r.m_invMass,o=r.m_invI,u=i.m_invMass,a=i.m_invI,f=n.normal.x,l=n.normal.y,c=l,h=-f,p=0,d=0;if(e.warmStarting){d=n.pointCount;for(p=0;p<d;++p){var v=n.points[p];v.normalImpulse*=e.dtRatio,v.tangentImpulse*=e.dtRatio;var m=v.normalImpulse*f+v.tangentImpulse*c,g=v.normalImpulse*l+v.tangentImpulse*h;r.m_angularVelocity-=o*(v.rA.x*g-v.rA.y*m),r.m_linearVelocity.x-=s*m,r.m_linearVelocity.y-=s*g,i.m_angularVelocity+=a*(v.rB.x*g-v.rB.y*m),i.m_linearVelocity.x+=u*m,i.m_linearVelocity.y+=u*g}}else{d=n.pointCount;for(p=0;p<d;++p)r=n.points[p],r.normalImpulse=0,r.tangentImpulse=0}}},b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var e=0,t,n,r,i,s,o,u,a,f,l=0;l<this.m_constraintCount;++l){i=this.m_constraints[l];var c=i.bodyA,h=i.bodyB,p=c.m_angularVelocity,d=h.m_angularVelocity,v=c.m_linearVelocity,m=h.m_linearVelocity,g=c.m_invMass,y=c.m_invI,b=h.m_invMass,w=h.m_invI;u=i.normal.x;var E=a=i.normal.y;f=-u,o=i.friction;for(e=0;e<i.pointCount;e++)t=i.points[e],n=m.x-d*t.rB.y-v.x+p*t.rA.y,r=m.y+d*t.rB.x-v.y-p*t.rA.x,n=n*E+r*f,n=t.tangentMass*-n,r=o*t.normalImpulse,r=b2Math.Clamp(t.tangentImpulse+n,-r,r),n=r-t.tangentImpulse,s=n*E,n*=f,v.x-=g*s,v.y-=g*n,p-=y*(t.rA.x*n-t.rA.y*s),m.x+=b*s,m.y+=b*n,d+=w*(t.rB.x*n-t.rB.y*s),t.tangentImpulse=r;if(i.pointCount==1)t=i.points[0],n=m.x+ -d*t.rB.y-v.x- -p*t.rA.y,r=m.y+d*t.rB.x-v.y-p*t.rA.x,i=n*u+r*a,n=-t.normalMass*(i-t.velocityBias),r=t.normalImpulse+n,r=r>0?r:0,n=r-t.normalImpulse,s=n*u,n*=a,v.x-=g*s,v.y-=g*n,p-=y*(t.rA.x*n-t.rA.y*s),m.x+=b*s,m.y+=b*n,d+=w*(t.rB.x*n-t.rB.y*s),t.normalImpulse=r;else{t=i.points[0],e=i.points[1],n=t.normalImpulse,o=e.normalImpulse;var S=(m.x-d*t.rB.y-v.x+p*t.rA.y)*u+(m.y+d*t.rB.x-v.y-p*t.rA.x)*a,x=(m.x-d*e.rB.y-v.x+p*e.rA.y)*u+(m.y+d*e.rB.x-v.y-p*e.rA.x)*a;r=S-t.velocityBias,s=x-e.velocityBias,f=i.K,r-=f.col1.x*n+f.col2.x*o;for(s-=f.col1.y*n+f.col2.y*o;;){f=i.normalMass,E=-(f.col1.x*r+f.col2.x*s),f=-(f.col1.y*r+f.col2.y*s);if(E>=0&&f>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}E=-t.normalMass*r,f=0,x=i.K.col1.y*E+s;if(E>=0&&x>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}E=0,f=-e.normalMass*s,S=i.K.col2.x*f+r;if(f>=0&&S>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}f=E=0,S=r,x=s;if(S>=0&&x>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}break}}c.m_angularVelocity=p,h.m_angularVelocity=d}},b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var e=0;e<this.m_constraintCount;++e)for(var t=this.m_constraints[e],n=t.manifold,r=0;r<t.pointCount;++r){var i=n.m_points[r],s=t.points[r];i.m_normalImpulse=s.normalImpulse,i.m_tangentImpulse=s.tangentImpulse}},b2ContactSolver.prototype.SolvePositionConstraints=function(e){for(var t=0,n=0;n<this.m_constraintCount;n++){var r=this.m_constraints[n],i=r.bodyA,s=r.bodyB,o=i.m_mass*i.m_invMass,u=i.m_mass*i.m_invI,a=s.m_mass*s.m_invMass,f=s.m_mass*s.m_invI;b2ContactSolver.s_psm.Initialize(r);for(var l=b2ContactSolver.s_psm.m_normal,c=0;c<r.pointCount;c++){var h=r.points[c],p=b2ContactSolver.s_psm.m_points[c],d=b2ContactSolver.s_psm.m_separations[c],v=p.x-i.m_sweep.c.x,m=p.y-i.m_sweep.c.y,g=p.x-s.m_sweep.c.x;p=p.y-s.m_sweep.c.y,t=t<d?t:d,d=b2Math.Clamp(e*(d+b2Settings.b2_linearSlop),-b2Settings.b2_maxLinearCorrection,0),d=-h.equalizedMass*d,h=d*l.x,d*=l.y,i.m_sweep.c.x-=o*h,i.m_sweep.c.y-=o*d,i.m_sweep.a-=u*(v*d-m*h),i.SynchronizeTransform(),s.m_sweep.c.x+=a*h,s.m_sweep.c.y+=a*d,s.m_sweep.a+=f*(g*d-p*h),s.SynchronizeTransform()}}return t>-1.5*b2Settings.b2_linearSlop},b2ContactSolver.prototype.m_step=new b2TimeStep,b2ContactSolver.prototype.m_allocator=null,b2ContactSolver.prototype.m_constraints=[],b2ContactSolver.prototype.m_constraintCount=0;var b2Simplex=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Simplex.prototype.__constructor=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},b2Simplex.prototype.__varz=function(){this.m_v1=new b2SimplexVertex,this.m_v2=new b2SimplexVertex,this.m_v3=new b2SimplexVertex,this.m_vertices=Array(3)},b2Simplex.prototype.ReadCache=function(e,t,n,r,i){b2Settings.b2Assert(0<=e.count&&e.count<=3);var s,o;this.m_count=e.count;for(var u=this.m_vertices,a=0;a<this.m_count;a++){var f=u[a];f.indexA=e.indexA[a],f.indexB=e.indexB[a],s=t.GetVertex(f.indexA),o=r.GetVertex(f.indexB),f.wA=b2Math.MulX(n,s),f.wB=b2Math.MulX(i,o),f.w=b2Math.SubtractVV(f.wB,f.wA),f.a=0}if(this.m_count>1){e=e.metric,s=this.GetMetric();if(s<.5*e||2*e<s||s<Number.MIN_VALUE)this.m_count=0}this.m_count==0&&(f=u[0],f.indexA=0,f.indexB=0,s=t.GetVertex(0),o=r.GetVertex(0),f.wA=b2Math.MulX(n,s),f.wB=b2Math.MulX(i,o),f.w=b2Math.SubtractVV(f.wB,f.wA),this.m_count=1)},b2Simplex.prototype.WriteCache=function(e){e.metric=this.GetMetric(),e.count=parseInt(this.m_count);for(var t=this.m_vertices,n=0;n<this.m_count;n++)e.indexA[n]=parseInt(t[n].indexA),e.indexB[n]=parseInt(t[n].indexB)},b2Simplex.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var e=b2Math.SubtractVV(this.m_v2.w,this.m_v1.w);return b2Math.CrossVV(e,this.m_v1.w.GetNegative())>0?b2Math.CrossFV(1,e):b2Math.CrossVF(e,1);default:return b2Settings.b2Assert(!1),new b2Vec2}},b2Simplex.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return b2Settings.b2Assert(!1),new b2Vec2;case 1:return this.m_v1.w;case 2:return new b2Vec2(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return b2Settings.b2Assert(!1),new b2Vec2}},b2Simplex.prototype.GetWitnessPoints=function(e,t){switch(this.m_count){case 0:b2Settings.b2Assert(!1);break;case 1:e.SetV(this.m_v1.wA),t.SetV(this.m_v1.wB);break;case 2:e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,t.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:b2Settings.b2Assert(!1)}},b2Simplex.prototype.GetMetric=function(){switch(this.m_count){case 0:return b2Settings.b2Assert(!1),0;case 1:return 0;case 2:return b2Math.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return b2Math.CrossVV(b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),b2Math.SubtractVV(this.m_v3.w,this.m_v1.w));default:return b2Settings.b2Assert(!1),0}},b2Simplex.prototype.Solve2=function(){var e=this.m_v1.w,t=this.m_v2.w,n=b2Math.SubtractVV(t,e);e=-(e.x*n.x+e.y*n.y),e<=0?this.m_count=this.m_v1.a=1:(t=t.x*n.x+t.y*n.y,t<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(n=1/(t+e),this.m_v1.a=t*n,this.m_v2.a=e*n,this.m_count=2))},b2Simplex.prototype.Solve3=function(){var e=this.m_v1.w,t=this.m_v2.w,n=this.m_v3.w,r=b2Math.SubtractVV(t,e),i=b2Math.Dot(e,r),s=b2Math.Dot(t,r);i=-i;var o=b2Math.SubtractVV(n,e),u=b2Math.Dot(e,o),a=b2Math.Dot(n,o);u=-u;var f=b2Math.SubtractVV(n,t),l=b2Math.Dot(t,f);f=b2Math.Dot(n,f),l=-l,o=b2Math.CrossVV(r,o),r=o*b2Math.CrossVV(t,n),n=o*b2Math.CrossVV(n,e),e=o*b2Math.CrossVV(e,t),i<=0&&u<=0?this.m_count=this.m_v1.a=1:s>0&&i>0&&e<=0?(a=1/(s+i),this.m_v1.a=s*a,this.m_v2.a=i*a,this.m_count=2):a>0&&u>0&&n<=0?(s=1/(a+u),this.m_v1.a=a*s,this.m_v3.a=u*s,this.m_count=2,this.m_v2.Set(this.m_v3)):s<=0&&l<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):a<=0&&f<=0?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):f>0&&l>0&&r<=0?(s=1/(f+l),this.m_v2.a=f*s,this.m_v3.a=l*s,this.m_count=2,this.m_v1.Set(this.m_v3)):(s=1/(r+n+e),this.m_v1.a=r*s,this.m_v2.a=n*s,this.m_v3.a=e*s,this.m_count=3)},b2Simplex.prototype.m_v1=new b2SimplexVertex,b2Simplex.prototype.m_v2=new b2SimplexVertex,b2Simplex.prototype.m_v3=new b2SimplexVertex,b2Simplex.prototype.m_vertices=Array(3),b2Simplex.prototype.m_count=0;var b2WeldJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2WeldJoint.prototype,b2Joint.prototype),b2WeldJoint.prototype._super=b2Joint.prototype,b2WeldJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new b2Mat33},b2WeldJoint.prototype.__varz=function(){this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_impulse=new b2Vec3,this.m_mass=new b2Mat33},b2WeldJoint.prototype.InitVelocityConstraints=function(e){var t,n,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x,o=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n,t=i.m_xf.R;var u=this.m_localAnchorB.x-i.m_sweep.localCenter.x,a=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n,t=r.m_invMass,n=i.m_invMass;var f=r.m_invI,l=i.m_invI;this.m_mass.col1.x=t+n+o*o*f+a*a*l,this.m_mass.col2.x=-o*s*f-a*u*l,this.m_mass.col3.x=-o*f-a*l,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=t+n+s*s*f+u*u*l,this.m_mass.col3.y=s*f+u*l,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=f+l,e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_impulse.z*=e.dtRatio,r.m_linearVelocity.x-=t*this.m_impulse.x,r.m_linearVelocity.y-=t*this.m_impulse.y,r.m_angularVelocity-=f*(s*this.m_impulse.y-o*this.m_impulse.x+this.m_impulse.z),i.m_linearVelocity.x+=n*this.m_impulse.x,i.m_linearVelocity.y+=n*this.m_impulse.y,i.m_angularVelocity+=l*(u*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},b2WeldJoint.prototype.SolveVelocityConstraints=function(){var e,t,n=this.m_bodyA,r=this.m_bodyB,i=n.m_linearVelocity,s=n.m_angularVelocity,o=r.m_linearVelocity,u=r.m_angularVelocity,a=n.m_invMass,f=r.m_invMass,l=n.m_invI,c=r.m_invI;e=n.m_xf.R;var h=this.m_localAnchorA.x-n.m_sweep.localCenter.x,p=this.m_localAnchorA.y-n.m_sweep.localCenter.y;t=e.col1.x*h+e.col2.x*p,p=e.col1.y*h+e.col2.y*p,h=t,e=r.m_xf.R;var d=this.m_localAnchorB.x-r.m_sweep.localCenter.x,v=this.m_localAnchorB.y-r.m_sweep.localCenter.y;t=e.col1.x*d+e.col2.x*v,v=e.col1.y*d+e.col2.y*v,d=t,e=o.x-u*v-i.x+s*p,t=o.y+u*d-i.y-s*h;var m=u-s,g=new b2Vec3;this.m_mass.Solve33(g,-e,-t,-m),this.m_impulse.Add(g),i.x-=a*g.x,i.y-=a*g.y,s-=l*(h*g.y-p*g.x+g.z),o.x+=f*g.x,o.y+=f*g.y,u+=c*(d*g.y-v*g.x+g.z),n.m_angularVelocity=s,r.m_angularVelocity=u},b2WeldJoint.prototype.SolvePositionConstraints=function(){var e,t,n=this.m_bodyA,r=this.m_bodyB;e=n.m_xf.R;var i=this.m_localAnchorA.x-n.m_sweep.localCenter.x,s=this.m_localAnchorA.y-n.m_sweep.localCenter.y;t=e.col1.x*i+e.col2.x*s,s=e.col1.y*i+e.col2.y*s,i=t,e=r.m_xf.R;var o=this.m_localAnchorB.x-r.m_sweep.localCenter.x,u=this.m_localAnchorB.y-r.m_sweep.localCenter.y;t=e.col1.x*o+e.col2.x*u,u=e.col1.y*o+e.col2.y*u,o=t,e=n.m_invMass,t=r.m_invMass;var a=n.m_invI,f=r.m_invI,l=r.m_sweep.c.x+o-n.m_sweep.c.x-i,c=r.m_sweep.c.y+u-n.m_sweep.c.y-s,h=r.m_sweep.a-n.m_sweep.a-this.m_referenceAngle,p=10*b2Settings.b2_linearSlop,d=Math.sqrt(l*l+c*c),v=b2Math.Abs(h);return d>p&&(a*=1,f*=1),this.m_mass.col1.x=e+t+s*s*a+u*u*f,this.m_mass.col2.x=-s*i*a-u*o*f,this.m_mass.col3.x=-s*a-u*f,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=e+t+i*i*a+o*o*f,this.m_mass.col3.y=i*a+o*f,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=a+f,p=new b2Vec3,this.m_mass.Solve33(p,-l,-c,-h),n.m_sweep.c.x-=e*p.x,n.m_sweep.c.y-=e*p.y,n.m_sweep.a-=a*(i*p.y-s*p.x+p.z),r.m_sweep.c.x+=t*p.x,r.m_sweep.c.y+=t*p.y,r.m_sweep.a+=f*(o*p.y-u*p.x+p.z),n.SynchronizeTransform(),r.SynchronizeTransform(),d<=b2Settings.b2_linearSlop&&v<=b2Settings.b2_angularSlop},b2WeldJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},b2WeldJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},b2WeldJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_impulse.x,e*this.m_impulse.y)},b2WeldJoint.prototype.GetReactionTorque=function(e){return e*this.m_impulse.z},b2WeldJoint.prototype.m_localAnchorA=new b2Vec2,b2WeldJoint.prototype.m_localAnchorB=new b2Vec2,b2WeldJoint.prototype.m_referenceAngle=null,b2WeldJoint.prototype.m_impulse=new b2Vec3,b2WeldJoint.prototype.m_mass=new b2Mat33;var b2Math=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Math.prototype.__constructor=function(){},b2Math.prototype.__varz=function(){},b2Math.IsValid=function(e){return isFinite(e)},b2Math.Dot=function(e,t){return e.x*t.x+e.y*t.y},b2Math.CrossVV=function(e,t){return e.x*t.y-e.y*t.x},b2Math.CrossVF=function(e,t){return new b2Vec2(t*e.y,-t*e.x)},b2Math.CrossFV=function(e,t){return new b2Vec2(-e*t.y,e*t.x)},b2Math.MulMV=function(e,t){return new b2Vec2(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y)},b2Math.MulTMV=function(e,t){return new b2Vec2(b2Math.Dot(t,e.col1),b2Math.Dot(t,e.col2))},b2Math.MulX=function(e,t){var n=b2Math.MulMV(e.R,t);return n.x+=e.position.x,n.y+=e.position.y,n},b2Math.MulXT=function(e,t){var n=b2Math.SubtractVV(t,e.position),r=n.x*e.R.col1.x+n.y*e.R.col1.y;return n.y=n.x*e.R.col2.x+n.y*e.R.col2.y,n.x=r,n},b2Math.AddVV=function(e,t){return new b2Vec2(e.x+t.x,e.y+t.y)},b2Math.SubtractVV=function(e,t){return new b2Vec2(e.x-t.x,e.y-t.y)},b2Math.Distance=function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},b2Math.DistanceSquared=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r},b2Math.MulFV=function(e,t){return new b2Vec2(e*t.x,e*t.y)},b2Math.AddMM=function(e,t){return b2Mat22.FromVV(b2Math.AddVV(e.col1,t.col1),b2Math.AddVV(e.col2,t.col2))},b2Math.MulMM=function(e,t){return b2Mat22.FromVV(b2Math.MulMV(e,t.col1),b2Math.MulMV(e,t.col2))},b2Math.MulTMM=function(e,t){var n=new b2Vec2(b2Math.Dot(e.col1,t.col1),b2Math.Dot(e.col2,t.col1)),r=new b2Vec2(b2Math.Dot(e.col1,t.col2),b2Math.Dot(e.col2,t.col2));return b2Mat22.FromVV(n,r)},b2Math.Abs=function(e){return e>0?e:-e},b2Math.AbsV=function(e){return new b2Vec2(b2Math.Abs(e.x),b2Math.Abs(e.y))},b2Math.AbsM=function(e){return b2Mat22.FromVV(b2Math.AbsV(e.col1),b2Math.AbsV(e.col2))},b2Math.Min=function(e,t){return e<t?e:t},b2Math.MinV=function(e,t){return new b2Vec2(b2Math.Min(e.x,t.x),b2Math.Min(e.y,t.y))},b2Math.Max=function(e,t){return e>t?e:t},b2Math.MaxV=function(e,t){return new b2Vec2(b2Math.Max(e.x,t.x),b2Math.Max(e.y,t.y))},b2Math.Clamp=function(e,t,n){return e<t?t:e>n?n:e},b2Math.ClampV=function(e,t,n){return b2Math.MaxV(t,b2Math.MinV(e,n))},b2Math.Swap=function(e,t){var n=e[0];e[0]=t[0],t[0]=n},b2Math.Random=function(){return Math.random()*2-1},b2Math.RandomRange=function(e,t){var n=Math.random();return n=(t-e)*n+e},b2Math.NextPowerOfTwo=function(e){return e|=e>>1&2147483647,e|=e>>2&1073741823,e|=e>>4&268435455,e|=e>>8&16777215,e|=e>>16&65535,e+1},b2Math.IsPowerOfTwo=function(e){return e>0&&(e&e-1)==0},b2Math.b2Vec2_zero=new b2Vec2(0,0),b2Math.b2Mat22_identity=b2Mat22.FromVV(new b2Vec2(1,0),new b2Vec2(0,1)),b2Math.b2Transform_identity=new b2Transform(b2Math.b2Vec2_zero,b2Math.b2Mat22_identity);var b2PulleyJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PulleyJoint.prototype,b2Joint.prototype),b2PulleyJoint.prototype._super=b2Joint.prototype,b2PulleyJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=e.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=e.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=e.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=e.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_ratio=e.ratio,this.m_constant=e.lengthA+this.m_ratio*e.lengthB,this.m_maxLength1=b2Math.Min(e.maxLengthA,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=b2Math.Min(e.maxLengthB,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},b2PulleyJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u1=new b2Vec2,this.m_u2=new b2Vec2},b2PulleyJoint.b2_minPulleyLength=2,b2PulleyJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r;r=t.m_xf.R;var i=this.m_localAnchor1.x-t.m_sweep.localCenter.x,s=this.m_localAnchor1.y-t.m_sweep.localCenter.y,o=r.col1.x*i+r.col2.x*s;s=r.col1.y*i+r.col2.y*s,i=o,r=n.m_xf.R;var u=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y;o=r.col1.x*u+r.col2.x*a,a=r.col1.y*u+r.col2.y*a,u=o,r=n.m_sweep.c.x+u,o=n.m_sweep.c.y+a;var f=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,l=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(t.m_sweep.c.x+i-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),t.m_sweep.c.y+s-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y)),this.m_u2.Set(r-f,o-l),r=this.m_u1.Length(),o=this.m_u2.Length(),r>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/r):this.m_u1.SetZero(),o>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/o):this.m_u2.SetZero(),this.m_constant-r-this.m_ratio*o>0?(this.m_state=b2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=b2Joint.e_atUpperLimit,r<this.m_maxLength1?(this.m_limitState1=b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=b2Joint.e_atUpperLimit,o<this.m_maxLength2?(this.m_limitState2=b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=b2Joint.e_atUpperLimit,r=i*this.m_u1.y-s*this.m_u1.x,o=u*this.m_u2.y-a*this.m_u2.x,this.m_limitMass1=t.m_invMass+t.m_invI*r*r,this.m_limitMass2=n.m_invMass+n.m_invI*o*o,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,e.warmStarting?(this.m_impulse*=e.dtRatio,this.m_limitImpulse1*=e.dtRatio,this.m_limitImpulse2*=e.dtRatio,e=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,r=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,o=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,f=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*e,t.m_linearVelocity.y+=t.m_invMass*r,t.m_angularVelocity+=t.m_invI*(i*r-s*e),n.m_linearVelocity.x+=n.m_invMass*o,n.m_linearVelocity.y+=n.m_invMass*f,n.m_angularVelocity+=n.m_invI*(u*f-a*o)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},b2PulleyJoint.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s;var a,f;this.m_state==b2Joint.e_atUpperLimit&&(n=e.m_linearVelocity.x+ -e.m_angularVelocity*i,s=e.m_linearVelocity.y+e.m_angularVelocity*r,a=t.m_linearVelocity.x+ -t.m_angularVelocity*u,f=t.m_linearVelocity.y+t.m_angularVelocity*o,n=-(this.m_u1.x*n+this.m_u1.y*s)-this.m_ratio*(this.m_u2.x*a+this.m_u2.y*f),f=this.m_pulleyMass*-n,n=this.m_impulse,this.m_impulse=b2Math.Max(0,this.m_impulse+f),f=this.m_impulse-n,n=-f*this.m_u1.x,s=-f*this.m_u1.y,a=-this.m_ratio*f*this.m_u2.x,f=-this.m_ratio*f*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*n,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(r*s-i*n),t.m_linearVelocity.x+=t.m_invMass*a,t.m_linearVelocity.y+=t.m_invMass*f,t.m_angularVelocity+=t.m_invI*(o*f-u*a)),this.m_limitState1==b2Joint.e_atUpperLimit&&(n=e.m_linearVelocity.x+ -e.m_angularVelocity*i,s=e.m_linearVelocity.y+e.m_angularVelocity*r,n=-(this.m_u1.x*n+this.m_u1.y*s),f=-this.m_limitMass1*n,n=this.m_limitImpulse1,this.m_limitImpulse1=b2Math.Max(0,this.m_limitImpulse1+f),f=this.m_limitImpulse1-n,n=-f*this.m_u1.x,s=-f*this.m_u1.y,e.m_linearVelocity.x+=e.m_invMass*n,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(r*s-i*n)),this.m_limitState2==b2Joint.e_atUpperLimit&&(a=t.m_linearVelocity.x+ -t.m_angularVelocity*u,f=t.m_linearVelocity.y+t.m_angularVelocity*o,n=-(this.m_u2.x*a+this.m_u2.y*f),f=-this.m_limitMass2*n,n=this.m_limitImpulse2,this.m_limitImpulse2=b2Math.Max(0,this.m_limitImpulse2+f),f=this.m_limitImpulse2-n,a=-f*this.m_u2.x,f=-f*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*a,t.m_linearVelocity.y+=t.m_invMass*f,t.m_angularVelocity+=t.m_invI*(o*f-u*a))},b2PulleyJoint.prototype.SolvePositionConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n,r=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,s=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,u,a,f,l,c,h,p,d=0;return this.m_state==b2Joint.e_atUpperLimit&&(n=e.m_xf.R,u=this.m_localAnchor1.x-e.m_sweep.localCenter.x,a=this.m_localAnchor1.y-e.m_sweep.localCenter.y,c=n.col1.x*u+n.col2.x*a,a=n.col1.y*u+n.col2.y*a,u=c,n=t.m_xf.R,f=this.m_localAnchor2.x-t.m_sweep.localCenter.x,l=this.m_localAnchor2.y-t.m_sweep.localCenter.y,c=n.col1.x*f+n.col2.x*l,l=n.col1.y*f+n.col2.y*l,f=c,n=e.m_sweep.c.x+u,c=e.m_sweep.c.y+a,h=t.m_sweep.c.x+f,p=t.m_sweep.c.y+l,this.m_u1.Set(n-r,c-i),this.m_u2.Set(h-s,p-o),n=this.m_u1.Length(),c=this.m_u2.Length(),n>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/n):this.m_u1.SetZero(),c>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/c):this.m_u2.SetZero(),n=this.m_constant-n-this.m_ratio*c,d=b2Math.Max(d,-n),n=b2Math.Clamp(n+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),p=-this.m_pulleyMass*n,n=-p*this.m_u1.x,c=-p*this.m_u1.y,h=-this.m_ratio*p*this.m_u2.x,p=-this.m_ratio*p*this.m_u2.y,e.m_sweep.c.x+=e.m_invMass*n,e.m_sweep.c.y+=e.m_invMass*c,e.m_sweep.a+=e.m_invI*(u*c-a*n),t.m_sweep.c.x+=t.m_invMass*h,t.m_sweep.c.y+=t.m_invMass*p,t.m_sweep.a+=t.m_invI*(f*p-l*h),e.SynchronizeTransform(),t.SynchronizeTransform()),this.m_limitState1==b2Joint.e_atUpperLimit&&(n=e.m_xf.R,u=this.m_localAnchor1.x-e.m_sweep.localCenter.x,a=this.m_localAnchor1.y-e.m_sweep.localCenter.y,c=n.col1.x*u+n.col2.x*a,a=n.col1.y*u+n.col2.y*a,u=c,n=e.m_sweep.c.x+u,c=e.m_sweep.c.y+a,this.m_u1.Set(n-r,c-i),n=this.m_u1.Length(),n>b2Settings.b2_linearSlop?(this.m_u1.x*=1/n,this.m_u1.y*=1/n):this.m_u1.SetZero(),n=this.m_maxLength1-n,d=b2Math.Max(d,-n),n=b2Math.Clamp(n+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),p=-this.m_limitMass1*n,n=-p*this.m_u1.x,c=-p*this.m_u1.y,e.m_sweep.c.x+=e.m_invMass*n,e.m_sweep.c.y+=e.m_invMass*c,e.m_sweep.a+=e.m_invI*(u*c-a*n),e.SynchronizeTransform()),this.m_limitState2==b2Joint.e_atUpperLimit&&(n=t.m_xf.R,f=this.m_localAnchor2.x-t.m_sweep.localCenter.x,l=this.m_localAnchor2.y-t.m_sweep.localCenter.y,c=n.col1.x*f+n.col2.x*l,l=n.col1.y*f+n.col2.y*l,f=c,h=t.m_sweep.c.x+f,p=t.m_sweep.c.y+l,this.m_u2.Set(h-s,p-o),c=this.m_u2.Length(),c>b2Settings.b2_linearSlop?(this.m_u2.x*=1/c,this.m_u2.y*=1/c):this.m_u2.SetZero(),n=this.m_maxLength2-c,d=b2Math.Max(d,-n),n=b2Math.Clamp(n+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),p=-this.m_limitMass2*n,h=-p*this.m_u2.x,p=-p*this.m_u2.y,t.m_sweep.c.x+=t.m_invMass*h,t.m_sweep.c.y+=t.m_invMass*p,t.m_sweep.a+=t.m_invI*(f*p-l*h),t.SynchronizeTransform()),d<b2Settings.b2_linearSlop},b2PulleyJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2PulleyJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2PulleyJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_impulse*this.m_u2.x,e*this.m_impulse*this.m_u2.y)},b2PulleyJoint.prototype.GetReactionTorque=function(){return 0},b2PulleyJoint.prototype.GetGroundAnchorA=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor1),e},b2PulleyJoint.prototype.GetGroundAnchorB=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor2),e},b2PulleyJoint.prototype.GetLength1=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);return e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y),Math.sqrt(t*t+e*e)},b2PulleyJoint.prototype.GetLength2=function(){var e=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);return e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y),Math.sqrt(t*t+e*e)},b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},b2PulleyJoint.prototype.m_ground=null,b2PulleyJoint.prototype.m_groundAnchor1=new b2Vec2,b2PulleyJoint.prototype.m_groundAnchor2=new b2Vec2,b2PulleyJoint.prototype.m_localAnchor1=new b2Vec2,b2PulleyJoint.prototype.m_localAnchor2=new b2Vec2,b2PulleyJoint.prototype.m_u1=new b2Vec2,b2PulleyJoint.prototype.m_u2=new b2Vec2,b2PulleyJoint.prototype.m_constant=null,b2PulleyJoint.prototype.m_ratio=null,b2PulleyJoint.prototype.m_maxLength1=null,b2PulleyJoint.prototype.m_maxLength2=null,b2PulleyJoint.prototype.m_pulleyMass=null,b2PulleyJoint.prototype.m_limitMass1=null,b2PulleyJoint.prototype.m_limitMass2=null,b2PulleyJoint.prototype.m_impulse=null,b2PulleyJoint.prototype.m_limitImpulse1=null,b2PulleyJoint.prototype.m_limitImpulse2=null,b2PulleyJoint.prototype.m_state=0,b2PulleyJoint.prototype.m_limitState1=0,b2PulleyJoint.prototype.m_limitState2=0;var b2PrismaticJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PrismaticJoint.prototype,b2Joint.prototype),b2PrismaticJoint.prototype._super=b2Joint.prototype,b2PrismaticJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},b2PrismaticJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_axis=new b2Vec2,this.m_perp=new b2Vec2,this.m_K=new b2Mat33,this.m_impulse=new b2Vec3},b2PrismaticJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r,i;this.m_localCenterA.SetV(t.GetLocalCenter()),this.m_localCenterB.SetV(n.GetLocalCenter());var s=t.GetTransform();n.GetTransform(),r=t.m_xf.R;var o=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y;i=r.col1.x*o+r.col2.x*u,u=r.col1.y*o+r.col2.y*u,o=i,r=n.m_xf.R;var a=this.m_localAnchor2.x-this.m_localCenterB.x,f=this.m_localAnchor2.y-this.m_localCenterB.y;i=r.col1.x*a+r.col2.x*f,f=r.col1.y*a+r.col2.y*f,a=i,r=n.m_sweep.c.x+a-t.m_sweep.c.x-o,i=n.m_sweep.c.y+f-t.m_sweep.c.y-u,this.m_invMassA=t.m_invMass,this.m_invMassB=n.m_invMass,this.m_invIA=t.m_invI,this.m_invIB=n.m_invI,this.m_axis.SetV(b2Math.MulMV(s.R,this.m_localXAxis1)),this.m_a1=(r+o)*this.m_axis.y-(i+u)*this.m_axis.x,this.m_a2=a*this.m_axis.y-f*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(b2Math.MulMV(s.R,this.m_localYAxis1)),this.m_s1=(r+o)*this.m_perp.y-(i+u)*this.m_perp.x,this.m_s2=a*this.m_perp.y-f*this.m_perp.x,s=this.m_invMassA,o=this.m_invMassB,u=this.m_invIA,a=this.m_invIB,this.m_K.col1.x=s+o+u*this.m_s1*this.m_s1+a*this.m_s2*this.m_s2,this.m_K.col1.y=u*this.m_s1+a*this.m_s2,this.m_K.col1.z=u*this.m_s1*this.m_a1+a*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=u+a,this.m_K.col2.z=u*this.m_a1+a*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=s+o+u*this.m_a1*this.m_a1+a*this.m_a2*this.m_a2,this.m_enableLimit?(r=this.m_axis.x*r+this.m_axis.y*i,b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:r<=this.m_lowerTranslation?this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitState=b2Joint.e_atLowerLimit,this.m_impulse.z=0):r>=this.m_upperTranslation?this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitState=b2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=b2Joint.e_inactiveLimit,this.m_enableMotor==0&&(this.m_motorImpulse=0),e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,r=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,i=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,s=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,t.m_linearVelocity.x-=this.m_invMassA*e,t.m_linearVelocity.y-=this.m_invMassA*r,t.m_angularVelocity-=this.m_invIA*i,n.m_linearVelocity.x+=this.m_invMassB*e,n.m_linearVelocity.y+=this.m_invMassB*r,n.m_angularVelocity+=this.m_invIB*s):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},b2PrismaticJoint.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=t.m_linearVelocity,i=t.m_angularVelocity,s=n.m_linearVelocity,o=n.m_angularVelocity,u,a,f;this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits&&(f=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*o-this.m_a1*i)),u=this.m_motorImpulse,e=e.dt*this.m_maxMotorForce,this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+f,-e,e),f=this.m_motorImpulse-u,u=f*this.m_axis.x,e=f*this.m_axis.y,a=f*this.m_a1,f*=this.m_a2,r.x-=this.m_invMassA*u,r.y-=this.m_invMassA*e,i-=this.m_invIA*a,s.x+=this.m_invMassB*u,s.y+=this.m_invMassB*e,o+=this.m_invIB*f),a=this.m_perp.x*(s.x-r.x)+this.m_perp.y*(s.y-r.y)+this.m_s2*o-this.m_s1*i,e=o-i,this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit?(f=this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*o-this.m_a1*i,u=this.m_impulse.Copy(),f=this.m_K.Solve33(new b2Vec3,-a,-e,-f),this.m_impulse.Add(f),this.m_limitState==b2Joint.e_atLowerLimit?this.m_impulse.z=b2Math.Max(this.m_impulse.z,0):this.m_limitState==b2Joint.e_atUpperLimit&&(this.m_impulse.z=b2Math.Min(this.m_impulse.z,0)),a=-a-(this.m_impulse.z-u.z)*this.m_K.col3.x,e=-e-(this.m_impulse.z-u.z)*this.m_K.col3.y,e=this.m_K.Solve22(new b2Vec2,a,e),e.x+=u.x,e.y+=u.y,this.m_impulse.x=e.x,this.m_impulse.y=e.y,f.x=this.m_impulse.x-u.x,f.y=this.m_impulse.y-u.y,f.z=this.m_impulse.z-u.z,u=f.x*this.m_perp.x+f.z*this.m_axis.x,e=f.x*this.m_perp.y+f.z*this.m_axis.y,a=f.x*this.m_s1+f.y+f.z*this.m_a1,f=f.x*this.m_s2+f.y+f.z*this.m_a2):(f=this.m_K.Solve22(new b2Vec2,-a,-e),this.m_impulse.x+=f.x,this.m_impulse.y+=f.y,u=f.x*this.m_perp.x,e=f.x*this.m_perp.y,a=f.x*this.m_s1+f.y,f=f.x*this.m_s2+f.y),r.x-=this.m_invMassA*u,r.y-=this.m_invMassA*e,i-=this.m_invIA*a,s.x+=this.m_invMassB*u,s.y+=this.m_invMassB*e,o+=this.m_invIB*f,t.m_linearVelocity.SetV(r),t.m_angularVelocity=i,n.m_linearVelocity.SetV(s),n.m_angularVelocity=o},b2PrismaticJoint.prototype.SolvePositionConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.m_sweep.c,r=e.m_sweep.a,i=t.m_sweep.c,s=t.m_sweep.a,o,u,a,f,l=0,c=0;a=!1;var h=0,p=b2Mat22.FromAngle(r),d=b2Mat22.FromAngle(s);o=p,c=this.m_localAnchor1.x-this.m_localCenterA.x;var v=this.m_localAnchor1.y-this.m_localCenterA.y;u=o.col1.x*c+o.col2.x*v,v=o.col1.y*c+o.col2.y*v,c=u,o=d,d=this.m_localAnchor2.x-this.m_localCenterB.x,f=this.m_localAnchor2.y-this.m_localCenterB.y,u=o.col1.x*d+o.col2.x*f,f=o.col1.y*d+o.col2.y*f,d=u,o=i.x+d-n.x-c,u=i.y+f-n.y-v;if(this.m_enableLimit){this.m_axis=b2Math.MulMV(p,this.m_localXAxis1),this.m_a1=(o+c)*this.m_axis.y-(u+v)*this.m_axis.x,this.m_a2=d*this.m_axis.y-f*this.m_axis.x;var m=this.m_axis.x*o+this.m_axis.y*u;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?(h=b2Math.Clamp(m,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),l=b2Math.Abs(m),a=!0):m<=this.m_lowerTranslation?(h=b2Math.Clamp(m-this.m_lowerTranslation+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),l=this.m_lowerTranslation-m,a=!0):m>=this.m_upperTranslation&&(h=b2Math.Clamp(m-this.m_upperTranslation+b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),l=m-this.m_upperTranslation,a=!0)}return this.m_perp=b2Math.MulMV(p,this.m_localYAxis1),this.m_s1=(o+c)*this.m_perp.y-(u+v)*this.m_perp.x,this.m_s2=d*this.m_perp.y-f*this.m_perp.x,p=new b2Vec3,v=this.m_perp.x*o+this.m_perp.y*u,d=s-r-this.m_refAngle,l=b2Math.Max(l,b2Math.Abs(v)),c=b2Math.Abs(d),a?(a=this.m_invMassA,f=this.m_invMassB,o=this.m_invIA,u=this.m_invIB,this.m_K.col1.x=a+f+o*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,this.m_K.col1.y=o*this.m_s1+u*this.m_s2,this.m_K.col1.z=o*this.m_s1*this.m_a1+u*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=o+u,this.m_K.col2.z=o*this.m_a1+u*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=a+f+o*this.m_a1*this.m_a1+u*this.m_a2*this.m_a2,this.m_K.Solve33(p,-v,-d,-h)):(a=this.m_invMassA,f=this.m_invMassB,o=this.m_invIA,u=this.m_invIB,h=o*this.m_s1+u*this.m_s2,m=o+u,this.m_K.col1.Set(a+f+o*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,h,0),this.m_K.col2.Set(h,m,0),h=this.m_K.Solve22(new b2Vec2,-v,-d),p.x=h.x,p.y=h.y,p.z=0),h=p.x*this.m_perp.x+p.z*this.m_axis.x,a=p.x*this.m_perp.y+p.z*this.m_axis.y,v=p.x*this.m_s1+p.y+p.z*this.m_a1,p=p.x*this.m_s2+p.y+p.z*this.m_a2,n.x-=this.m_invMassA*h,n.y-=this.m_invMassA*a,r-=this.m_invIA*v,i.x+=this.m_invMassB*h,i.y+=this.m_invMassB*a,s+=this.m_invIB*p,e.m_sweep.a=r,t.m_sweep.a=s,e.SynchronizeTransform(),t.SynchronizeTransform(),l<=b2Settings.b2_linearSlop&&c<=b2Settings.b2_angularSlop},b2PrismaticJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2PrismaticJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2PrismaticJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},b2PrismaticJoint.prototype.GetReactionTorque=function(e){return e*this.m_impulse.y},b2PrismaticJoint.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2);return t=r.x-n.x,n=r.y-n.y,e=e.GetWorldVector(this.m_localXAxis1),e.x*t+e.y*n},b2PrismaticJoint.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s,n=t.m_sweep.c.x+o-(e.m_sweep.c.x+r),s=t.m_sweep.c.y+u-(e.m_sweep.c.y+i);var a=e.GetWorldVector(this.m_localXAxis1),f=e.m_linearVelocity,l=t.m_linearVelocity;return e=e.m_angularVelocity,t=t.m_angularVelocity,n*-e*a.y+s*e*a.x+(a.x*(l.x+ -t*u-f.x- -e*i)+a.y*(l.y+t*o-f.y-e*r))},b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2PrismaticJoint.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},b2PrismaticJoint.prototype.SetLimits=function(e,t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},b2PrismaticJoint.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},b2PrismaticJoint.prototype.SetMotorSpeed=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2PrismaticJoint.prototype.SetMaxMotorForce=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},b2PrismaticJoint.prototype.m_localAnchor1=new b2Vec2,b2PrismaticJoint.prototype.m_localAnchor2=new b2Vec2,b2PrismaticJoint.prototype.m_localXAxis1=new b2Vec2,b2PrismaticJoint.prototype.m_localYAxis1=new b2Vec2,b2PrismaticJoint.prototype.m_refAngle=null,b2PrismaticJoint.prototype.m_axis=new b2Vec2,b2PrismaticJoint.prototype.m_perp=new b2Vec2,b2PrismaticJoint.prototype.m_s1=null,b2PrismaticJoint.prototype.m_s2=null,b2PrismaticJoint.prototype.m_a1=null,b2PrismaticJoint.prototype.m_a2=null,b2PrismaticJoint.prototype.m_K=new b2Mat33,b2PrismaticJoint.prototype.m_impulse=new b2Vec3,b2PrismaticJoint.prototype.m_motorMass=null,b2PrismaticJoint.prototype.m_motorImpulse=null,b2PrismaticJoint.prototype.m_lowerTranslation=null,b2PrismaticJoint.prototype.m_upperTranslation=null,b2PrismaticJoint.prototype.m_maxMotorForce=null,b2PrismaticJoint.prototype.m_motorSpeed=null,b2PrismaticJoint.prototype.m_enableLimit=null,b2PrismaticJoint.prototype.m_enableMotor=null,b2PrismaticJoint.prototype.m_limitState=0;var b2RevoluteJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2RevoluteJoint.prototype,b2Joint.prototype),b2RevoluteJoint.prototype._super=b2Joint.prototype,b2RevoluteJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=e.lowerAngle,this.m_upperAngle=e.upperAngle,this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit},b2RevoluteJoint.prototype.__varz=function(){this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.K3=new b2Mat22,this.impulse3=new b2Vec3,this.impulse2=new b2Vec2,this.reduced=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_impulse=new b2Vec3,this.m_mass=new b2Mat33},b2RevoluteJoint.tImpulse=new b2Vec2,b2RevoluteJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r,i;r=t.m_xf.R;var s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y;i=r.col1.x*s+r.col2.x*o,o=r.col1.y*s+r.col2.y*o,s=i,r=n.m_xf.R;var u=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y;i=r.col1.x*u+r.col2.x*a,a=r.col1.y*u+r.col2.y*a,u=i,r=t.m_invMass,i=n.m_invMass;var f=t.m_invI,l=n.m_invI;this.m_mass.col1.x=r+i+o*o*f+a*a*l,this.m_mass.col2.x=-o*s*f-a*u*l,this.m_mass.col3.x=-o*f-a*l,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=r+i+s*s*f+u*u*l,this.m_mass.col3.y=s*f+u*l,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=f+l,this.m_motorMass=1/(f+l),this.m_enableMotor==0&&(this.m_motorImpulse=0);if(this.m_enableLimit){var c=n.m_sweep.a-t.m_sweep.a-this.m_referenceAngle;b2Math.Abs(this.m_upperAngle-this.m_lowerAngle)<2*b2Settings.b2_angularSlop?this.m_limitState=b2Joint.e_equalLimits:c<=this.m_lowerAngle?(this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=b2Joint.e_atLowerLimit):c>=this.m_upperAngle?(this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=b2Joint.e_atUpperLimit):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=b2Joint.e_inactiveLimit;e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x,c=this.m_impulse.y,t.m_linearVelocity.x-=r*e,t.m_linearVelocity.y-=r*c,t.m_angularVelocity-=f*(s*c-o*e+this.m_motorImpulse+this.m_impulse.z),n.m_linearVelocity.x+=i*e,n.m_linearVelocity.y+=i*c,n.m_angularVelocity+=l*(u*c-a*e+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},b2RevoluteJoint.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r,i,s,o,u,a=t.m_linearVelocity,f=t.m_angularVelocity,l=n.m_linearVelocity,c=n.m_angularVelocity,h=t.m_invMass,p=n.m_invMass,d=t.m_invI,v=n.m_invI;this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits&&(s=this.m_motorMass*-(c-f-this.m_motorSpeed),o=this.m_motorImpulse,e=e.dt*this.m_maxMotorTorque,this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+s,-e,e),s=this.m_motorImpulse-o,f-=d*s,c+=v*s);if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){r=t.m_xf.R,s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,i=r.col1.x*s+r.col2.x*o,o=r.col1.y*s+r.col2.y*o,s=i,r=n.m_xf.R,e=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y,i=r.col1.x*e+r.col2.x*u,u=r.col1.y*e+r.col2.y*u,e=i,i=l.x+ -c*u-a.x- -f*o;var m=l.y+c*e-a.y-f*s;this.m_mass.Solve33(this.impulse3,-i,-m,-(c-f)),this.m_limitState==b2Joint.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==b2Joint.e_atLowerLimit?(r=this.m_impulse.z+this.impulse3.z,r<0&&(this.m_mass.Solve22(this.reduced,-i,-m),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==b2Joint.e_atUpperLimit&&(r=this.m_impulse.z+this.impulse3.z,r>0&&(this.m_mass.Solve22(this.reduced,-i,-m),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),a.x-=h*this.impulse3.x,a.y-=h*this.impulse3.y,f-=d*(s*this.impulse3.y-o*this.impulse3.x+this.impulse3.z),l.x+=p*this.impulse3.x,l.y+=p*this.impulse3.y,c+=v*(e*this.impulse3.y-u*this.impulse3.x+this.impulse3.z)}else r=t.m_xf.R,s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,i=r.col1.x*s+r.col2.x*o,o=r.col1.y*s+r.col2.y*o,s=i,r=n.m_xf.R,e=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y,i=r.col1.x*e+r.col2.x*u,u=r.col1.y*e+r.col2.y*u,e=i,this.m_mass.Solve22(this.impulse2,-(l.x+ -c*u-a.x- -f*o),-(l.y+c*e-a.y-f*s)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,a.x-=h*this.impulse2.x,a.y-=h*this.impulse2.y,f-=d*(s*this.impulse2.y-o*this.impulse2.x),l.x+=p*this.impulse2.x,l.y+=p*this.impulse2.y,c+=v*(e*this.impulse2.y-u*this.impulse2.x);t.m_linearVelocity.SetV(a),t.m_angularVelocity=f,n.m_linearVelocity.SetV(l),n.m_angularVelocity=c},b2RevoluteJoint.prototype.SolvePositionConstraints=function(){var e,t,n=this.m_bodyA,r=this.m_bodyB,i=0;t=0;var s,o,u;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){e=r.m_sweep.a-n.m_sweep.a-this.m_referenceAngle;var a=0;this.m_limitState==b2Joint.e_equalLimits?(e=b2Math.Clamp(e-this.m_lowerAngle,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection),a=-this.m_motorMass*e,i=b2Math.Abs(e)):this.m_limitState==b2Joint.e_atLowerLimit?(e-=this.m_lowerAngle,i=-e,e=b2Math.Clamp(e+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0),a=-this.m_motorMass*e):this.m_limitState==b2Joint.e_atUpperLimit&&(i=e-=this.m_upperAngle,e=b2Math.Clamp(e-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection),a=-this.m_motorMass*e),n.m_sweep.a-=n.m_invI*a,r.m_sweep.a+=r.m_invI*a,n.SynchronizeTransform(),r.SynchronizeTransform()}t=n.m_xf.R,a=this.m_localAnchor1.x-n.m_sweep.localCenter.x,e=this.m_localAnchor1.y-n.m_sweep.localCenter.y,s=t.col1.x*a+t.col2.x*e,e=t.col1.y*a+t.col2.y*e,a=s,t=r.m_xf.R;var f=this.m_localAnchor2.x-r.m_sweep.localCenter.x,l=this.m_localAnchor2.y-r.m_sweep.localCenter.y;s=t.col1.x*f+t.col2.x*l,l=t.col1.y*f+t.col2.y*l,f=s,o=r.m_sweep.c.x+f-n.m_sweep.c.x-a,u=r.m_sweep.c.y+l-n.m_sweep.c.y-e;var c=o*o+u*u;t=Math.sqrt(c),s=n.m_invMass;var h=r.m_invMass,p=n.m_invI,d=r.m_invI,v=10*b2Settings.b2_linearSlop;return c>v*v&&(c=1/(s+h),o=c*-o,u=c*-u,n.m_sweep.c.x-=.5*s*o,n.m_sweep.c.y-=.5*s*u,r.m_sweep.c.x+=.5*h*o,r.m_sweep.c.y+=.5*h*u,o=r.m_sweep.c.x+f-n.m_sweep.c.x-a,u=r.m_sweep.c.y+l-n.m_sweep.c.y-e),this.K1.col1.x=s+h,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=s+h,this.K2.col1.x=p*e*e,this.K2.col2.x=-p*a*e,this.K2.col1.y=-p*a*e,this.K2.col2.y=p*a*a,this.K3.col1.x=d*l*l,this.K3.col2.x=-d*f*l,this.K3.col1.y=-d*f*l,this.K3.col2.y=d*f*f,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(b2RevoluteJoint.tImpulse,-o,-u),o=b2RevoluteJoint.tImpulse.x,u=b2RevoluteJoint.tImpulse.y,n.m_sweep.c.x-=n.m_invMass*o,n.m_sweep.c.y-=n.m_invMass*u,n.m_sweep.a-=n.m_invI*(a*u-e*o),r.m_sweep.c.x+=r.m_invMass*o,r.m_sweep.c.y+=r.m_invMass*u,r.m_sweep.a+=r.m_invI*(f*u-l*o),n.SynchronizeTransform(),r.SynchronizeTransform(),t<=b2Settings.b2_linearSlop&&i<=b2Settings.b2_angularSlop},b2RevoluteJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2RevoluteJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2RevoluteJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_impulse.x,e*this.m_impulse.y)},b2RevoluteJoint.prototype.GetReactionTorque=function(e){return e*this.m_impulse.z},b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2RevoluteJoint.prototype.EnableLimit=function(e){this.m_enableLimit=e},b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},b2RevoluteJoint.prototype.SetLimits=function(e,t){this.m_lowerAngle=e,this.m_upperAngle=t},b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},b2RevoluteJoint.prototype.EnableMotor=function(e){this.m_enableMotor=e},b2RevoluteJoint.prototype.SetMotorSpeed=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2RevoluteJoint.prototype.SetMaxMotorTorque=function(e){this.m_maxMotorTorque=e},b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},b2RevoluteJoint.prototype.K=new b2Mat22,b2RevoluteJoint.prototype.K1=new b2Mat22,b2RevoluteJoint.prototype.K2=new b2Mat22,b2RevoluteJoint.prototype.K3=new b2Mat22,b2RevoluteJoint.prototype.impulse3=new b2Vec3,b2RevoluteJoint.prototype.impulse2=new b2Vec2,b2RevoluteJoint.prototype.reduced=new b2Vec2,b2RevoluteJoint.prototype.m_localAnchor1=new b2Vec2,b2RevoluteJoint.prototype.m_localAnchor2=new b2Vec2,b2RevoluteJoint.prototype.m_impulse=new b2Vec3,b2RevoluteJoint.prototype.m_motorImpulse=null,b2RevoluteJoint.prototype.m_mass=new b2Mat33,b2RevoluteJoint.prototype.m_motorMass=null,b2RevoluteJoint.prototype.m_enableMotor=null,b2RevoluteJoint.prototype.m_maxMotorTorque=null,b2RevoluteJoint.prototype.m_motorSpeed=null,b2RevoluteJoint.prototype.m_enableLimit=null,b2RevoluteJoint.prototype.m_referenceAngle=null,b2RevoluteJoint.prototype.m_lowerAngle=null,b2RevoluteJoint.prototype.m_upperAngle=null,b2RevoluteJoint.prototype.m_limitState=0;var b2JointDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2JointDef.prototype.__constructor=function(){this.type=b2Joint.e_unknownJoint,this.bodyB=this.bodyA=this.userData=null,this.collideConnected=!1},b2JointDef.prototype.__varz=function(){},b2JointDef.prototype.type=0,b2JointDef.prototype.userData=null,b2JointDef.prototype.bodyA=null,b2JointDef.prototype.bodyB=null,b2JointDef.prototype.collideConnected=null;var b2LineJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2LineJointDef.prototype,b2JointDef.prototype),b2LineJointDef.prototype._super=b2JointDef.prototype,b2LineJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},b2LineJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.localAxisA=new b2Vec2},b2LineJointDef.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r)},b2LineJointDef.prototype.localAnchorA=new b2Vec2,b2LineJointDef.prototype.localAnchorB=new b2Vec2,b2LineJointDef.prototype.localAxisA=new b2Vec2,b2LineJointDef.prototype.enableLimit=null,b2LineJointDef.prototype.lowerTranslation=null,b2LineJointDef.prototype.upperTranslation=null,b2LineJointDef.prototype.enableMotor=null,b2LineJointDef.prototype.maxMotorForce=null,b2LineJointDef.prototype.motorSpeed=null;var b2DistanceJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2DistanceJoint.prototype,b2Joint.prototype),b2DistanceJoint.prototype._super=b2Joint.prototype,b2DistanceJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_length=e.length,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_bias=this.m_gamma=this.m_impulse=0},b2DistanceJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u=new b2Vec2},b2DistanceJoint.prototype.InitVelocityConstraints=function(e){var t,n,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchor1.x-r.m_sweep.localCenter.x,o=this.m_localAnchor1.y-r.m_sweep.localCenter.y;n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n,t=i.m_xf.R;var u=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n,this.m_u.x=i.m_sweep.c.x+u-r.m_sweep.c.x-s,this.m_u.y=i.m_sweep.c.y+a-r.m_sweep.c.y-o,n=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),n>b2Settings.b2_linearSlop?this.m_u.Multiply(1/n):this.m_u.SetZero(),t=s*this.m_u.y-o*this.m_u.x;var f=u*this.m_u.y-a*this.m_u.x;t=r.m_invMass+r.m_invI*t*t+i.m_invMass+i.m_invI*f*f,this.m_mass=t!=0?1/t:0;if(this.m_frequencyHz>0){n-=this.m_length,f=2*Math.PI*this.m_frequencyHz;var l=this.m_mass*f*f;this.m_gamma=e.dt*(2*this.m_mass*this.m_dampingRatio*f+e.dt*l),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=n*e.dt*l*this.m_gamma,this.m_mass=t+this.m_gamma,this.m_mass=this.m_mass!=0?1/this.m_mass:0}e.warmStarting?(this.m_impulse*=e.dtRatio,e=this.m_impulse*this.m_u.x,t=this.m_impulse*this.m_u.y,r.m_linearVelocity.x-=r.m_invMass*e,r.m_linearVelocity.y-=r.m_invMass*t,r.m_angularVelocity-=r.m_invI*(s*t-o*e),i.m_linearVelocity.x+=i.m_invMass*e,i.m_linearVelocity.y+=i.m_invMass*t,i.m_angularVelocity+=i.m_invI*(u*t-a*e)):this.m_impulse=0},b2DistanceJoint.prototype.SolveVelocityConstraints=function(){var e,t=this.m_bodyA,n=this.m_bodyB;e=t.m_xf.R;var r=this.m_localAnchor1.x-t.m_sweep.localCenter.x,i=this.m_localAnchor1.y-t.m_sweep.localCenter.y,s=e.col1.x*r+e.col2.x*i;i=e.col1.y*r+e.col2.y*i,r=s,e=n.m_xf.R;var o=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=e.col1.x*o+e.col2.x*u,u=e.col1.y*o+e.col2.y*u,o=s,s=-this.m_mass*(this.m_u.x*(n.m_linearVelocity.x+ -n.m_angularVelocity*u-(t.m_linearVelocity.x+ -t.m_angularVelocity*i))+this.m_u.y*(n.m_linearVelocity.y+n.m_angularVelocity*o-(t.m_linearVelocity.y+t.m_angularVelocity*r))+this.m_bias+this.m_gamma*this.m_impulse),this.m_impulse+=s,e=s*this.m_u.x,s*=this.m_u.y,t.m_linearVelocity.x-=t.m_invMass*e,t.m_linearVelocity.y-=t.m_invMass*s,t.m_angularVelocity-=t.m_invI*(r*s-i*e),n.m_linearVelocity.x+=n.m_invMass*e,n.m_linearVelocity.y+=n.m_invMass*s,n.m_angularVelocity+=n.m_invI*(o*s-u*e)},b2DistanceJoint.prototype.SolvePositionConstraints=function(){var e;if(this.m_frequencyHz>0)return!0;var t=this.m_bodyA,n=this.m_bodyB;e=t.m_xf.R;var r=this.m_localAnchor1.x-t.m_sweep.localCenter.x,i=this.m_localAnchor1.y-t.m_sweep.localCenter.y,s=e.col1.x*r+e.col2.x*i;i=e.col1.y*r+e.col2.y*i,r=s,e=n.m_xf.R;var o=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=e.col1.x*o+e.col2.x*u,u=e.col1.y*o+e.col2.y*u,o=s,s=n.m_sweep.c.x+o-t.m_sweep.c.x-r;var a=n.m_sweep.c.y+u-t.m_sweep.c.y-i;e=Math.sqrt(s*s+a*a),s/=e,a/=e,e-=this.m_length,e=b2Math.Clamp(e,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var f=-this.m_mass*e;return this.m_u.Set(s,a),s=f*this.m_u.x,a=f*this.m_u.y,t.m_sweep.c.x-=t.m_invMass*s,t.m_sweep.c.y-=t.m_invMass*a,t.m_sweep.a-=t.m_invI*(r*a-i*s),n.m_sweep.c.x+=n.m_invMass*s,n.m_sweep.c.y+=n.m_invMass*a,n.m_sweep.a+=n.m_invI*(o*a-u*s),t.SynchronizeTransform(),n.SynchronizeTransform(),b2Math.Abs(e)<b2Settings.b2_linearSlop},b2DistanceJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2DistanceJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2DistanceJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)},b2DistanceJoint.prototype.GetReactionTorque=function(){return 0},b2DistanceJoint.prototype.GetLength=function(){return this.m_length},b2DistanceJoint.prototype.SetLength=function(e){this.m_length=e},b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},b2DistanceJoint.prototype.SetFrequency=function(e){this.m_frequencyHz=e},b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b2DistanceJoint.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e},b2DistanceJoint.prototype.m_localAnchor1=new b2Vec2,b2DistanceJoint.prototype.m_localAnchor2=new b2Vec2,b2DistanceJoint.prototype.m_u=new b2Vec2,b2DistanceJoint.prototype.m_frequencyHz=null,b2DistanceJoint.prototype.m_dampingRatio=null,b2DistanceJoint.prototype.m_gamma=null,b2DistanceJoint.prototype.m_bias=null,b2DistanceJoint.prototype.m_impulse=null,b2DistanceJoint.prototype.m_mass=null,b2DistanceJoint.prototype.m_length=null;var b2PulleyJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PulleyJointDef.prototype,b2JointDef.prototype),b2PulleyJointDef.prototype._super=b2JointDef.prototype,b2PulleyJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0,this.ratio=1,this.collideConnected=!0},b2PulleyJointDef.prototype.__varz=function(){this.groundAnchorA=new b2Vec2,this.groundAnchorB=new b2Vec2,this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2PulleyJointDef.prototype.Initialize=function(e,t,n,r,i,s,o){this.bodyA=e,this.bodyB=t,this.groundAnchorA.SetV(n),this.groundAnchorB.SetV(r),this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(s),e=i.x-n.x,n=i.y-n.y,this.lengthA=Math.sqrt(e*e+n*n),n=s.x-r.x,r=s.y-r.y,this.lengthB=Math.sqrt(n*n+r*r),this.ratio=o,o=this.lengthA+this.ratio*this.lengthB,this.maxLengthA=o-this.ratio*b2PulleyJoint.b2_minPulleyLength,this.maxLengthB=(o-b2PulleyJoint.b2_minPulleyLength)/this.ratio},b2PulleyJointDef.prototype.groundAnchorA=new b2Vec2,b2PulleyJointDef.prototype.groundAnchorB=new b2Vec2,b2PulleyJointDef.prototype.localAnchorA=new b2Vec2,b2PulleyJointDef.prototype.localAnchorB=new b2Vec2,b2PulleyJointDef.prototype.lengthA=null,b2PulleyJointDef.prototype.maxLengthA=null,b2PulleyJointDef.prototype.lengthB=null,b2PulleyJointDef.prototype.maxLengthB=null,b2PulleyJointDef.prototype.ratio=null;var b2DistanceJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2DistanceJointDef.prototype,b2JointDef.prototype),b2DistanceJointDef.prototype._super=b2JointDef.prototype,b2DistanceJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_distanceJoint,this.length=1,this.dampingRatio=this.frequencyHz=0},b2DistanceJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2DistanceJointDef.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(r)),e=r.x-n.x,n=r.y-n.y,this.length=Math.sqrt(e*e+n*n),this.dampingRatio=this.frequencyHz=0},b2DistanceJointDef.prototype.localAnchorA=new b2Vec2,b2DistanceJointDef.prototype.localAnchorB=new b2Vec2,b2DistanceJointDef.prototype.length=null,b2DistanceJointDef.prototype.frequencyHz=null,b2DistanceJointDef.prototype.dampingRatio=null;var b2FrictionJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2FrictionJointDef.prototype,b2JointDef.prototype),b2FrictionJointDef.prototype._super=b2JointDef.prototype,b2FrictionJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_frictionJoint,this.maxTorque=this.maxForce=0},b2FrictionJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2FrictionJointDef.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n))},b2FrictionJointDef.prototype.localAnchorA=new b2Vec2,b2FrictionJointDef.prototype.localAnchorB=new b2Vec2,b2FrictionJointDef.prototype.maxForce=null,b2FrictionJointDef.prototype.maxTorque=null;var b2WeldJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2WeldJointDef.prototype,b2JointDef.prototype),b2WeldJointDef.prototype._super=b2JointDef.prototype,b2WeldJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_weldJoint,this.referenceAngle=0},b2WeldJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2WeldJointDef.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2WeldJointDef.prototype.localAnchorA=new b2Vec2,b2WeldJointDef.prototype.localAnchorB=new b2Vec2,b2WeldJointDef.prototype.referenceAngle=null;var b2GearJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GearJointDef.prototype,b2JointDef.prototype),b2GearJointDef.prototype._super=b2JointDef.prototype,b2GearJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_gearJoint,this.joint2=this.joint1=null,this.ratio=1},b2GearJointDef.prototype.__varz=function(){},b2GearJointDef.prototype.joint1=null,b2GearJointDef.prototype.joint2=null,b2GearJointDef.prototype.ratio=null;var b2Color=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Color.prototype.__constructor=function(e,t,n){this._r=parseInt(255*b2Math.Clamp(e,0,1)),this._g=parseInt(255*b2Math.Clamp(t,0,1)),this._b=parseInt(255*b2Math.Clamp(n,0,1))},b2Color.prototype.__varz=function(){},b2Color.prototype.Set=function(e,t,n){this._r=parseInt(255*b2Math.Clamp(e,0,1)),this._g=parseInt(255*b2Math.Clamp(t,0,1)),this._b=parseInt(255*b2Math.Clamp(n,0,1))},b2Color.prototype.__defineGetter__("r",function(){return this._r}),b2Color.prototype.__defineSetter__("r",function(e){this._r=parseInt(255*b2Math.Clamp(e,0,1))}),b2Color.prototype.__defineGetter__("g",function(){return this._g}),b2Color.prototype.__defineSetter__("g",function(e){this._g=parseInt(255*b2Math.Clamp(e,0,1))}),b2Color.prototype.__defineGetter__("b",function(){return this._b}),b2Color.prototype.__defineSetter__("b",function(e){this._b=parseInt(255*b2Math.Clamp(e,0,1))}),b2Color.prototype.__defineGetter__("color",function(){return this._r<<16|this._g<<8|this._b}),b2Color.prototype._r=0,b2Color.prototype._g=0,b2Color.prototype._b=0;var b2FrictionJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2FrictionJoint.prototype,b2Joint.prototype),b2FrictionJoint.prototype._super=b2Joint.prototype,b2FrictionJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=e.maxForce,this.m_maxTorque=e.maxTorque},b2FrictionJoint.prototype.__varz=function(){this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_linearImpulse=new b2Vec2,this.m_linearMass=new b2Mat22},b2FrictionJoint.prototype.InitVelocityConstraints=function(e){var t,n,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x,o=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n,t=i.m_xf.R;var u=this.m_localAnchorB.x-i.m_sweep.localCenter.x,a=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n,t=r.m_invMass,n=i.m_invMass;var f=r.m_invI,l=i.m_invI,c=new b2Mat22;c.col1.x=t+n,c.col2.x=0,c.col1.y=0,c.col2.y=t+n,c.col1.x+=f*o*o,c.col2.x+=-f*s*o,c.col1.y+=-f*s*o,c.col2.y+=f*s*s,c.col1.x+=l*a*a,c.col2.x+=-l*u*a,c.col1.y+=-l*u*a,c.col2.y+=l*u*u,c.GetInverse(this.m_linearMass),this.m_angularMass=f+l,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.warmStarting?(this.m_linearImpulse.x*=e.dtRatio,this.m_linearImpulse.y*=e.dtRatio,this.m_angularImpulse*=e.dtRatio,e=this.m_linearImpulse,r.m_linearVelocity.x-=t*e.x,r.m_linearVelocity.y-=t*e.y,r.m_angularVelocity-=f*(s*e.y-o*e.x+this.m_angularImpulse),i.m_linearVelocity.x+=n*e.x,i.m_linearVelocity.y+=n*e.y,i.m_angularVelocity+=l*(u*e.y-a*e.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},b2FrictionJoint.prototype.SolveVelocityConstraints=function(e){var t,n,r=this.m_bodyA,i=this.m_bodyB,s=r.m_linearVelocity,o=r.m_angularVelocity,u=i.m_linearVelocity,a=i.m_angularVelocity,f=r.m_invMass,l=i.m_invMass,c=r.m_invI,h=i.m_invI;t=r.m_xf.R;var p=this.m_localAnchorA.x-r.m_sweep.localCenter.x,d=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*p+t.col2.x*d,d=t.col1.y*p+t.col2.y*d,p=n,t=i.m_xf.R;var v=this.m_localAnchorB.x-i.m_sweep.localCenter.x,m=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*v+t.col2.x*m,m=t.col1.y*v+t.col2.y*m,v=n,n=-this.m_angularMass*(a-o);var g=this.m_angularImpulse;t=e.dt*this.m_maxTorque,this.m_angularImpulse=b2Math.Clamp(this.m_angularImpulse+n,-t,t),n=this.m_angularImpulse-g,o-=c*n,a+=h*n,t=b2Math.MulMV(this.m_linearMass,new b2Vec2(-(u.x-a*m-s.x+o*d),-(u.y+a*v-s.y-o*p))),n=this.m_linearImpulse.Copy(),this.m_linearImpulse.Add(t),t=e.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>t*t&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(t)),t=b2Math.SubtractVV(this.m_linearImpulse,n),s.x-=f*t.x,s.y-=f*t.y,o-=c*(p*t.y-d*t.x),u.x+=l*t.x,u.y+=l*t.y,a+=h*(v*t.y-m*t.x),r.m_angularVelocity=o,i.m_angularVelocity=a},b2FrictionJoint.prototype.SolvePositionConstraints=function(){return!0},b2FrictionJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},b2FrictionJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},b2FrictionJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_linearImpulse.x,e*this.m_linearImpulse.y)},b2FrictionJoint.prototype.GetReactionTorque=function(e){return e*this.m_angularImpulse},b2FrictionJoint.prototype.SetMaxForce=function(e){this.m_maxForce=e},b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},b2FrictionJoint.prototype.SetMaxTorque=function(e){this.m_maxTorque=e},b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},b2FrictionJoint.prototype.m_localAnchorA=new b2Vec2,b2FrictionJoint.prototype.m_localAnchorB=new b2Vec2,b2FrictionJoint.prototype.m_linearImpulse=new b2Vec2,b2FrictionJoint.prototype.m_angularImpulse=null,b2FrictionJoint.prototype.m_maxForce=null,b2FrictionJoint.prototype.m_maxTorque=null,b2FrictionJoint.prototype.m_linearMass=new b2Mat22,b2FrictionJoint.prototype.m_angularMass=null;var b2Distance=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Distance.prototype.__constructor=function(){},b2Distance.prototype.__varz=function(){},b2Distance.Distance=function(e,t,n){++b2Distance.b2_gjkCalls;var r=n.proxyA,i=n.proxyB,s=n.transformA,o=n.transformB,u=b2Distance.s_simplex;u.ReadCache(t,r,s,i,o);var a=u.m_vertices,f=b2Distance.s_saveA,l=b2Distance.s_saveB,c=0;u.GetClosestPoint().LengthSquared();for(var h=0,p,d=0;d<20;){c=u.m_count;for(h=0;h<c;h++)f[h]=a[h].indexA,l[h]=a[h].indexB;switch(u.m_count){case 1:break;case 2:u.Solve2();break;case 3:u.Solve3();break;default:b2Settings.b2Assert(!1)}if(u.m_count==3)break;p=u.GetClosestPoint(),p.LengthSquared(),h=u.GetSearchDirection();if(h.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;p=a[u.m_count],p.indexA=r.GetSupport(b2Math.MulTMV(s.R,h.GetNegative())),p.wA=b2Math.MulX(s,r.GetVertex(p.indexA)),p.indexB=i.GetSupport(b2Math.MulTMV(o.R,h)),p.wB=b2Math.MulX(o,i.GetVertex(p.indexB)),p.w=b2Math.SubtractVV(p.wB,p.wA),++d,++b2Distance.b2_gjkIters;var v=!1;for(h=0;h<c;h++)if(p.indexA==f[h]&&p.indexB==l[h]){v=!0;break}if(v)break;++u.m_count}b2Distance.b2_gjkMaxIters=b2Math.Max(b2Distance.b2_gjkMaxIters,d),u.GetWitnessPoints(e.pointA,e.pointB),e.distance=b2Math.SubtractVV(e.pointA,e.pointB).Length(),e.iterations=d,u.WriteCache(t),n.useRadii&&(t=r.m_radius,i=i.m_radius,e.distance>t+i&&e.distance>Number.MIN_VALUE?(e.distance-=t+i,n=b2Math.SubtractVV(e.pointB,e.pointA),n.Normalize(),e.pointA.x+=t*n.x,e.pointA.y+=t*n.y,e.pointB.x-=i*n.x,e.pointB.y-=i*n.y):(p=new b2Vec2,p.x=.5*(e.pointA.x+e.pointB.x),p.y=.5*(e.pointA.y+e.pointB.y),e.pointA.x=e.pointB.x=p.x,e.pointA.y=e.pointB.y=p.y,e.distance=0))},b2Distance.b2_gjkCalls=0,b2Distance.b2_gjkIters=0,b2Distance.b2_gjkMaxIters=0,b2Distance.s_simplex=new b2Simplex,b2Distance.s_saveA=Array(3),b2Distance.s_saveB=Array(3);var b2MouseJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2MouseJoint.prototype,b2Joint.prototype),b2MouseJoint.prototype._super=b2Joint.prototype,b2MouseJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_target.SetV(e.target);var t=this.m_target.x-this.m_bodyB.m_xf.position.x,n=this.m_target.y-this.m_bodyB.m_xf.position.y,r=this.m_bodyB.m_xf.R;this.m_localAnchor.x=t*r.col1.x+n*r.col1.y,this.m_localAnchor.y=t*r.col2.x+n*r.col2.y,this.m_maxForce=e.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_gamma=this.m_beta=0},b2MouseJoint.prototype.__varz=function(){this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.m_localAnchor=new b2Vec2,this.m_target=new b2Vec2,this.m_impulse=new b2Vec2,this.m_mass=new b2Mat22,this.m_C=new b2Vec2},b2MouseJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyB,n=t.GetMass(),r=2*Math.PI*this.m_frequencyHz,i=n*r*r;this.m_gamma=e.dt*(2*n*this.m_dampingRatio*r+e.dt*i),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_beta=e.dt*i*this.m_gamma,i=t.m_xf.R,n=this.m_localAnchor.x-t.m_sweep.localCenter.x,r=this.m_localAnchor.y-t.m_sweep.localCenter.y;var s=i.col1.x*n+i.col2.x*r;r=i.col1.y*n+i.col2.y*r,n=s,i=t.m_invMass,s=t.m_invI,this.K1.col1.x=i,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=i,this.K2.col1.x=s*r*r,this.K2.col2.x=-s*n*r,this.K2.col1.y=-s*n*r,this.K2.col2.y=s*n*n,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=t.m_sweep.c.x+n-this.m_target.x,this.m_C.y=t.m_sweep.c.y+r-this.m_target.y,t.m_angularVelocity*=.98,this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,t.m_linearVelocity.x+=i*this.m_impulse.x,t.m_linearVelocity.y+=i*this.m_impulse.y,t.m_angularVelocity+=s*(n*this.m_impulse.y-r*this.m_impulse.x)},b2MouseJoint.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyB,n,r,i;n=t.m_xf.R;var s=this.m_localAnchor.x-t.m_sweep.localCenter.x,o=this.m_localAnchor.y-t.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*o,o=n.col1.y*s+n.col2.y*o,s=r,r=t.m_linearVelocity.x+ -t.m_angularVelocity*o;var u=t.m_linearVelocity.y+t.m_angularVelocity*s;n=this.m_mass,r=r+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,i=u+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y,u=-(n.col1.x*r+n.col2.x*i),i=-(n.col1.y*r+n.col2.y*i),n=this.m_impulse.x,r=this.m_impulse.y,this.m_impulse.x+=u,this.m_impulse.y+=i,e=e.dt*this.m_maxForce,this.m_impulse.LengthSquared()>e*e&&this.m_impulse.Multiply(e/this.m_impulse.Length()),u=this.m_impulse.x-n,i=this.m_impulse.y-r,t.m_linearVelocity.x+=t.m_invMass*u,t.m_linearVelocity.y+=t.m_invMass*i,t.m_angularVelocity+=t.m_invI*(s*i-o*u)},b2MouseJoint.prototype.SolvePositionConstraints=function(){return!0},b2MouseJoint.prototype.GetAnchorA=function(){return this.m_target},b2MouseJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},b2MouseJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_impulse.x,e*this.m_impulse.y)},b2MouseJoint.prototype.GetReactionTorque=function(){return 0},b2MouseJoint.prototype.GetTarget=function(){return this.m_target},b2MouseJoint.prototype.SetTarget=function(e){this.m_bodyB.IsAwake()==0&&this.m_bodyB.SetAwake(!0),this.m_target=e},b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce},b2MouseJoint.prototype.SetMaxForce=function(e){this.m_maxForce=e},b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},b2MouseJoint.prototype.SetFrequency=function(e){this.m_frequencyHz=e},b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b2MouseJoint.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e},b2MouseJoint.prototype.K=new b2Mat22,b2MouseJoint.prototype.K1=new b2Mat22,b2MouseJoint.prototype.K2=new b2Mat22,b2MouseJoint.prototype.m_localAnchor=new b2Vec2,b2MouseJoint.prototype.m_target=new b2Vec2,b2MouseJoint.prototype.m_impulse=new b2Vec2,b2MouseJoint.prototype.m_mass=new b2Mat22,b2MouseJoint.prototype.m_C=new b2Vec2,b2MouseJoint.prototype.m_maxForce=null,b2MouseJoint.prototype.m_frequencyHz=null,b2MouseJoint.prototype.m_dampingRatio=null,b2MouseJoint.prototype.m_beta=null,b2MouseJoint.prototype.m_gamma=null;var b2PrismaticJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PrismaticJointDef.prototype,b2JointDef.prototype),b2PrismaticJointDef.prototype._super=b2JointDef.prototype,b2PrismaticJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},b2PrismaticJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.localAxisA=new b2Vec2},b2PrismaticJointDef.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2PrismaticJointDef.prototype.localAnchorA=new b2Vec2,b2PrismaticJointDef.prototype.localAnchorB=new b2Vec2,b2PrismaticJointDef.prototype.localAxisA=new b2Vec2,b2PrismaticJointDef.prototype.referenceAngle=null,b2PrismaticJointDef.prototype.enableLimit=null,b2PrismaticJointDef.prototype.lowerTranslation=null,b2PrismaticJointDef.prototype.upperTranslation=null,b2PrismaticJointDef.prototype.enableMotor=null,b2PrismaticJointDef.prototype.maxMotorForce=null,b2PrismaticJointDef.prototype.motorSpeed=null;var b2TimeOfImpact=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TimeOfImpact.prototype.__constructor=function(){},b2TimeOfImpact.prototype.__varz=function(){},b2TimeOfImpact.TimeOfImpact=function(e){++b2TimeOfImpact.b2_toiCalls;var t=e.proxyA,n=e.proxyB,r=e.sweepA,i=e.sweepB;b2Settings.b2Assert(r.t0==i.t0),b2Settings.b2Assert(1-r.t0>Number.MIN_VALUE);var s=t.m_radius+n.m_radius;e=e.tolerance;var o=0,u=0,a=0;b2TimeOfImpact.s_cache.count=0;for(b2TimeOfImpact.s_distanceInput.useRadii=!1;;){r.GetTransform(b2TimeOfImpact.s_xfA,o),i.GetTransform(b2TimeOfImpact.s_xfB,o),b2TimeOfImpact.s_distanceInput.proxyA=t,b2TimeOfImpact.s_distanceInput.proxyB=n,b2TimeOfImpact.s_distanceInput.transformA=b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_distanceInput.transformB=b2TimeOfImpact.s_xfB,b2Distance.Distance(b2TimeOfImpact.s_distanceOutput,b2TimeOfImpact.s_cache,b2TimeOfImpact.s_distanceInput);if(b2TimeOfImpact.s_distanceOutput.distance<=0){o=1;break}b2TimeOfImpact.s_fcn.Initialize(b2TimeOfImpact.s_cache,t,b2TimeOfImpact.s_xfA,n,b2TimeOfImpact.s_xfB);var f=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(f<=0){o=1;break}u==0&&(a=f>s?b2Math.Max(s-e,.75*s):b2Math.Max(f-e,.02*s));if(f-a<.5*e){if(u==0){o=1;break}break}var l=o,c=o,h=1;f=f,r.GetTransform(b2TimeOfImpact.s_xfA,h),i.GetTransform(b2TimeOfImpact.s_xfB,h);var p=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(p>=a){o=1;break}for(var d=0;;){var v;v=d&1?c+(a-f)*(h-c)/(p-f):.5*(c+h),r.GetTransform(b2TimeOfImpact.s_xfA,v),i.GetTransform(b2TimeOfImpact.s_xfB,v);var m=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(b2Math.Abs(m-a)<.025*e){l=v;break}m>a?(c=v,f=m):(h=v,p=m),++d,++b2TimeOfImpact.b2_toiRootIters;if(d==50)break}b2TimeOfImpact.b2_toiMaxRootIters=b2Math.Max(b2TimeOfImpact.b2_toiMaxRootIters,d);if(l<(1+100*Number.MIN_VALUE)*o)break;o=l,u++,++b2TimeOfImpact.b2_toiIters;if(u==1e3)break}return b2TimeOfImpact.b2_toiMaxIters=b2Math.Max(b2TimeOfImpact.b2_toiMaxIters,u),o},b2TimeOfImpact.b2_toiCalls=0,b2TimeOfImpact.b2_toiIters=0,b2TimeOfImpact.b2_toiMaxIters=0,b2TimeOfImpact.b2_toiRootIters=0,b2TimeOfImpact.b2_toiMaxRootIters=0,b2TimeOfImpact.s_cache=new b2SimplexCache,b2TimeOfImpact.s_distanceInput=new b2DistanceInput,b2TimeOfImpact.s_xfA=new b2Transform,b2TimeOfImpact.s_xfB=new b2Transform,b2TimeOfImpact.s_fcn=new b2SeparationFunction,b2TimeOfImpact.s_distanceOutput=new b2DistanceOutput;var b2GearJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GearJoint.prototype,b2Joint.prototype),b2GearJoint.prototype._super=b2Joint.prototype,b2GearJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]);var t=e.joint1.m_type,n=e.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null,this.m_ground1=e.joint1.GetBodyA(),this.m_bodyA=e.joint1.GetBodyB(),t==b2Joint.e_revoluteJoint?(this.m_revolute1=e.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),t=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=e.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),t=this.m_prismatic1.GetJointTranslation()),this.m_ground2=e.joint2.GetBodyA(),this.m_bodyB=e.joint2.GetBodyB(),n==b2Joint.e_revoluteJoint?(this.m_revolute2=e.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),n=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=e.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),n=this.m_prismatic2.GetJointTranslation()),this.m_ratio=e.ratio,this.m_constant=t+this.m_ratio*n,this.m_impulse=0},b2GearJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_J=new b2Jacobian},b2GearJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_ground1,n=this.m_ground2,r=this.m_bodyA,i=this.m_bodyB,s,o,u,a,f,l=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,l+=r.m_invI):(a=t.m_xf.R,s=this.m_prismatic1.m_localXAxis1,t=a.col1.x*s.x+a.col2.x*s.y,s=a.col1.y*s.x+a.col2.y*s.y,a=r.m_xf.R,o=this.m_localAnchor1.x-r.m_sweep.localCenter.x,u=this.m_localAnchor1.y-r.m_sweep.localCenter.y,f=a.col1.x*o+a.col2.x*u,u=a.col1.y*o+a.col2.y*u,o=f,a=o*s-u*t,this.m_J.linearA.Set(-t,-s),this.m_J.angularA=-a,l+=r.m_invMass+r.m_invI*a*a),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,l+=this.m_ratio*this.m_ratio*i.m_invI):(a=n.m_xf.R,s=this.m_prismatic2.m_localXAxis1,t=a.col1.x*s.x+a.col2.x*s.y,s=a.col1.y*s.x+a.col2.y*s.y,a=i.m_xf.R,o=this.m_localAnchor2.x-i.m_sweep.localCenter.x,u=this.m_localAnchor2.y-i.m_sweep.localCenter.y,f=a.col1.x*o+a.col2.x*u,u=a.col1.y*o+a.col2.y*u,o=f,a=o*s-u*t,this.m_J.linearB.Set(-this.m_ratio*t,-this.m_ratio*s),this.m_J.angularB=-this.m_ratio*a,l+=this.m_ratio*this.m_ratio*(i.m_invMass+i.m_invI*a*a)),this.m_mass=l>0?1/l:0,e.warmStarting?(r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearA.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearA.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularA,i.m_linearVelocity.x+=i.m_invMass*this.m_impulse*this.m_J.linearB.x,i.m_linearVelocity.y+=i.m_invMass*this.m_impulse*this.m_J.linearB.y,i.m_angularVelocity+=i.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},b2GearJoint.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n=-this.m_mass*this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,t.m_linearVelocity,t.m_angularVelocity);this.m_impulse+=n,e.m_linearVelocity.x+=e.m_invMass*n*this.m_J.linearA.x,e.m_linearVelocity.y+=e.m_invMass*n*this.m_J.linearA.y,e.m_angularVelocity+=e.m_invI*n*this.m_J.angularA,t.m_linearVelocity.x+=t.m_invMass*n*this.m_J.linearB.x,t.m_linearVelocity.y+=t.m_invMass*n*this.m_J.linearB.y,t.m_angularVelocity+=t.m_invI*n*this.m_J.angularB},b2GearJoint.prototype.SolvePositionConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n,r;return n=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),r=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),n=-this.m_mass*(this.m_constant-(n+this.m_ratio*r)),e.m_sweep.c.x+=e.m_invMass*n*this.m_J.linearA.x,e.m_sweep.c.y+=e.m_invMass*n*this.m_J.linearA.y,e.m_sweep.a+=e.m_invI*n*this.m_J.angularA,t.m_sweep.c.x+=t.m_invMass*n*this.m_J.linearB.x,t.m_sweep.c.y+=t.m_invMass*n*this.m_J.linearB.y,t.m_sweep.a+=t.m_invI*n*this.m_J.angularB,e.SynchronizeTransform(),t.SynchronizeTransform(),0<b2Settings.b2_linearSlop},b2GearJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2GearJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2GearJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_impulse*this.m_J.linearB.x,e*this.m_impulse*this.m_J.linearB.y)},b2GearJoint.prototype.GetReactionTorque=function(e){var t=this.m_bodyB.m_xf.R,n=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,r=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,i=t.col1.x*n+t.col2.x*r;return r=t.col1.y*n+t.col2.y*r,n=i,e*(this.m_impulse*this.m_J.angularB-n*this.m_impulse*this.m_J.linearB.y+r*this.m_impulse*this.m_J.linearB.x)},b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},b2GearJoint.prototype.SetRatio=function(e){this.m_ratio=e},b2GearJoint.prototype.m_ground1=null,b2GearJoint.prototype.m_ground2=null,b2GearJoint.prototype.m_revolute1=null,b2GearJoint.prototype.m_prismatic1=null,b2GearJoint.prototype.m_revolute2=null,b2GearJoint.prototype.m_prismatic2=null,b2GearJoint.prototype.m_groundAnchor1=new b2Vec2,b2GearJoint.prototype.m_groundAnchor2=new b2Vec2,b2GearJoint.prototype.m_localAnchor1=new b2Vec2,b2GearJoint.prototype.m_localAnchor2=new b2Vec2,b2GearJoint.prototype.m_J=new b2Jacobian,b2GearJoint.prototype.m_constant=null,b2GearJoint.prototype.m_ratio=null,b2GearJoint.prototype.m_mass=null,b2GearJoint.prototype.m_impulse=null;var b2TOIInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TOIInput.prototype.__constructor=function(){},b2TOIInput.prototype.__varz=function(){this.proxyA=new b2DistanceProxy,this.proxyB=new b2DistanceProxy,this.sweepA=new b2Sweep,this.sweepB=new b2Sweep},b2TOIInput.prototype.proxyA=new b2DistanceProxy,b2TOIInput.prototype.proxyB=new b2DistanceProxy,b2TOIInput.prototype.sweepA=new b2Sweep,b2TOIInput.prototype.sweepB=new b2Sweep,b2TOIInput.prototype.tolerance=null;var b2RevoluteJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2RevoluteJointDef.prototype,b2JointDef.prototype),b2RevoluteJointDef.prototype._super=b2JointDef.prototype,b2RevoluteJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0,this.enableMotor=this.enableLimit=!1},b2RevoluteJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2RevoluteJointDef.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2RevoluteJointDef.prototype.localAnchorA=new b2Vec2,b2RevoluteJointDef.prototype.localAnchorB=new b2Vec2,b2RevoluteJointDef.prototype.referenceAngle=null,b2RevoluteJointDef.prototype.enableLimit=null,b2RevoluteJointDef.prototype.lowerAngle=null,b2RevoluteJointDef.prototype.upperAngle=null,b2RevoluteJointDef.prototype.enableMotor=null,b2RevoluteJointDef.prototype.motorSpeed=null,b2RevoluteJointDef.prototype.maxMotorTorque=null;var b2MouseJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2MouseJointDef.prototype,b2JointDef.prototype),b2MouseJointDef.prototype._super=b2JointDef.prototype,b2MouseJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},b2MouseJointDef.prototype.__varz=function(){this.target=new b2Vec2},b2MouseJointDef.prototype.target=new b2Vec2,b2MouseJointDef.prototype.maxForce=null,b2MouseJointDef.prototype.frequencyHz=null,b2MouseJointDef.prototype.dampingRatio=null;var b2Contact=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Contact.prototype.__constructor=function(){},b2Contact.prototype.__varz=function(){this.m_nodeA=new b2ContactEdge,this.m_nodeB=new b2ContactEdge,this.m_manifold=new b2Manifold,this.m_oldManifold=new b2Manifold},b2Contact.s_input=new b2TOIInput,b2Contact.e_sensorFlag=1,b2Contact.e_continuousFlag=2,b2Contact.e_islandFlag=4,b2Contact.e_toiFlag=8,b2Contact.e_touchingFlag=16,b2Contact.e_enabledFlag=32,b2Contact.e_filterFlag=64,b2Contact.prototype.Reset=function(e,t){this.m_flags=b2Contact.e_enabledFlag;if(!e||!t)this.m_fixtureB=this.m_fixtureA=null;else{if(e.IsSensor()||t.IsSensor())this.m_flags|=b2Contact.e_sensorFlag;var n=e.GetBody(),r=t.GetBody();if(n.GetType()!=b2Body.b2_dynamicBody||n.IsBullet()||r.GetType()!=b2Body.b2_dynamicBody||r.IsBullet())this.m_flags|=b2Contact.e_continuousFlag;this.m_fixtureA=e,this.m_fixtureB=t,this.m_manifold.m_pointCount=0,this.m_next=this.m_prev=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null}},b2Contact.prototype.Update=function(e){var t=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=t,this.m_flags|=b2Contact.e_enabledFlag;var n=!1;t=(this.m_flags&b2Contact.e_touchingFlag)==b2Contact.e_touchingFlag;var r=this.m_fixtureA.m_body,i=this.m_fixtureB.m_body,s=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&b2Contact.e_sensorFlag)s&&(n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape(),r=r.GetTransform(),i=i.GetTransform(),n=b2Shape.TestOverlap(n,r,s,i)),this.m_manifold.m_pointCount=0;else{r.GetType()!=b2Body.b2_dynamicBody||r.IsBullet()||i.GetType()!=b2Body.b2_dynamicBody||i.IsBullet()?this.m_flags|=b2Contact.e_continuousFlag:this.m_flags&=~b2Contact.e_continuousFlag;if(s){this.Evaluate(),n=this.m_manifold.m_pointCount>0;for(s=0;s<this.m_manifold.m_pointCount;++s){var o=this.m_manifold.m_points[s];o.m_normalImpulse=0,o.m_tangentImpulse=0;for(var u=o.m_id,a=0;a<this.m_oldManifold.m_pointCount;++a){var f=this.m_oldManifold.m_points[a];if(f.m_id.key==u.key){o.m_normalImpulse=f.m_normalImpulse,o.m_tangentImpulse=f.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;n!=t&&(r.SetAwake(!0),i.SetAwake(!0))}n?this.m_flags|=b2Contact.e_touchingFlag:this.m_flags&=~b2Contact.e_touchingFlag,t==0&&n==1&&e.BeginContact(this),t==1&&n==0&&e.EndContact(this),(this.m_flags&b2Contact.e_sensorFlag)==0&&e.PreSolve(this,this.m_oldManifold)},b2Contact.prototype.Evaluate=function(){},b2Contact.prototype.ComputeTOI=function(e,t){return b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape()),b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape()),b2Contact.s_input.sweepA=e,b2Contact.s_input.sweepB=t,b2Contact.s_input.tolerance=b2Settings.b2_linearSlop,b2TimeOfImpact.TimeOfImpact(b2Contact.s_input)},b2Contact.prototype.GetManifold=function(){return this.m_manifold},b2Contact.prototype.GetWorldManifold=function(e){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),i=this.m_fixtureB.GetShape();e.Initialize(this.m_manifold,t.GetTransform(),r.m_radius,n.GetTransform(),i.m_radius)},b2Contact.prototype.IsTouching=function(){return(this.m_flags&b2Contact.e_touchingFlag)==b2Contact.e_touchingFlag},b2Contact.prototype.IsContinuous=function(){return(this.m_flags&b2Contact.e_continuousFlag)==b2Contact.e_continuousFlag},b2Contact.prototype.SetSensor=function(e){e?this.m_flags|=b2Contact.e_sensorFlag:this.m_flags&=~b2Contact.e_sensorFlag},b2Contact.prototype.IsSensor=function(){return(this.m_flags&b2Contact.e_sensorFlag)==b2Contact.e_sensorFlag},b2Contact.prototype.SetEnabled=function(e){e?this.m_flags|=b2Contact.e_enabledFlag:this.m_flags&=~b2Contact.e_enabledFlag},b2Contact.prototype.IsEnabled=function(){return(this.m_flags&b2Contact.e_enabledFlag)==b2Contact.e_enabledFlag},b2Contact.prototype.GetNext=function(){return this.m_next},b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},b2Contact.prototype.FlagForFiltering=function(){this.m_flags|=b2Contact.e_filterFlag},b2Contact.prototype.m_flags=0,b2Contact.prototype.m_prev=null,b2Contact.prototype.m_next=null,b2Contact.prototype.m_nodeA=new b2ContactEdge,b2Contact.prototype.m_nodeB=new b2ContactEdge,b2Contact.prototype.m_fixtureA=null,b2Contact.prototype.m_fixtureB=null,b2Contact.prototype.m_manifold=new b2Manifold,b2Contact.prototype.m_oldManifold=new b2Manifold,b2Contact.prototype.m_toi=null;var b2ContactConstraint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactConstraint.prototype.__constructor=function(){this.points=Array(b2Settings.b2_maxManifoldPoints);for(var e=0;e<b2Settings.b2_maxManifoldPoints;e++)this.points[e]=new b2ContactConstraintPoint},b2ContactConstraint.prototype.__varz=function(){this.localPlaneNormal=new b2Vec2,this.localPoint=new b2Vec2,this.normal=new b2Vec2,this.normalMass=new b2Mat22,this.K=new b2Mat22},b2ContactConstraint.prototype.points=null,b2ContactConstraint.prototype.localPlaneNormal=new b2Vec2,b2ContactConstraint.prototype.localPoint=new b2Vec2,b2ContactConstraint.prototype.normal=new b2Vec2,b2ContactConstraint.prototype.normalMass=new b2Mat22,b2ContactConstraint.prototype.K=new b2Mat22,b2ContactConstraint.prototype.bodyA=null,b2ContactConstraint.prototype.bodyB=null,b2ContactConstraint.prototype.type=0,b2ContactConstraint.prototype.radius=null,b2ContactConstraint.prototype.friction=null,b2ContactConstraint.prototype.restitution=null,b2ContactConstraint.prototype.pointCount=0,b2ContactConstraint.prototype.manifold=null;var b2ContactResult=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactResult.prototype.__constructor=function(){},b2ContactResult.prototype.__varz=function(){this.position=new b2Vec2,this.normal=new b2Vec2,this.id=new b2ContactID},b2ContactResult.prototype.shape1=null,b2ContactResult.prototype.shape2=null,b2ContactResult.prototype.position=new b2Vec2,b2ContactResult.prototype.normal=new b2Vec2,b2ContactResult.prototype.normalImpulse=null,b2ContactResult.prototype.tangentImpulse=null,b2ContactResult.prototype.id=new b2ContactID;var b2PolygonContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolygonContact.prototype,b2Contact.prototype),b2PolygonContact.prototype._super=b2Contact.prototype,b2PolygonContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolygonContact.prototype.__varz=function(){},b2PolygonContact.Create=function(){return new b2PolygonContact},b2PolygonContact.Destroy=function(){},b2PolygonContact.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();b2Collision.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape(),e.m_xf,this.m_fixtureB.GetShape(),t.m_xf)},b2PolygonContact.prototype.Reset=function(e,t){this._super.Reset.apply(this,[e,t])};var ClipVertex=function(){this.__varz(),this.__constructor.apply(this,arguments)};ClipVertex.prototype.__constructor=function(){},ClipVertex.prototype.__varz=function(){this.v=new b2Vec2,this.id=new b2ContactID},ClipVertex.prototype.Set=function(e){this.v.SetV(e.v),this.id.Set(e.id)},ClipVertex.prototype.v=new b2Vec2,ClipVertex.prototype.id=new b2ContactID;var b2ContactFilter=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactFilter.prototype.__constructor=function(){},b2ContactFilter.prototype.__varz=function(){},b2ContactFilter.b2_defaultFilter=new b2ContactFilter,b2ContactFilter.prototype.ShouldCollide=function(e,t){var n=e.GetFilterData(),r=t.GetFilterData();return n.groupIndex==r.groupIndex&&n.groupIndex!=0?n.groupIndex>0:(n.maskBits&r.categoryBits)!=0&&(n.categoryBits&r.maskBits)!=0},b2ContactFilter.prototype.RayCollide=function(e,t){return e?this.ShouldCollide(e,t):!0};var b2NullContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2NullContact.prototype,b2Contact.prototype),b2NullContact.prototype._super=b2Contact.prototype,b2NullContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2NullContact.prototype.__varz=function(){},b2NullContact.prototype.Evaluate=function(){};var b2ContactListener=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactListener.prototype.__constructor=function(){},b2ContactListener.prototype.__varz=function(){},b2ContactListener.b2_defaultListener=new b2ContactListener,b2ContactListener.prototype.BeginContact=function(){},b2ContactListener.prototype.EndContact=function(){},b2ContactListener.prototype.PreSolve=function(){},b2ContactListener.prototype.PostSolve=function(){};var b2Island=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Island.prototype.__constructor=function(){this.m_bodies=[],this.m_contacts=[],this.m_joints=[]},b2Island.prototype.__varz=function(){},b2Island.s_impulse=new b2ContactImpulse,b2Island.prototype.Initialize=function(e,t,n,r,i,s){var o=0;this.m_bodyCapacity=e,this.m_contactCapacity=t,this.m_jointCapacity=n,this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,this.m_allocator=r,this.m_listener=i,this.m_contactSolver=s;for(o=this.m_bodies.length;o<e;o++)this.m_bodies[o]=null;for(o=this.m_contacts.length;o<t;o++)this.m_contacts[o]=null;for(o=this.m_joints.length;o<n;o++)this.m_joints[o]=null},b2Island.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0},b2Island.prototype.Solve=function(e,t,n){var r=0,i=0,s;for(r=0;r<this.m_bodyCount;++r)i=this.m_bodies[r],i.GetType()==b2Body.b2_dynamicBody&&(i.m_linearVelocity.x+=e.dt*(t.x+i.m_invMass*i.m_force.x),i.m_linearVelocity.y+=e.dt*(t.y+i.m_invMass*i.m_force.y),i.m_angularVelocity+=e.dt*i.m_invI*i.m_torque,i.m_linearVelocity.Multiply(b2Math.Clamp(1-e.dt*i.m_linearDamping,0,1)),i.m_angularVelocity*=b2Math.Clamp(1-e.dt*i.m_angularDamping,0,1));this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator),t=this.m_contactSolver,t.InitVelocityConstraints(e);for(r=0;r<this.m_jointCount;++r)s=this.m_joints[r],s.InitVelocityConstraints(e);for(r=0;r<e.velocityIterations;++r){for(i=0;i<this.m_jointCount;++i)s=this.m_joints[i],s.SolveVelocityConstraints(e);t.SolveVelocityConstraints()}for(r=0;r<this.m_jointCount;++r)s=this.m_joints[r],s.FinalizeVelocityConstraints();t.FinalizeVelocityConstraints();for(r=0;r<this.m_bodyCount;++r){i=this.m_bodies[r];if(i.GetType()!=b2Body.b2_staticBody){var o=e.dt*i.m_linearVelocity.x,u=e.dt*i.m_linearVelocity.y;o*o+u*u>b2Settings.b2_maxTranslationSquared&&(i.m_linearVelocity.Normalize(),i.m_linearVelocity.x*=b2Settings.b2_maxTranslation*e.inv_dt,i.m_linearVelocity.y*=b2Settings.b2_maxTranslation*e.inv_dt),o=e.dt*i.m_angularVelocity,o*o>b2Settings.b2_maxRotationSquared&&(i.m_angularVelocity=i.m_angularVelocity<0?-b2Settings.b2_maxRotation*e.inv_dt:b2Settings.b2_maxRotation*e.inv_dt),i.m_sweep.c0.SetV(i.m_sweep.c),i.m_sweep.a0=i.m_sweep.a,i.m_sweep.c.x+=e.dt*i.m_linearVelocity.x,i.m_sweep.c.y+=e.dt*i.m_linearVelocity.y,i.m_sweep.a+=e.dt*i.m_angularVelocity,i.SynchronizeTransform()}}for(r=0;r<e.positionIterations;++r){o=t.SolvePositionConstraints(b2Settings.b2_contactBaumgarte),u=!0;for(i=0;i<this.m_jointCount;++i)s=this.m_joints[i],s=s.SolvePositionConstraints(b2Settings.b2_contactBaumgarte),u=u&&s;if(o&&u)break}this.Report(t.m_constraints);if(n){n=Number.MAX_VALUE,t=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance,o=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;for(r=0;r<this.m_bodyCount;++r)i=this.m_bodies[r],i.GetType()!=b2Body.b2_staticBody&&((i.m_flags&b2Body.e_allowSleepFlag)==0&&(n=i.m_sleepTime=0),(i.m_flags&b2Body.e_allowSleepFlag)==0||i.m_angularVelocity*i.m_angularVelocity>o||b2Math.Dot(i.m_linearVelocity,i.m_linearVelocity)>t?n=i.m_sleepTime=0:(i.m_sleepTime+=e.dt,n=b2Math.Min(n,i.m_sleepTime)));if(n>=b2Settings.b2_timeToSleep)for(r=0;r<this.m_bodyCount;++r)i=this.m_bodies[r],i.SetAwake(!1)}},b2Island.prototype.SolveTOI=function(e){var t=0,n=0;this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var r=this.m_contactSolver;for(t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(e);for(t=0;t<e.velocityIterations;++t){r.SolveVelocityConstraints();for(n=0;n<this.m_jointCount;++n)this.m_joints[n].SolveVelocityConstraints(e)}for(t=0;t<this.m_bodyCount;++t){n=this.m_bodies[t];if(n.GetType()!=b2Body.b2_staticBody){var i=e.dt*n.m_linearVelocity.x,s=e.dt*n.m_linearVelocity.y;i*i+s*s>b2Settings.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=b2Settings.b2_maxTranslation*e.inv_dt,n.m_linearVelocity.y*=b2Settings.b2_maxTranslation*e.inv_dt),i=e.dt*n.m_angularVelocity,i*i>b2Settings.b2_maxRotationSquared&&(n.m_angularVelocity=n.m_angularVelocity<0?-b2Settings.b2_maxRotation*e.inv_dt:b2Settings.b2_maxRotation*e.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=e.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=e.dt*n.m_linearVelocity.y,n.m_sweep.a+=e.dt*n.m_angularVelocity,n.SynchronizeTransform()}}for(t=0;t<e.positionIterations;++t){i=r.SolvePositionConstraints(.75),s=!0;for(n=0;n<this.m_jointCount;++n){var o=this.m_joints[n].SolvePositionConstraints(b2Settings.b2_contactBaumgarte);s=s&&o}if(i&&s)break}this.Report(r.m_constraints)},b2Island.prototype.Report=function(e){if(this.m_listener!=null)for(var t=0;t<this.m_contactCount;++t){for(var n=this.m_contacts[t],r=e[t],i=0;i<r.pointCount;++i)b2Island.s_impulse.normalImpulses[i]=r.points[i].normalImpulse,b2Island.s_impulse.tangentImpulses[i]=r.points[i].tangentImpulse;this.m_listener.PostSolve(n,b2Island.s_impulse)}},b2Island.prototype.AddBody=function(e){e.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=e},b2Island.prototype.AddContact=function(e){this.m_contacts[this.m_contactCount++]=e},b2Island.prototype.AddJoint=function(e){this.m_joints[this.m_jointCount++]=e},b2Island.prototype.m_allocator=null,b2Island.prototype.m_listener=null,b2Island.prototype.m_contactSolver=null,b2Island.prototype.m_bodies=null,b2Island.prototype.m_contacts=null,b2Island.prototype.m_joints=null,b2Island.prototype.m_bodyCount=0,b2Island.prototype.m_jointCount=0,b2Island.prototype.m_contactCount=0,b2Island.prototype.m_bodyCapacity=0,b2Island.prototype.m_contactCapacity=0,b2Island.prototype.m_jointCapacity=0;var b2PolyAndEdgeContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolyAndEdgeContact.prototype,b2Contact.prototype),b2PolyAndEdgeContact.prototype._super=b2Contact.prototype,b2PolyAndEdgeContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolyAndEdgeContact.prototype.__varz=function(){},b2PolyAndEdgeContact.Create=function(){return new b2PolyAndEdgeContact},b2PolyAndEdgeContact.Destroy=function(){},b2PolyAndEdgeContact.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape(),e.m_xf,this.m_fixtureB.GetShape(),t.m_xf)},b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge=function(){},b2PolyAndEdgeContact.prototype.Reset=function(e,t){this._super.Reset.apply(this,[e,t]),b2Settings.b2Assert(e.GetType()==b2Shape.e_polygonShape),b2Settings.b2Assert(t.GetType()==b2Shape.e_edgeShape)};var b2Collision=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Collision.prototype.__constructor=function(){},b2Collision.prototype.__varz=function(){},b2Collision.MakeClipPointVector=function(){var e=Array(2);return e[0]=new ClipVertex,e[1]=new ClipVertex,e},b2Collision.ClipSegmentToLine=function(e,t,n,r){var i,s=0;i=t[0];var o=i.v;i=t[1];var u=i.v,a=n.x*o.x+n.y*o.y-r;return i=n.x*u.x+n.y*u.y-r,a<=0&&e[s++].Set(t[0]),i<=0&&e[s++].Set(t[1]),a*i<0&&(n=a/(a-i),i=e[s],i=i.v,i.x=o.x+n*(u.x-o.x),i.y=o.y+n*(u.y-o.y),i=e[s],i.id=(a>0?t[0]:t[1]).id,++s),s},b2Collision.EdgeSeparation=function(e,t,n,r,i){var s=e.m_vertices;e=e.m_normals;var o=r.m_vertexCount,u=r.m_vertices,a,f;a=t.R,f=e[n],e=a.col1.x*f.x+a.col2.x*f.y,r=a.col1.y*f.x+a.col2.y*f.y,a=i.R;var l=a.col1.x*e+a.col1.y*r;a=a.col2.x*e+a.col2.y*r;for(var c=0,h=Number.MAX_VALUE,p=0;p<o;++p)f=u[p],f=f.x*l+f.y*a,f<h&&(h=f,c=p);return f=s[n],a=t.R,n=t.position.x+(a.col1.x*f.x+a.col2.x*f.y),t=t.position.y+(a.col1.y*f.x+a.col2.y*f.y),f=u[c],a=i.R,s=i.position.x+(a.col1.x*f.x+a.col2.x*f.y),i=i.position.y+(a.col1.y*f.x+a.col2.y*f.y),s-=n,i-=t,s*e+i*r},b2Collision.FindMaxSeparation=function(e,t,n,r,i){var s=t.m_vertexCount,o=t.m_normals,u,a;a=i.R,u=r.m_centroid;var f=i.position.x+(a.col1.x*u.x+a.col2.x*u.y),l=i.position.y+(a.col1.y*u.x+a.col2.y*u.y);a=n.R,u=t.m_centroid,f-=n.position.x+(a.col1.x*u.x+a.col2.x*u.y),l-=n.position.y+(a.col1.y*u.x+a.col2.y*u.y),a=f*n.R.col1.x+l*n.R.col1.y,l=f*n.R.col2.x+l*n.R.col2.y,f=0;for(var c=-Number.MAX_VALUE,h=0;h<s;++h)u=o[h],u=u.x*a+u.y*l,u>c&&(c=u,f=h);o=b2Collision.EdgeSeparation(t,n,f,r,i),l=f-1>=0?f-1:s-1,c=b2Collision.EdgeSeparation(t,n,l,r,i),h=f+1<s?f+1:0;var p=b2Collision.EdgeSeparation(t,n,h,r,i);a=u=0;if(c>o&&c>p)a=-1,u=l,l=c;else{if(!(p>o))return e[0]=f,o;a=1,u=h,l=p}for(;;){f=a==-1?u-1>=0?u-1:s-1:u+1<s?u+1:0,o=b2Collision.EdgeSeparation(t,n,f,r,i);if(!(o>l))break;u=f,l=o}return e[0]=u,l},b2Collision.FindIncidentEdge=function(e,t,n,r,i,s){var o=t.m_normals,u=i.m_vertexCount;t=i.m_vertices,i=i.m_normals;var a;a=n.R,n=o[r],o=a.col1.x*n.x+a.col2.x*n.y;var f=a.col1.y*n.x+a.col2.y*n.y;a=s.R,n=a.col1.x*o+a.col1.y*f,f=a.col2.x*o+a.col2.y*f,o=n,a=0;for(var l=Number.MAX_VALUE,c=0;c<u;++c)n=i[c],n=o*n.x+f*n.y,n<l&&(l=n,a=c);i=a,o=i+1<u?i+1:0,u=e[0],n=t[i],a=s.R,u.v.x=s.position.x+(a.col1.x*n.x+a.col2.x*n.y),u.v.y=s.position.y+(a.col1.y*n.x+a.col2.y*n.y),u.id.features.referenceEdge=r,u.id.features.incidentEdge=i,u.id.features.incidentVertex=0,u=e[1],n=t[o],a=s.R,u.v.x=s.position.x+(a.col1.x*n.x+a.col2.x*n.y),u.v.y=s.position.y+(a.col1.y*n.x+a.col2.y*n.y),u.id.features.referenceEdge=r,u.id.features.incidentEdge=o,u.id.features.incidentVertex=1},b2Collision.CollidePolygons=function(e,t,n,r,i){var s;e.m_pointCount=0;var o=t.m_radius+r.m_radius;s=0,b2Collision.s_edgeAO[0]=s;var u=b2Collision.FindMaxSeparation(b2Collision.s_edgeAO,t,n,r,i);s=b2Collision.s_edgeAO[0];if(!(u>o)){var a=0;b2Collision.s_edgeBO[0]=a;var f=b2Collision.FindMaxSeparation(b2Collision.s_edgeBO,r,i,t,n);a=b2Collision.s_edgeBO[0];if(!(f>o)){var l=0,c=0;f>.98*u+.001?(u=r,r=t,t=i,n=n,l=a,e.m_type=b2Manifold.e_faceB,c=1):(u=t,r=r,t=n,n=i,l=s,e.m_type=b2Manifold.e_faceA,c=0),s=b2Collision.s_incidentEdge,b2Collision.FindIncidentEdge(s,u,t,l,r,n),i=u.m_vertices,a=i[l];var h;h=l+1<u.m_vertexCount?i[parseInt(l+1)]:i[0],l=b2Collision.s_localTangent,l.Set(h.x-a.x,h.y-a.y),l.Normalize(),i=b2Collision.s_localNormal,i.x=l.y,i.y=-l.x,r=b2Collision.s_planePoint,r.Set(.5*(a.x+h.x),.5*(a.y+h.y)),f=b2Collision.s_tangent,u=t.R,f.x=u.col1.x*l.x+u.col2.x*l.y,f.y=u.col1.y*l.x+u.col2.y*l.y;var p=b2Collision.s_tangent2;p.x=-f.x,p.y=-f.y,l=b2Collision.s_normal,l.x=f.y,l.y=-f.x;var d=b2Collision.s_v11,v=b2Collision.s_v12;d.x=t.position.x+(u.col1.x*a.x+u.col2.x*a.y),d.y=t.position.y+(u.col1.y*a.x+u.col2.y*a.y),v.x=t.position.x+(u.col1.x*h.x+u.col2.x*h.y),v.y=t.position.y+(u.col1.y*h.x+u.col2.y*h.y),t=l.x*d.x+l.y*d.y,u=f.x*v.x+f.y*v.y+o,h=b2Collision.s_clipPoints1,a=b2Collision.s_clipPoints2,v=0,v=b2Collision.ClipSegmentToLine(h,s,p,-f.x*d.x-f.y*d.y+o);if(!(v<2)){v=b2Collision.ClipSegmentToLine(a,h,f,u);if(!(v<2)){e.m_localPlaneNormal.SetV(i),e.m_localPoint.SetV(r);for(r=i=0;r<b2Settings.b2_maxManifoldPoints;++r)s=a[r],l.x*s.v.x+l.y*s.v.y-t<=o&&(f=e.m_points[i],u=n.R,p=s.v.x-n.position.x,d=s.v.y-n.position.y,f.m_localPoint.x=p*u.col1.x+d*u.col1.y,f.m_localPoint.y=p*u.col2.x+d*u.col2.y,f.m_id.Set(s.id),f.m_id.features.flip=c,++i);e.m_pointCount=i}}}}},b2Collision.CollideCircles=function(e,t,n,r,i){e.m_pointCount=0;var s,o;s=n.R,o=t.m_p;var u=n.position.x+(s.col1.x*o.x+s.col2.x*o.y);n=n.position.y+(s.col1.y*o.x+s.col2.y*o.y),s=i.R,o=r.m_p,u=i.position.x+(s.col1.x*o.x+s.col2.x*o.y)-u,i=i.position.y+(s.col1.y*o.x+s.col2.y*o.y)-n,s=t.m_radius+r.m_radius,u*u+i*i>s*s||(e.m_type=b2Manifold.e_circles,e.m_localPoint.SetV(t.m_p),e.m_localPlaneNormal.SetZero(),e.m_pointCount=1,e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0)},b2Collision.CollidePolygonAndCircle=function(e,t,n,r,i){e.m_pointCount=0;var s,o,u,a;a=i.R,u=r.m_p;var f=i.position.y+(a.col1.y*u.x+a.col2.y*u.y);s=i.position.x+(a.col1.x*u.x+a.col2.x*u.y)-n.position.x,o=f-n.position.y,a=n.R,n=s*a.col1.x+o*a.col1.y,a=s*a.col2.x+o*a.col2.y;var l=0;i=-Number.MAX_VALUE,f=t.m_radius+r.m_radius;var c=t.m_vertexCount,h=t.m_vertices;t=t.m_normals;for(var p=0;p<c;++p){u=h[p],s=n-u.x,o=a-u.y,u=t[p],u=u.x*s+u.y*o;if(u>f)return;u>i&&(i=u,l=p)}u=l,s=h[u],c=h[u+1<c?u+1:0];if(i<Number.MIN_VALUE)e.m_pointCount=1,e.m_type=b2Manifold.e_faceA,e.m_localPlaneNormal.SetV(t[l]),e.m_localPoint.x=.5*(s.x+c.x),e.m_localPoint.y=.5*(s.y+c.y);else{i=(n-c.x)*(s.x-c.x)+(a-c.y)*(s.y-c.y);if((n-s.x)*(c.x-s.x)+(a-s.y)*(c.y-s.y)<=0){if((n-s.x)*(n-s.x)+(a-s.y)*(a-s.y)>f*f)return;e.m_pointCount=1,e.m_type=b2Manifold.e_faceA,e.m_localPlaneNormal.x=n-s.x,e.m_localPlaneNormal.y=a-s.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(s)}else if(i<=0){if((n-c.x)*(n-c.x)+(a-c.y)*(a-c.y)>f*f)return;e.m_pointCount=1,e.m_type=b2Manifold.e_faceA,e.m_localPlaneNormal.x=n-c.x,e.m_localPlaneNormal.y=a-c.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(c)}else{l=.5*(s.x+c.x),s=.5*(s.y+c.y),i=(n-l)*t[u].x+(a-s)*t[u].y;if(i>f)return;e.m_pointCount=1,e.m_type=b2Manifold.e_faceA,e.m_localPlaneNormal.x=t[u].x,e.m_localPlaneNormal.y=t[u].y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.Set(l,s)}}e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0},b2Collision.TestOverlap=function(e,t){var n=t.lowerBound,r=e.upperBound,i=n.x-r.x,s=n.y-r.y;n=e.lowerBound,r=t.upperBound;var o=n.y-r.y;return i>0||s>0?!1:n.x-r.x>0||o>0?!1:!0},b2Collision.b2_nullFeature=255,b2Collision.s_incidentEdge=b2Collision.MakeClipPointVector(),b2Collision.s_clipPoints1=b2Collision.MakeClipPointVector(),b2Collision.s_clipPoints2=b2Collision.MakeClipPointVector(),b2Collision.s_edgeAO=Array(1),b2Collision.s_edgeBO=Array(1),b2Collision.s_localTangent=new b2Vec2,b2Collision.s_localNormal=new b2Vec2,b2Collision.s_planePoint=new b2Vec2,b2Collision.s_normal=new b2Vec2,b2Collision.s_tangent=new b2Vec2,b2Collision.s_tangent2=new b2Vec2,b2Collision.s_v11=new b2Vec2,b2Collision.s_v12=new b2Vec2,b2Collision.b2CollidePolyTempVec=new b2Vec2;var b2PolyAndCircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolyAndCircleContact.prototype,b2Contact.prototype),b2PolyAndCircleContact.prototype._super=b2Contact.prototype,b2PolyAndCircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolyAndCircleContact.prototype.__varz=function(){},b2PolyAndCircleContact.Create=function(){return new b2PolyAndCircleContact},b2PolyAndCircleContact.Destroy=function(){},b2PolyAndCircleContact.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body,t=this.m_fixtureB.m_body;b2Collision.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),e.m_xf,this.m_fixtureB.GetShape(),t.m_xf)},b2PolyAndCircleContact.prototype.Reset=function(e,t){this._super.Reset.apply(this,[e,t]),b2Settings.b2Assert(e.GetType()==b2Shape.e_polygonShape),b2Settings.b2Assert(t.GetType()==b2Shape.e_circleShape)};var b2ContactPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactPoint.prototype.__constructor=function(){},b2ContactPoint.prototype.__varz=function(){this.position=new b2Vec2,this.velocity=new b2Vec2,this.normal=new b2Vec2,this.id=new b2ContactID},b2ContactPoint.prototype.shape1=null,b2ContactPoint.prototype.shape2=null,b2ContactPoint.prototype.position=new b2Vec2,b2ContactPoint.prototype.velocity=new b2Vec2,b2ContactPoint.prototype.normal=new b2Vec2,b2ContactPoint.prototype.separation=null,b2ContactPoint.prototype.friction=null,b2ContactPoint.prototype.restitution=null,b2ContactPoint.prototype.id=new b2ContactID;var b2CircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2CircleContact.prototype,b2Contact.prototype),b2CircleContact.prototype._super=b2Contact.prototype,b2CircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2CircleContact.prototype.__varz=function(){},b2CircleContact.Create=function(){return new b2CircleContact},b2CircleContact.Destroy=function(){},b2CircleContact.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();b2Collision.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape(),e.m_xf,this.m_fixtureB.GetShape(),t.m_xf)},b2CircleContact.prototype.Reset=function(e,t){this._super.Reset.apply(this,[e,t])};var b2EdgeAndCircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2EdgeAndCircleContact.prototype,b2Contact.prototype),b2EdgeAndCircleContact.prototype._super=b2Contact.prototype,b2EdgeAndCircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2EdgeAndCircleContact.prototype.__varz=function(){},b2EdgeAndCircleContact.Create=function(){return new b2EdgeAndCircleContact},b2EdgeAndCircleContact.Destroy=function(){},b2EdgeAndCircleContact.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),e.m_xf,this.m_fixtureB.GetShape(),t.m_xf)},b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle=function(){},b2EdgeAndCircleContact.prototype.Reset=function(e,t){this._super.Reset.apply(this,[e,t])};var b2ContactManager=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactManager.prototype.__constructor=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=b2ContactFilter.b2_defaultFilter,this.m_contactListener=b2ContactListener.b2_defaultListener,this.m_contactFactory=new b2ContactFactory(this.m_allocator),this.m_broadPhase=new b2DynamicTreeBroadPhase},b2ContactManager.prototype.__varz=function(){},b2ContactManager.s_evalCP=new b2ContactPoint,b2ContactManager.prototype.AddPair=function(e,t){var n=e,r=t,i=n.GetBody(),s=r.GetBody();if(i!=s){for(var o=s.GetContactList();o;){if(o.other==i){var u=o.contact.GetFixtureA(),a=o.contact.GetFixtureB();if(u==n&&a==r)return;if(u==r&&a==n)return}o=o.next}s.ShouldCollide(i)!=0&&this.m_contactFilter.ShouldCollide(n,r)!=0&&(o=this.m_contactFactory.Create(n,r),n=o.GetFixtureA(),r=o.GetFixtureB(),i=n.m_body,s=r.m_body,o.m_prev=null,o.m_next=this.m_world.m_contactList,this.m_world.m_contactList!=null&&(this.m_world.m_contactList.m_prev=o),this.m_world.m_contactList=o,o.m_nodeA.contact=o,o.m_nodeA.other=s,o.m_nodeA.prev=null,o.m_nodeA.next=i.m_contactList,i.m_contactList!=null&&(i.m_contactList.prev=o.m_nodeA),i.m_contactList=o.m_nodeA,o.m_nodeB.contact=o,o.m_nodeB.other=i,o.m_nodeB.prev=null,o.m_nodeB.next=s.m_contactList,s.m_contactList!=null&&(s.m_contactList.prev=o.m_nodeB),s.m_contactList=o.m_nodeB,++this.m_world.m_contactCount)}},b2ContactManager.prototype.FindNewContacts=function(){var e=this;this.m_broadPhase.UpdatePairs(function(t,n){return e.AddPair(t,n)})},b2ContactManager.prototype.Destroy=function(e){var t=e.GetFixtureA(),n=e.GetFixtureB();t=t.GetBody(),n=n.GetBody(),e.IsTouching()&&this.m_contactListener.EndContact(e),e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_world.m_contactList&&(this.m_world.m_contactList=e.m_next),e.m_nodeA.prev&&(e.m_nodeA.prev.next=e.m_nodeA.next),e.m_nodeA.next&&(e.m_nodeA.next.prev=e.m_nodeA.prev),e.m_nodeA==t.m_contactList&&(t.m_contactList=e.m_nodeA.next),e.m_nodeB.prev&&(e.m_nodeB.prev.next=e.m_nodeB.next),e.m_nodeB.next&&(e.m_nodeB.next.prev=e.m_nodeB.prev),e.m_nodeB==n.m_contactList&&(n.m_contactList=e.m_nodeB.next),this.m_contactFactory.Destroy(e),--this.m_contactCount},b2ContactManager.prototype.Collide=function(){for(var e=this.m_world.m_contactList;e;){var t=e.GetFixtureA(),n=e.GetFixtureB(),r=t.GetBody(),i=n.GetBody();if(r.IsAwake()==0&&i.IsAwake()==0)e=e.GetNext();else{if(e.m_flags&b2Contact.e_filterFlag){if(i.ShouldCollide(r)==0){t=e,e=t.GetNext(),this.Destroy(t);continue}if(this.m_contactFilter.ShouldCollide(t,n)==0){t=e,e=t.GetNext(),this.Destroy(t);continue}e.m_flags&=~b2Contact.e_filterFlag}this.m_broadPhase.TestOverlap(t.m_proxy,n.m_proxy)==0?(t=e,e=t.GetNext(),this.Destroy(t)):(e.Update(this.m_contactListener),e=e.GetNext())}}},b2ContactManager.prototype.m_world=null,b2ContactManager.prototype.m_broadPhase=null,b2ContactManager.prototype.m_contactList=null,b2ContactManager.prototype.m_contactCount=0,b2ContactManager.prototype.m_contactFilter=null,b2ContactManager.prototype.m_contactListener=null,b2ContactManager.prototype.m_contactFactory=null,b2ContactManager.prototype.m_allocator=null;var b2World=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2World.prototype.__constructor=function(e,t){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null,this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,b2World.m_warmStarting=!0,b2World.m_continuousPhysics=!0,this.m_allowSleep=t,this.m_gravity=e,this.m_inv_dt0=0,this.m_contactManager.m_world=this,this.m_groundBody=this.CreateBody(new b2BodyDef)},b2World.prototype.__varz=function(){this.s_stack=[],this.m_contactManager=new b2ContactManager,this.m_contactSolver=new b2ContactSolver,this.m_island=new b2Island},b2World.s_timestep2=new b2TimeStep,b2World.s_backupA=new b2Sweep,b2World.s_backupB=new b2Sweep,b2World.s_timestep=new b2TimeStep,b2World.s_queue=[],b2World.e_newFixture=1,b2World.e_locked=2,b2World.s_xf=new b2Transform,b2World.s_jointColor=new b2Color(.5,.8,.8),b2World.m_warmStarting=null,b2World.m_continuousPhysics=null,b2World.prototype.Solve=function(e){for(var t,n=this.m_controllerList;n;n=n.m_next)n.Step(e);n=this.m_island,n.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~b2Body.e_islandFlag;for(var r=this.m_contactList;r;r=r.m_next)r.m_flags&=~b2Contact.e_islandFlag;for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;r=this.s_stack;for(var i=this.m_bodyList;i;i=i.m_next)if(!(i.m_flags&b2Body.e_islandFlag)&&i.IsAwake()!=0&&i.IsActive()!=0&&i.GetType()!=b2Body.b2_staticBody){n.Clear();var s=0;r[s++]=i;for(i.m_flags|=b2Body.e_islandFlag;s>0;){t=r[--s],n.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()!=b2Body.b2_staticBody){for(var o,u=t.m_contactList;u;u=u.next)u.contact.m_flags&b2Contact.e_islandFlag||u.contact.IsSensor()!=1&&u.contact.IsEnabled()!=0&&u.contact.IsTouching()!=0&&(n.AddContact(u.contact),u.contact.m_flags|=b2Contact.e_islandFlag,o=u.other,o.m_flags&b2Body.e_islandFlag||(r[s++]=o,o.m_flags|=b2Body.e_islandFlag));for(t=t.m_jointList;t;t=t.next)t.joint.m_islandFlag!=1&&(o=t.other,o.IsActive()!=0&&(n.AddJoint(t.joint),t.joint.m_islandFlag=!0,o.m_flags&b2Body.e_islandFlag||(r[s++]=o,o.m_flags|=b2Body.e_islandFlag)))}}n.Solve(e,this.m_gravity,this.m_allowSleep);for(s=0;s<n.m_bodyCount;++s)t=n.m_bodies[s],t.GetType()==b2Body.b2_staticBody&&(t.m_flags&=~b2Body.e_islandFlag)}for(s=0;s<r.length;++s){if(!r[s])break;r[s]=null}for(t=this.m_bodyList;t;t=t.m_next)t.IsAwake()==0||t.IsActive()==0||t.GetType()!=b2Body.b2_staticBody&&t.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},b2World.prototype.SolveTOI=function(e){var t,n,r,i=this.m_island;i.Initialize(this.m_bodyCount,b2Settings.b2_maxTOIContactsPerIsland,b2Settings.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var s=b2World.s_queue;for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~b2Body.e_islandFlag,t.m_sweep.t0=0;for(r=this.m_contactList;r;r=r.m_next)r.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;for(;;){var o=null,u=1;for(r=this.m_contactList;r;r=r.m_next)if(r.IsSensor()!=1&&r.IsEnabled()!=0&&r.IsContinuous()!=0){t=1;if(r.m_flags&b2Contact.e_toiFlag)t=r.m_toi;else{t=r.m_fixtureA,n=r.m_fixtureB,t=t.m_body,n=n.m_body;if(!(t.GetType()==b2Body.b2_dynamicBody&&t.IsAwake()!=0||n.GetType()==b2Body.b2_dynamicBody&&n.IsAwake()!=0))continue;var a=t.m_sweep.t0;t.m_sweep.t0<n.m_sweep.t0?(a=n.m_sweep.t0,t.m_sweep.Advance(a)):n.m_sweep.t0<t.m_sweep.t0&&(a=t.m_sweep.t0,n.m_sweep.Advance(a)),t=r.ComputeTOI(t.m_sweep,n.m_sweep),b2Settings.b2Assert(0<=t&&t<=1),t>0&&t<1&&(t=(1-t)*a+t,t>1&&(t=1)),r.m_toi=t,r.m_flags|=b2Contact.e_toiFlag}Number.MIN_VALUE<t&&t<u&&(o=r,u=t)}if(o==null||1-100*Number.MIN_VALUE<u)break;t=o.m_fixtureA,n=o.m_fixtureB,t=t.m_body,n=n.m_body,b2World.s_backupA.Set(t.m_sweep),b2World.s_backupB.Set(n.m_sweep),t.Advance(u),n.Advance(u),o.Update(this.m_contactManager.m_contactListener),o.m_flags&=~b2Contact.e_toiFlag;if(o.IsSensor()==1||o.IsEnabled()==0)t.m_sweep.Set(b2World.s_backupA),n.m_sweep.Set(b2World.s_backupB),t.SynchronizeTransform(),n.SynchronizeTransform();else if(o.IsTouching()!=0){t=t,t.GetType()!=b2Body.b2_dynamicBody&&(t=n),i.Clear(),o=r=0,s[r+o++]=t;for(t.m_flags|=b2Body.e_islandFlag;o>0;){t=s[r++],--o,i.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()==b2Body.b2_dynamicBody){for(n=t.m_contactList;n;n=n.next){if(i.m_contactCount==i.m_contactCapacity)break;n.contact.m_flags&b2Contact.e_islandFlag||n.contact.IsSensor()!=1&&n.contact.IsEnabled()!=0&&n.contact.IsTouching()!=0&&(i.AddContact(n.contact),n.contact.m_flags|=b2Contact.e_islandFlag,a=n.other,a.m_flags&b2Body.e_islandFlag||(a.GetType()!=b2Body.b2_staticBody&&(a.Advance(u),a.SetAwake(!0)),s[r+o]=a,++o,a.m_flags|=b2Body.e_islandFlag))}for(t=t.m_jointList;t;t=t.next)i.m_jointCount!=i.m_jointCapacity&&t.joint.m_islandFlag!=1&&(a=t.other,a.IsActive()!=0&&(i.AddJoint(t.joint),t.joint.m_islandFlag=!0,a.m_flags&b2Body.e_islandFlag||(a.GetType()!=b2Body.b2_staticBody&&(a.Advance(u),a.SetAwake(!0)),s[r+o]=a,++o,a.m_flags|=b2Body.e_islandFlag)))}}r=b2World.s_timestep,r.warmStarting=!1,r.dt=(1-u)*e.dt,r.inv_dt=1/r.dt,r.dtRatio=0,r.velocityIterations=e.velocityIterations,r.positionIterations=e.positionIterations,i.SolveTOI(r);for(u=u=0;u<i.m_bodyCount;++u){t=i.m_bodies[u],t.m_flags&=~b2Body.e_islandFlag;if(t.IsAwake()!=0&&t.GetType()==b2Body.b2_dynamicBody){t.SynchronizeFixtures();for(n=t.m_contactList;n;n=n.next)n.contact.m_flags&=~b2Contact.e_toiFlag}}for(u=0;u<i.m_contactCount;++u)r=i.m_contacts[u],r.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(u=0;u<i.m_jointCount;++u)r=i.m_joints[u],r.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}},b2World.prototype.DrawJoint=function(e){var t=e.GetBodyA(),n=e.GetBodyB(),r=t.m_xf.position,i=n.m_xf.position,s=e.GetAnchorA(),o=e.GetAnchorB(),u=b2World.s_jointColor;switch(e.m_type){case b2Joint.e_distanceJoint:this.m_debugDraw.DrawSegment(s,o,u);break;case b2Joint.e_pulleyJoint:t=e.GetGroundAnchorA(),e=e.GetGroundAnchorB(),this.m_debugDraw.DrawSegment(t,s,u),this.m_debugDraw.DrawSegment(e,o,u),this.m_debugDraw.DrawSegment(t,e,u);break;case b2Joint.e_mouseJoint:this.m_debugDraw.DrawSegment(s,o,u);break;default:t!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,s,u),this.m_debugDraw.DrawSegment(s,o,u),n!=this.m_groundBody&&this.m_debugDraw.DrawSegment(i,o,u)}},b2World.prototype.DrawShape=function(e,t,n){switch(e.m_type){case b2Shape.e_circleShape:this.m_debugDraw.DrawSolidCircle(b2Math.MulX(t,e.m_p),e.m_radius,t.R.col1,n);break;case b2Shape.e_polygonShape:var r=0,i=e.GetVertexCount();e=e.GetVertices();var s=Array(i);for(r=0;r<i;++r)s[r]=b2Math.MulX(t,e[r]);this.m_debugDraw.DrawSolidPolygon(s,i,n);break;case b2Shape.e_edgeShape:this.m_debugDraw.DrawSegment(b2Math.MulX(t,e.GetVertex1()),b2Math.MulX(t,e.GetVertex2()),n)}},b2World.prototype.SetDestructionListener=function(e){this.m_destructionListener=e},b2World.prototype.SetContactFilter=function(e){this.m_contactManager.m_contactFilter=e},b2World.prototype.SetContactListener=function(e){this.m_contactManager.m_contactListener=e},b2World.prototype.SetDebugDraw=function(e){this.m_debugDraw=e},b2World.prototype.SetBroadPhase=function(e){var t=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=e;for(var n=this.m_bodyList;n;n=n.m_next)for(var r=n.m_fixtureList;r;r=r.m_next)r.m_proxy=e.CreateProxy(t.GetFatAABB(r.m_proxy),r)},b2World.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},b2World.prototype.CreateBody=function(e){if(this.IsLocked()==1)return null;e=new b2Body(e,this),e.m_prev=null;if(e.m_next=this.m_bodyList)this.m_bodyList.m_prev=e;return this.m_bodyList=e,++this.m_bodyCount,e},b2World.prototype.DestroyBody=function(e){if(this.IsLocked()!=1){for(var t=e.m_jointList;t;){var n=t;t=t.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(n.joint),this.DestroyJoint(n.joint)}for(t=e.m_controllerList;t;)n=t,t=t.nextController,n.controller.RemoveBody(e);for(t=e.m_contactList;t;)n=t,t=t.next,this.m_contactManager.Destroy(n.contact);e.m_contactList=null;for(t=e.m_fixtureList;t;)n=t,t=t.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(n),n.DestroyProxy(this.m_contactManager.m_broadPhase),n.Destroy();e.m_fixtureList=null,e.m_fixtureCount=0,e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_bodyList&&(this.m_bodyList=e.m_next),--this.m_bodyCount}},b2World.prototype.CreateJoint=function(e){var t=b2Joint.Create(e,null);t.m_prev=null;if(t.m_next=this.m_jointList)this.m_jointList.m_prev=t;this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null;if(t.m_edgeA.next=t.m_bodyA.m_jointList)t.m_bodyA.m_jointList.prev=t.m_edgeA;t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null;if(t.m_edgeB.next=t.m_bodyB.m_jointList)t.m_bodyB.m_jointList.prev=t.m_edgeB;t.m_bodyB.m_jointList=t.m_edgeB;var n=e.bodyA,r=e.bodyB;if(e.collideConnected==0)for(e=r.GetContactList();e;)e.other==n&&e.contact.FlagForFiltering(),e=e.next;return t},b2World.prototype.DestroyJoint=function(e){var t=e.m_collideConnected;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_jointList&&(this.m_jointList=e.m_next);var n=e.m_bodyA,r=e.m_bodyB;n.SetAwake(!0),r.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA==n.m_jointList&&(n.m_jointList=e.m_edgeA.next),e.m_edgeA.prev=null,e.m_edgeA.next=null,e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB==r.m_jointList&&(r.m_jointList=e.m_edgeB.next),e.m_edgeB.prev=null,e.m_edgeB.next=null,b2Joint.Destroy(e,null),--this.m_jointCount;if(t==0)for(e=r.GetContactList();e;)e.other==n&&e.contact.FlagForFiltering(),e=e.next},b2World.prototype.AddController=function(e){return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList=e,e.m_world=this,this.m_controllerCount++,e},b2World.prototype.RemoveController=function(e){e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),this.m_controllerList==e&&(this.m_controllerList=e.m_next),this.m_controllerCount--},b2World.prototype.CreateController=function(e){if(e.m_world!=this)throw Error("Controller can only be a member of one world");return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=e),this.m_controllerList=e,++this.m_controllerCount,e.m_world=this,e},b2World.prototype.DestroyController=function(e){e.Clear(),e.m_next&&(e.m_next.m_prev=e.m_prev),e.m_prev&&(e.m_prev.m_next=e.m_next),e==this.m_controllerList&&(this.m_controllerList=e.m_next),--this.m_controllerCount},b2World.prototype.SetWarmStarting=function(e){b2World.m_warmStarting=e},b2World.prototype.SetContinuousPhysics=function(e){b2World.m_continuousPhysics=e},b2World.prototype.GetBodyCount=function(){return this.m_bodyCount},b2World.prototype.GetJointCount=function(){return this.m_jointCount},b2World.prototype.GetContactCount=function(){return this.m_contactCount},b2World.prototype.SetGravity=function(e){this.m_gravity=e},b2World.prototype.GetGravity=function(){return this.m_gravity},b2World.prototype.GetGroundBody=function(){return this.m_groundBody},b2World.prototype.Step=function(e,t,n){this.m_flags&b2World.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~b2World.e_newFixture),this.m_flags|=b2World.e_locked;var r=b2World.s_timestep2;r.dt=e,r.velocityIterations=t,r.positionIterations=n,r.inv_dt=e>0?1/e:0,r.dtRatio=this.m_inv_dt0*e,r.warmStarting=b2World.m_warmStarting,this.m_contactManager.Collide(),r.dt>0&&this.Solve(r),b2World.m_continuousPhysics&&r.dt>0&&this.SolveTOI(r),r.dt>0&&(this.m_inv_dt0=r.inv_dt),this.m_flags&=~b2World.e_locked},b2World.prototype.ClearForces=function(){for(var e=this.m_bodyList;e;e=e.m_next)e.m_force.SetZero(),e.m_torque=0},b2World.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.Clear();var e=this.m_debugDraw.GetFlags(),t,n,r;new b2Vec2,new b2Vec2,new b2Vec2;var i;new b2AABB,new b2AABB,i=[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2];var s=new b2Color(0,0,0);if(e&b2DebugDraw.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next){i=t.m_xf;for(n=t.GetFixtureList();n;n=n.m_next)r=n.GetShape(),t.IsActive()==0?s.Set(.5,.5,.3):t.GetType()==b2Body.b2_staticBody?s.Set(.5,.9,.5):t.GetType()==b2Body.b2_kinematicBody?s.Set(.5,.5,.9):t.IsAwake()==0?s.Set(.6,.6,.6):s.Set(.9,.7,.7),this.DrawShape(r,i,s)}if(e&b2DebugDraw.e_jointBit)for(t=this.m_jointList;t;t=t.m_next)this.DrawJoint(t);if(e&b2DebugDraw.e_controllerBit)for(t=this.m_controllerList;t;t=t.m_next)t.Draw(this.m_debugDraw);if(e&b2DebugDraw.e_pairBit){s.Set(.3,.9,.9);for(t=this.m_contactManager.m_contactList;t;t=t.GetNext())r=t.GetFixtureA(),n=t.GetFixtureB(),r=r.GetAABB().GetCenter(),n=n.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(r,n,s)}if(e&b2DebugDraw.e_aabbBit){r=this.m_contactManager.m_broadPhase,i=[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2];for(t=this.m_bodyList;t;t=t.GetNext())if(t.IsActive()!=0)for(n=t.GetFixtureList();n;n=n.GetNext()){var o=r.GetFatAABB(n.m_proxy);i[0].Set(o.lowerBound.x,o.lowerBound.y),i[1].Set(o.upperBound.x,o.lowerBound.y),i[2].Set(o.upperBound.x,o.upperBound.y),i[3].Set(o.lowerBound.x,o.upperBound.y),this.m_debugDraw.DrawPolygon(i,4,s)}}if(e&b2DebugDraw.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)i=b2World.s_xf,i.R=t.m_xf.R,i.position=t.GetWorldCenter(),this.m_debugDraw.DrawTransform(i)}},b2World.prototype.QueryAABB=function(e,t){var n=this.m_contactManager.m_broadPhase;n.Query(function(t){return e(n.GetUserData(t))},t)},b2World.prototype.QueryShape=function(e,t,n){n==null&&(n=new b2Transform,n.SetIdentity());var r=this.m_contactManager.m_broadPhase,i=new b2AABB;t.ComputeAABB(i,n),r.Query(function(i){return i=r.GetUserData(i),b2Shape.TestOverlap(t,n,i.GetShape(),i.GetBody().GetTransform())?e(i):!0},i)},b2World.prototype.QueryPoint=function(e,t){var n=this.m_contactManager.m_broadPhase,r=new b2AABB;r.lowerBound.Set(t.x-b2Settings.b2_linearSlop,t.y-b2Settings.b2_linearSlop),r.upperBound.Set(t.x+b2Settings.b2_linearSlop,t.y+b2Settings.b2_linearSlop),n.Query(function(r){return r=n.GetUserData(r),r.TestPoint(t)?e(r):!0},r)},b2World.prototype.RayCast=function(e,t,n){var r=this.m_contactManager.m_broadPhase,i=new b2RayCastOutput,s=new b2RayCastInput(t,n);r.RayCast(function(s,o){var u=r.GetUserData(o);if(u.RayCast(i,s)){var f=i.fraction,l=new b2Vec2((1-f)*t.x+f*n.x,(1-f)*t.y+f*n.y);return e(u,l,i.normal,f)}return s.maxFraction},s)},b2World.prototype.RayCastOne=function(e,t){var n;return this.RayCast(function(e,t,r,i){return n=e,i},e,t),n},b2World.prototype.RayCastAll=function(e,t){var n=[];return this.RayCast(function(e){return n[n.length]=e,1},e,t),n},b2World.prototype.GetBodyList=function(){return this.m_bodyList},b2World.prototype.GetJointList=function(){return this.m_jointList},b2World.prototype.GetContactList=function(){return this.m_contactList},b2World.prototype.IsLocked=function(){return(this.m_flags&b2World.e_locked)>0},b2World.prototype.s_stack=[],b2World.prototype.m_flags=0,b2World.prototype.m_contactManager=new b2ContactManager,b2World.prototype.m_contactSolver=new b2ContactSolver,b2World.prototype.m_island=new b2Island,b2World.prototype.m_bodyList=null,b2World.prototype.m_jointList=null,b2World.prototype.m_contactList=null,b2World.prototype.m_bodyCount=0,b2World.prototype.m_contactCount=0,b2World.prototype.m_jointCount=0,b2World.prototype.m_controllerList=null,b2World.prototype.m_controllerCount=0,b2World.prototype.m_gravity=null,b2World.prototype.m_allowSleep=null,b2World.prototype.m_groundBody=null,b2World.prototype.m_destructionListener=null,b2World.prototype.m_debugDraw=null,b2World.prototype.m_inv_dt0=null,typeof exports!="undefined"&&(exports.b2BoundValues=b2BoundValues,exports.b2Math=b2Math,exports.b2DistanceOutput=b2DistanceOutput,exports.b2Mat33=b2Mat33,exports.b2ContactPoint=b2ContactPoint,exports.b2PairManager=b2PairManager,exports.b2PositionSolverManifold=b2PositionSolverManifold,exports.b2OBB=b2OBB,exports.b2CircleContact=b2CircleContact,exports.b2PulleyJoint=b2PulleyJoint,exports.b2Pair=b2Pair,exports.b2TimeStep=b2TimeStep,exports.b2FixtureDef=b2FixtureDef,exports.b2World=b2World,exports.b2PrismaticJoint=b2PrismaticJoint,exports.b2Controller=b2Controller,exports.b2ContactID=b2ContactID,exports.b2RevoluteJoint=b2RevoluteJoint,exports.b2JointDef=b2JointDef,exports.b2Transform=b2Transform,exports.b2GravityController=b2GravityController,exports.b2EdgeAndCircleContact=b2EdgeAndCircleContact,exports.b2EdgeShape=b2EdgeShape,exports.b2BuoyancyController=b2BuoyancyController,exports.b2LineJointDef=b2LineJointDef,exports.b2Contact=b2Contact,exports.b2DistanceJoint=b2DistanceJoint,exports.b2Body=b2Body,exports.b2DestructionListener=b2DestructionListener,exports.b2PulleyJointDef=b2PulleyJointDef,exports.b2ContactEdge=b2ContactEdge,exports.b2ContactConstraint=b2ContactConstraint,exports.b2ContactImpulse=b2ContactImpulse,exports.b2DistanceJointDef=b2DistanceJointDef,exports.b2ContactResult=b2ContactResult,exports.b2EdgeChainDef=b2EdgeChainDef,exports.b2Vec2=b2Vec2,exports.b2Vec3=b2Vec3,exports.b2DistanceProxy=b2DistanceProxy,exports.b2FrictionJointDef=b2FrictionJointDef,exports.b2PolygonContact=b2PolygonContact,exports.b2TensorDampingController=b2TensorDampingController,exports.b2ContactFactory=b2ContactFactory,exports.b2WeldJointDef=b2WeldJointDef,exports.b2ConstantAccelController=b2ConstantAccelController,exports.b2GearJointDef=b2GearJointDef,exports.ClipVertex=ClipVertex,exports.b2SeparationFunction=b2SeparationFunction,exports.b2ManifoldPoint=b2ManifoldPoint,exports.b2Color=b2Color,exports.b2PolygonShape=b2PolygonShape,exports.b2DynamicTreePair=b2DynamicTreePair,exports.b2ContactConstraintPoint=b2ContactConstraintPoint,exports.b2FrictionJoint=b2FrictionJoint,exports.b2ContactFilter=b2ContactFilter,exports.b2ControllerEdge=b2ControllerEdge,exports.b2Distance=b2Distance,exports.b2Fixture=b2Fixture,exports.b2DynamicTreeNode=b2DynamicTreeNode,exports.b2MouseJoint=b2MouseJoint,exports.b2DistanceInput=b2DistanceInput,exports.b2BodyDef=b2BodyDef,exports.b2DynamicTreeBroadPhase=b2DynamicTreeBroadPhase,exports.b2Settings=b2Settings,exports.b2Proxy=b2Proxy,exports.b2Point=b2Point,exports.b2BroadPhase=b2BroadPhase,exports.b2Manifold=b2Manifold,exports.b2WorldManifold=b2WorldManifold,exports.b2PrismaticJointDef=b2PrismaticJointDef,exports.b2RayCastOutput=b2RayCastOutput,exports.b2ConstantForceController=b2ConstantForceController,exports.b2TimeOfImpact=b2TimeOfImpact,exports.b2CircleShape=b2CircleShape,exports.b2MassData=b2MassData,exports.b2Joint=b2Joint,exports.b2GearJoint=b2GearJoint,exports.b2DynamicTree=b2DynamicTree,exports.b2JointEdge=b2JointEdge,exports.b2LineJoint=b2LineJoint,exports.b2NullContact=b2NullContact,exports.b2ContactListener=b2ContactListener,exports.b2RayCastInput=b2RayCastInput,exports.b2TOIInput=b2TOIInput,exports.Features=Features,exports.b2FilterData=b2FilterData,exports.b2Island=b2Island,exports.b2ContactManager=b2ContactManager,exports.b2ContactSolver=b2ContactSolver,exports.b2Simplex=b2Simplex,exports.b2AABB=b2AABB,exports.b2Jacobian=b2Jacobian,exports.b2Bound=b2Bound,exports.b2RevoluteJointDef=b2RevoluteJointDef,exports.b2PolyAndEdgeContact=b2PolyAndEdgeContact,exports.b2SimplexVertex=b2SimplexVertex,exports.b2WeldJoint=b2WeldJoint,exports.b2Collision=b2Collision,exports.b2Mat22=b2Mat22,exports.b2SimplexCache=b2SimplexCache,exports.b2PolyAndCircleContact=b2PolyAndCircleContact,exports.b2MouseJointDef=b2MouseJointDef,exports.b2Shape=b2Shape,exports.b2Segment=b2Segment,exports.b2ContactRegister=b2ContactRegister,exports.b2DebugDraw=b2DebugDraw,exports.b2Sweep=b2Sweep),function(e){var t=function(){throw"UID cannot be instantiated"};t._nextID=0,t.get=function(){return t._nextID++},e.UID=t}(window),function(e){var t=function(){throw"Ticker cannot be instantiated."};t.useRAF=null,t.animationTarget=null,t._listeners=null,t._pauseable=null,t._paused=!1,t._inited=!1,t._startTime=0,t._pausedTime=0,t._ticks=0,t._pausedTickers=0,t._interval=50,t._lastTime=0,t._times=null,t._tickTimes=null,t._rafActive=!1,t._timeoutID=null,t.addListener=function(e,n){e!=null&&(t._inited||t.init(),t.removeListener(e),t._pauseable[t._listeners.length]=n==null?!0:n,t._listeners.push(e))},t.init=function(){t._inited=!0,t._times=[],t._tickTimes=[],t._pauseable=[],t._listeners=[],t._times.push(t._lastTime=t._startTime=t._getTime()),t.setInterval(t._interval)},t.removeListener=function(e){t._listeners!=null&&(e=t._listeners.indexOf(e),e!=-1&&(t._listeners.splice(e,1),t._pauseable.splice(e,1)))},t.removeAllListeners=function(){t._listeners=[],t._pauseable=[]},t.setInterval=function(e){t._interval=e,t._inited&&t._setupTick()},t.getInterval=function(){return t._interval},t.setFPS=function(e){t.setInterval(1e3/e)},t.getFPS=function(){return 1e3/t._interval},t.getMeasuredFPS=function(e){return t._times.length<2?-1:(e==null&&(e=t.getFPS()|0),e=Math.min(t._times.length-1,e),1e3/((t._times[0]-t._times[e])/e))},t.setPaused=function(e){t._paused=e},t.getPaused=function(){return t._paused},t.getTime=function(e){return t._getTime()-t._startTime-(e?t._pausedTime:0)},t.getTicks=function(e){return t._ticks-(e?t._pausedTickers:0)},t._handleAF=function(e){e-t._lastTime>=t._interval-1&&t._tick(),t._rafActive=!1,t._setupTick()},t._handleTimeout=function(){t._tick(),t.timeoutID=null,t._setupTick()},t._setupTick=function(){if(!t._rafActive&&t.timeoutID==null){if(t.useRAF){var n=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame;if(n){n(t._handleAF,t.animationTarget),t._rafActive=!0;return}}t.timeoutID=setTimeout(t._handleTimeout,t._interval)}},t._tick=function(){t._ticks++;var e=t._getTime(),n=e-t._lastTime,r=t._paused;r&&(t._pausedTickers++,t._pausedTime+=n),t._lastTime=e;for(var i=t._pauseable,s=t._listeners.slice(),o=s?s.length:0,u=0;u<o;u++){var a=s[u];a==null||r&&i[u]||(a.tick?a.tick(n,r):a instanceof Function&&a(n,r))}for(t._tickTimes.unshift(t._getTime()-e);t._tickTimes.length>100;)t._tickTimes.pop();for(t._times.unshift(e);t._times.length>100;)t._times.pop()},t._getTime=function(){return(new Date).getTime()},e.Ticker=t}(window),function(e){var t=function(e,t,n,r,i){this.initialize(e,t,n,r,i)},n=t.prototype;n.stageX=0,n.stageY=0,n.type=null,n.nativeEvent=null,n.onMouseMove=null,n.onMouseUp=null,n.target=null,n.initialize=function(e,t,n,r,i){this.type=e,this.stageX=t,this.stageY=n,this.target=r,this.nativeEvent=i},n.clone=function(){return new t(this.type,this.stageX,this.stageY,this.target,this.nativeEvent)},n.toString=function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"},e.MouseEvent=t}(window),function(e){var t=function(e,t,n,r,i,s){this.initialize(e,t,n,r,i,s)},n=t.prototype;t.identity=null,t.DEG_TO_RAD=Math.PI/180,n.a=1,n.b=0,n.c=0,n.d=1,n.tx=0,n.ty=0,n.alpha=1,n.shadow=null,n.compositeOperation=null,n.initialize=function(e,t,n,r,i,s){e!=null&&(this.a=e),this.b=t||0,this.c=n||0,r!=null&&(this.d=r),this.tx=i||0,this.ty=s||0},n.prepend=function(e,t,n,r,i,s){var o=this.tx;if(e!=1||t!=0||n!=0||r!=1){var u=this.a,a=this.c;this.a=u*e+this.b*n,this.b=u*t+this.b*r,this.c=a*e+this.d*n,this.d=a*t+this.d*r}this.tx=o*e+this.ty*n+i,this.ty=o*t+this.ty*r+s},n.append=function(e,t,n,r,i,s){var o=this.a,u=this.b,a=this.c,f=this.d;this.a=e*o+t*a,this.b=e*u+t*f,this.c=n*o+r*a,this.d=n*u+r*f,this.tx=i*o+s*a+this.tx,this.ty=i*u+s*f+this.ty},n.prependMatrix=function(e){this.prepend(e.a,e.b,e.c,e.d,e.tx,e.ty),this.prependProperties(e.alpha,e.shadow,e.compositeOperation)},n.appendMatrix=function(e){this.append(e.a,e.b,e.c,e.d,e.tx,e.ty),this.appendProperties(e.alpha,e.shadow,e.compositeOperation)},n.prependTransform=function(e,n,r,i,s,o,u,a,f){if(s%360)var l=s*t.DEG_TO_RAD,s=Math.cos(l),l=Math.sin(l);else s=1,l=0;if(a||f)this.tx-=a,this.ty-=f;o||u?(o*=t.DEG_TO_RAD,u*=t.DEG_TO_RAD,this.prepend(s*r,l*r,-l*i,s*i,0,0),this.prepend(Math.cos(u),Math.sin(u),-Math.sin(o),Math.cos(o),e,n)):this.prepend(s*r,l*r,-l*i,s*i,e,n)},n.appendTransform=function(e,n,r,i,s,o,u,a,f){if(s%360)var l=s*t.DEG_TO_RAD,s=Math.cos(l),l=Math.sin(l);else s=1,l=0;o||u?(o*=t.DEG_TO_RAD,u*=t.DEG_TO_RAD,this.append(Math.cos(u),Math.sin(u),-Math.sin(o),Math.cos(o),e,n),this.append(s*r,l*r,-l*i,s*i,0,0)):this.append(s*r,l*r,-l*i,s*i,e,n);if(a||f)this.tx-=a*this.a+f*this.c,this.ty-=a*this.b+f*this.d},n.rotate=function(e){var t=Math.cos(e),e=Math.sin(e),n=this.a,r=this.c,i=this.tx;this.a=n*t-this.b*e,this.b=n*e+this.b*t,this.c=r*t-this.d*e,this.d=r*e+this.d*t,this.tx=i*t-this.ty*e,this.ty=i*e+this.ty*t},n.skew=function(e,n){e*=t.DEG_TO_RAD,n*=t.DEG_TO_RAD,this.append(Math.cos(n),Math.sin(n),-Math.sin(e),Math.cos(e),0,0)},n.scale=function(e,t){this.a*=e,this.d*=t,this.tx*=e,this.ty*=t},n.translate=function(e,t){this.tx+=e,this.ty+=t},n.identity=function(){this.alpha=this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.shadow=this.compositeOperation=null},n.invert=function(){var e=this.a,t=this.b,n=this.c,r=this.d,i=this.tx,s=e*r-t*n;this.a=r/s,this.b=-t/s,this.c=-n/s,this.d=e/s,this.tx=(n*this.ty-r*i)/s,this.ty=-(e*this.ty-t*i)/s},n.isIdentity=function(){return this.tx==0&&this.ty==0&&this.a==1&&this.b==0&&this.c==0&&this.d==1},n.decompose=function(e){e==null&&(e={}),e.x=this.tx,e.y=this.ty,e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var n=Math.atan2(-this.c,this.d),r=Math.atan2(this.b,this.a);return n==r?(e.rotation=r/t.DEG_TO_RAD,this.a<0&&this.d>=0&&(e.rotation+=e.rotation<=0?180:-180),e.skewX=e.skewY=0):(e.skewX=n/t.DEG_TO_RAD,e.skewY=r/t.DEG_TO_RAD),e},n.reinitialize=function(e,t,n,r,i,s,o,u,a){return this.initialize(e,t,n,r,i,s),this.alpha=o||1,this.shadow=u,this.compositeOperation=a,this},n.appendProperties=function(e,t,n){this.alpha*=e,this.shadow=t||this.shadow,this.compositeOperation=n||this.compositeOperation},n.prependProperties=function(e,t,n){this.alpha*=e,this.shadow=this.shadow||t,this.compositeOperation=this.compositeOperation||n},n.clone=function(){var e=new t(this.a,this.b,this.c,this.d,this.tx,this.ty);return e.shadow=this.shadow,e.alpha=this.alpha,e.compositeOperation=this.compositeOperation,e},n.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},t.identity=new t(1,0,0,1,0,0),e.Matrix2D=t}(window),function(e){var t=function(e,t){this.initialize(e,t)},n=t.prototype;n.x=0,n.y=0,n.initialize=function(e,t){this.x=e==null?0:e,this.y=t==null?0:t},n.clone=function(){return new t(this.x,this.y)},n.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},e.Point=t}(window),function(e){var t=function(e,t,n,r){this.initialize(e,t,n,r)},n=t.prototype;n.x=0,n.y=0,n.width=0,n.height=0,n.initialize=function(e,t,n,r){this.x=e==null?0:e,this.y=t==null?0:t,this.width=n==null?0:n,this.height=r==null?0:r},n.clone=function(){return new t(this.x,this.y,this.width,this.height)},n.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"},e.Rectangle=t}(window),function(e){var t=function(e,t,n,r){this.initialize(e,t,n,r)},n=t.prototype;t.identity=null,n.color=null,n.offsetX=0,n.offsetY=0,n.blur=0,n.initialize=function(e,t,n,r){this.color=e,this.offsetX=t,this.offsetY=n,this.blur=r},n.toString=function(){return"[Shadow]"},n.clone=function(){return new t(this.color,this.offsetX,this.offsetY,this.blur)},t.identity=new t("transparent",0,0,0),e.Shadow=t}(window),function(e){var t=function(e){this.initialize(e)},n=t.prototype;n.complete=!0,n.onComplete=null,n._animations=null,n._frames=null,n._images=null,n._data=null,n._loadCount=0,n._frameHeight=0,n._frameWidth=0,n._numFrames=0,n._regX=0,n._regY=0,n.initialize=function(e){var t,n,r;if(e!=null){if(e.images&&(n=e.images.length)>0){r=this._images=[];for(t=0;t<n;t++){var i=e.images[t];if(!(i instanceof Image)){var s=i,i=new Image;i.src=s}r.push(i),!i.getContext&&!i.complete&&(this._loadCount++,this.complete=!1,function(e){i.onload=function(){e._handleImageLoad()}}(this))}}if(e.frames!=null)if(e.frames instanceof Array){this._frames=[],r=e.frames;for(t=0,n=r.length;t<n;t++)s=r[t],this._frames.push({image:this._images[s[4]?s[4]:0],rect:new Rectangle(s[0],s[1],s[2],s[3]),regX:s[5]||0,regY:s[6]||0})}else n=e.frames,this._frameWidth=n.width,this._frameHeight=n.height,this._regX=n.regX||0,this._regY=n.regY||0,this._numFrames=n.count,this._loadCount==0&&this._calculateFrames();if((n=e.animations)!=null){this._animations=[],this._data={};for(var o in n){e={name:o},s=n[o];if(isNaN(s))if(s instanceof Array){e.frequency=s[3],e.next=s[2],r=e.frames=[];for(t=s[0];t<=s[1];t++)r.push(t)}else e.frequency=s.frequency,e.next=s.next,r=e.frames=s.frames.slice(0);else r=e.frames=[s];e.next=r.length<2||e.next==0?null:e.next==null||e.next==1?o:e.next,e.frequency||(e.frequency=1),this._animations.push(o),this._data[o]=e}}}},n.getNumFrames=function(e){return e==null?this._frames?this._frames.length:this._numFrames:(e=this._data[e],e==null?0:e.frames.length)},n.getAnimations=function(){return this._animations.slice(0)},n.getAnimation=function(e){return this._data[e]},n.getFrame=function(e){return this.complete&&this._frames&&(frame=this._frames[e])?frame:null},n.toString=function(){return"[SpriteSheet]"},n.clone=function(){var e=new t;return e.complete=this.complete,e._animations=this._animations,e._frames=this._frames,e._images=this._images,e._data=this._data,e._frameHeight=this._frameHeight,e._frameWidth=this._frameWidth,e._numFrames=this._numFrames,e._loadCount=this._loadCount,e},n._handleImageLoad=function(){--this._loadCount==0&&(this._calculateFrames(),this.complete=!0,this.onComplete&&this.onComplete())},n._calculateFrames=function(){if(!this._frames&&this._frameWidth!=0){this._frames=[];for(var e=0,t=this._frameWidth,n=this._frameHeight,r=0,i=this._images;r<i.length;r++){for(var s=i[r],o=(s.width+1)/t|0,u=(s.height+1)/n|0,u=this._numFrames>0?Math.min(this._numFrames-e,o*u):o*u,a=0;a<u;a++)this._frames.push({image:s,rect:new Rectangle(a%o*t,(a/o|0)*n,t,n),regX:this._regX,regY:this._regY});e+=u}this._numFrames=e}},e.SpriteSheet=t}(window),function(e){function t(e,t){this.f=e,this.params=t}t.prototype.exec=function(e){this.f.apply(e,this.params)};var n=function(){this.initialize()},r=n.prototype;n.getRGB=function(e,t,n,r){return e!=null&&n==null&&(r=t,n=e&255,t=e>>8&255,e=e>>16&255),r==null?"rgb("+e+","+t+","+n+")":"rgba("+e+","+t+","+n+","+r+")"},n.getHSL=function(e,t,n,r){return r==null?"hsl("+e%360+","+t+"%,"+n+"%)":"hsla("+e%360+","+t+"%,"+n+"%,"+r+")"},n.BASE_64={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63},n.STROKE_CAPS_MAP=["butt","round","square"],n.STROKE_JOINTS_MAP=["miter","round","bevel"],n._ctx=document.createElement("canvas").getContext("2d"),n.beginCmd=new t(n._ctx.beginPath,[]),n.fillCmd=new t(n._ctx.fill,[]),n.strokeCmd=new t(n._ctx.stroke,[]),r._strokeInstructions=null,r._strokeStyleInstructions=null,r._fillInstructions=null,r._instructions=null,r._oldInstructions=null,r._activeInstructions=null,r._active=!1,r._dirty=!1,r.initialize=function(){this.clear(),this._ctx=n._ctx},r.draw=function(e){this._dirty&&this._updateInstructions();for(var t=this._instructions,n=0,r=t.length;n<r;n++)t[n].exec(e)},r.moveTo=function(e,n){return this._activeInstructions.push(new t(this._ctx.moveTo,[e,n])),this},r.lineTo=function(e,n){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.lineTo,[e,n])),this},r.arcTo=function(e,n,r,i,s){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.arcTo,[e,n,r,i,s])),this},r.arc=function(e,n,r,i,s,o){return this._dirty=this._active=!0,o==null&&(o=!1),this._activeInstructions.push(new t(this._ctx.arc,[e,n,r,i,s,o])),this},r.quadraticCurveTo=function(e,n,r,i){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.quadraticCurveTo,[e,n,r,i])),this},r.bezierCurveTo=function(e,n,r,i,s,o){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.bezierCurveTo,[e,n,r,i,s,o])),this},r.rect=function(e,n,r,i){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.rect,[e,n,r,i])),this},r.closePath=function(){return this._active&&(this._dirty=!0,this._activeInstructions.push(new t(this._ctx.closePath,[]))),this},r.clear=function(){return this._instructions=[],this._oldInstructions=[],this._activeInstructions=[],this._strokeStyleInstructions=this._strokeInstructions=this._fillInstructions=null,this._active=this._dirty=!1,this},r.beginFill=function(e){return this._active&&this._newPath(),this._fillInstructions=e?[new t(this._setProp,["fillStyle",e])]:null,this},r.beginLinearGradientFill=function(e,n,r,i,s,o){this._active&&this._newPath(),r=this._ctx.createLinearGradient(r,i,s,o),i=0;for(s=e.length;i<s;i++)r.addColorStop(n[i],e[i]);return this._fillInstructions=[new t(this._setProp,["fillStyle",r])],this},r.beginRadialGradientFill=function(e,n,r,i,s,o,u,a){this._active&&this._newPath(),r=this._ctx.createRadialGradient(r,i,s,o,u,a),i=0;for(s=e.length;i<s;i++)r.addColorStop(n[i],e[i]);return this._fillInstructions=[new t(this._setProp,["fillStyle",r])],this},r.beginBitmapFill=function(e,n){this._active&&this._newPath();var r=this._ctx.createPattern(e,n||"");return this._fillInstructions=[new t(this._setProp,["fillStyle",r])],this},r.endFill=function(){return this.beginFill(),this},r.setStrokeStyle=function(e,r,i,s){return this._active&&this._newPath(),this._strokeStyleInstructions=[new t(this._setProp,["lineWidth",e==null?"1":e]),new t(this._setProp,["lineCap",r==null?"butt":isNaN(r)?r:n.STROKE_CAPS_MAP[r]]),new t(this._setProp,["lineJoin",i==null?"miter":isNaN(i)?i:n.STROKE_JOINTS_MAP[i]]),new t(this._setProp,["miterLimit",s==null?"10":s])],this},r.beginStroke=function(e){return this._active&&this._newPath(),this._strokeInstructions=e?[new t(this._setProp,["strokeStyle",e])]:null,this},r.beginLinearGradientStroke=function(e,n,r,i,s,o){this._active&&this._newPath(),r=this._ctx.createLinearGradient(r,i,s,o),i=0;for(s=e.length;i<s;i++)r.addColorStop(n[i],e[i]);return this._strokeInstructions=[new t(this._setProp,["strokeStyle",r])],this},r.beginRadialGradientStroke=function(e,n,r,i,s,o,u,a){this._active&&this._newPath(),r=this._ctx.createRadialGradient(r,i,s,o,u,a),i=0;for(s=e.length;i<s;i++)r.addColorStop(n[i],e[i]);return this._strokeInstructions=[new t(this._setProp,["strokeStyle",r])],this},r.beginBitmapStroke=function(e,n){this._active&&this._newPath();var r=this._ctx.createPattern(e,n||"");return this._strokeInstructions=[new t(this._setProp,["strokeStyle",r])],this},r.endStroke=function(){return this.beginStroke(),this},r.curveTo=r.quadraticCurveTo,r.drawRect=r.rect,r.drawRoundRect=function(e,t,n,r,i){return this.drawRoundRectComplex(e,t,n,r,i,i,i,i),this},r.drawRoundRectComplex=function(e,n,r,i,s,o,u,a){this._dirty=this._active=!0;var f=Math.PI,l=this._ctx.arc,h=this._ctx.lineTo;return this._activeInstructions.push(new t(this._ctx.moveTo,[e+s,n]),new t(h,[e+r-o,n]),o>=0?new t(l,[e+r-o,n+o,o,-f/2,0]):new t(l,[e+r,n,-o,f,f/2,!0]),new t(h,[e+r,n+i-u]),a>=0?new t(l,[e+r-u,n+i-u,u,0,f/2]):new t(l,[e+r,n+i,-u,-f/2,f,!0]),new t(h,[e+a,n+i]),a>=0?new t(l,[e+a,n+i-a,a,f/2,f]):new t(l,[e,n+i,-a,0,-f/2,!0]),new t(h,[e,n+s]),s>=0?new t(l,[e+s,n+s,s,f,-f/2]):new t(l,[e,n,-s,f/2,0,!0])),this},r.drawCircle=function(e,t,n){return this.arc(e,t,n,0,Math.PI*2),this},r.drawEllipse=function(e,n,r,i){this._dirty=this._active=!0;var s=r/2*.5522848,o=i/2*.5522848,u=e+r,a=n+i,r=e+r/2,i=n+i/2;return this._activeInstructions.push(new t(this._ctx.moveTo,[e,i]),new t(this._ctx.bezierCurveTo,[e,i-o,r-s,n,r,n]),new t(this._ctx.bezierCurveTo,[r+s,n,u,i-o,u,i]),new t(this._ctx.bezierCurveTo,[u,i+o,r+s,a,r,a]),new t(this._ctx.bezierCurveTo,[r-s,a,e,i+o,e,i])),this},r.drawPolyStar=function(e,n,r,i,s,o){this._dirty=this._active=!0,s==null&&(s=0),s=1-s,o==null?o=0:o/=180/Math.PI;var u=Math.PI/i;this._activeInstructions.push(new t(this._ctx.moveTo,[e+Math.cos(o)*r,n+Math.sin(o)*r]));for(var a=0;a<i;a++)o+=u,s!=1&&this._activeInstructions.push(new t(this._ctx.lineTo,[e+Math.cos(o)*r*s,n+Math.sin(o)*r*s])),o+=u,this._activeInstructions.push(new t(this._ctx.lineTo,[e+Math.cos(o)*r,n+Math.sin(o)*r]));return this},r.p=r.decodePath=function(e){for(var t=[this.moveTo,this.lineTo,this.quadraticCurveTo,this.bezierCurveTo],r=[2,2,4,6],i=0,s=e.length,o=[],u=0,f=0,l=n.BASE_64;i<s;){var c=l[e.charAt(i)],h=c>>3,p=t[h];if(!p||c&3)throw"bad path data";var d=r[h];h||(u=f=0),o.length=0,i++,c=(c>>2&1)+2;for(h=0;h<d;h++){var v=l[e.charAt(i)],m=v>>5?-1:1,v=(v&31)<<6|l[e.charAt(i+1)];c==3&&(v=v<<6|l[e.charAt(i+2)]),v=m*v/10,h%2?u=v+=u:f=v+=f,o[h]=v,i+=c}p.apply(this,o)}return this},r.clone=function(){var e=new n;return e._instructions=this._instructions.slice(),e._activeInstructions=this._activeInstructions.slice(),e._oldInstructions=this._oldInstructions.slice(),this._fillInstructions&&(e._fillInstructions=this._fillInstructions.slice()),this._strokeInstructions&&(e._strokeInstructions=this._strokeInstructions.slice()),this._strokeStyleInstructions&&(e._strokeStyleInstructions=this._strokeStyleInstructions.slice()),e._active=this._active,e._dirty=this._dirty,e},r.toString=function(){return"[Graphics]"},r.mt=r.moveTo,r.lt=r.lineTo,r.at=r.arcTo,r.bt=r.bezierCurveTo,r.qt=r.quadraticCurveTo,r.a=r.arc,r.r=r.rect,r.cp=r.closePath,r.c=r.clear,r.f=r.beginFill,r.lf=r.beginLinearGradientFill,r.rf=r.beginRadialGradientFill,r.bf=r.beginBitmapFill,r.ef=r.endFill,r.ss=r.setStrokeStyle,r.s=r.beginStroke,r.ls=r.beginLinearGradientStroke,r.rs=r.beginRadialGradientStroke,r.bs=r.beginBitmapStroke,r.es=r.endStroke,r.dr=r.drawRect,r.rr=r.drawRoundRect,r.rc=r.drawRoundRectComplex,r.dc=r.drawCircle,r.de=r.drawEllipse,r.dp=r.drawPolyStar,r._updateInstructions=function(){this._instructions=this._oldInstructions.slice(),this._instructions.push(n.beginCmd),this._fillInstructions&&this._instructions.push.apply(this._instructions,this._fillInstructions),this._strokeInstructions&&(this._instructions.push.apply(this._instructions,this._strokeInstructions),this._strokeStyleInstructions&&this._instructions.push.apply(this._instructions,this._strokeStyleInstructions)),this._instructions.push.apply(this._instructions,this._activeInstructions),this._fillInstructions&&this._instructions.push(n.fillCmd),this._strokeInstructions&&this._instructions.push(n.strokeCmd)},r._newPath=function(){this._dirty&&this._updateInstructions(),this._oldInstructions=this._instructions,this._activeInstructions=[],this._active=this._dirty=!1},r._setProp=function(e,t){this[e]=t},e.Graphics=n}(window),function(e){var t=function(){this.initialize()},n=t.prototype;t.suppressCrossDomainErrors=!1,t._hitTestCanvas=document.createElement("canvas"),t._hitTestCanvas.width=t._hitTestCanvas.height=1,t._hitTestContext=t._hitTestCanvas.getContext("2d"),t._nextCacheID=1,n.alpha=1,n.cacheCanvas=null,n.id=-1,n.mouseEnabled=!0,n.name=null,n.parent=null,n.regX=0,n.regY=0,n.rotation=0,n.scaleX=1,n.scaleY=1,n.skewX=0,n.skewY=0,n.shadow=null,n.visible=!0,n.x=0,n.y=0,n.compositeOperation=null,n.snapToPixel=!1,n.onPress=null,n.onClick=null,n.onDoubleClick=null,n.onMouseOver=null,n.onMouseOut=null,n.onTick=null,n.filters=null,n.cacheID=0,n._cacheOffsetX=0,n._cacheOffsetY=0,n._cacheDataURLID=0,n._cacheDataURL=null,n._matrix=null,n.initialize=function(){this.id=UID.get(),this._matrix=new Matrix2D},n.isVisible=function(){return this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0},n.draw=function(e,t){return t||!this.cacheCanvas?!1:(e.drawImage(this.cacheCanvas,this._cacheOffsetX,this._cacheOffsetY),!0)},n.cache=function(e,n,r,i){var s=this.cacheCanvas;s==null&&(s=this.cacheCanvas=document.createElement("canvas"));var o=s.getContext("2d");s.width=r,s.height=i,o.setTransform(1,0,0,1,-e,-n),o.clearRect(e,n,s.width,s.height),this.draw(o,!0,this._matrix.reinitialize(1,0,0,1,-e,-n)),this._cacheOffsetX=e,this._cacheOffsetY=n,this._applyFilters(),this.cacheID=t._nextCacheID++},n.updateCache=function(e){var n=this.cacheCanvas,r=this._cacheOffsetX,i=this._cacheOffsetY;if(n==null)throw"cache() must be called before updateCache()";var s=n.getContext("2d");s.setTransform(1,0,0,1,-r,-i),e?s.globalCompositeOperation=e:s.clearRect(r,i,n.width,n.height),this.draw(s,!0),e&&(s.globalCompositeOperation="source-over"),this._applyFilters(),this.cacheID=t._nextCacheID++},n.uncache=function(){this._cacheDataURL=this.cacheCanvas=null,this.cacheID=this._cacheOffsetX=this._cacheOffsetY=0},n.getCacheDataURL=function(){return this.cacheCanvas?(this.cacheID!=this._cacheDataURLID&&(this._cacheDataURL=this.cacheCanvas.toDataURL()),this._cacheDataURL):null},n.getStage=function(){for(var e=this;e.parent;)e=e.parent;return e instanceof Stage?e:null},n.localToGlobal=function(e,t){var n=this.getConcatenatedMatrix(this._matrix);return n==null?null:(n.append(1,0,0,1,e,t),new Point(n.tx,n.ty))},n.globalToLocal=function(e,t){var n=this.getConcatenatedMatrix(this._matrix);return n==null?null:(n.invert(),n.append(1,0,0,1,e,t),new Point(n.tx,n.ty))},n.localToLocal=function(e,t,n){return e=this.localToGlobal(e,t),n.globalToLocal(e.x,e.y)},n.setTransform=function(e,t,n,r,i,s,o,u,a){this.x=e||0,this.y=t||0,this.scaleX=n==null?1:n,this.scaleY=r==null?1:r,this.rotation=i||0,this.skewX=s||0,this.skewY=o||0,this.regX=u||0,this.regY=a||0},n.getConcatenatedMatrix=function(e){e?e.identity():e=new Matrix2D;for(var t=this;t!=null;)e.prependTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY),e.prependProperties(t.alpha,t.shadow,t.compositeOperation),t=t.parent;return e},n.hitTest=function(e,n){var r=t._hitTestContext,i=t._hitTestCanvas;return r.setTransform(1,0,0,1,-e,-n),this.draw(r),r=this._testHit(r),i.width=0,i.width=1,r},n.clone=function(){var e=new t;return this.cloneProps(e),e},n.toString=function(){return"[DisplayObject (name="+this.name+")]"},n.cloneProps=function(e){e.alpha=this.alpha,e.name=this.name,e.regX=this.regX,e.regY=this.regY,e.rotation=this.rotation,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.shadow=this.shadow,e.skewX=this.skewX,e.skewY=this.skewY,e.visible=this.visible,e.x=this.x,e.y=this.y,e.mouseEnabled=this.mouseEnabled,e.compositeOperation=this.compositeOperation,this.cacheCanvas&&(e.cacheCanvas=this.cacheCanvas.cloneNode(!0),e.cacheCanvas.getContext("2d").putImageData(this.cacheCanvas.getContext("2d").getImageData(0,0,this.cacheCanvas.width,this.cacheCanvas.height),0,0))},n.applyShadow=function(e,t){t=t||Shadow.identity,e.shadowColor=t.color,e.shadowOffsetX=t.offsetX,e.shadowOffsetY=t.offsetY,e.shadowBlur=t.blur},n._tick=function(e){this.onTick&&this.onTick(e)},n._testHit=function(e){try{var n=e.getImageData(0,0,1,1).data[3]>1}catch(r){if(!t.suppressCrossDomainErrors)throw"An error has occured. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images."}return n},n._applyFilters=function(){if(this.filters&&this.filters.length!=0&&this.cacheCanvas)for(var e=this.filters.length,t=this.cacheCanvas.getContext("2d"),n=this.cacheCanvas.width,r=this.cacheCanvas.height,i=0;i<e;i++)this.filters[i].applyFilter(t,0,0,n,r)},e.DisplayObject=t}(window),function(e){var t=function(){this.initialize()},n=t.prototype=new DisplayObject;n.children=null,n.DisplayObject_initialize=n.initialize,n.initialize=function(){this.DisplayObject_initialize(),this.children=[]},n.isVisible=function(){return this.visible&&this.alpha>0&&this.children.length&&this.scaleX!=0&&this.scaleY!=0},n.DisplayObject_draw=n.draw,n.draw=function(e,n,r){var i=Stage._snapToPixelEnabled;if(this.DisplayObject_draw(e,n))return!0;for(var r=r||this._matrix.reinitialize(1,0,0,1,0,0,this.alpha,this.shadow,this.compositeOperation),n=this.children.length,s=this.children.slice(0),o=0;o<n;o++){var u=s[o];if(u.isVisible()){var a=!1,f=u._matrix.reinitialize(r.a,r.b,r.c,r.d,r.tx,r.ty,r.alpha,r.shadow,r.compositeOperation);f.appendTransform(u.x,u.y,u.scaleX,u.scaleY,u.rotation,u.skewX,u.skewY,u.regX,u.regY),f.appendProperties(u.alpha,u.shadow,u.compositeOperation),u instanceof t&&u.cacheCanvas==null||(i&&u.snapToPixel&&f.a==1&&f.b==0&&f.c==0&&f.d==1?e.setTransform(f.a,f.b,f.c,f.d,f.tx+.5|0,f.ty+.5|0):e.setTransform(f.a,f.b,f.c,f.d,f.tx,f.ty),e.globalAlpha=f.alpha,e.globalCompositeOperation=f.compositeOperation||"source-over",(a=f.shadow)&&this.applyShadow(e,a)),u.draw(e,!1,f),a&&this.applyShadow(e)}}return!0},n.addChild=function(e){if(e==null)return e;var t=arguments.length;if(t>1){for(var n=0;n<t;n++)this.addChild(arguments[n]);return arguments[t-1]}return e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e),e},n.addChildAt=function(e,t){var n=arguments.length;if(n>2){for(var t=arguments[r-1],r=0;r<n-1;r++)this.addChildAt(arguments[r],t+r);return arguments[n-2]}return e.parent&&e.parent.removeChild(e),e.parent=this,this.children.splice(t,0,e),e},n.removeChild=function(e){var t=arguments.length;if(t>1){for(var n=!0,r=0;r<t;r++)n=n&&this.removeChild(arguments[r]);return n}return this.removeChildAt(this.children.indexOf(e))},n.removeChildAt=function(e){var t=arguments.length;if(t>1){for(var n=[],r=0;r<t;r++)n[r]=arguments[r];n.sort(function(e,t){return t-e});for(var i=!0,r=0;r<t;r++)i=i&&this.removeChildAt(n[r]);return i}return e<0||e>this.children.length-1?!1:(t=this.children[e],t!=null&&(t.parent=null),this.children.splice(e,1),!0)},n.removeAllChildren=function(){for(var e=this.children;e.length;)e.pop().parent=null},n.getChildAt=function(e){return this.children[e]},n.sortChildren=function(e){this.children.sort(e)},n.getChildIndex=function(e){return this.children.indexOf(e)},n.getNumChildren=function(){return this.children.length},n.swapChildrenAt=function(e,t){var n=this.children,r=n[e],i=n[t];r&&i&&(n[e]=i,n[t]=r)},n.swapChildren=function(e,t){for(var n=this.children,r,i,s=0,o=n.length;s<o;s++)if(n[s]==e&&(r=s),n[s]==t&&(i=s),r!=null&&i!=null)break;s!=o&&(n[r]=t,n[i]=e)},n.setChildIndex=function(e,t){for(var n=this.children,r=0,i=n.length;r<i;r++)if(n[r]==e)break;r==i||t<0||t>i||r==t||(n.splice(t,1),t<r&&r--,n.splice(e,r,0))},n.contains=function(e){for(;e;){if(e==this)return!0;e=e.parent}return!1},n.hitTest=function(e,t){return this.getObjectUnderPoint(e,t)!=null},n.getObjectsUnderPoint=function(e,t){var n=[],r=this.localToGlobal(e,t);return this._getObjectsUnderPoint(r.x,r.y,n),n},n.getObjectUnderPoint=function(e,t){var n=this.localToGlobal(e,t);return this._getObjectsUnderPoint(n.x,n.y)},n.clone=function(e){var n=new t;this.cloneProps(n);if(e)for(var r=n.children=[],i=0,s=this.children.length;i<s;i++){var o=this.children[i].clone(e);o.parent=n,r.push(o)}return n},n.toString=function(){return"[Container (name="+this.name+")]"},n._tick=function(e){for(var t=this.children.length-1;t>=0;t--){var n=this.children[t];n._tick&&n._tick(e)}this.onTick&&this.onTick(e)},n._getObjectsUnderPoint=function(e,n,r,i){var s=DisplayObject._hitTestContext,o=DisplayObject._hitTestCanvas,u=this._matrix,a=i&1&&(this.onPress||this.onClick||this.onDoubleClick)||i&2&&(this.onMouseOver||this.onMouseOut);if(this.cacheCanvas){if(this.getConcatenatedMatrix(u),s.setTransform(u.a,u.b,u.c,u.d,u.tx-e,u.ty-n),s.globalAlpha=u.alpha,this.draw(s),!this._testHit(s))return null;if(o.width=0,o.width=1,a)return this}for(var f=this.children.length-1;f>=0;f--){var l=this.children[f];if(l.isVisible()&&l.mouseEnabled)if(l instanceof t){if(a){if(l=l._getObjectsUnderPoint(e,n))return this}else if(l=l._getObjectsUnderPoint(e,n,r,i),!r&&l)return l}else if(!i||a||i&1&&(l.onPress||l.onClick||l.onDoubleClick)||i&2&&(l.onMouseOver||l.onMouseOut))if(l.getConcatenatedMatrix(u),s.setTransform(u.a,u.b,u.c,u.d,u.tx-e,u.ty-n),s.globalAlpha=u.alpha,l.draw(s),this._testHit(s)){if(o.width=0,o.width=1,a)return this;if(!r)return l;r.push(l)}}return null},e.Container=t}(window),function(e){var t=function(e){this.initialize(e)},n=t.prototype=new Container;t._snapToPixelEnabled=!1,n.autoClear=!0,n.canvas=null,n.mouseX=null,n.mouseY=null,n.onMouseMove=null,n.onMouseUp=null,n.onMouseDown=null,n.snapToPixelEnabled=!1,n.mouseInBounds=!1,n.tickOnUpdate=!0,n._activeMouseEvent=null,n._activeMouseTarget=null,n._mouseOverIntervalID=null,n._mouseOverX=0,n._mouseOverY=0,n._mouseOverTarget=null,n.Container_initialize=n.initialize,n.initialize=function(e){this.Container_initialize(),this.canvas=e instanceof HTMLCanvasElement?e:document.getElementById(e),this._enableMouseEvents(!0)},n.update=function(e){this.canvas&&(this.autoClear&&this.clear(),t._snapToPixelEnabled=this.snapToPixelEnabled,this.tickOnUpdate&&this._tick(e),this.draw(this.canvas.getContext("2d"),!1,this.getConcatenatedMatrix(this._matrix)))},n.tick=n.update,n.clear=function(){if(this.canvas){var e=this.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this.canvas.width,this.canvas.height)}},n.toDataURL=function(e,t){t||(t="image/png");var n=this.canvas.getContext("2d"),r=this.canvas.width,i=this.canvas.height,s;if(e){s=n.getImageData(0,0,r,i);var o=n.globalCompositeOperation;n.globalCompositeOperation="destination-over",n.fillStyle=e,n.fillRect(0,0,r,i)}var u=this.canvas.toDataURL(t);return e&&(n.clearRect(0,0,r,i),n.putImageData(s,0,0),n.globalCompositeOperation=o),u},n.enableMouseOver=function(e){this._mouseOverIntervalID&&(clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=null);if(e==null)e=20;else if(e<=0)return;var t=this;this._mouseOverIntervalID=setInterval(function(){t._testMouseOver()},1e3/Math.min(50,e)),this._mouseOverX=NaN,this._mouseOverTarget=null},n.clone=function(){var e=new t(null);return this.cloneProps(e),e},n.toString=function(){return"[Stage (name="+this.name+")]"},n._enableMouseEvents=function(){var t=this,n=e.addEventListener?e:document;n.addEventListener("mouseup",function(e){t._handleMouseUp(e)},!1),n.addEventListener("mousemove",function(e){t._handleMouseMove(e)},!1),n.addEventListener("dblclick",function(e){t._handleDoubleClick(e)},!1),this.canvas&&this.canvas.addEventListener("mousedown",function(e){t._handleMouseDown(e)},!1)},n._handleMouseMove=function(t){if(this.canvas){t||(t=e.event);var n=this.mouseInBounds;this._updateMousePosition(t.pageX,t.pageY);if(n||this.mouseInBounds)t=new MouseEvent("onMouseMove",this.mouseX,this.mouseY,this,t),this.onMouseMove&&this.onMouseMove(t),this._activeMouseEvent&&this._activeMouseEvent.onMouseMove&&this._activeMouseEvent.onMouseMove(t)}else this.mouseX=this.mouseY=null},n._updateMousePosition=function(e,t){var n=this.canvas;do e-=n.offsetLeft,t-=n.offsetTop;while(n=n.offsetParent);if(this.mouseInBounds=e>=0&&t>=0&&e<this.canvas.width&&t<this.canvas.height)this.mouseX=e,this.mouseY=t},n._handleMouseUp=function(e){var t=new MouseEvent("onMouseUp",this.mouseX,this.mouseY,this,e);this.onMouseUp&&this.onMouseUp(t),this._activeMouseEvent&&this._activeMouseEvent.onMouseUp&&this._activeMouseEvent.onMouseUp(t),this._activeMouseTarget&&this._activeMouseTarget.onClick&&this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,true,this._mouseOverIntervalID?3:1)==this._activeMouseTarget&&this._activeMouseTarget.onClick(new MouseEvent("onClick",this.mouseX,this.mouseY,this._activeMouseTarget,e)),this._activeMouseEvent=this._activeMouseTarget=null},n._handleMouseDown=function(e){this.onMouseDown&&this.onMouseDown(new MouseEvent("onMouseDown",this.mouseX,this.mouseY,this,e));var t=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,this._mouseOverIntervalID?3:1);t&&(t.onPress instanceof Function&&(e=new MouseEvent("onPress",this.mouseX,this.mouseY,t,e),t.onPress(e),e.onMouseMove||e.onMouseUp)&&(this._activeMouseEvent=e),this._activeMouseTarget=t)},n._testMouseOver=function(){if(this.mouseX!=this._mouseOverX||this.mouseY!=this._mouseOverY||!this.mouseInBounds){var e=null;this.mouseInBounds&&(e=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,3),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY),this._mouseOverTarget!=e&&(this._mouseOverTarget&&this._mouseOverTarget.onMouseOut&&this._mouseOverTarget.onMouseOut(new MouseEvent("onMouseOut",this.mouseX,this.mouseY,this._mouseOverTarget)),e&&e.onMouseOver&&e.onMouseOver(new MouseEvent("onMouseOver",this.mouseX,this.mouseY,e)),this._mouseOverTarget=e)}},n._handleDoubleClick=function(e){this.onDoubleClick&&this.onDoubleClick(new MouseEvent("onDoubleClick",this.mouseX,this.mouseY,this,e));var t=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,this._mouseOverIntervalID?3:1);t&&t.onDoubleClick instanceof Function&&t.onDoubleClick(new MouseEvent("onPress",this.mouseX,this.mouseY,t,e))},e.Stage=t}(window),function(e){var t=function(e){this.initialize(e)},n=t.prototype=new DisplayObject;n.image=null,n.snapToPixel=!0,n.sourceRect=null,n.DisplayObject_initialize=n.initialize,n.initialize=function(e){this.DisplayObject_initialize(),typeof e=="string"?(this.image=new Image,this.image.src=e):this.image=e},n.isVisible=function(){return this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0&&this.image&&(this.image.complete||this.image.getContext||this.image.readyState>=2)},n.DisplayObject_draw=n.draw,n.draw=function(e,t){if(this.DisplayObject_draw(e,t))return!0;var n=this.sourceRect;return n?e.drawImage(this.image,n.x,n.y,n.width,n.height,0,0,n.width,n.height):e.drawImage(this.image,0,0),!0},n.clone=function(){var e=new t(this.image);return this.cloneProps(e),e},n.toString=function(){return"[Bitmap (name="+this.name+")]"},e.Bitmap=t}(window),function(e){var t=function(e){this.initialize(e)},n=t.prototype=new DisplayObject;n.onAnimationEnd=null,n.currentFrame=-1,n.currentAnimation=null,n.paused=!0,n.spriteSheet=null,n.snapToPixel=!0,n.offset=0,n.currentAnimationFrame=0,n._advanceCount=0,n._animation=null,n.DisplayObject_initialize=n.initialize,n.initialize=function(e){this.DisplayObject_initialize(),this.spriteSheet=e},n.isVisible=function(){return this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0&&this.spriteSheet.complete&&this.currentFrame>=0},n.DisplayObject_draw=n.draw,n.draw=function(e,t){if(this.DisplayObject_draw(e,t))return!0;this._normalizeFrame();var n=this.spriteSheet.getFrame(this.currentFrame);if(n!=null){var r=n.rect;return e.drawImage(n.image,r.x,r.y,r.width,r.height,-n.regX,-n.regY,r.width,r.height),!0}},n.play=function(){this.paused=!1},n.stop=function(){this.paused=!0},n.gotoAndPlay=function(e){this.paused=!1,this._goto(e)},n.gotoAndStop=function(e){this.paused=!0,this._goto(e)},n.advance=function(){this._animation?this.currentAnimationFrame++:this.currentFrame++,this._normalizeFrame()},n.clone=function(){var e=new t(this.spriteSheet);return this.cloneProps(e),e},n.toString=function(){return"[BitmapAnimation (name="+this.name+")]"},n._tick=function(e){var t=this._animation?this._animation.frequency:1;!this.paused&&(++this._advanceCount+this.offset)%t==0&&this.advance(),this.onTick&&this.onTick(e)},n._normalizeFrame=function(){var e=this._animation;e?this.currentAnimationFrame>=e.frames.length?(e.next?this._goto(e.next):(this.paused=!0,this.currentAnimationFrame=e.frames.length-1,this.currentFrame=e.frames[this.currentAnimationFrame]),this.onAnimationEnd)&&this.onAnimationEnd(this,e.name):this.currentFrame=e.frames[this.currentAnimationFrame]:this.currentFrame>=this.spriteSheet.getNumFrames()&&(this.currentFrame=0,this.onAnimationEnd)&&this.onAnimationEnd(this,null)},n.DisplayObject_cloneProps=n.cloneProps,n.cloneProps=function(e){this.DisplayObject_cloneProps(e),e.onAnimationEnd=this.onAnimationEnd,e.currentFrame=this.currentFrame,e.currentAnimation=this.currentAnimation,e.paused=this.paused,e.offset=this.offset,e._animation=this._animation,e.currentAnimationFrame=this.currentAnimationFrame},n._goto=function(e){if(isNaN(e)){var t=this.spriteSheet.getAnimation(e);t&&(this.currentAnimationFrame=0,this._animation=t,this.currentAnimation=e,this._normalizeFrame())}else this.currentAnimation=this._animation=null,this.currentFrame=e},e.BitmapAnimation=t}(window),function(e){var t=function(e){this.initialize(e)},n=t.prototype=new DisplayObject;n.graphics=null,n.DisplayObject_initialize=n.initialize,n.initialize=function(e){this.DisplayObject_initialize(),this.graphics=e?e:new Graphics},n.isVisible=function(){return this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0&&this.graphics},n.DisplayObject_draw=n.draw,n.draw=function(e,t){return this.DisplayObject_draw(e,t)?!0:(this.graphics.draw(e),!0)},n.clone=function(e){return e=new t(e&&this.graphics?this.graphics.clone():this.graphics),this.cloneProps(e),e},n.toString=function(){return"[Shape (name="+this.name+")]"},e.Shape=t}(window),function(e){var t=function(e,t,n){this.initialize(e,t,n)},n=t.prototype=new DisplayObject;t._workingContext=document.createElement("canvas").getContext("2d"),n.text="",n.font=null,n.color=null,n.textAlign=null,n.textBaseline=null,n.maxWidth=null,n.outline=!1,n.lineHeight=null,n.lineWidth=null,n.DisplayObject_initialize=n.initialize,n.initialize=function(e,t,n){this.DisplayObject_initialize(),this.text=e,this.font=t,this.color=n?n:"#000"},n.isVisible=function(){return Boolean(this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0&&this.text!=null&&this.text!="")},n.DisplayObject_draw=n.draw,n.draw=function(e,t){if(this.DisplayObject_draw(e,t))return!0;this.outline?e.strokeStyle=this.color:e.fillStyle=this.color,e.font=this.font,e.textAlign=this.textAlign?this.textAlign:"start",e.textBaseline=this.textBaseline?this.textBaseline:"alphabetic";for(var n=String(this.text).split(/(?:\r\n|\r|\n)/),r=this.lineHeight==null?this.getMeasuredLineHeight():this.lineHeight,i=0,s=0,o=n.length;s<o;s++){var u=e.measureText(n[s]).width;if(this.lineWidth==null||u<this.lineWidth)this._drawTextLine(e,n[s],i);else{for(var u=n[s].split(/(\s)/),a=u[0],f=1,l=u.length;f<l;f+=2)e.measureText(a+u[f]+u[f+1]).width>this.lineWidth?(this._drawTextLine(e,a,i),i+=r,a=u[f+1]):a+=u[f]+u[f+1];this._drawTextLine(e,a,i)}i+=r}return!0},n.getMeasuredWidth=function(){return this._getWorkingContext().measureText(this.text).width},n.getMeasuredLineHeight=function(){return this._getWorkingContext().measureText("M").width*1.2},n.clone=function(){var e=new t(this.text,this.font,this.color);return this.cloneProps(e),e},n.toString=function(){return"[Text (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"},n.DisplayObject_cloneProps=n.cloneProps,n.cloneProps=function(e){this.DisplayObject_cloneProps(e),e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,e.maxWidth=this.maxWidth,e.outline=this.outline,e.lineHeight=this.lineHeight,e.lineWidth=this.lineWidth},n._getWorkingContext=function(){var e=t._workingContext;return e.font=this.font,e.textAlign=this.textAlign?this.textAlign:"start",e.textBaseline=this.textBaseline?this.textBaseline:"alphabetic",e},n._drawTextLine=function(e,t,n){this.outline?e.strokeText(t,0,n,this.maxWidth):e.fillText(t,0,n,this.maxWidth||65535)},e.Text=t}(window),function(e){var t=function(){throw"SpriteSheetUtils cannot be instantiated"};t._workingCanvas=document.createElement("canvas"),t._workingContext=t._workingCanvas.getContext("2d"),t.addFlippedFrames=function(e,n,r,i){if(n||r||i){var s=0;n&&t._flip(e,++s,!0,!1),r&&t._flip(e,++s,!1,!0),i&&t._flip(e,++s,!0,!0)}},t.extractFrame=function(e,n){isNaN(n)&&(n=e.getAnimation(n).frames[0]);var r=e.getFrame(n);if(!r)return null;var i=r.rect,s=t._workingCanvas;return s.width=i.width,s.height=i.height,t._workingContext.drawImage(r.image,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r=new Image,r.src=s.toDataURL("image/png"),r},t._flip=function(e,n,r,i){for(var s=e._images,o=t._workingCanvas,u=t._workingContext,a=s.length/n,f=0;f<a;f++){var l=s[f];l.__tmp=f,o.width=l.width,o.height=l.height,u.setTransform(r?-1:1,0,0,i?-1:1,r?l.width:0,i?l.height:0),u.drawImage(l,0,0);var h=new Image;h.src=o.toDataURL("image/png"),h.width=l.width,h.height=l.height,s.push(h)}u=e._frames,o=u.length/n;for(f=0;f<o;f++){var l=u[f],p=l.rect.clone(),h=s[l.image.__tmp+a*n],d={image:h,rect:p,regX:l.regX,regY:l.regY};r&&(p.x=h.width-p.x-p.width,d.regX=p.width-l.regX),i&&(p.y=h.height-p.y-p.height,d.regY=p.height-l.regY),u.push(d)}r="_"+(r?"h":"")+(i?"v":""),i=e._animations,e=e._data,s=i.length/n;for(f=0;f<s;f++){u=i[f],l=e[u],a={name:u+r,frequency:l.frequency,next:l.next,frames:[]},l.next&&(a.next+=r),u=l.frames,l=0;for(h=u.length;l<h;l++)a.frames.push(u[l]+o*n);e[a.name]=a,i.push(a.name)}},e.SpriteSheetUtils=t}(window),function(e){var t=function(e){this.initialize(e)},n=t.prototype=new DisplayObject;n.htmlElement=null,n._style=null,n.DisplayObject_initialize=n.initialize,n.initialize=function(e){typeof e=="string"&&(e=document.getElementById(e)),this.DisplayObject_initialize(),this.mouseEnabled=!1;if(this.htmlElement=e)this._style=e.style,this._style.position="absolute",this._style.transformOrigin=this._style.webkitTransformOrigin=this._style.msTransformOrigin=this._style.MozTransformOrigin="0% 0%"},n.isVisible=function(){return this.htmlElement!=null},n.draw=function(){if(this.htmlElement!=null){var e=this._matrix,t=this.htmlElement;return t.style.opacity=""+e.alpha,t.style.visibility=this.visible?"visible":"hidden",t.style.transform=t.style.webkitTransform=t.style.oTransform=t.style.msTransform=["matrix("+e.a,e.b,e.c,e.d,e.tx,e.ty+")"].join(","),t.style.MozTransform=["matrix("+e.a,e.b,e.c,e.d,e.tx+"px",e.ty+"px)"].join(","),!0}},n.cache=function(){},n.uncache=function(){},n.updateCache=function(){},n.hitTest=function(){},n.localToGlobal=function(){},n.globalToLocal=function(){},n.localToLocal=function(){},n.clone=function(){var e=new t;return this.cloneProps(e),e},n.toString=function(){return"[DOMElement (name="+this.name+")]"},n._tick=function(e){this.htmlElement!=null&&(this.htmlElement.style.visibility="hidden",this.onTick)&&this.onTick(e)},e.DOMElement=t}(window),function(e){var t=function(){this.initialize()},n=t.prototype;n.initialize=function(){},n.getBounds=function(){return new Rectangle(0,0,0,0)},n.applyFilter=function(){},n.toString=function(){return"[Filter]"},n.clone=function(){return new t},e.Filter=t}(window),function(e){var t=function(){throw"Touch cannot be instantiated"};t.isSupported=function(){return"ontouchstart"in e},t.enable=function(e){e!=null&&t.isSupported()&&(e._primaryTouchId=-1,e._handleTouchMoveListener=null,e.canvas.addEventListener("touchstart",function(n){t._handleTouchStart(e,n)},!1),document.addEventListener("touchend",function(n){t._handleTouchEnd(e,n)},!1))},t._handleTouchStart=function(e,n){n.preventDefault();if(e._primaryTouchId==-1){e._handleTouchMoveListener=e._handleTouchMoveListener||function(n){t._handleTouchMove(e,n)},document.addEventListener("touchmove",e._handleTouchMoveListener,!1);var r=n.changedTouches[0];e._primaryTouchId=r.identifier,e._updateMousePosition(r.pageX,r.pageY),e._handleMouseDown(r)}},t._handleTouchMove=function(e,n){var r=t._findPrimaryTouch(e,n.changedTouches);r&&e._handleMouseMove(r)},t._handleTouchEnd=function(e,n){var r=t._findPrimaryTouch(e,n.changedTouches);r&&(e._primaryTouchId=-1,e._handleMouseUp(r),document.removeEventListener("touchmove",e._handleTouchMoveListener),e._handleTouchMoveListener=null)},t._findPrimaryTouch=function(e,t){for(var n=t.length,r=0;r<n;r++){var i=t[r];if(i.identifier==e._primaryTouchId)return i}return null},e.Touch=t}(window);var Kibo=function(e){this.element=e||window.document,this.initialize()};Kibo.KEY_NAMES_BY_CODE={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"caps_lock",27:"esc",32:"space",33:"page_up",34:"page_down",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"num_lock"},Kibo.KEY_CODES_BY_NAME={},function(){for(var e in Kibo.KEY_NAMES_BY_CODE)Object.prototype.hasOwnProperty.call(Kibo.KEY_NAMES_BY_CODE,e)&&(Kibo.KEY_CODES_BY_NAME[Kibo.KEY_NAMES_BY_CODE[e]]=+e)}(),Kibo.MODIFIERS=["shift","ctrl","alt"],Kibo.WILDCARD_TYPES=["arrow","number","letter","f"],Kibo.WILDCARDS={arrow:[37,38,39,40],number:[48,49,50,51,52,53,54,55,56,57],letter:[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90],f:[112,113,114,115,116,117,118,119,120,121,122,123]},Kibo.assert=function(e,t){t=t||{},t.name=t.name||"Exception raised",t.message=t.message||"an error has occurred.";try{if(!e)throw t}catch(n){typeof console!="undefined"&&console.log?console.log(n.name+": "+n.message):window.alert(n.name+": "+n.message)}},Kibo.registerEvent=function(){if(document.addEventListener)return function(e,t,n){e.addEventListener(t,n,!1)};if(document.attachEvent)return function(e,t,n){e.attachEvent("on"+t,n)}}(),Kibo.unregisterEvent=function(){if(document.removeEventListener)return function(e,t,n){e.removeEventListener(t,n,!1)};if(document.detachEvent)return function(e,t,n){e.detachEvent("on"+t,n)}}(),Kibo.isArray=function(e){return!!e&&!!e.splice},Kibo.isString=function(e){return typeof e=="string"},Kibo.arrayIncludes=function(){return Array.prototype.indexOf?function(e,t){return e.indexOf(t)!==-1}:function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}}(),Kibo.trimString=function(e){return e.replace(/^\s+|\s+$/g,"")},Kibo.neatString=function(e){return Kibo.trimString(e).replace(/\s+/g," ")},Kibo.capitalize=function(e){return e.toLowerCase().replace(/^./,function(e){return e.toUpperCase()})},Kibo.isModifier=function(e){return Kibo.arrayIncludes(Kibo.MODIFIERS,e)},Kibo.prototype.initialize=function(){var e,t=this;this.lastKeyCode=-1,this.lastModifiers={};for(e=0;e<Kibo.MODIFIERS.length;e++)this.lastModifiers[Kibo.MODIFIERS[e]]=!1;this.keysDown={any:[]},this.keysUp={any:[]};for(e=0;e<Kibo.WILDCARD_TYPES.length;e++)this.keysDown["any "+Kibo.WILDCARD_TYPES[e]]=[],this.keysUp["any "+Kibo.WILDCARD_TYPES[e]]=[];this.downHandler=this.handler("down"),this.upHandler=this.handler("up"),Kibo.registerEvent(this.element,"keydown",this.downHandler),Kibo.registerEvent(this.element,"keyup",this.upHandler),Kibo.registerEvent(window,"unload",function n(){Kibo.unregisterEvent(t.element,"keydown",t.downHandler),Kibo.unregisterEvent(t.element,"keyup",t.upHandler),Kibo.unregisterEvent(window,"unload",n)})},Kibo.prototype.matchingKeys=function(e){var t,n,r,i,s=[];for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){r=Kibo.trimString(o).split(" ");if(r.length&&r[0]!=="any"){i=!0;for(n=0;n<r.length;n++)i=i&&(Kibo.isModifier(r[n])?this.lastKey(r[n]):this.lastKey()===r[n]);i&&s.push(o)}}return s},Kibo.prototype.handler=function(e){var t=this;return function(n){var r,i,s,o;n=n||window.event,t.lastKeyCode=n.keyCode;for(r=0;r<Kibo.MODIFIERS.length;r++)t.lastModifiers[Kibo.MODIFIERS[r]]=n[Kibo.MODIFIERS[r]+"Key"];Kibo.arrayIncludes(Kibo.MODIFIERS,Kibo.keyName(t.lastKeyCode))&&(t.lastModifiers[Kibo.keyName(t.lastKeyCode)]=!0),o=t["keys"+Kibo.capitalize(e)],s=t.matchingKeys(o);for(r=0;r<o.any.length;r++)o.any[r](n)===!1&&n.preventDefault&&n.preventDefault();for(r=0;r<Kibo.WILDCARD_TYPES.length;r++)if(Kibo.arrayIncludes(Kibo.WILDCARDS[Kibo.WILDCARD_TYPES[r]],t.lastKeyCode))for(i=0;i<o["any "+Kibo.WILDCARD_TYPES[r]].length;i++)o["any "+Kibo.WILDCARD_TYPES[r]][i](n)===!1&&n.preventDefault&&n.preventDefault();for(r=0;r<s.length;r++)for(i=0;i<o[s[r]].length;i++)o[s[r]][i](n)===!1&&n.preventDefault&&n.preventDefault()}},Kibo.prototype.registerKeys=function(e,t,n){var r,i=this["keys"+Kibo.capitalize(e)];Kibo.isArray(t)||(t=[t]);for(r=0;r<t.length;r++)Kibo.assert(Kibo.isString(t[r]),{name:"Type error",message:"expected string or array of strings."}),t[r]=Kibo.neatString(t[r]),Kibo.isArray(i[t[r]])?i[t[r]].push(n):i[t[r]]=[n];return this},Kibo.prototype.unregisterKeys=function(e,t,n){var r,i,s=this["keys"+Kibo.capitalize(e)];Kibo.isArray(t)||(t=[t]);for(r=0;r<t.length;r++){Kibo.assert(Kibo.isString(t[r]),{name:"Type error",message:"expected string or array of strings."}),t[r]=Kibo.neatString(t[r]);if(n===null)delete s[t[r]];else if(Kibo.isArray(s[t[r]]))for(i=0;i<s[t[r]].length;i++)if(String(s[t[r]][i])===String(n)){s[t[r]].splice(i,1);break}}return this},Kibo.prototype.delegate=function(e,t,n){return n!==null?this.registerKeys(e,t,n):this.unregisterKeys(e,t,n)},Kibo.prototype.down=function(e,t){return this.delegate("down",e,t)},Kibo.prototype.up=function(e,t){return this.delegate("up",e,t)},Kibo.keyName=function(e){return Kibo.KEY_NAMES_BY_CODE[e+""]},Kibo.keyCode=function(e){return+Kibo.KEY_CODES_BY_NAME[e]},Kibo.prototype.lastKey=function(e){return e?(Kibo.assert(Kibo.arrayIncludes(Kibo.MODIFIERS,e),{name:"Modifier error",message:"invalid modifier "+e+" (valid modifiers are: "+Kibo.MODIFIERS.join(", ")+")."}),this.lastModifiers[e]):Kibo.keyName(this.lastKeyCode)},function(e){var t=function(){this.init()};t.prototype={};var n=t.prototype;n.loaded=!1,n.progress=0,n._item=null,n.onProgress=null,n.onLoadStart=null,n.onFileLoad=null,n.onFileProgress=null,n.onComplete=null,n.onError=null,n.getItem=function(){return this._item},n.init=function(){},n.load=function(){},n.cancel=function(){},n._sendLoadStart=function(){this.onLoadStart&&this.onLoadStart({target:this})},n._sendProgress=function(e){var t;if(e instanceof Number)this.progress=e,t={loaded:this.progress,total:1};else if(t=e,this.progress=e.loaded/e.total,isNaN(this.progress)||this.progress==Infinity)this.progress=0;t.target=this,this.onProgress&&this.onProgress(t)},n._sendFileProgress=function(e){this.onFileProgress&&(e.target=this,this.onFileProgress(e))},n._sendComplete=function(){this.onComplete&&this.onComplete({target:this})},n._sendFileComplete=function(e){this.onFileLoad&&(e.target=this,this.onFileLoad(e))},n._sendError=function(e){this.onError&&(e==null&&(e={}),e.target=this,this.onError(e))},n.toString=function(){return"[PreloadJS AbstractLoader]"},e.AbstractLoader=t}(window),function(e){function t(){}var n=function(e){this.initialize(e)},r=n.prototype=new AbstractLoader;n.IMAGE="image",n.SOUND="sound",n.JSON="json",n.JAVASCRIPT="javascript",n.CSS="css",n.XML="xml",n.TEXT="text",n.TIMEOUT_TIME=8e3,r.useXHR=!0,r.stopOnError=!1,r.maintainScriptOrder=!0,r.next=null,r.typeHandlers=null,r.extensionHandlers=null,r._maxConnections=1,r._currentLoads=null,r._loadQueue=null,r._loadedItemsById=null,r._loadedItemsBySrc=null,r._targetProgress=0,r._numItems=0,r._numItemsLoaded=null,r._scriptOrder=null,r._loadedScripts=null,r.TAG_LOAD_OGGS=!0,r.initialize=function(t){this._targetProgress=this._numItemsLoaded=this._numItems=0,this._paused=!1,this._currentLoads=[],this._loadQueue=[],this._scriptOrder=[],this._loadedScripts=[],this._loadedItemsById={},this._loadedItemsBySrc={},this.typeHandlers={},this.extensionHandlers={},this.useXHR=t!=0&&e.XMLHttpRequest!=null,this.determineCapabilities()},r.determineCapabilities=function(){var e=n.lib.BrowserDetect;e!=null&&(n.TAG_LOAD_OGGS=e.isFirefox||e.isOpera)},n.isBinary=function(e){switch(e){case n.IMAGE:case n.SOUND:return!0;default:return!1}},r.installPlugin=function(e){if(e!=null&&e.getPreloadHandlers!=null){e=e.getPreloadHandlers();if(e.types!=null)for(var t=0,n=e.types.length;t<n;t++)this.typeHandlers[e.types[t]]=e.callback;if(e.extensions!=null)for(t=0,n=e.extensions.length;t<n;t++)this.extensionHandlers[e.extensions[t]]=e.callback}},r.setMaxConnections=function(e){this._maxConnections=e,this._paused||this._loadNext()},r.loadFile=function(e,t){this._addItem(e),t!==!1&&this.setPaused(!1)},r.loadManifest=function(e,t){var n;e instanceof Array?n=e:e instanceof Object&&(n=[e]);for(var r=0,i=n.length;r<i;r++)this._addItem(n[r],!1);t!==!1&&this._loadNext()},r.load=function(){this.setPaused(!1)},r.getResult=function(e){return this._loadedItemsById[e]||this._loadedItemsBySrc[e]},r.setPaused=function(e){(this._paused=e)||this._loadNext()},r.close=function(){for(;this._currentLoads.length;)this._currentLoads.pop().cancel();this._currentLoads=[],this._scriptOrder=[],this._loadedScripts=[]},r._addItem=function(e){e=this._createLoadItem(e),e!=null&&(this._loadQueue.push(e),this._numItems++,this._updateProgress(),e.getItem().type==n.JAVASCRIPT&&(this._scriptOrder.push(e.getItem()),this._loadedScripts.push(null)))},r._loadNext=function(){if(!this._paused){this._loadQueue.length==0&&(this._sendComplete(),this.next&&this.next.load&&this.next.load.apply(this.next));for(;this._loadQueue.length&&this._currentLoads.length<this._maxConnections;){var e=this._loadQueue.shift();e.onProgress=n.proxy(this._handleProgress,this),e.onComplete=n.proxy(this._handleFileComplete,this),e.onError=n.proxy(this._handleFileError,this),this._currentLoads.push(e),e.load()}}},r._handleFileError=function(e){var e=e.target,t=this._createResultData(e.getItem());this._numItemsLoaded++,this._updateProgress(),this._sendError(t),this.stopOnError||(this._removeLoadItem(e),this._loadNext())},r._createResultData=function(e){return{id:e.id,result:null,data:e.data,type:e.type,src:e.src}},r._handleFileComplete=function(e){this._numItemsLoaded++;var e=e.target,t=e.getItem();this._removeLoadItem(e);var r=this._createResultData(t);r.result=e instanceof n.lib.XHRLoader?this._createResult(t,e.getResult()):t.tag,this._loadedItemsById[t.id]=r,this._loadedItemsBySrc[t.src]=r;var i=this;switch(t.type){case n.IMAGE:if(e instanceof n.lib.XHRLoader){r.result.onload=function(){i._handleFileTagComplete(t,r)};return}break;case n.JAVASCRIPT:if(this.maintainScriptOrder){this._loadedScripts[this._scriptOrder.indexOf(t)]=t,this._checkScriptLoadOrder();return}}this._handleFileTagComplete(t,r)},r._checkScriptLoadOrder=function(){for(var e=this._loadedScripts.length,t=0;t<e;t++){var n=this._loadedScripts[t];if(n===null)break;if(n!==!0){var n=this.getResult(n.src),r=this._createResultData(n);r.result=n.result,this._handleFileTagComplete(n,r),this._loadedScripts[t]=!0,t--,e--}}},r._handleFileTagComplete=function(e,t){e.completeHandler&&e.completeHandler(t),this._updateProgress(),this._sendFileComplete(t),this._loadNext()},r._removeLoadItem=function(e){for(var t=this._currentLoads.length,n=0;n<t;n++)if(this._currentLoads[n]==e){this._currentLoads.splice(n,1);break}},r._createResult=function(t,r){var i=null,s;switch(t.type){case n.IMAGE:i=this._createImage();break;case n.SOUND:i=t.tag||this._createAudio();break;case n.CSS:i=this._createLink();break;case n.JAVASCRIPT:i=this._createScript();break;case n.XML:if(e.DOMParser){var o=new DOMParser;o.parseFromString(r,"text/xml")}else o=new ActiveXObject("Microsoft.XMLDOM"),o.async=!1,o.loadXML(r),s=o;break;case n.JSON:case n.TEXT:s=r}return i?(t.type==n.CSS?i.href=t.src:i.src=t.src,i):s},r._handleProgress=function(e){var e=e.target,t=this._createResultData(e.getItem());t.progress=e.progress,this._sendFileProgress(t),this._updateProgress()},r._updateProgress=function(){var e=this._numItemsLoaded/this._numItems,t=this._numItems-this._numItemsLoaded;if(t>0){for(var n=0,r=0,i=this._currentLoads.length;r<i;r++)n+=this._currentLoads[r].progress;e+=n/t*(t/this._numItems)}this._sendProgress({loaded:e,total:1})},r._createLoadItem=function(e){var t={};switch(typeof e){case"string":t.src=e;break;case"object":e instanceof HTMLAudioElement?(t.tag=e,t.src=t.tag.src,t.type=n.SOUND):t=e}t.ext=this._getNameAfter(t.src,"."),t.type||(t.type=this.getType(t.ext));if(t.id==null||t.id=="")t.id=t.src;if(e=this.typeHandlers[t.type]||this.extensionHandlers[t.ext]){e=e(t.src,t.type,t.id,t.data);if(e===!1)return null;e!==!0&&(e.src!=null&&(t.src=e.src),e.id!=null&&(t.id=e.id),e.tag!=null&&e.tag.load instanceof Function&&(t.tag=e.tag)),t.ext=this._getNameAfter(t.src,".")}e=this.useXHR;switch(t.type){case n.JSON:case n.XML:case n.TEXT:e=!0;break;case n.SOUND:t.ext=="ogg"&&n.TAG_LOAD_OGGS&&(e=!1)}if(e)return new n.lib.XHRLoader(t);if(t.tag)return new n.lib.TagLoader(t);var r,e="src",i=!1;switch(t.type){case n.IMAGE:r=this._createImage();break;case n.SOUND:r=this._createAudio();break;case n.CSS:e="href",i=!0,r=this._createLink();break;case n.JAVASCRIPT:i=!0,r=this._createScript()}return t.tag=r,new n.lib.TagLoader(t,e,i)},r.getType=function(e){switch(e){case"jpeg":case"jpg":case"gif":case"png":return n.IMAGE;case"ogg":case"mp3":case"wav":return n.SOUND;case"json":return n.JSON;case"xml":return n.XML;case"css":return n.CSS;case"js":return n.JAVASCRIPT;default:return n.TEXT}},r._getNameAfter=function(e,t){var n=e.lastIndexOf(t),n=e.substr(n+1),r=n.lastIndexOf(/[\b|\?|\#|\s]/);return r==-1?n:n.substr(0,r)},r._createImage=function(){return document.createElement("img")},r._createAudio=function(){var e=document.createElement("audio");return e.autoplay=!1,e.type="audio/ogg",e},r._createScript=function(){var e=document.createElement("script");return e.type="text/javascript",e},r._createLink=function(){var e=document.createElement("link");return e.type="text/css",e.rel="stylesheet",e},r.toString=function(){return"[PreloadJS]"},n.proxy=function(e,t){return function(n){return e.apply(t,arguments)}},n.lib={},e.PreloadJS=n,t.init=function(){var n=navigator.userAgent;t.isFirefox=n.indexOf("Firefox")>-1,t.isOpera=e.opera!=null,t.isIOS=n.indexOf("iPod")>-1||n.indexOf("iPhone")>-1||n.indexOf("iPad")>-1},t.init(),n.lib.BrowserDetect=t}(window),function(){var e=function(e,t,n){this.init(e,t,n)},t=e.prototype=new AbstractLoader;t._srcAttr=null,t._loadTimeOutTimeout=null,t.tagCompleteProxy=null,t.init=function(e,t,n){this._item=e,this._srcAttr=t||"src",this._useXHR=n==1,this.isAudio=e.tag instanceof HTMLAudioElement,this.tagCompleteProxy=PreloadJS.proxy(this._handleTagLoad,this)},t.cancel=function(){this._clean();var e=this.getItem();e!=null&&(e.src=null)},t.load=function(){this._useXHR?this.loadXHR():this.loadTag()},t.loadXHR=function(){var e=this.getItem(),e=new PreloadJS.lib.XHRLoader(e);e.onProgress=PreloadJS.proxy(this._handleProgress,this),e.onFileLoad=PreloadJS.proxy(this._handleXHRComplete,this),e.onFileError=PreloadJS.proxy(this._handleLoadError,this),e.load()},t._handleXHRComplete=function(e){this._clean();var t=e.getItem();e.getResult(),t.type==PreloadJS.IMAGE?(t.tag.onload=PreloadJS.proxy(this._sendComplete,this),t.tag.src=t.src):(t.tag[this._srcAttr]=t.src,this._sendComplete())},t._handleLoadError=function(e){this._clean(),this._sendError(e)},t.loadTag=function(){var e=this.getItem(),t=e.tag;clearTimeout(this._loadTimeOutTimeout),this._loadTimeOutTimeout=setTimeout(PreloadJS.proxy(this._handleLoadTimeOut,this),PreloadJS.TIMEOUT_TIME),this.isAudio&&(t.src=null,t.preload="auto",t.setAttribute("data-temp","true")),t.onerror=PreloadJS.proxy(this._handleLoadError,this),t.onprogress=PreloadJS.proxy(this._handleProgress,this),this.isAudio?(t.onstalled=PreloadJS.proxy(this._handleStalled,this),t.addEventListener("canplaythrough",this.tagCompleteProxy)):t.onload=PreloadJS.proxy(this._handleTagLoad,this),t[this._srcAttr]=e.src,e=e.type==PreloadJS.SOUND&&e.ext=="ogg"&&PreloadJS.lib.BrowserDetect.isFirefox,t.load!=null&&!e&&t.load()},t._handleLoadTimeOut=function(){this._clean(),this._sendError()},t._handleStalled=function(){},t._handleLoadError=function(){this._clean(),this._sendError()},t._handleTagLoad=function(){var e=this.getItem().tag;clearTimeout(this._loadTimeOutTimeout),(!this.isAudio||e.readyState===4)&&!this.loaded&&(this.loaded=!0,this._clean(),this._sendComplete())},t._clean=function(){clearTimeout(this._loadTimeOutTimeout);var e=this.getItem().tag;e.onload=null,e.removeEventListener("canplaythrough",this.tagCompleteProxy),e.onstalled=null,e.onprogress=null,e.onerror=null},t._handleProgress=function(e){clearTimeout(this._loadTimeOutTimeout);if(this.isAudio){e=this.getItem();if(e.buffered==null)return;e={loaded:e.buffered.length>0?e.buffered.end(0):0,total:e.duration}}this._sendProgress(e)},t.toString=function(){return"[PreloadJS TagLoader]"},PreloadJS.lib.TagLoader=e}(window),function(e){var t=function(e){this.init(e)},n=t.prototype=new AbstractLoader;n._wasLoaded=!1,n._request=null,n._loadTimeOutTimeout=null,n._xhrLevel=null,n.init=function(e){this._item=e,this._createXHR(e)},n.getResult=function(){try{return this._request.responseText}catch(e){}return this._request.response},n.cancel=function(){this._clean(),this._request.abort()},n.load=function(){if(this._request==null)this.handleError();else{this._xhrLevel==1&&(this._loadTimeOutTimeout=setTimeout(PreloadJS.proxy(this.handleTimeout,this),PreloadJS.TIMEOUT_TIME)),this._request.onloadstart=PreloadJS.proxy(this.handleLoadStart,this),this._request.onprogress=PreloadJS.proxy(this.handleProgress,this),this._request.onabort=PreloadJS.proxy(this.handleAbort,this),this._request.onerror=PreloadJS.proxy(this.handleError,this),this._request.ontimeout=PreloadJS.proxy(this.handleTimeout,this),this._request.onload=PreloadJS.proxy(this.handleLoad,this),this._request.onreadystatechange=PreloadJS.proxy(this.handleReadyStateChange,this);try{this._request.send()}catch(e){}}},n.handleProgress=function(e){e.loaded>0&&e.total==0||this._sendProgress({loaded:e.loaded,total:e.total})},n.handleLoadStart=function(){clearTimeout(this._loadTimeOutTimeout),this._sendLoadStart()},n.handleAbort=function(){this._clean(),this._sendError()},n.handleError=function(){this._clean(),this._sendError()},n.handleReadyStateChange=function(){this._request.readyState==4&&this.handleLoad()},n._checkError=function(){switch(parseInt(this._request.status)){case 404:case 0:return!1}if(this._request.response==null){try{if(this._request.responseXML!=null)return!0}catch(e){}return!1}return!0},n.handleLoad=function(){this.loaded||(this.loaded=!0,this._checkError()?(this._clean(),this._sendComplete()):this.handleError())},n.handleTimeout=function(){this._clean(),this._sendError()},n.handleLoadEnd=function(){this._clean()},n._createXHR=function(t){this._xhrLevel=1,e.ArrayBuffer&&(this._xhrLevel=2);if(e.XMLHttpRequest)this._request=new XMLHttpRequest;else try{this._request=new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(n){return null}return t.type==PreloadJS.TEXT&&this._request.overrideMimeType("text/plain; charset=x-user-defined"),this._request.open("GET",t.src,!0),PreloadJS.isBinary(t.type)&&(this._request.responseType="arraybuffer"),!0},n._clean=function(){clearTimeout(this._loadTimeOutTimeout);var e=this._request;e.onloadstart=null,e.onprogress=null,e.onabort=null,e.onerror=null,e.onload=null,e.ontimeout=null,e.onloadend=null,e.onreadystatechange=null,clearInterval(this._checkLoadInterval)},n.toString=function(){return"[PreloadJS XHRLoader]"},PreloadJS.lib.XHRLoader=t}(window),trolley=function(){function t(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function n(e,t){var n;for(n in t)t.hasOwnProperty(n)&&typeof e[n]=="undefined"&&(e[n]=t[n]);return e}function r(e,t){var n,r=0;e=[].concat(e);for(n=0;n<e.length;n++)typeof e[n]!="undefined"&&(t(e[n],r),r++)}function i(e,t,n){return e+t/2-n/2}function s(t){return e=t,e||(e=new b2World(new b2Vec2(0,-9.81),!0),e.SetWarmStarting(!0)),e}function o(n,s,o){function a(e,t,n){e.x=Math.abs(e.x),e.y=Math.abs(e.y),e.x+t>u.width&&(u.width=e.x+t),e.y+n>u.height&&(u.height=e.y+n)}var u={boxes:[],circles:[],width:0,height:0,bodyDef:new b2BodyDef};return arguments.length===1&&(t(u.bodyDef,n.options),o=n.isStatic,s=n.y,n=n.x),typeof o=="boolean"&&o?u.bodyDef.type=b2Body.b2_staticBody:u.bodyDef.type=b2Body.b2_dynamicBody,typeof o=="object"&&t(u.bodyDef,o),u.box=function(e,t,n,r,i){var s;if(arguments.length<1)throw"box must have arguments, at least object or width, height";return arguments.length===1&&(s=e),arguments.length<4&&(i=n,n=e,r=t,e=t=0),s||(s={x:e,y:t,width:n,height:r,options:i}),u.boxes.push(s),a(s,s.width,s.height),u},u.circle=function(e,t,n,r){var i;if(arguments.length<1)throw"circle must have arguments, at least object or size";return arguments.length===1&&typeof e!="number"&&(i=e),arguments.length<3&&(r=t,n=e,e=t=0),i||(i={x:e,y:t,size:n,options:r}),u.circles.push(i),a(i,i.size,i.size),u},u.create=function(){function l(e,n){fixtureDef=new b2FixtureDef,t(fixtureDef,{density:1}),t(fixtureDef,n),fixtureDef.shape=e,o.CreateFixture(fixtureDef)}var o,a=u.width/2,f=u.height/2;return u.bodyDef.position.Set(n+a,s+f),o=e.CreateBody(u.bodyDef),r(u.boxes,function(e){var t=new b2PolygonShape.AsBox(e.width/2,e.height/2),n=i(e.x,e.width,u.width),r=i(e.y,e.height,u.height);t.m_vertices.forEach(function(e){e.x+=n,e.y+=r}),l(t,e.options)}),r(u.circles,function(e){var t=new b2CircleShape(e.size/2),n=i(e.x,e.size,u.width),r=i(e.y,e.size,u.height);t.SetLocalPosition(new b2Vec2(n,r)),l(t,e.options)}),o.width=u.width,o.height=u.height,o},u.b=u.box,u.c=u.circle,u}function u(){function s(s,o,u){var a,f,l=s.GetPosition();return arguments.length===1&&(o=u=0),o=i(o,0,s.width),u=i(u,0,s.width),o+=l.x,u+=l.y,n.push([s,o,u]),n.length===2&&(a=new b2Vec2(n[0][1],n[0][2]),f=new b2Vec2(n[1][1],n[1][2]),t.joint=r.Initialize(n[0][0],n[1][0],a,f),e.CreateJoint(r)),t}var t={},n=[],r=new b2DistanceJointDef;return t.a=t.b=s,t}function a(e){var t=e.GetPosition();if(typeof e.width=="undefined"||typeof e.height=="undefined")e.width=0,e.height=0;return{x:t.x-e.width/2,y:t.y-e.height/2,origo:{x:t.x,y:t.y},width:e.width,height:e.height}}function f(e){var t={bodyWraps:[]};return t.create=function(){var e=[];return r(t.bodyWraps,function(t){e.push(t.create())}),e},r(e,function(e){var i;e=n(e,{x:0,y:0,isStatic:!1,options:{}}),i=o(e),r(e.boxes,function(e){e=n(e,{x:0,y:0,width:1,height:1,options:{}}),i.box(e)}),r(e.circles,function(e){e=n(e,{x:0,y:0,size:1,options:{}}),i.circle(e)}),t.bodyWraps.push(i)}),t}var e;return{init:s,body:o,b:o,joint:u,position:a,pos:a,build:f}}(),function(){function C(e,t,n){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e._chain&&(e=e._wrapped),t._chain&&(t=t._wrapped);if(e.isEqual&&S.isFunction(e.isEqual))return e.isEqual(t);if(t.isEqual&&S.isFunction(t.isEqual))return t.isEqual(e);var r=a.call(e);if(r!=a.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var i=n.length;while(i--)if(n[i]==e)return!0;n.push(e);var s=0,o=!0;if(r=="[object Array]"){s=e.length,o=s==t.length;if(o)while(s--)if(!(o=s in e==s in t&&C(e[s],t[s],n)))break}else{if("constructor"in e!="constructor"in t||e.constructor!=t.constructor)return!1;for(var u in e)if(S.has(e,u)){s++;if(!(o=S.has(t,u)&&C(e[u],t[u],n)))break}if(o){for(u in t)if(S.has(t,u)&&!(s--))break;o=!s}}return n.pop(),o}var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.slice,u=r.unshift,a=i.toString,f=i.hasOwnProperty,l=r.forEach,c=r.map,h=r.reduce,p=r.reduceRight,d=r.filter,v=r.every,m=r.some,g=r.indexOf,y=r.lastIndexOf,b=Array.isArray,w=Object.keys,E=s.bind,S=function(e){return new P(e)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=S),exports._=S):e._=S,S.VERSION="1.3.3";var x=S.each=S.forEach=function(e,t,r){if(e==null)return;if(l&&e.forEach===l)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(r,e[i],i,e)===n)return}else for(var o in e)if(S.has(e,o)&&t.call(r,e[o],o,e)===n)return};S.map=S.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(x(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},S.reduce=S.foldl=S.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=S.bind(t,r)),i?e.reduce(t,n):e.reduce(t);x(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},S.reduceRight=S.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=S.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=S.toArray(e).reverse();return r&&!i&&(t=S.bind(t,r)),i?S.reduce(s,t,n,r):S.reduce(s,t)},S.find=S.detect=function(e,t,n){var r;return T(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},S.filter=S.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(x(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},S.reject=function(e,t,n){var r=[];return e==null?r:(x(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},S.every=S.all=function(e,t,r){var i=!0;return e==null?i:v&&e.every===v?e.every(t,r):(x(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var T=S.some=S.any=function(e,t,r){t||(t=S.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,r):(x(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};S.include=S.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:(n=T(e,function(e){return e===t}),n)},S.invoke=function(e,t){var n=o.call(arguments,2);return S.map(e,function(e){return(S.isFunction(t)?t||e:e[t]).apply(e,n)})},S.pluck=function(e,t){return S.map(e,function(e){return e[t]})},S.max=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&S.isEmpty(e))return-Infinity;var r={computed:-Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},S.min=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&S.isEmpty(e))return Infinity;var r={computed:Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},S.shuffle=function(e){var t=[],n;return x(e,function(e,r,i){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t},S.sortBy=function(e,t,n){var r=S.isFunction(t)?t:function(e){return e[t]};return S.pluck(S.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},S.groupBy=function(e,t){var n={},r=S.isFunction(t)?t:function(e){return e[t]};return x(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},S.sortedIndex=function(e,t,n){n||(n=S.identity);var r=0,i=e.length;while(r<i){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},S.toArray=function(e){return e?S.isArray(e)?o.call(e):S.isArguments(e)?o.call(e):e.toArray&&S.isFunction(e.toArray)?e.toArray():S.values(e):[]},S.size=function(e){return S.isArray(e)?e.length:S.keys(e).length},S.first=S.head=S.take=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},S.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},S.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},S.rest=S.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},S.compact=function(e){return S.filter(e,function(e){return!!e})},S.flatten=function(e,t){return S.reduce(e,function(e,n){return S.isArray(n)?e.concat(t?n:S.flatten(n)):(e[e.length]=n,e)},[])},S.without=function(e){return S.difference(e,o.call(arguments,1))},S.uniq=S.unique=function(e,t,n){var r=n?S.map(e,n):e,i=[];return e.length<3&&(t=!0),S.reduce(r,function(n,r,s){if(t?S.last(n)!==r||!n.length:!S.include(n,r))n.push(r),i.push(e[s]);return n},[]),i},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=S.intersect=function(e){var t=o.call(arguments,1);return S.filter(S.uniq(e),function(e){return S.every(t,function(t){return S.indexOf(t,e)>=0})})},S.difference=function(e){var t=S.flatten(o.call(arguments,1),!0);return S.filter(e,function(e){return!S.include(t,e)})},S.zip=function(){var e=o.call(arguments),t=S.max(S.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=S.pluck(e,""+r);return n},S.indexOf=function(e,t,n){if(e==null)return-1;var r,i;if(n)return r=S.sortedIndex(e,t),e[r]===t?r:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(r in e&&e[r]===t)return r;return-1},S.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);var n=e.length;while(n--)if(n in e&&e[n]===t)return n;return-1},S.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var N=function(){};S.bind=function(t,n){var r,i;if(t.bind===E&&E)return E.apply(t,o.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return i=o.call(arguments,2),r=function(){if(this instanceof r){N.prototype=t.prototype;var e=new N,s=t.apply(e,i.concat(o.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(o.call(arguments)))}},S.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=S.functions(e)),x(t,function(t){e[t]=S.bind(e[t],e)}),e},S.memoize=function(e,t){var n={};return t||(t=S.identity),function(){var r=t.apply(this,arguments);return S.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},S.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(o.call(arguments,1)))},S.throttle=function(e,t){var n,r,i,s,o,u,a=S.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var f=function(){i=null,o&&e.apply(n,r),a()};return i||(i=setTimeout(f,t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}},S.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,n||e.apply(i,s)};n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(o,t)}},S.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},S.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},S.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},S.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},S.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)S.has(e,n)&&(t[t.length]=n);return t},S.values=function(e){return S.map(e,S.identity)},S.functions=S.methods=function(e){var t=[];for(var n in e)S.isFunction(e[n])&&t.push(n);return t.sort()},S.extend=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},S.pick=function(e){var t={};return x(S.flatten(o.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},S.defaults=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e},S.isEqual=function(e,t){return C(e,t,[])},S.isEmpty=function(e){if(e==null)return!0;if(S.isArray(e)||S.isString(e))return e.length===0;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!!e&&e.nodeType==1},S.isArray=b||function(e){return a.call(e)=="[object Array]"},S.isObject=function(e){return e===Object(e)},S.isArguments=function(e){return a.call(e)=="[object Arguments]"},S.isArguments(arguments)||(S.isArguments=function(e){return!!e&&!!S.has(e,"callee")}),S.isFunction=function(e){return a.call(e)=="[object Function]"},S.isString=function(e){return a.call(e)=="[object String]"},S.isNumber=function(e){return a.call(e)=="[object Number]"},S.isFinite=function(e){return S.isNumber(e)&&isFinite(e)},S.isNaN=function(e){return e!==e},S.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},S.isDate=function(e){return a.call(e)=="[object Date]"},S.isRegExp=function(e){return a.call(e)=="[object RegExp]"},S.isNull=function(e){return e===null},S.isUndefined=function(e){return e===void 0},S.has=function(e,t){return f.call(e,t)},S.noConflict=function(){return e._=t,this},S.identity=function(e){return e},S.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},S.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},S.result=function(e,t){if(e==null)return null;var n=e[t];return S.isFunction(n)?n.call(e):n},S.mixin=function(e){x(S.functions(e),function(t){B(t,S[t]=e[t])})};var k=0;S.uniqueId=function(e){var t=k++;return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/.^/,A={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var O in A)A[A[O]]=O;var M=/\\|'|\r|\n|\t|\u2028|\u2029/g,_=/\\(\\|'|r|n|t|u2028|u2029)/g,D=function(e){return e.replace(_,function(e,t){return A[t]})};S.template=function(e,t,n){n=S.defaults(n||{},S.templateSettings);var r="__p+='"+e.replace(M,function(e){return"\\"+A[e]}).replace(n.escape||L,function(e,t){return"'+\n_.escape("+D(t)+")+\n'"}).replace(n.interpolate||L,function(e,t){return"'+\n("+D(t)+")+\n'"}).replace(n.evaluate||L,function(e,t){return"';\n"+D(t)+"\n;__p+='"})+"';\n";n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+r+"return __p;\n";var i=new Function(n.variable||"obj","_",r);if(t)return i(t,S);var s=function(e){return i.call(this,e,S)};return s.source="function("+(n.variable||"obj")+"){\n"+r+"}",s},S.chain=function(e){return S(e).chain()};var P=function(e){this._wrapped=e};S.prototype=P.prototype;var H=function(e,t){return t?S(e).chain():e},B=function(e,t){P.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),H(t.apply(S,e),this._chain)}};S.mixin(S),x(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];P.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],H(n,this._chain)}}),x(["concat","join","slice"],function(e){var t=r[e];P.prototype[e]=function(){return H(t.apply(this._wrapped,arguments),this._chain)}}),P.prototype.chain=function(){return this._chain=!0,this},P.prototype.value=function(){return this._wrapped}}.call(this),helpers={deepDefaults:function(e,t){_.isObject(e)&&_.isObject(t)&&(_.defaults(e,t),_.each(e,function(e,n){helpers.deepDefaults(e,t[n])}))}},events=function(){var e,t;return e={},t={},e.l=t,e.on=function(e,n,r){arguments.length===2&&(r=n,n=1),t[e]||(t[e]=[]),t[e].push({priority:n,callback:r}),t[e].sort(function(e,t){return e.priority>t.priority})},e.trigger=function(e,n,r){var i;return _.each(t[e],function(e){var t;t=e.callback(n,r),typeof t!="undefined"&&(i=t)}),i},e}(),preload=function(){function i(e,s){e=_.without(e,r),r=r.concat(e);var o=[],u=new PreloadJS;t+=e.length,u.onFileLoad=function(e){o.push(e)},u.onComplete=function(){var e=[];n+=o.length,_.each(o,function(t){allAssets.push(t);switch(t.type){case PreloadJS.JAVASCRIPT:document.body.appendChild(t.result);break;case PreloadJS.JSON:try{t=JSON.parse(t.result),_.each(t.preload,function(t){if(_.contains(r,t))return;e.push(t)}),delete t.preload,helpers.deepDefaults(result,t)}catch(n){throw console.error("Unable to parse "+t.src),n}}}),e.length>0&&i(e,s),s(n,t,result,allAssets)},u.loadManifest(e)}var e={},t=0,n=0,r=[];return e.recursiveLoad=function(e,r){t=0,n=0,result={},allAssets=[],i(e,r)},e}(),physics=function(){function o(e,t,n){var r=t.m_fixtureA.m_body.object,i=t.m_fixtureB.m_body.object;events.trigger(e,r,i,n)}function a(e,t){e.Step(t,t*r,t*i)}var e={},t=e.world=trolley.init(),n=Date.now(),r=300,i=200,s=[];events.on("onload",function(){r=meta.velocityIterationsPerSecond||r,i=meta.positionIterationsPerSecond||i,meta.gravity&&t.SetGravity(new b2Vec2(meta.gravity.x,meta.gravity.y))}),e.createBody=function(e){e.body=trolley.build(e.body).create()[0],e.body&&(e.body.object=e)},e.overlapping=function(e){function r(e){return e!==n&&e.GetAABB().TestOverlap(n.GetAABB())&&t.push(e.GetBody()),!0}var t=[],n=e.GetFixtureList();while(n!==null)physics.world.QueryAABB(r,n.GetAABB()),n=n.GetNext();return t},e.collide=function(e,t){events.on("collide",function(n,r){if(!n||!r)return;var i=n.def===e?n:r;if(i.def!==e)return;i===r&&(r=n),t(i,r)})};var u=new b2ContactListener;return u.BeginContact=function(e){o("collide",e),o("begincontact",e)},u.EndContact=function(e){o("endcontact",e)},u.PostSolve=function(e,t){o("postsolve",e,t)},u.PreSolve=function(e,t){o("presolve",e,t)},t.SetContactListener(u),t.SetContactFilter({ShouldCollide:function(e,t){var n,r;return n=e.m_body.object,r=t.m_body.object,events.trigger("shouldcollide",n,r)}}),events.on("objectCreate",function(t){e.createBody(t)}),events.on("objectDestroy",function(e){s.push(e.body)}),events.on("tick",3,function(){t.ClearForces()}),events.on("tick",-1,function(){_.each(s,function(e){t.DestroyBody(e)}),s=[];var e=(new Date).getTime(),r=(e-n)/1e3;n=e,r>10&&(r=1/game.fps),a(t,r)}),e}(),graphics=function(){function t(t){var n=e.pos(t);_.each(t.graphics,function(e){e.x=n.x+e.regX,e.y=n.y+e.regY,e.paddX&&(e.x+=e.paddX),e.paddY&&(e.y+=e.paddY),t.body&&(e.rotation=-(t.body.GetAngle()*180/Math.PI))})}var e;return e={},e.scale=10,events.on("onload",function(){e.scale=meta.scale||e.scale}),e.pos=function(t){var n;return t.body?(n=trolley.pos(t.body),{x:n.x*e.scale,y:e.height-n.y*e.scale-t.body.height*e.scale}):t},e.createGraphics=function(t){var n=[];_.each(t.graphics,function(r){var i,s,o,u,a,f;t.body?(s=t.body.width*e.scale,o=t.body.height*e.scale):(s=r.width,o=r.height);if(r.id){if(!game.assets[r.id])throw new Error("Unknown graphics id: "+r.id);u=new Shape,i=u.graphics,i.beginBitmapFill(game.assets[r.id]),i.drawRect(0,0,s,o)}else a=new SpriteSheet(r),u=new BitmapAnimation(a),t.animation&&(r.animation=t.animation),r.animation||(r.animation="default"),u.gotoAndPlay(r.animation);t.rotation&&(u.rotation=t.rotation),u.paddX=r.paddX,u.paddY=r.paddY,u.regX=s/2,u.regY=o/2,u.loop=r.loop,meta.graphics&&(u.scaleX=meta.graphics.scaleX||1,u.scaleY=meta.graphics.scaleY||1),r.zindex?e.stage.addChildAt(u,r.zindex):e.stage.addChild(u),n.push(u),r.name&&(n[r.name]=u)}),t.graphics=n},events.on("objectCreate",function(n){e.createGraphics(n),_.each(n.graphics,function(e){e.loop&&(e.onAnimationEnd=function(){e.loop--;if(e.loop===0){n.body?game.destroyObject(n):graphics.stage.removeChild(e);return}e.gotoAndPlay(e.currentAnimation)})}),t(n)}),events.on("objectDestroy",function(t){_.each(t.graphics,function(t){e.stage.removeChild(t)})}),events.on("onload",function(){var t;t=document.getElementById("gamepanel"),e.width=t.width,e.height=t.height,e.center={x:e.width/2,y:e.height/2},e.stage=new Stage(t),e.stage.onMouseMove=function(e){events.trigger("mouseMove",e)},e.stage.onMouseDown=function(e){events.trigger("mouseDown",e)},e.stage.onMouseUp=function(e){events.trigger("mouseUp",e)}}),events.on("tick",2,function(){_.each(game.actives,t),e.stage.update()}),e}(),game=function(){var e;return e={},e.fps=40,e.objects=[],e.actives=[],e.defs={},e.assets={},e.keys=new Kibo,e.createObject=function(t){var n=e.defs[t.def];return n&&helpers.deepDefaults(t,n),t.name&&(e[t.name]=t),e.objects.push(t),n&&n.body&&n.body.isStatic||e.actives.push(t),events.trigger("objectCreate",t),t},e.destroyObject=function(t){events.trigger("objectDestroy",t),e.objects=_.without(e.objects,t)},e.overlapping=function(e){var t=physics.overlapping(e.body);return _.chain(t).compact().map(function(e){return e.object}).value()},e.init=function(t,n,r){var i;t.match(/\.json$/i)||(t+=".json"),i=[t,"meta.json"],preload.recursiveLoad(i,function(t,i,s,o){n&&n(t,i,s,o);if(t<i)return;_.each(e.objects,function(t){e.destroyObject(t)}),meta=s.meta,events.trigger("onload"),_.each(o,function(t){e.assets[t.id]=t.result}),_.extend(e.defs,s.defs),_.each(s.objects,function(t){e.createObject(t)}),Ticker.removeAllListeners(),Ticker.setFPS(e.fps),Ticker.addListener(function(){events.trigger("tick")}),setTimeout(function(){events.trigger("ready")},100),r&&r()})},e}();