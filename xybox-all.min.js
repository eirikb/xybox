function extend(a,b){for(var c in b)a[c]=b[c]}function isInstanceOf(a,b){for(;"object"==typeof a;){if(a.constructor===b)return!0;a=a._super}return!1}var b2BoundValues=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BoundValues.prototype.__constructor=function(){this.lowerValues=[],this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=[],this.upperValues[0]=0,this.upperValues[1]=0},b2BoundValues.prototype.__varz=function(){},b2BoundValues.prototype.lowerValues=null,b2BoundValues.prototype.upperValues=null;var b2PairManager=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2PairManager.prototype.__constructor=function(){this.m_pairs=[],this.m_pairBuffer=[],this.m_pairBufferCount=this.m_pairCount=0,this.m_freePair=null},b2PairManager.prototype.__varz=function(){},b2PairManager.prototype.AddPair=function(a,b){var c=a.pairs[b];return null!=c?c:(null==this.m_freePair&&(this.m_freePair=new b2Pair,this.m_pairs.push(this.m_freePair)),c=this.m_freePair,this.m_freePair=c.next,c.proxy1=a,c.proxy2=b,c.status=0,c.userData=null,c.next=null,a.pairs[b]=c,b.pairs[a]=c,++this.m_pairCount,c)},b2PairManager.prototype.RemovePair=function(a,b){var c=a.pairs[b];if(null==c)return null;var d=c.userData;return delete a.pairs[b],delete b.pairs[a],c.next=this.m_freePair,c.proxy1=null,c.proxy2=null,c.userData=null,c.status=0,this.m_freePair=c,--this.m_pairCount,d},b2PairManager.prototype.Find=function(a,b){return a.pairs[b]},b2PairManager.prototype.ValidateBuffer=function(){},b2PairManager.prototype.ValidateTable=function(){},b2PairManager.prototype.Initialize=function(a){this.m_broadPhase=a},b2PairManager.prototype.AddBufferedPair=function(a,b){var c=this.AddPair(a,b);0==c.IsBuffered()&&(c.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount]=c,++this.m_pairBufferCount),c.ClearRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer()},b2PairManager.prototype.RemoveBufferedPair=function(a,b){var c=this.Find(a,b);null!=c&&(0==c.IsBuffered()&&(c.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount]=c,++this.m_pairBufferCount),c.SetRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer())},b2PairManager.prototype.Commit=function(a){var b=0;for(b=0;b<this.m_pairBufferCount;++b){var c=this.m_pairBuffer[b];c.ClearBuffered();var d=c.proxy1,e=c.proxy2;c.IsRemoved()||0==c.IsFinal()&&a(d.userData,e.userData)}this.m_pairBufferCount=0,b2BroadPhase.s_validate&&this.ValidateTable()},b2PairManager.prototype.m_broadPhase=null,b2PairManager.prototype.m_pairs=null,b2PairManager.prototype.m_freePair=null,b2PairManager.prototype.m_pairCount=0,b2PairManager.prototype.m_pairBuffer=null,b2PairManager.prototype.m_pairBufferCount=0;var b2TimeStep=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TimeStep.prototype.__constructor=function(){},b2TimeStep.prototype.__varz=function(){},b2TimeStep.prototype.Set=function(a){this.dt=a.dt,this.inv_dt=a.inv_dt,this.positionIterations=a.positionIterations,this.velocityIterations=a.velocityIterations,this.warmStarting=a.warmStarting},b2TimeStep.prototype.dt=null,b2TimeStep.prototype.inv_dt=null,b2TimeStep.prototype.dtRatio=null,b2TimeStep.prototype.velocityIterations=0,b2TimeStep.prototype.positionIterations=0,b2TimeStep.prototype.warmStarting=null;var b2Controller=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Controller.prototype.__constructor=function(){},b2Controller.prototype.__varz=function(){},b2Controller.prototype.Step=function(){},b2Controller.prototype.Draw=function(){},b2Controller.prototype.AddBody=function(a){var b=new b2ControllerEdge;b.controller=this,b.body=a,b.nextBody=m_bodyList,b.prevBody=null,m_bodyList=b,b.nextBody&&(b.nextBody.prevBody=b),m_bodyCount++,b.nextController=a.m_controllerList,b.prevController=null,a.m_controllerList=b,b.nextController&&(b.nextController.prevController=b),a.m_controllerCount++},b2Controller.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!=this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody),b.nextBody&&(b.nextBody.prevBody=b.prevBody),b.nextController&&(b.nextController.prevController=b.prevController),b.prevController&&(b.prevController.nextController=b.nextController),m_bodyList==b&&(m_bodyList=b.nextBody),a.m_controllerList==b&&(a.m_controllerList=b.nextController),a.m_controllerCount--,m_bodyCount--},b2Controller.prototype.Clear=function(){for(;m_bodyList;)this.RemoveBody(m_bodyList.body)},b2Controller.prototype.GetNext=function(){return this.m_next},b2Controller.prototype.GetWorld=function(){return this.m_world},b2Controller.prototype.GetBodyList=function(){return m_bodyList},b2Controller.prototype.m_next=null,b2Controller.prototype.m_prev=null,b2Controller.prototype.m_world=null;var b2GravityController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GravityController.prototype,b2Controller.prototype),b2GravityController.prototype._super=b2Controller.prototype,b2GravityController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2GravityController.prototype.__varz=function(){},b2GravityController.prototype.Step=function(){var a=null,b=null,c=null,d=0,e=null,f=null,g=null,h=0,i=0,j=0;if(h=null,this.invSqr)for(a=m_bodyList;a;a=a.nextBody)for(b=a.body,c=b.GetWorldCenter(),d=b.GetMass(),e=m_bodyList;e!=a;e=e.nextBody)f=e.body,g=f.GetWorldCenter(),h=g.x-c.x,i=g.y-c.y,j=h*h+i*i,j<Number.MIN_VALUE||(h=new b2Vec2(h,i),h.Multiply(this.G/j/Math.sqrt(j)*d*f.GetMass()),b.IsAwake()&&b.ApplyForce(h,c),h.Multiply(-1),f.IsAwake()&&f.ApplyForce(h,g));else for(a=m_bodyList;a;a=a.nextBody)for(b=a.body,c=b.GetWorldCenter(),d=b.GetMass(),e=m_bodyList;e!=a;e=e.nextBody)f=e.body,g=f.GetWorldCenter(),h=g.x-c.x,i=g.y-c.y,j=h*h+i*i,j<Number.MIN_VALUE||(h=new b2Vec2(h,i),h.Multiply(this.G/j*d*f.GetMass()),b.IsAwake()&&b.ApplyForce(h,c),h.Multiply(-1),f.IsAwake()&&f.ApplyForce(h,g))},b2GravityController.prototype.G=1,b2GravityController.prototype.invSqr=!0;var b2DestructionListener=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DestructionListener.prototype.__constructor=function(){},b2DestructionListener.prototype.__varz=function(){},b2DestructionListener.prototype.SayGoodbyeJoint=function(){},b2DestructionListener.prototype.SayGoodbyeFixture=function(){};var b2ContactEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactEdge.prototype.__constructor=function(){},b2ContactEdge.prototype.__varz=function(){},b2ContactEdge.prototype.other=null,b2ContactEdge.prototype.contact=null,b2ContactEdge.prototype.prev=null,b2ContactEdge.prototype.next=null;var b2EdgeChainDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2EdgeChainDef.prototype.__constructor=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},b2EdgeChainDef.prototype.__varz=function(){},b2EdgeChainDef.prototype.vertices=null,b2EdgeChainDef.prototype.vertexCount=null,b2EdgeChainDef.prototype.isALoop=null;var b2Vec2=function(a,b){2==arguments.length&&(this.x=a,this.y=b)};b2Vec2.Make=function(a,b){return new b2Vec2(a,b)},b2Vec2.prototype.SetZero=function(){this.y=this.x=0},b2Vec2.prototype.Set=function(a,b){this.x=a,this.y=b},b2Vec2.prototype.SetV=function(a){this.x=a.x,this.y=a.y},b2Vec2.prototype.GetNegative=function(){return new b2Vec2(-this.x,-this.y)},b2Vec2.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},b2Vec2.prototype.Copy=function(){return new b2Vec2(this.x,this.y)},b2Vec2.prototype.Add=function(a){this.x+=a.x,this.y+=a.y},b2Vec2.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y},b2Vec2.prototype.Multiply=function(a){this.x*=a,this.y*=a},b2Vec2.prototype.MulM=function(a){var b=this.x;this.x=a.col1.x*b+a.col2.x*this.y,this.y=a.col1.y*b+a.col2.y*this.y},b2Vec2.prototype.MulTM=function(a){var b=b2Math.Dot(this,a.col1);this.y=b2Math.Dot(this,a.col2),this.x=b},b2Vec2.prototype.CrossVF=function(a){var b=this.x;this.x=a*this.y,this.y=-a*b},b2Vec2.prototype.CrossFV=function(a){var b=this.x;this.x=-a*this.y,this.y=a*b},b2Vec2.prototype.MinV=function(a){this.x=this.x<a.x?this.x:a.x,this.y=this.y<a.y?this.y:a.y},b2Vec2.prototype.MaxV=function(a){this.x=this.x>a.x?this.x:a.x,this.y=this.y>a.y?this.y:a.y},b2Vec2.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},b2Vec2.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},b2Vec2.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var b=1/a;return this.x*=b,this.y*=b,a},b2Vec2.prototype.IsValid=function(){return b2Math.IsValid(this.x)&&b2Math.IsValid(this.y)},b2Vec2.prototype.x=0,b2Vec2.prototype.y=0;var b2Vec3=function(a,b,c){3==arguments.length&&(this.x=a,this.y=b,this.z=c)};b2Vec3.prototype.SetZero=function(){this.x=this.y=this.z=0},b2Vec3.prototype.Set=function(a,b,c){this.x=a,this.y=b,this.z=c},b2Vec3.prototype.SetV=function(a){this.x=a.x,this.y=a.y,this.z=a.z},b2Vec3.prototype.GetNegative=function(){return new b2Vec3(-this.x,-this.y,-this.z)},b2Vec3.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},b2Vec3.prototype.Copy=function(){return new b2Vec3(this.x,this.y,this.z)},b2Vec3.prototype.Add=function(a){this.x+=a.x,this.y+=a.y,this.z+=a.z},b2Vec3.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y,this.z-=a.z},b2Vec3.prototype.Multiply=function(a){this.x*=a,this.y*=a,this.z*=a},b2Vec3.prototype.x=0,b2Vec3.prototype.y=0,b2Vec3.prototype.z=0;var b2DistanceProxy=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceProxy.prototype.__constructor=function(){},b2DistanceProxy.prototype.__varz=function(){},b2DistanceProxy.prototype.Set=function(a){switch(a.GetType()){case b2Shape.e_circleShape:this.m_vertices=Array(1),this.m_vertices[0]=a.m_p,this.m_count=1,this.m_radius=a.m_radius;break;case b2Shape.e_polygonShape:this.m_vertices=a.m_vertices,this.m_count=a.m_vertexCount,this.m_radius=a.m_radius;break;default:b2Settings.b2Assert(!1)}},b2DistanceProxy.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_count;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},b2DistanceProxy.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_count;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return this.m_vertices[b]},b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},b2DistanceProxy.prototype.GetVertex=function(a){return b2Settings.b2Assert(a>=0&&a<this.m_count),this.m_vertices[a]},b2DistanceProxy.prototype.m_vertices=null,b2DistanceProxy.prototype.m_count=0,b2DistanceProxy.prototype.m_radius=null;var b2ContactFactory=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactFactory.prototype.__constructor=function(a){this.m_allocator=a,this.InitializeRegisters()},b2ContactFactory.prototype.__varz=function(){},b2ContactFactory.prototype.AddType=function(a,b,c,d){this.m_registers[c][d].createFcn=a,this.m_registers[c][d].destroyFcn=b,this.m_registers[c][d].primary=!0,c!=d&&(this.m_registers[d][c].createFcn=a,this.m_registers[d][c].destroyFcn=b,this.m_registers[d][c].primary=!1)},b2ContactFactory.prototype.InitializeRegisters=function(){this.m_registers=Array(b2Shape.e_shapeTypeCount);for(var a=0;a<b2Shape.e_shapeTypeCount;a++){this.m_registers[a]=Array(b2Shape.e_shapeTypeCount);for(var b=0;b<b2Shape.e_shapeTypeCount;b++)this.m_registers[a][b]=new b2ContactRegister}this.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape),this.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_circleShape),this.AddType(b2PolygonContact.Create,b2PolygonContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_polygonShape),this.AddType(b2EdgeAndCircleContact.Create,b2EdgeAndCircleContact.Destroy,b2Shape.e_edgeShape,b2Shape.e_circleShape),this.AddType(b2PolyAndEdgeContact.Create,b2PolyAndEdgeContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_edgeShape)},b2ContactFactory.prototype.Create=function(a,b){var c=a.GetType(),d=b.GetType();return c=this.m_registers[c][d],c.pool?(d=c.pool,c.pool=d.m_next,c.poolCount--,d.Reset(a,b),d):(d=c.createFcn,null!=d?(c.primary?(d=d(this.m_allocator),d.Reset(a,b)):(d=d(this.m_allocator),d.Reset(b,a)),d):null)},b2ContactFactory.prototype.Destroy=function(a){a.m_manifold.m_pointCount>0&&(a.m_fixtureA.m_body.SetAwake(!0),a.m_fixtureB.m_body.SetAwake(!0));var b=a.m_fixtureA.GetType(),c=a.m_fixtureB.GetType();b=this.m_registers[b][c],b.poolCount++,a.m_next=b.pool,b.pool=a,b=b.destroyFcn,b(a,this.m_allocator)},b2ContactFactory.prototype.m_registers=null,b2ContactFactory.prototype.m_allocator=null;var b2ConstantAccelController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2ConstantAccelController.prototype,b2Controller.prototype),b2ConstantAccelController.prototype._super=b2Controller.prototype,b2ConstantAccelController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2ConstantAccelController.prototype.__varz=function(){this.A=new b2Vec2(0,0)},b2ConstantAccelController.prototype.Step=function(a){a=new b2Vec2(this.A.x*a.dt,this.A.y*a.dt);for(var b=m_bodyList;b;b=b.nextBody){var c=b.body;c.IsAwake()&&c.SetLinearVelocity(new b2Vec2(c.GetLinearVelocity().x+a.x,c.GetLinearVelocity().y+a.y))}},b2ConstantAccelController.prototype.A=new b2Vec2(0,0);var b2SeparationFunction=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SeparationFunction.prototype.__constructor=function(){},b2SeparationFunction.prototype.__varz=function(){this.m_localPoint=new b2Vec2,this.m_axis=new b2Vec2},b2SeparationFunction.e_points=1,b2SeparationFunction.e_faceA=2,b2SeparationFunction.e_faceB=4,b2SeparationFunction.prototype.Initialize=function(a,b,c,d,e){this.m_proxyA=b,this.m_proxyB=d,b=a.count,b2Settings.b2Assert(b>0&&3>b);var f,g,h,i;if(1==b)this.m_type=b2SeparationFunction.e_points,f=this.m_proxyA.GetVertex(a.indexA[0]),g=this.m_proxyB.GetVertex(a.indexB[0]),i=f,h=c.R,f=c.position.x+(h.col1.x*i.x+h.col2.x*i.y),c=c.position.y+(h.col1.y*i.x+h.col2.y*i.y),i=g,h=e.R,g=e.position.x+(h.col1.x*i.x+h.col2.x*i.y),e=e.position.y+(h.col1.y*i.x+h.col2.y*i.y),this.m_axis.x=g-f,this.m_axis.y=e-c,this.m_axis.Normalize();else{if(a.indexB[0]==a.indexB[1])this.m_type=b2SeparationFunction.e_faceA,b=this.m_proxyA.GetVertex(a.indexA[0]),d=this.m_proxyA.GetVertex(a.indexA[1]),g=this.m_proxyB.GetVertex(a.indexB[0]),this.m_localPoint.x=.5*(b.x+d.x),this.m_localPoint.y=.5*(b.y+d.y),this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(d,b),1),this.m_axis.Normalize(),i=this.m_axis,h=c.R,b=h.col1.x*i.x+h.col2.x*i.y,d=h.col1.y*i.x+h.col2.y*i.y,i=this.m_localPoint,h=c.R,f=c.position.x+(h.col1.x*i.x+h.col2.x*i.y),c=c.position.y+(h.col1.y*i.x+h.col2.y*i.y),i=g,h=e.R,g=e.position.x+(h.col1.x*i.x+h.col2.x*i.y),e=e.position.y+(h.col1.y*i.x+h.col2.y*i.y),a=(g-f)*b+(e-c)*d;else if(a.indexA[0]==a.indexA[0])this.m_type=b2SeparationFunction.e_faceB,h=this.m_proxyB.GetVertex(a.indexB[0]),i=this.m_proxyB.GetVertex(a.indexB[1]),f=this.m_proxyA.GetVertex(a.indexA[0]),this.m_localPoint.x=.5*(h.x+i.x),this.m_localPoint.y=.5*(h.y+i.y),this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(i,h),1),this.m_axis.Normalize(),i=this.m_axis,h=e.R,b=h.col1.x*i.x+h.col2.x*i.y,d=h.col1.y*i.x+h.col2.y*i.y,i=this.m_localPoint,h=e.R,g=e.position.x+(h.col1.x*i.x+h.col2.x*i.y),e=e.position.y+(h.col1.y*i.x+h.col2.y*i.y),i=f,h=c.R,f=c.position.x+(h.col1.x*i.x+h.col2.x*i.y),c=c.position.y+(h.col1.y*i.x+h.col2.y*i.y),a=(f-g)*b+(c-e)*d;else{b=this.m_proxyA.GetVertex(a.indexA[0]),d=this.m_proxyA.GetVertex(a.indexA[1]),h=this.m_proxyB.GetVertex(a.indexB[0]),i=this.m_proxyB.GetVertex(a.indexB[1]),b2Math.MulX(c,f),f=b2Math.MulMV(c.R,b2Math.SubtractVV(d,b)),b2Math.MulX(e,g),a=b2Math.MulMV(e.R,b2Math.SubtractVV(i,h)),e=f.x*f.x+f.y*f.y,g=a.x*a.x+a.y*a.y;var j=b2Math.SubtractVV(a,f);c=f.x*j.x+f.y*j.y,j=a.x*j.x+a.y*j.y,f=f.x*a.x+f.y*a.y;var k=e*g-f*f;a=0,0!=k&&(a=b2Math.Clamp((f*j-c*g)/k,0,1)),0>(f*a+j)/g&&(a=b2Math.Clamp((f-c)/e,0,1)),f=new b2Vec2,f.x=b.x+a*(d.x-b.x),f.y=b.y+a*(d.y-b.y),g=new b2Vec2,g.x=h.x+a*(i.x-h.x),g.y=h.y+a*(i.y-h.y),0==a||1==a?(this.m_type=b2SeparationFunction.e_faceB,this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(i,h),1),this.m_axis.Normalize(),this.m_localPoint=g):(this.m_type=b2SeparationFunction.e_faceA,this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(d,b),1),this.m_localPoint=f)}0>a&&this.m_axis.NegativeSelf()}},b2SeparationFunction.prototype.Evaluate=function(a,b){var c,d,e;switch(this.m_type){case b2SeparationFunction.e_points:return c=b2Math.MulTMV(a.R,this.m_axis),d=b2Math.MulTMV(b.R,this.m_axis.GetNegative()),c=this.m_proxyA.GetSupportVertex(c),d=this.m_proxyB.GetSupportVertex(d),c=b2Math.MulX(a,c),d=b2Math.MulX(b,d),e=(d.x-c.x)*this.m_axis.x+(d.y-c.y)*this.m_axis.y;case b2SeparationFunction.e_faceA:return e=b2Math.MulMV(a.R,this.m_axis),c=b2Math.MulX(a,this.m_localPoint),d=b2Math.MulTMV(b.R,e.GetNegative()),d=this.m_proxyB.GetSupportVertex(d),d=b2Math.MulX(b,d),e=(d.x-c.x)*e.x+(d.y-c.y)*e.y;case b2SeparationFunction.e_faceB:return e=b2Math.MulMV(b.R,this.m_axis),d=b2Math.MulX(b,this.m_localPoint),c=b2Math.MulTMV(a.R,e.GetNegative()),c=this.m_proxyA.GetSupportVertex(c),c=b2Math.MulX(a,c),e=(c.x-d.x)*e.x+(c.y-d.y)*e.y;default:return b2Settings.b2Assert(!1),0}},b2SeparationFunction.prototype.m_proxyA=null,b2SeparationFunction.prototype.m_proxyB=null,b2SeparationFunction.prototype.m_type=0,b2SeparationFunction.prototype.m_localPoint=new b2Vec2,b2SeparationFunction.prototype.m_axis=new b2Vec2;var b2DynamicTreePair=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreePair.prototype.__constructor=function(){},b2DynamicTreePair.prototype.__varz=function(){},b2DynamicTreePair.prototype.proxyA=null,b2DynamicTreePair.prototype.proxyB=null;var b2ContactConstraintPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactConstraintPoint.prototype.__constructor=function(){},b2ContactConstraintPoint.prototype.__varz=function(){this.localPoint=new b2Vec2,this.rA=new b2Vec2,this.rB=new b2Vec2},b2ContactConstraintPoint.prototype.localPoint=new b2Vec2,b2ContactConstraintPoint.prototype.rA=new b2Vec2,b2ContactConstraintPoint.prototype.rB=new b2Vec2,b2ContactConstraintPoint.prototype.normalImpulse=null,b2ContactConstraintPoint.prototype.tangentImpulse=null,b2ContactConstraintPoint.prototype.normalMass=null,b2ContactConstraintPoint.prototype.tangentMass=null,b2ContactConstraintPoint.prototype.equalizedMass=null,b2ContactConstraintPoint.prototype.velocityBias=null;var b2ControllerEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ControllerEdge.prototype.__constructor=function(){},b2ControllerEdge.prototype.__varz=function(){},b2ControllerEdge.prototype.controller=null,b2ControllerEdge.prototype.body=null,b2ControllerEdge.prototype.prevBody=null,b2ControllerEdge.prototype.nextBody=null,b2ControllerEdge.prototype.prevController=null,b2ControllerEdge.prototype.nextController=null;var b2DistanceInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceInput.prototype.__constructor=function(){},b2DistanceInput.prototype.__varz=function(){},b2DistanceInput.prototype.proxyA=null,b2DistanceInput.prototype.proxyB=null,b2DistanceInput.prototype.transformA=null,b2DistanceInput.prototype.transformB=null,b2DistanceInput.prototype.useRadii=null;var b2Settings=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Settings.prototype.__constructor=function(){},b2Settings.prototype.__varz=function(){},b2Settings.b2MixFriction=function(a,b){return Math.sqrt(a*b)},b2Settings.b2MixRestitution=function(a,b){return a>b?a:b},b2Settings.b2Assert=function(a){if(!a)throw"Assertion Failed"},b2Settings.VERSION="2.1alpha",b2Settings.USHRT_MAX=65535,b2Settings.b2_pi=Math.PI,b2Settings.b2_maxManifoldPoints=2,b2Settings.b2_aabbExtension=.1,b2Settings.b2_aabbMultiplier=2,b2Settings.b2_polygonRadius=2*b2Settings.b2_linearSlop,b2Settings.b2_linearSlop=.005,b2Settings.b2_angularSlop=2/180*b2Settings.b2_pi,b2Settings.b2_toiSlop=8*b2Settings.b2_linearSlop,b2Settings.b2_maxTOIContactsPerIsland=32,b2Settings.b2_maxTOIJointsPerIsland=32,b2Settings.b2_velocityThreshold=1,b2Settings.b2_maxLinearCorrection=.2,b2Settings.b2_maxAngularCorrection=8/180*b2Settings.b2_pi,b2Settings.b2_maxTranslation=2,b2Settings.b2_maxTranslationSquared=b2Settings.b2_maxTranslation*b2Settings.b2_maxTranslation,b2Settings.b2_maxRotation=.5*b2Settings.b2_pi,b2Settings.b2_maxRotationSquared=b2Settings.b2_maxRotation*b2Settings.b2_maxRotation,b2Settings.b2_contactBaumgarte=.2,b2Settings.b2_timeToSleep=.5,b2Settings.b2_linearSleepTolerance=.01,b2Settings.b2_angularSleepTolerance=2/180*b2Settings.b2_pi;var b2Proxy=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Proxy.prototype.__constructor=function(){},b2Proxy.prototype.__varz=function(){this.lowerBounds=Array(2),this.upperBounds=Array(2),this.pairs={}},b2Proxy.prototype.IsValid=function(){return this.overlapCount!=b2BroadPhase.b2_invalid},b2Proxy.prototype.lowerBounds=Array(2),b2Proxy.prototype.upperBounds=Array(2),b2Proxy.prototype.overlapCount=0,b2Proxy.prototype.timeStamp=0,b2Proxy.prototype.pairs={},b2Proxy.prototype.next=null,b2Proxy.prototype.userData=null;var b2Point=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Point.prototype.__constructor=function(){},b2Point.prototype.__varz=function(){this.p=new b2Vec2},b2Point.prototype.Support=function(){return this.p},b2Point.prototype.GetFirstVertex=function(){return this.p},b2Point.prototype.p=new b2Vec2;var b2WorldManifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2WorldManifold.prototype.__constructor=function(){this.m_points=Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.m_points[a]=new b2Vec2},b2WorldManifold.prototype.__varz=function(){this.m_normal=new b2Vec2},b2WorldManifold.prototype.Initialize=function(a,b,c,d,e){if(0!=a.m_pointCount){var f,g,h,i,j,k,l,m=0;switch(a.m_type){case b2Manifold.e_circles:g=b.R,f=a.m_localPoint,m=b.position.x+g.col1.x*f.x+g.col2.x*f.y,b=b.position.y+g.col1.y*f.x+g.col2.y*f.y,g=d.R,f=a.m_points[0].m_localPoint,a=d.position.x+g.col1.x*f.x+g.col2.x*f.y,d=d.position.y+g.col1.y*f.x+g.col2.y*f.y,f=a-m,g=d-b,h=f*f+g*g,h>Number.MIN_VALUE*Number.MIN_VALUE?(h=Math.sqrt(h),this.m_normal.x=f/h,this.m_normal.y=g/h):(this.m_normal.x=1,this.m_normal.y=0),f=b+c*this.m_normal.y,d-=e*this.m_normal.y,this.m_points[0].x=.5*(m+c*this.m_normal.x+(a-e*this.m_normal.x)),this.m_points[0].y=.5*(f+d);break;case b2Manifold.e_faceA:for(g=b.R,f=a.m_localPlaneNormal,h=g.col1.x*f.x+g.col2.x*f.y,i=g.col1.y*f.x+g.col2.y*f.y,g=b.R,f=a.m_localPoint,j=b.position.x+g.col1.x*f.x+g.col2.x*f.y,k=b.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_normal.x=h,this.m_normal.y=i,m=0;m<a.m_pointCount;m++)g=d.R,f=a.m_points[m].m_localPoint,l=d.position.x+g.col1.x*f.x+g.col2.x*f.y,f=d.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_points[m].x=l+.5*(c-(l-j)*h-(f-k)*i-e)*h,this.m_points[m].y=f+.5*(c-(l-j)*h-(f-k)*i-e)*i;break;case b2Manifold.e_faceB:for(g=d.R,f=a.m_localPlaneNormal,h=g.col1.x*f.x+g.col2.x*f.y,i=g.col1.y*f.x+g.col2.y*f.y,g=d.R,f=a.m_localPoint,j=d.position.x+g.col1.x*f.x+g.col2.x*f.y,k=d.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_normal.x=-h,this.m_normal.y=-i,m=0;m<a.m_pointCount;m++)g=b.R,f=a.m_points[m].m_localPoint,l=b.position.x+g.col1.x*f.x+g.col2.x*f.y,f=b.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_points[m].x=l+.5*(e-(l-j)*h-(f-k)*i-c)*h,this.m_points[m].y=f+.5*(e-(l-j)*h-(f-k)*i-c)*i}}},b2WorldManifold.prototype.m_normal=new b2Vec2,b2WorldManifold.prototype.m_points=null;var b2RayCastOutput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2RayCastOutput.prototype.__constructor=function(){},b2RayCastOutput.prototype.__varz=function(){this.normal=new b2Vec2},b2RayCastOutput.prototype.normal=new b2Vec2,b2RayCastOutput.prototype.fraction=null;var b2ConstantForceController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2ConstantForceController.prototype,b2Controller.prototype),b2ConstantForceController.prototype._super=b2Controller.prototype,b2ConstantForceController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2ConstantForceController.prototype.__varz=function(){this.F=new b2Vec2(0,0)},b2ConstantForceController.prototype.Step=function(){for(var a=m_bodyList;a;a=a.nextBody){var b=a.body;b.IsAwake()&&b.ApplyForce(this.F,b.GetWorldCenter())}},b2ConstantForceController.prototype.F=new b2Vec2(0,0);var b2MassData=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2MassData.prototype.__constructor=function(){},b2MassData.prototype.__varz=function(){this.center=new b2Vec2(0,0)},b2MassData.prototype.mass=0,b2MassData.prototype.center=new b2Vec2(0,0),b2MassData.prototype.I=0;var b2DynamicTree=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTree.prototype.__constructor=function(){this.m_freeList=this.m_root=null,this.m_insertionCount=this.m_path=0},b2DynamicTree.prototype.__varz=function(){},b2DynamicTree.prototype.AllocateNode=function(){if(this.m_freeList){var a=this.m_freeList;return this.m_freeList=a.parent,a.parent=null,a.child1=null,a.child2=null,a}return new b2DynamicTreeNode},b2DynamicTree.prototype.FreeNode=function(a){a.parent=this.m_freeList,this.m_freeList=a},b2DynamicTree.prototype.InsertLeaf=function(a){if(++this.m_insertionCount,null==this.m_root)this.m_root=a,this.m_root.parent=null;else{var b=a.aabb.GetCenter(),c=this.m_root;if(0==c.IsLeaf())do{var d=c.child1;c=c.child2,c=Math.abs((d.aabb.lowerBound.x+d.aabb.upperBound.x)/2-b.x)+Math.abs((d.aabb.lowerBound.y+d.aabb.upperBound.y)/2-b.y)<Math.abs((c.aabb.lowerBound.x+c.aabb.upperBound.x)/2-b.x)+Math.abs((c.aabb.lowerBound.y+c.aabb.upperBound.y)/2-b.y)?d:c}while(0==c.IsLeaf());if(b=c.parent,d=this.AllocateNode(),d.parent=b,d.userData=null,d.aabb.Combine(a.aabb,c.aabb),b){c.parent.child1==c?b.child1=d:b.child2=d,d.child1=c,d.child2=a,c.parent=d,a.parent=d;do{if(b.aabb.Contains(d.aabb))break;b.aabb.Combine(b.child1.aabb,b.child2.aabb),d=b,b=b.parent}while(b)}else d.child1=c,d.child2=a,c.parent=d,this.m_root=a.parent=d}},b2DynamicTree.prototype.RemoveLeaf=function(a){if(a==this.m_root)this.m_root=null;else{var b=a.parent,c=b.parent;if(a=b.child1==a?b.child2:b.child1,c)for(c.child1==b?c.child1=a:c.child2=a,a.parent=c,this.FreeNode(b);c&&(b=c.aabb,c.aabb=b2AABB.Combine(c.child1.aabb,c.child2.aabb),!b.Contains(c.aabb));)c=c.parent;else this.m_root=a,a.parent=null,this.FreeNode(b)}},b2DynamicTree.prototype.CreateProxy=function(a,b){var c=this.AllocateNode(),d=b2Settings.b2_aabbExtension,e=b2Settings.b2_aabbExtension;return c.aabb.lowerBound.x=a.lowerBound.x-d,c.aabb.lowerBound.y=a.lowerBound.y-e,c.aabb.upperBound.x=a.upperBound.x+d,c.aabb.upperBound.y=a.upperBound.y+e,c.userData=b,this.InsertLeaf(c),c},b2DynamicTree.prototype.DestroyProxy=function(a){this.RemoveLeaf(a),this.FreeNode(a)},b2DynamicTree.prototype.MoveProxy=function(a,b,c){if(b2Settings.b2Assert(a.IsLeaf()),a.aabb.Contains(b))return!1;this.RemoveLeaf(a);var d=b2Settings.b2_aabbExtension+b2Settings.b2_aabbMultiplier*(c.x>0?c.x:-c.x);return c=b2Settings.b2_aabbExtension+b2Settings.b2_aabbMultiplier*(c.y>0?c.y:-c.y),a.aabb.lowerBound.x=b.lowerBound.x-d,a.aabb.lowerBound.y=b.lowerBound.y-c,a.aabb.upperBound.x=b.upperBound.x+d,a.aabb.upperBound.y=b.upperBound.y+c,this.InsertLeaf(a),!0},b2DynamicTree.prototype.Rebalance=function(a){if(null!=this.m_root)for(var b=0;a>b;b++){for(var c=this.m_root,d=0;0==c.IsLeaf();)c=1&this.m_path>>d?c.child2:c.child1,d=31&d+1;++this.m_path,this.RemoveLeaf(c),this.InsertLeaf(c)}},b2DynamicTree.prototype.GetFatAABB=function(a){return a.aabb},b2DynamicTree.prototype.GetUserData=function(a){return a.userData},b2DynamicTree.prototype.Query=function(a,b){if(null!=this.m_root){var c=[],d=0;for(c[d++]=this.m_root;d>0;){var e=c[--d];if(e.aabb.TestOverlap(b))if(e.IsLeaf()){if(!a(e))break}else c[d++]=e.child1,c[d++]=e.child2}}},b2DynamicTree.prototype.RayCast=function(a,b){if(null!=this.m_root){var c=b.p1,d=b.p2,e=b2Math.SubtractVV(c,d);e.Normalize(),e=b2Math.CrossFV(1,e);var f,g=b2Math.AbsV(e),h=b.maxFraction,i=new b2AABB;f=c.x+h*(d.x-c.x),h=c.y+h*(d.y-c.y),i.lowerBound.x=Math.min(c.x,f),i.lowerBound.y=Math.min(c.y,h),i.upperBound.x=Math.max(c.x,f),i.upperBound.y=Math.max(c.y,h);var j=[],k=0;for(j[k++]=this.m_root;k>0;)if(f=j[--k],0!=f.aabb.TestOverlap(i)){h=f.aabb.GetCenter();var l=f.aabb.GetExtents();if(!(Math.abs(e.x*(c.x-h.x)+e.y*(c.y-h.y))-g.x*l.x-g.y*l.y>0))if(f.IsLeaf()){if(h=new b2RayCastInput,h.p1=b.p1,h.p2=b.p2,h.maxFraction=b.maxFraction,h=a(h,f),0==h)break;f=c.x+h*(d.x-c.x),h=c.y+h*(d.y-c.y),i.lowerBound.x=Math.min(c.x,f),i.lowerBound.y=Math.min(c.y,h),i.upperBound.x=Math.max(c.x,f),i.upperBound.y=Math.max(c.y,h)}else j[k++]=f.child1,j[k++]=f.child2}}},b2DynamicTree.prototype.m_root=null,b2DynamicTree.prototype.m_freeList=null,b2DynamicTree.prototype.m_path=0,b2DynamicTree.prototype.m_insertionCount=0;var b2JointEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2JointEdge.prototype.__constructor=function(){},b2JointEdge.prototype.__varz=function(){},b2JointEdge.prototype.other=null,b2JointEdge.prototype.joint=null,b2JointEdge.prototype.prev=null,b2JointEdge.prototype.next=null;var b2RayCastInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2RayCastInput.prototype.__constructor=function(a,b,c){a&&this.p1.SetV(a),b&&this.p2.SetV(b),c&&(this.maxFraction=c)},b2RayCastInput.prototype.__varz=function(){this.p1=new b2Vec2,this.p2=new b2Vec2},b2RayCastInput.prototype.p1=new b2Vec2,b2RayCastInput.prototype.p2=new b2Vec2,b2RayCastInput.prototype.maxFraction=null;var Features=function(){this.__varz(),this.__constructor.apply(this,arguments)};Features.prototype.__constructor=function(){},Features.prototype.__varz=function(){},Features.prototype.__defineGetter__("referenceEdge",function(){return this._referenceEdge}),Features.prototype.__defineSetter__("referenceEdge",function(a){this._referenceEdge=a,this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}),Features.prototype.__defineGetter__("incidentEdge",function(){return this._incidentEdge}),Features.prototype.__defineSetter__("incidentEdge",function(a){this._incidentEdge=a,this._m_id._key=4294902015&this._m_id._key|65280&this._incidentEdge<<8}),Features.prototype.__defineGetter__("incidentVertex",function(){return this._incidentVertex}),Features.prototype.__defineSetter__("incidentVertex",function(a){this._incidentVertex=a,this._m_id._key=4278255615&this._m_id._key|16711680&this._incidentVertex<<16}),Features.prototype.__defineGetter__("flip",function(){return this._flip}),Features.prototype.__defineSetter__("flip",function(a){this._flip=a,this._m_id._key=16777215&this._m_id._key|4278190080&this._flip<<24}),Features.prototype._referenceEdge=0,Features.prototype._incidentEdge=0,Features.prototype._incidentVertex=0,Features.prototype._flip=0,Features.prototype._m_id=null;var b2FilterData=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2FilterData.prototype.__constructor=function(){},b2FilterData.prototype.__varz=function(){this.categoryBits=1,this.maskBits=65535},b2FilterData.prototype.Copy=function(){var a=new b2FilterData;return a.categoryBits=this.categoryBits,a.maskBits=this.maskBits,a.groupIndex=this.groupIndex,a},b2FilterData.prototype.categoryBits=1,b2FilterData.prototype.maskBits=65535,b2FilterData.prototype.groupIndex=0;var b2AABB=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2AABB.prototype.__constructor=function(){},b2AABB.prototype.__varz=function(){this.lowerBound=new b2Vec2,this.upperBound=new b2Vec2
},b2AABB.Combine=function(a,b){var c=new b2AABB;return c.Combine(a,b),c},b2AABB.prototype.IsValid=function(){var a=this.upperBound.y-this.lowerBound.y;return a=(a=this.upperBound.x-this.lowerBound.x>=0&&a>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},b2AABB.prototype.GetCenter=function(){return new b2Vec2((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},b2AABB.prototype.GetExtents=function(){return new b2Vec2((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},b2AABB.prototype.Contains=function(a){return this.lowerBound.x<=a.lowerBound.x&&this.lowerBound.y<=a.lowerBound.y&&a.upperBound.x<=this.upperBound.x&&a.upperBound.y<=this.upperBound.y},b2AABB.prototype.RayCast=function(a,b){var c,d=-Number.MAX_VALUE,e=Number.MAX_VALUE,f=b.p1.x,g=b.p1.y,h=b.p2.x-b.p1.x,i=b.p2.y-b.p1.y,j=Math.abs(i),k=a.normal;if(Math.abs(h)<Number.MIN_VALUE){if(f<this.lowerBound.x||this.upperBound.x<f)return!1}else if(c=1/h,h=(this.lowerBound.x-f)*c,f=(this.upperBound.x-f)*c,c=-1,h>f&&(c=h,h=f,f=c,c=1),h>d&&(k.x=c,k.y=0,d=h),e=Math.min(e,f),d>e)return!1;if(j<Number.MIN_VALUE){if(g<this.lowerBound.y||this.upperBound.y<g)return!1}else if(c=1/i,h=(this.lowerBound.y-g)*c,f=(this.upperBound.y-g)*c,c=-1,h>f&&(c=h,h=f,f=c,c=1),h>d&&(k.y=c,k.x=0,d=h),e=Math.min(e,f),d>e)return!1;return a.fraction=d,!0},b2AABB.prototype.TestOverlap=function(a){var b=a.lowerBound.y-this.upperBound.y,c=this.lowerBound.y-a.upperBound.y;return a.lowerBound.x-this.upperBound.x>0||b>0?!1:this.lowerBound.x-a.upperBound.x>0||c>0?!1:!0},b2AABB.prototype.Combine=function(a,b){this.lowerBound.x=Math.min(a.lowerBound.x,b.lowerBound.x),this.lowerBound.y=Math.min(a.lowerBound.y,b.lowerBound.y),this.upperBound.x=Math.max(a.upperBound.x,b.upperBound.x),this.upperBound.y=Math.max(a.upperBound.y,b.upperBound.y)},b2AABB.prototype.lowerBound=new b2Vec2,b2AABB.prototype.upperBound=new b2Vec2;var b2Jacobian=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Jacobian.prototype.__constructor=function(){},b2Jacobian.prototype.__varz=function(){this.linearA=new b2Vec2,this.linearB=new b2Vec2},b2Jacobian.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},b2Jacobian.prototype.Set=function(a,b,c,d){this.linearA.SetV(a),this.angularA=b,this.linearB.SetV(c),this.angularB=d},b2Jacobian.prototype.Compute=function(a,b,c,d){return this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*c.x+this.linearB.y*c.y)+this.angularB*d},b2Jacobian.prototype.linearA=new b2Vec2,b2Jacobian.prototype.angularA=null,b2Jacobian.prototype.linearB=new b2Vec2,b2Jacobian.prototype.angularB=null;var b2Bound=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Bound.prototype.__constructor=function(){},b2Bound.prototype.__varz=function(){},b2Bound.prototype.IsLower=function(){return 0==(1&this.value)},b2Bound.prototype.IsUpper=function(){return 1==(1&this.value)},b2Bound.prototype.Swap=function(a){var b=this.value,c=this.proxy,d=this.stabbingCount;this.value=a.value,this.proxy=a.proxy,this.stabbingCount=a.stabbingCount,a.value=b,a.proxy=c,a.stabbingCount=d},b2Bound.prototype.value=0,b2Bound.prototype.proxy=null,b2Bound.prototype.stabbingCount=0;var b2SimplexVertex=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SimplexVertex.prototype.__constructor=function(){},b2SimplexVertex.prototype.__varz=function(){},b2SimplexVertex.prototype.Set=function(a){this.wA.SetV(a.wA),this.wB.SetV(a.wB),this.w.SetV(a.w),this.a=a.a,this.indexA=a.indexA,this.indexB=a.indexB},b2SimplexVertex.prototype.wA=null,b2SimplexVertex.prototype.wB=null,b2SimplexVertex.prototype.w=null,b2SimplexVertex.prototype.a=null,b2SimplexVertex.prototype.indexA=0,b2SimplexVertex.prototype.indexB=0;var b2Mat22=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Mat22.prototype.__constructor=function(){this.col1.x=this.col2.y=1},b2Mat22.prototype.__varz=function(){this.col1=new b2Vec2,this.col2=new b2Vec2},b2Mat22.FromAngle=function(a){var b=new b2Mat22;return b.Set(a),b},b2Mat22.FromVV=function(a,b){var c=new b2Mat22;return c.SetVV(a,b),c},b2Mat22.prototype.Set=function(a){var b=Math.cos(a);a=Math.sin(a),this.col1.x=b,this.col2.x=-a,this.col1.y=a,this.col2.y=b},b2Mat22.prototype.SetVV=function(a,b){this.col1.SetV(a),this.col2.SetV(b)},b2Mat22.prototype.Copy=function(){var a=new b2Mat22;return a.SetM(this),a},b2Mat22.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2)},b2Mat22.prototype.AddM=function(a){this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y},b2Mat22.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},b2Mat22.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},b2Mat22.prototype.GetInverse=function(a){var b=this.col1.x,c=this.col2.x,d=this.col1.y,e=this.col2.y,f=b*e-c*d;return 0!=f&&(f=1/f),a.col1.x=f*e,a.col2.x=-f*c,a.col1.y=-f*d,a.col2.y=f*b,a},b2Mat22.prototype.Solve=function(a,b,c){var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h=d*g-e*f;return 0!=h&&(h=1/h),a.x=h*(g*b-e*c),a.y=h*(d*c-f*b),a},b2Mat22.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},b2Mat22.prototype.col1=new b2Vec2,b2Mat22.prototype.col2=new b2Vec2;var b2SimplexCache=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SimplexCache.prototype.__constructor=function(){},b2SimplexCache.prototype.__varz=function(){this.indexA=Array(3),this.indexB=Array(3)},b2SimplexCache.prototype.metric=null,b2SimplexCache.prototype.count=0,b2SimplexCache.prototype.indexA=Array(3),b2SimplexCache.prototype.indexB=Array(3);var b2Shape=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Shape.prototype.__constructor=function(){this.m_type=b2Shape.e_unknownShape,this.m_radius=b2Settings.b2_linearSlop},b2Shape.prototype.__varz=function(){},b2Shape.TestOverlap=function(a,b,c,d){var e=new b2DistanceInput;return e.proxyA=new b2DistanceProxy,e.proxyA.Set(a),e.proxyB=new b2DistanceProxy,e.proxyB.Set(c),e.transformA=b,e.transformB=d,e.useRadii=!0,a=new b2SimplexCache,a.count=0,b=new b2DistanceOutput,b2Distance.Distance(b,a,e),b.distance<10*Number.MIN_VALUE},b2Shape.e_hitCollide=1,b2Shape.e_missCollide=0,b2Shape.e_startsInsideCollide=-1,b2Shape.e_unknownShape=-1,b2Shape.e_circleShape=0,b2Shape.e_polygonShape=1,b2Shape.e_edgeShape=2,b2Shape.e_shapeTypeCount=3,b2Shape.prototype.Copy=function(){return null},b2Shape.prototype.Set=function(a){this.m_radius=a.m_radius},b2Shape.prototype.GetType=function(){return this.m_type},b2Shape.prototype.TestPoint=function(){return!1},b2Shape.prototype.RayCast=function(){return!1},b2Shape.prototype.ComputeAABB=function(){},b2Shape.prototype.ComputeMass=function(){},b2Shape.prototype.ComputeSubmergedArea=function(){return 0},b2Shape.prototype.m_type=0,b2Shape.prototype.m_radius=null;var b2Segment=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Segment.prototype.__constructor=function(){},b2Segment.prototype.__varz=function(){this.p1=new b2Vec2,this.p2=new b2Vec2},b2Segment.prototype.TestSegment=function(a,b,c,d){var e=c.p1,f=c.p2.x-e.x,g=c.p2.y-e.y;c=this.p2.y-this.p1.y;var h=-(this.p2.x-this.p1.x),i=100*Number.MIN_VALUE,j=-(f*c+g*h);if(j>i){var k=e.x-this.p1.x,l=e.y-this.p1.y;if(e=k*c+l*h,e>=0&&d*j>=e&&(d=-f*l+g*k,d>=-i*j&&j*(1+i)>=d))return e/=j,d=Math.sqrt(c*c+h*h),c/=d,h/=d,a[0]=e,b.Set(c,h),!0}return!1},b2Segment.prototype.Extend=function(a){this.ExtendForward(a),this.ExtendBackward(a)},b2Segment.prototype.ExtendForward=function(a){var b=this.p2.x-this.p1.x,c=this.p2.y-this.p1.y;a=Math.min(b>0?(a.upperBound.x-this.p1.x)/b:0>b?(a.lowerBound.x-this.p1.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p1.y)/c:0>c?(a.lowerBound.y-this.p1.y)/c:Number.POSITIVE_INFINITY),this.p2.x=this.p1.x+b*a,this.p2.y=this.p1.y+c*a},b2Segment.prototype.ExtendBackward=function(a){var b=-this.p2.x+this.p1.x,c=-this.p2.y+this.p1.y;a=Math.min(b>0?(a.upperBound.x-this.p2.x)/b:0>b?(a.lowerBound.x-this.p2.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p2.y)/c:0>c?(a.lowerBound.y-this.p2.y)/c:Number.POSITIVE_INFINITY),this.p1.x=this.p2.x+b*a,this.p1.y=this.p2.y+c*a},b2Segment.prototype.p1=new b2Vec2,b2Segment.prototype.p2=new b2Vec2;var b2ContactRegister=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactRegister.prototype.__constructor=function(){},b2ContactRegister.prototype.__varz=function(){},b2ContactRegister.prototype.createFcn=null,b2ContactRegister.prototype.destroyFcn=null,b2ContactRegister.prototype.primary=null,b2ContactRegister.prototype.pool=null,b2ContactRegister.prototype.poolCount=0;var b2DebugDraw=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DebugDraw.prototype.__constructor=function(){this.m_drawFlags=0},b2DebugDraw.prototype.__varz=function(){},b2DebugDraw.e_shapeBit=1,b2DebugDraw.e_jointBit=2,b2DebugDraw.e_aabbBit=4,b2DebugDraw.e_pairBit=8,b2DebugDraw.e_centerOfMassBit=16,b2DebugDraw.e_controllerBit=32,b2DebugDraw.prototype.SetFlags=function(a){this.m_drawFlags=a},b2DebugDraw.prototype.GetFlags=function(){return this.m_drawFlags},b2DebugDraw.prototype.AppendFlags=function(a){this.m_drawFlags|=a},b2DebugDraw.prototype.ClearFlags=function(a){this.m_drawFlags&=~a},b2DebugDraw.prototype.SetSprite=function(a){this.m_sprite=a},b2DebugDraw.prototype.GetSprite=function(){return this.m_sprite},b2DebugDraw.prototype.SetDrawScale=function(a){this.m_drawScale=a},b2DebugDraw.prototype.GetDrawScale=function(){return this.m_drawScale},b2DebugDraw.prototype.SetLineThickness=function(a){this.m_lineThickness=a},b2DebugDraw.prototype.GetLineThickness=function(){return this.m_lineThickness},b2DebugDraw.prototype.SetAlpha=function(a){this.m_alpha=a},b2DebugDraw.prototype.GetAlpha=function(){return this.m_alpha},b2DebugDraw.prototype.SetFillAlpha=function(a){this.m_fillAlpha=a},b2DebugDraw.prototype.GetFillAlpha=function(){return this.m_fillAlpha},b2DebugDraw.prototype.SetXFormScale=function(a){this.m_xformScale=a},b2DebugDraw.prototype.GetXFormScale=function(){return this.m_xformScale},b2DebugDraw.prototype.Clear=function(){this.m_sprite.clearRect(0,0,this.m_sprite.canvas.width,this.m_sprite.canvas.height)},b2DebugDraw.prototype.Y=function(a){return this.m_sprite.canvas.height-a},b2DebugDraw.prototype.ToWorldPoint=function(a){return new b2Vec2(a.x/this.m_drawScale,this.Y(a.y)/this.m_drawScale)},b2DebugDraw.prototype.ColorStyle=function(a,b){return"rgba("+a.r+", "+a.g+", "+a.b+", "+b+")"},b2DebugDraw.prototype.DrawPolygon=function(a,b,c){for(this.m_sprite.graphics.lineStyle(this.m_lineThickness,c.color,this.m_alpha),this.m_sprite.graphics.moveTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale),c=1;b>c;c++)this.m_sprite.graphics.lineTo(a[c].x*this.m_drawScale,a[c].y*this.m_drawScale);this.m_sprite.graphics.lineTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale)},b2DebugDraw.prototype.DrawSolidPolygon=function(a,b,c){for(this.m_sprite.strokeSyle=this.ColorStyle(c,this.m_alpha),this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.fillStyle=this.ColorStyle(c,this.m_fillAlpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(a[0].x*this.m_drawScale,this.Y(a[0].y*this.m_drawScale)),c=1;b>c;c++)this.m_sprite.lineTo(a[c].x*this.m_drawScale,this.Y(a[c].y*this.m_drawScale));this.m_sprite.lineTo(a[0].x*this.m_drawScale,this.Y(a[0].y*this.m_drawScale)),this.m_sprite.fill(),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawCircle=function(a,b,c){this.m_sprite.graphics.lineStyle(this.m_lineThickness,c.color,this.m_alpha),this.m_sprite.graphics.drawCircle(a.x*this.m_drawScale,a.y*this.m_drawScale,b*this.m_drawScale)},b2DebugDraw.prototype.DrawSolidCircle=function(a,b,c,d){this.m_sprite.strokeSyle=this.ColorStyle(d,this.m_alpha),this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.fillStyle=this.ColorStyle(d,this.m_fillAlpha),this.m_sprite.beginPath(),this.m_sprite.arc(a.x*this.m_drawScale,this.Y(a.y*this.m_drawScale),b*this.m_drawScale,0,2*Math.PI,!0),this.m_sprite.fill(),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawSegment=function(a,b,c){this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.strokeSyle=this.ColorStyle(c,this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(a.x*this.m_drawScale,this.Y(a.y*this.m_drawScale)),this.m_sprite.lineTo(b.x*this.m_drawScale,this.Y(b.y*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawTransform=function(a){this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.strokeSyle=this.ColorStyle(new b2Color(255,0,0),this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(a.position.x*this.m_drawScale,this.Y(a.position.y*this.m_drawScale)),this.m_sprite.lineTo((a.position.x+this.m_xformScale*a.R.col1.x)*this.m_drawScale,this.Y((a.position.y+this.m_xformScale*a.R.col1.y)*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath(),this.m_sprite.strokeSyle=this.ColorStyle(new b2Color(0,255,0),this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(a.position.x*this.m_drawScale,this.Y(a.position.y*this.m_drawScale)),this.m_sprite.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*this.m_drawScale,this.Y((a.position.y+this.m_xformScale*a.R.col2.y)*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.m_drawFlags=0,b2DebugDraw.prototype.m_sprite=null,b2DebugDraw.prototype.m_drawScale=1,b2DebugDraw.prototype.m_lineThickness=1,b2DebugDraw.prototype.m_alpha=1,b2DebugDraw.prototype.m_fillAlpha=1,b2DebugDraw.prototype.m_xformScale=1;var b2Sweep=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Sweep.prototype.__constructor=function(){},b2Sweep.prototype.__varz=function(){this.localCenter=new b2Vec2,this.c0=new b2Vec2,this.c=new b2Vec2},b2Sweep.prototype.Set=function(a){this.localCenter.SetV(a.localCenter),this.c0.SetV(a.c0),this.c.SetV(a.c),this.a0=a.a0,this.a=a.a,this.t0=a.t0},b2Sweep.prototype.Copy=function(){var a=new b2Sweep;return a.localCenter.SetV(this.localCenter),a.c0.SetV(this.c0),a.c.SetV(this.c),a.a0=this.a0,a.a=this.a,a.t0=this.t0,a},b2Sweep.prototype.GetTransform=function(a,b){a.position.x=(1-b)*this.c0.x+b*this.c.x,a.position.y=(1-b)*this.c0.y+b*this.c.y,a.R.Set((1-b)*this.a0+b*this.a);var c=a.R;a.position.x-=c.col1.x*this.localCenter.x+c.col2.x*this.localCenter.y,a.position.y-=c.col1.y*this.localCenter.x+c.col2.y*this.localCenter.y},b2Sweep.prototype.Advance=function(a){if(this.t0<a&&1-this.t0>Number.MIN_VALUE){var b=(a-this.t0)/(1-this.t0);this.c0.x=(1-b)*this.c0.x+b*this.c.x,this.c0.y=(1-b)*this.c0.y+b*this.c.y,this.a0=(1-b)*this.a0+b*this.a,this.t0=a}},b2Sweep.prototype.localCenter=new b2Vec2,b2Sweep.prototype.c0=new b2Vec2,b2Sweep.prototype.c=new b2Vec2,b2Sweep.prototype.a0=null,b2Sweep.prototype.a=null,b2Sweep.prototype.t0=null;var b2DistanceOutput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceOutput.prototype.__constructor=function(){},b2DistanceOutput.prototype.__varz=function(){this.pointA=new b2Vec2,this.pointB=new b2Vec2},b2DistanceOutput.prototype.pointA=new b2Vec2,b2DistanceOutput.prototype.pointB=new b2Vec2,b2DistanceOutput.prototype.distance=null,b2DistanceOutput.prototype.iterations=0;var b2Mat33=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Mat33.prototype.__constructor=function(a,b,c){a||b||c?(this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},b2Mat33.prototype.__varz=function(){this.col1=new b2Vec3,this.col2=new b2Vec3,this.col3=new b2Vec3},b2Mat33.prototype.SetVVV=function(a,b,c){this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c)},b2Mat33.prototype.Copy=function(){return new b2Mat33(this.col1,this.col2,this.col3)},b2Mat33.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2),this.col3.SetV(a.col3)},b2Mat33.prototype.AddM=function(a){this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col1.z+=a.col1.z,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y,this.col2.z+=a.col2.z,this.col3.x+=a.col3.x,this.col3.y+=a.col3.y,this.col3.z+=a.col3.z},b2Mat33.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},b2Mat33.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},b2Mat33.prototype.Solve22=function(a,b,c){var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h=d*g-e*f;return 0!=h&&(h=1/h),a.x=h*(g*b-e*c),a.y=h*(d*c-f*b),a},b2Mat33.prototype.Solve33=function(a,b,c,d){var e=this.col1.x,f=this.col1.y,g=this.col1.z,h=this.col2.x,i=this.col2.y,j=this.col2.z,k=this.col3.x,l=this.col3.y,m=this.col3.z,n=e*(i*m-j*l)+f*(j*k-h*m)+g*(h*l-i*k);return 0!=n&&(n=1/n),a.x=n*(b*(i*m-j*l)+c*(j*k-h*m)+d*(h*l-i*k)),a.y=n*(e*(c*m-d*l)+f*(d*k-b*m)+g*(b*l-c*k)),a.z=n*(e*(i*d-j*c)+f*(j*b-h*d)+g*(h*c-i*b)),a},b2Mat33.prototype.col1=new b2Vec3,b2Mat33.prototype.col2=new b2Vec3,b2Mat33.prototype.col3=new b2Vec3;var b2PositionSolverManifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2PositionSolverManifold.prototype.__constructor=function(){this.m_normal=new b2Vec2,this.m_separations=Array(b2Settings.b2_maxManifoldPoints),this.m_points=Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.m_points[a]=new b2Vec2},b2PositionSolverManifold.prototype.__varz=function(){},b2PositionSolverManifold.circlePointA=new b2Vec2,b2PositionSolverManifold.circlePointB=new b2Vec2,b2PositionSolverManifold.prototype.Initialize=function(a){b2Settings.b2Assert(a.pointCount>0);var b,c,d,e,f,g=0;switch(a.type){case b2Manifold.e_circles:d=a.bodyA.m_xf.R,c=a.localPoint,g=a.bodyA.m_xf.position.x+(d.col1.x*c.x+d.col2.x*c.y),b=a.bodyA.m_xf.position.y+(d.col1.y*c.x+d.col2.y*c.y),d=a.bodyB.m_xf.R,c=a.points[0].localPoint,e=a.bodyB.m_xf.position.x+(d.col1.x*c.x+d.col2.x*c.y),d=a.bodyB.m_xf.position.y+(d.col1.y*c.x+d.col2.y*c.y),c=e-g,f=d-b;var h=c*c+f*f;h>Number.MIN_VALUE*Number.MIN_VALUE?(h=Math.sqrt(h),this.m_normal.x=c/h,this.m_normal.y=f/h):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(g+e),this.m_points[0].y=.5*(b+d),this.m_separations[0]=c*this.m_normal.x+f*this.m_normal.y-a.radius;break;case b2Manifold.e_faceA:for(d=a.bodyA.m_xf.R,c=a.localPlaneNormal,this.m_normal.x=d.col1.x*c.x+d.col2.x*c.y,this.m_normal.y=d.col1.y*c.x+d.col2.y*c.y,d=a.bodyA.m_xf.R,c=a.localPoint,e=a.bodyA.m_xf.position.x+(d.col1.x*c.x+d.col2.x*c.y),f=a.bodyA.m_xf.position.y+(d.col1.y*c.x+d.col2.y*c.y),d=a.bodyB.m_xf.R,g=0;g<a.pointCount;++g)c=a.points[g].localPoint,b=a.bodyB.m_xf.position.x+(d.col1.x*c.x+d.col2.x*c.y),c=a.bodyB.m_xf.position.y+(d.col1.y*c.x+d.col2.y*c.y),this.m_separations[g]=(b-e)*this.m_normal.x+(c-f)*this.m_normal.y-a.radius,this.m_points[g].x=b,this.m_points[g].y=c;break;case b2Manifold.e_faceB:for(d=a.bodyB.m_xf.R,c=a.localPlaneNormal,this.m_normal.x=d.col1.x*c.x+d.col2.x*c.y,this.m_normal.y=d.col1.y*c.x+d.col2.y*c.y,d=a.bodyB.m_xf.R,c=a.localPoint,e=a.bodyB.m_xf.position.x+(d.col1.x*c.x+d.col2.x*c.y),f=a.bodyB.m_xf.position.y+(d.col1.y*c.x+d.col2.y*c.y),d=a.bodyA.m_xf.R,g=0;g<a.pointCount;++g)c=a.points[g].localPoint,b=a.bodyA.m_xf.position.x+(d.col1.x*c.x+d.col2.x*c.y),c=a.bodyA.m_xf.position.y+(d.col1.y*c.x+d.col2.y*c.y),this.m_separations[g]=(b-e)*this.m_normal.x+(c-f)*this.m_normal.y-a.radius,this.m_points[g].Set(b,c);this.m_normal.x*=-1,this.m_normal.y*=-1}},b2PositionSolverManifold.prototype.m_normal=null,b2PositionSolverManifold.prototype.m_points=null,b2PositionSolverManifold.prototype.m_separations=null;var b2OBB=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2OBB.prototype.__constructor=function(){},b2OBB.prototype.__varz=function(){this.R=new b2Mat22,this.center=new b2Vec2,this.extents=new b2Vec2},b2OBB.prototype.R=new b2Mat22,b2OBB.prototype.center=new b2Vec2,b2OBB.prototype.extents=new b2Vec2;var b2Pair=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Pair.prototype.__constructor=function(){},b2Pair.prototype.__varz=function(){},b2Pair.b2_nullProxy=b2Settings.USHRT_MAX,b2Pair.e_pairBuffered=1,b2Pair.e_pairRemoved=2,b2Pair.e_pairFinal=4,b2Pair.prototype.SetBuffered=function(){this.status|=b2Pair.e_pairBuffered},b2Pair.prototype.ClearBuffered=function(){this.status&=~b2Pair.e_pairBuffered},b2Pair.prototype.IsBuffered=function(){return(this.status&b2Pair.e_pairBuffered)==b2Pair.e_pairBuffered},b2Pair.prototype.SetRemoved=function(){this.status|=b2Pair.e_pairRemoved},b2Pair.prototype.ClearRemoved=function(){this.status&=~b2Pair.e_pairRemoved},b2Pair.prototype.IsRemoved=function(){return(this.status&b2Pair.e_pairRemoved)==b2Pair.e_pairRemoved},b2Pair.prototype.SetFinal=function(){this.status|=b2Pair.e_pairFinal},b2Pair.prototype.IsFinal=function(){return(this.status&b2Pair.e_pairFinal)==b2Pair.e_pairFinal},b2Pair.prototype.userData=null,b2Pair.prototype.proxy1=null,b2Pair.prototype.proxy2=null,b2Pair.prototype.next=null,b2Pair.prototype.status=0;var b2FixtureDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2FixtureDef.prototype.__constructor=function(){this.userData=this.shape=null,this.friction=.2,this.density=this.restitution=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},b2FixtureDef.prototype.__varz=function(){this.filter=new b2FilterData},b2FixtureDef.prototype.shape=null,b2FixtureDef.prototype.userData=null,b2FixtureDef.prototype.friction=null,b2FixtureDef.prototype.restitution=null,b2FixtureDef.prototype.density=null,b2FixtureDef.prototype.isSensor=null,b2FixtureDef.prototype.filter=new b2FilterData;var b2ContactID=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactID.prototype.__constructor=function(){this.features._m_id=this},b2ContactID.prototype.__varz=function(){this.features=new Features},b2ContactID.prototype.Set=function(a){key=a._key},b2ContactID.prototype.Copy=function(){var a=new b2ContactID;return a.key=key,a},b2ContactID.prototype.__defineSetter__("key",function(){return this._key}),b2ContactID.prototype.__defineSetter__("key",function(a){this._key=a,this.features._referenceEdge=255&this._key,this.features._incidentEdge=255&(65280&this._key)>>8,this.features._incidentVertex=255&(16711680&this._key)>>16,this.features._flip=255&(4278190080&this._key)>>24}),b2ContactID.prototype._key=0,b2ContactID.prototype.features=new Features;var b2Transform=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Transform.prototype.__constructor=function(a,b){a&&(this.position.SetV(a),this.R.SetM(b))},b2Transform.prototype.__varz=function(){this.position=new b2Vec2,this.R=new b2Mat22},b2Transform.prototype.Initialize=function(a,b){this.position.SetV(a),this.R.SetM(b)},b2Transform.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},b2Transform.prototype.Set=function(a){this.position.SetV(a.position),this.R.SetM(a.R)},b2Transform.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},b2Transform.prototype.position=new b2Vec2,b2Transform.prototype.R=new b2Mat22;var b2EdgeShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2EdgeShape.prototype,b2Shape.prototype),b2EdgeShape.prototype._super=b2Shape.prototype,b2EdgeShape.prototype.__constructor=function(a,b){this._super.__constructor.apply(this,[]),this.m_type=b2Shape.e_edgeShape,this.m_nextEdge=this.m_prevEdge=null,this.m_v1=a,this.m_v2=b,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-b2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-b2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-b2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-b2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},b2EdgeShape.prototype.__varz=function(){this.s_supportVec=new b2Vec2,this.m_v1=new b2Vec2,this.m_v2=new b2Vec2,this.m_coreV1=new b2Vec2,this.m_coreV2=new b2Vec2,this.m_normal=new b2Vec2,this.m_direction=new b2Vec2,this.m_cornerDir1=new b2Vec2,this.m_cornerDir2=new b2Vec2},b2EdgeShape.prototype.SetPrevEdge=function(a,b,c,d){this.m_prevEdge=a,this.m_coreV1=b,this.m_cornerDir1=c,this.m_cornerConvex1=d},b2EdgeShape.prototype.SetNextEdge=function(a,b,c,d){this.m_nextEdge=a,this.m_coreV2=b,this.m_cornerDir2=c,this.m_cornerConvex2=d},b2EdgeShape.prototype.TestPoint=function(){return!1},b2EdgeShape.prototype.RayCast=function(a,b,c){var d,e=b.p2.x-b.p1.x,f=b.p2.y-b.p1.y;d=c.R;var g=c.position.x+(d.col1.x*this.m_v1.x+d.col2.x*this.m_v1.y),h=c.position.y+(d.col1.y*this.m_v1.x+d.col2.y*this.m_v1.y),i=c.position.y+(d.col1.y*this.m_v2.x+d.col2.y*this.m_v2.y)-h;c=-(c.position.x+(d.col1.x*this.m_v2.x+d.col2.x*this.m_v2.y)-g),d=100*Number.MIN_VALUE;var j=-(e*i+f*c);if(j>d){g=b.p1.x-g;var k=b.p1.y-h;if(h=g*i+k*c,h>=0&&h<=b.maxFraction*j&&(b=-e*k+f*g,b>=-d*j&&j*(1+d)>=b))return h/=j,a.fraction=h,b=Math.sqrt(i*i+c*c),a.normal.x=i/b,a.normal.y=c/b,!0}return!1},b2EdgeShape.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_v1.x+c.col2.x*this.m_v1.y),e=b.position.y+(c.col1.y*this.m_v1.x+c.col2.y*this.m_v1.y),f=b.position.x+(c.col1.x*this.m_v2.x+c.col2.x*this.m_v2.y);c=b.position.y+(c.col1.y*this.m_v2.x+c.col2.y*this.m_v2.y),f>d?(a.lowerBound.x=d,a.upperBound.x=f):(a.lowerBound.x=f,a.upperBound.x=d),c>e?(a.lowerBound.y=e,a.upperBound.y=c):(a.lowerBound.y=c,a.upperBound.y=e)},b2EdgeShape.prototype.ComputeMass=function(a){a.mass=0,a.center.SetV(this.m_v1),a.I=0},b2EdgeShape.prototype.ComputeSubmergedArea=function(a,b,c,d){var e=new b2Vec2(a.x*b,a.y*b),f=b2Math.MulX(c,this.m_v1);c=b2Math.MulX(c,this.m_v2);var g=b2Math.Dot(a,f)-b;if(a=b2Math.Dot(a,c)-b,g>0){if(a>0)return 0;f.x=-a/(g-a)*f.x+g/(g-a)*c.x,f.y=-a/(g-a)*f.y+g/(g-a)*c.y}else a>0&&(c.x=-a/(g-a)*f.x+g/(g-a)*c.x,c.y=-a/(g-a)*f.y+g/(g-a)*c.y);return d.x=(e.x+f.x+c.x)/3,d.y=(e.y+f.y+c.y)/3,.5*((f.x-e.x)*(c.y-e.y)-(f.y-e.y)*(c.x-e.x))},b2EdgeShape.prototype.GetLength=function(){return this.m_length},b2EdgeShape.prototype.GetVertex1=function(){return this.m_v1},b2EdgeShape.prototype.GetVertex2=function(){return this.m_v2},b2EdgeShape.prototype.GetCoreVertex1=function(){return this.m_coreV1},b2EdgeShape.prototype.GetCoreVertex2=function(){return this.m_coreV2},b2EdgeShape.prototype.GetNormalVector=function(){return this.m_normal},b2EdgeShape.prototype.GetDirectionVector=function(){return this.m_direction},b2EdgeShape.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},b2EdgeShape.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},b2EdgeShape.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},b2EdgeShape.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},b2EdgeShape.prototype.GetFirstVertex=function(a){var b=a.R;return new b2Vec2(a.position.x+(b.col1.x*this.m_coreV1.x+b.col2.x*this.m_coreV1.y),a.position.y+(b.col1.y*this.m_coreV1.x+b.col2.y*this.m_coreV1.y))},b2EdgeShape.prototype.GetNextEdge=function(){return this.m_nextEdge},b2EdgeShape.prototype.GetPrevEdge=function(){return this.m_prevEdge},b2EdgeShape.prototype.Support=function(a,b,c){var d=a.R,e=a.position.x+(d.col1.x*this.m_coreV1.x+d.col2.x*this.m_coreV1.y),f=a.position.y+(d.col1.y*this.m_coreV1.x+d.col2.y*this.m_coreV1.y),g=a.position.x+(d.col1.x*this.m_coreV2.x+d.col2.x*this.m_coreV2.y);return a=a.position.y+(d.col1.y*this.m_coreV2.x+d.col2.y*this.m_coreV2.y),e*b+f*c>g*b+a*c?(this.s_supportVec.x=e,this.s_supportVec.y=f):(this.s_supportVec.x=g,this.s_supportVec.y=a),this.s_supportVec},b2EdgeShape.prototype.s_supportVec=new b2Vec2,b2EdgeShape.prototype.m_v1=new b2Vec2,b2EdgeShape.prototype.m_v2=new b2Vec2,b2EdgeShape.prototype.m_coreV1=new b2Vec2,b2EdgeShape.prototype.m_coreV2=new b2Vec2,b2EdgeShape.prototype.m_length=null,b2EdgeShape.prototype.m_normal=new b2Vec2,b2EdgeShape.prototype.m_direction=new b2Vec2,b2EdgeShape.prototype.m_cornerDir1=new b2Vec2,b2EdgeShape.prototype.m_cornerDir2=new b2Vec2,b2EdgeShape.prototype.m_cornerConvex1=null,b2EdgeShape.prototype.m_cornerConvex2=null,b2EdgeShape.prototype.m_nextEdge=null,b2EdgeShape.prototype.m_prevEdge=null;var b2BuoyancyController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2BuoyancyController.prototype,b2Controller.prototype),b2BuoyancyController.prototype._super=b2Controller.prototype,b2BuoyancyController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2BuoyancyController.prototype.__varz=function(){this.normal=new b2Vec2(0,-1),this.velocity=new b2Vec2(0,0)},b2BuoyancyController.prototype.Step=function(){if(m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var a=m_bodyList;a;a=a.nextBody){var b=a.body;if(0!=b.IsAwake()){for(var c=new b2Vec2,d=new b2Vec2,e=0,f=0,g=b.GetFixtureList();g;g=g.GetNext()){var h=new b2Vec2,i=g.GetShape().ComputeSubmergedArea(this.normal,this.offset,b.GetTransform(),h);e+=i,c.x+=i*h.x,c.y+=i*h.y,f+=1*i,d.x+=1*i*h.x,d.y+=1*i*h.y}c.x/=e,c.y/=e,d.x/=f,d.y/=f,e<Number.MIN_VALUE||(f=this.gravity.GetNegative(),f.Multiply(this.density*e),b.ApplyForce(f,d),d=b.GetLinearVelocityFromWorldPoint(c),d.Subtract(this.velocity),d.Multiply(-this.linearDrag*e),b.ApplyForce(d,c),b.ApplyTorque(-b.GetInertia()/b.GetMass()*e*b.GetAngularVelocity()*this.angularDrag))}}}},b2BuoyancyController.prototype.Draw=function(a){var b=new b2Vec2,c=new b2Vec2;b.x=this.normal.x*this.offset+1e3*this.normal.y,b.y=this.normal.y*this.offset-1e3*this.normal.x,c.x=this.normal.x*this.offset-1e3*this.normal.y,c.y=this.normal.y*this.offset+1e3*this.normal.x;var d=new b2Color(0,0,1);a.DrawSegment(b,c,d)},b2BuoyancyController.prototype.normal=new b2Vec2(0,-1),b2BuoyancyController.prototype.offset=0,b2BuoyancyController.prototype.density=0,b2BuoyancyController.prototype.velocity=new b2Vec2(0,0),b2BuoyancyController.prototype.linearDrag=2,b2BuoyancyController.prototype.angularDrag=1,b2BuoyancyController.prototype.useDensity=!1,b2BuoyancyController.prototype.useWorldGravity=!0,b2BuoyancyController.prototype.gravity=null;var b2Body=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Body.prototype.__constructor=function(a,b){this.m_flags=0,a.bullet&&(this.m_flags|=b2Body.e_bulletFlag),a.fixedRotation&&(this.m_flags|=b2Body.e_fixedRotationFlag),a.allowSleep&&(this.m_flags|=b2Body.e_allowSleepFlag),a.awake&&(this.m_flags|=b2Body.e_awakeFlag),a.active&&(this.m_flags|=b2Body.e_activeFlag),this.m_world=b,this.m_xf.position.SetV(a.position),this.m_xf.R.Set(a.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=a.angle;var c=this.m_xf.R,d=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*d.x+c.col2.x*d.y,this.m_sweep.c.y=c.col1.y*d.x+c.col2.y*d.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_contactList=this.m_controllerList=this.m_jointList=null,this.m_controllerCount=0,this.m_next=this.m_prev=null,this.m_linearVelocity.SetV(a.linearVelocity),this.m_angularVelocity=a.angularVelocity,this.m_linearDamping=a.linearDamping,this.m_angularDamping=a.angularDamping,this.m_force.Set(0,0),this.m_sleepTime=this.m_torque=0,this.m_type=a.type,this.m_invMass=this.m_mass=this.m_type==b2Body.b2_dynamicBody?1:0,this.m_invI=this.m_I=0,this.m_inertiaScale=a.inertiaScale,this.m_userData=a.userData,this.m_fixtureList=null,this.m_fixtureCount=0},b2Body.prototype.__varz=function(){this.m_xf=new b2Transform,this.m_sweep=new b2Sweep,this.m_linearVelocity=new b2Vec2,this.m_force=new b2Vec2
},b2Body.b2_staticBody=0,b2Body.b2_kinematicBody=1,b2Body.b2_dynamicBody=2,b2Body.s_xf1=new b2Transform,b2Body.e_islandFlag=1,b2Body.e_awakeFlag=2,b2Body.e_allowSleepFlag=4,b2Body.e_bulletFlag=8,b2Body.e_fixedRotationFlag=16,b2Body.e_activeFlag=32,b2Body.prototype.connectEdges=function(a,b,c){var d=Math.atan2(b.GetDirectionVector().y,b.GetDirectionVector().x);c=b2Math.MulFV(Math.tan(.5*(d-c)),b.GetDirectionVector()),c=b2Math.SubtractVV(c,b.GetNormalVector()),c=b2Math.MulFV(b2Settings.b2_toiSlop,c),c=b2Math.AddVV(c,b.GetVertex1());var e=b2Math.AddVV(a.GetDirectionVector(),b.GetDirectionVector());e.Normalize();var f=b2Math.Dot(a.GetDirectionVector(),b.GetNormalVector())>0;return a.SetNextEdge(b,c,e,f),b.SetPrevEdge(a,c,e,f),d},b2Body.prototype.SynchronizeFixtures=function(){var a=b2Body.s_xf1;a.R.Set(this.m_sweep.a0);var b=a.R,c=this.m_sweep.localCenter;for(a.position.x=this.m_sweep.c0.x-(b.col1.x*c.x+b.col2.x*c.y),a.position.y=this.m_sweep.c0.y-(b.col1.y*c.x+b.col2.y*c.y),c=this.m_world.m_contactManager.m_broadPhase,b=this.m_fixtureList;b;b=b.m_next)b.Synchronize(c,a,this.m_xf)},b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var a=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*b.x+a.col2.x*b.y),this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*b.x+a.col2.y*b.y)},b2Body.prototype.ShouldCollide=function(a){if(this.m_type!=b2Body.b2_dynamicBody&&a.m_type!=b2Body.b2_dynamicBody)return!1;for(var b=this.m_jointList;b;b=b.next)if(b.other==a&&0==b.joint.m_collideConnected)return!1;return!0},b2Body.prototype.Advance=function(a){this.m_sweep.Advance(a),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},b2Body.prototype.CreateFixture=function(a){if(1==this.m_world.IsLocked())return null;var b=new b2Fixture;return b.Create(this,this.m_xf,a),this.m_flags&b2Body.e_activeFlag&&b.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf),b.m_next=this.m_fixtureList,this.m_fixtureList=b,++this.m_fixtureCount,b.m_body=this,b.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=b2World.e_newFixture,b},b2Body.prototype.CreateFixture2=function(a,b){var c=new b2FixtureDef;return c.shape=a,c.density=b,this.CreateFixture(c)},b2Body.prototype.DestroyFixture=function(a){if(1!=this.m_world.IsLocked()){for(var b=this.m_fixtureList,c=null;null!=b;){if(b==a){c?c.m_next=a.m_next:this.m_fixtureList=a.m_next;break}c=b,b=b.m_next}for(b=this.m_contactList;b;){c=b.contact,b=b.next;var d=c.GetFixtureA(),e=c.GetFixtureB();(a==d||a==e)&&this.m_world.m_contactManager.Destroy(c)}this.m_flags&b2Body.e_activeFlag&&a.DestroyProxy(this.m_world.m_contactManager.m_broadPhase),a.Destroy(),a.m_body=null,a.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},b2Body.prototype.SetPositionAndAngle=function(a,b){var c;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(b),this.m_xf.position.SetV(a),c=this.m_xf.R;var d=this.m_sweep.localCenter;for(this.m_sweep.c.x=c.col1.x*d.x+c.col2.x*d.y,this.m_sweep.c.y=c.col1.y*d.x+c.col2.y*d.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=b,d=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.Synchronize(d,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},b2Body.prototype.SetTransform=function(a){this.SetPositionAndAngle(a.position,a.GetAngle())},b2Body.prototype.GetTransform=function(){return this.m_xf},b2Body.prototype.GetPosition=function(){return this.m_xf.position},b2Body.prototype.SetPosition=function(a){this.SetPositionAndAngle(a,this.GetAngle())},b2Body.prototype.GetAngle=function(){return this.m_sweep.a},b2Body.prototype.SetAngle=function(a){this.SetPositionAndAngle(this.GetPosition(),a)},b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c},b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},b2Body.prototype.SetLinearVelocity=function(a){this.m_type!=b2Body.b2_staticBody&&this.m_linearVelocity.SetV(a)},b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},b2Body.prototype.SetAngularVelocity=function(a){this.m_type!=b2Body.b2_staticBody&&(this.m_angularVelocity=a)},b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},b2Body.prototype.GetDefinition=function(){var a=new b2BodyDef;return a.type=this.GetType(),a.allowSleep=(this.m_flags&b2Body.e_allowSleepFlag)==b2Body.e_allowSleepFlag,a.angle=this.GetAngle(),a.angularDamping=this.m_angularDamping,a.angularVelocity=this.m_angularVelocity,a.fixedRotation=(this.m_flags&b2Body.e_fixedRotationFlag)==b2Body.e_fixedRotationFlag,a.bullet=(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag,a.awake=(this.m_flags&b2Body.e_awakeFlag)==b2Body.e_awakeFlag,a.linearDamping=this.m_linearDamping,a.linearVelocity.SetV(this.GetLinearVelocity()),a.position=this.GetPosition(),a.userData=this.GetUserData(),a},b2Body.prototype.ApplyForce=function(a,b){this.m_type==b2Body.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=a.x,this.m_force.y+=a.y,this.m_torque+=(b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x)},b2Body.prototype.ApplyTorque=function(a){this.m_type==b2Body.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=a)},b2Body.prototype.ApplyImpulse=function(a,b){this.m_type==b2Body.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*a.x,this.m_linearVelocity.y+=this.m_invMass*a.y,this.m_angularVelocity+=this.m_invI*((b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x))},b2Body.prototype.Split=function(a){for(var b,c=this.GetLinearVelocity().Copy(),d=this.GetAngularVelocity(),e=this.GetWorldCenter(),f=this.m_world.CreateBody(this.GetDefinition()),g=this.m_fixtureList;g;)if(a(g)){var h=g.m_next;b?b.m_next=h:this.m_fixtureList=h,this.m_fixtureCount--,g.m_next=f.m_fixtureList,f.m_fixtureList=g,f.m_fixtureCount++,g.m_body=f,g=h}else b=g,g=g.m_next;return this.ResetMassData(),f.ResetMassData(),b=this.GetWorldCenter(),a=f.GetWorldCenter(),b=b2Math.AddVV(c,b2Math.CrossFV(d,b2Math.SubtractVV(b,e))),c=b2Math.AddVV(c,b2Math.CrossFV(d,b2Math.SubtractVV(a,e))),this.SetLinearVelocity(b),f.SetLinearVelocity(c),this.SetAngularVelocity(d),f.SetAngularVelocity(d),this.SynchronizeFixtures(),f.SynchronizeFixtures(),f},b2Body.prototype.Merge=function(a){var b;for(b=a.m_fixtureList;b;){var c=b.m_next;a.m_fixtureCount--,b.m_next=this.m_fixtureList,this.m_fixtureList=b,this.m_fixtureCount++,b.m_body=e,b=c}d.m_fixtureCount=0;var d=this,e=a;d.GetWorldCenter(),e.GetWorldCenter(),d.GetLinearVelocity().Copy(),e.GetLinearVelocity().Copy(),d.GetAngularVelocity(),e.GetAngularVelocity(),d.ResetMassData(),this.SynchronizeFixtures()},b2Body.prototype.GetMass=function(){return this.m_mass},b2Body.prototype.GetInertia=function(){return this.m_I},b2Body.prototype.GetMassData=function(a){a.mass=this.m_mass,a.I=this.m_I,a.center.SetV(this.m_sweep.localCenter)},b2Body.prototype.SetMassData=function(a){if(b2Settings.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==b2Body.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=a.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,a.I>0&&0==(this.m_flags&b2Body.e_fixedRotationFlag)&&(this.m_I=a.I-this.m_mass*(a.center.x*a.center.x+a.center.y*a.center.y),this.m_invI=1/this.m_I);var b=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a.center),this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-b.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-b.x)}},b2Body.prototype.ResetMassData=function(){if(this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,this.m_sweep.localCenter.SetZero(),this.m_type!=b2Body.b2_staticBody&&this.m_type!=b2Body.b2_kinematicBody){for(var a=b2Vec2.Make(0,0),b=this.m_fixtureList;b;b=b.m_next)if(0!=b.m_density){var c=b.GetMassData();this.m_mass+=c.mass,a.x+=c.center.x*c.mass,a.y+=c.center.y*c.mass,this.m_I+=c.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,a.x*=this.m_invMass,a.y*=this.m_invMass):this.m_invMass=this.m_mass=1,this.m_I>0&&0==(this.m_flags&b2Body.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(a.x*a.x+a.y*a.y),this.m_I*=this.m_inertiaScale,b2Settings.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0,b=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(a),this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-b.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-b.x)}},b2Body.prototype.GetWorldPoint=function(a){var b=this.m_xf.R;return a=new b2Vec2(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y),a.x+=this.m_xf.position.x,a.y+=this.m_xf.position.y,a},b2Body.prototype.GetWorldVector=function(a){return b2Math.MulMV(this.m_xf.R,a)},b2Body.prototype.GetLocalPoint=function(a){return b2Math.MulXT(this.m_xf,a)},b2Body.prototype.GetLocalVector=function(a){return b2Math.MulTMV(this.m_xf.R,a)},b2Body.prototype.GetLinearVelocityFromWorldPoint=function(a){return new b2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))},b2Body.prototype.GetLinearVelocityFromLocalPoint=function(a){var b=this.m_xf.R;return a=new b2Vec2(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y),a.x+=this.m_xf.position.x,a.y+=this.m_xf.position.y,new b2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))},b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},b2Body.prototype.SetLinearDamping=function(a){this.m_linearDamping=a},b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},b2Body.prototype.SetAngularDamping=function(a){this.m_angularDamping=a},b2Body.prototype.SetType=function(a){if(this.m_type!=a)for(this.m_type=a,this.ResetMassData(),this.m_type==b2Body.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0,a=this.m_contactList;a;a=a.next)a.contact.FlagForFiltering()},b2Body.prototype.GetType=function(){return this.m_type},b2Body.prototype.SetBullet=function(a){a?this.m_flags|=b2Body.e_bulletFlag:this.m_flags&=~b2Body.e_bulletFlag},b2Body.prototype.IsBullet=function(){return(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag},b2Body.prototype.SetSleepingAllowed=function(a){a?this.m_flags|=b2Body.e_allowSleepFlag:(this.m_flags&=~b2Body.e_allowSleepFlag,this.SetAwake(!0))},b2Body.prototype.SetAwake=function(a){a?(this.m_flags|=b2Body.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~b2Body.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},b2Body.prototype.IsAwake=function(){return(this.m_flags&b2Body.e_awakeFlag)==b2Body.e_awakeFlag},b2Body.prototype.SetFixedRotation=function(a){a?this.m_flags|=b2Body.e_fixedRotationFlag:this.m_flags&=~b2Body.e_fixedRotationFlag,this.ResetMassData()},b2Body.prototype.IsFixedRotation=function(){return(this.m_flags&b2Body.e_fixedRotationFlag)==b2Body.e_fixedRotationFlag},b2Body.prototype.SetActive=function(a){if(a!=this.IsActive()){var b;if(a)for(this.m_flags|=b2Body.e_activeFlag,a=this.m_world.m_contactManager.m_broadPhase,b=this.m_fixtureList;b;b=b.m_next)b.CreateProxy(a,this.m_xf);else{for(this.m_flags&=~b2Body.e_activeFlag,a=this.m_world.m_contactManager.m_broadPhase,b=this.m_fixtureList;b;b=b.m_next)b.DestroyProxy(a);for(a=this.m_contactList;a;)b=a,a=a.next,this.m_world.m_contactManager.Destroy(b.contact);this.m_contactList=null}}},b2Body.prototype.IsActive=function(){return(this.m_flags&b2Body.e_activeFlag)==b2Body.e_activeFlag},b2Body.prototype.IsSleepingAllowed=function(){return(this.m_flags&b2Body.e_allowSleepFlag)==b2Body.e_allowSleepFlag},b2Body.prototype.GetFixtureList=function(){return this.m_fixtureList},b2Body.prototype.GetJointList=function(){return this.m_jointList},b2Body.prototype.GetControllerList=function(){return this.m_controllerList},b2Body.prototype.GetContactList=function(){return this.m_contactList},b2Body.prototype.GetNext=function(){return this.m_next},b2Body.prototype.GetUserData=function(){return this.m_userData},b2Body.prototype.SetUserData=function(a){this.m_userData=a},b2Body.prototype.GetWorld=function(){return this.m_world},b2Body.prototype.m_flags=0,b2Body.prototype.m_type=0,b2Body.prototype.m_islandIndex=0,b2Body.prototype.m_xf=new b2Transform,b2Body.prototype.m_sweep=new b2Sweep,b2Body.prototype.m_linearVelocity=new b2Vec2,b2Body.prototype.m_angularVelocity=null,b2Body.prototype.m_force=new b2Vec2,b2Body.prototype.m_torque=null,b2Body.prototype.m_world=null,b2Body.prototype.m_prev=null,b2Body.prototype.m_next=null,b2Body.prototype.m_fixtureList=null,b2Body.prototype.m_fixtureCount=0,b2Body.prototype.m_controllerList=null,b2Body.prototype.m_controllerCount=0,b2Body.prototype.m_jointList=null,b2Body.prototype.m_contactList=null,b2Body.prototype.m_mass=null,b2Body.prototype.m_invMass=null,b2Body.prototype.m_I=null,b2Body.prototype.m_invI=null,b2Body.prototype.m_inertiaScale=null,b2Body.prototype.m_linearDamping=null,b2Body.prototype.m_angularDamping=null,b2Body.prototype.m_sleepTime=null,b2Body.prototype.m_userData=null;var b2ContactImpulse=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactImpulse.prototype.__constructor=function(){},b2ContactImpulse.prototype.__varz=function(){this.normalImpulses=Array(b2Settings.b2_maxManifoldPoints),this.tangentImpulses=Array(b2Settings.b2_maxManifoldPoints)},b2ContactImpulse.prototype.normalImpulses=Array(b2Settings.b2_maxManifoldPoints),b2ContactImpulse.prototype.tangentImpulses=Array(b2Settings.b2_maxManifoldPoints);var b2TensorDampingController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2TensorDampingController.prototype,b2Controller.prototype),b2TensorDampingController.prototype._super=b2Controller.prototype,b2TensorDampingController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2TensorDampingController.prototype.__varz=function(){this.T=new b2Mat22},b2TensorDampingController.prototype.SetAxisAligned=function(a,b){this.T.col1.x=-a,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-b,this.maxTimestep=a>0||b>0?1/Math.max(a,b):0},b2TensorDampingController.prototype.Step=function(a){if(a=a.dt,!(a<=Number.MIN_VALUE)){a>this.maxTimestep&&this.maxTimestep>0&&(a=this.maxTimestep);for(var b=m_bodyList;b;b=b.nextBody){var c=b.body;if(c.IsAwake()){var d=c.GetWorldVector(b2Math.MulMV(this.T,c.GetLocalVector(c.GetLinearVelocity())));c.SetLinearVelocity(new b2Vec2(c.GetLinearVelocity().x+d.x*a,c.GetLinearVelocity().y+d.y*a))}}}},b2TensorDampingController.prototype.T=new b2Mat22,b2TensorDampingController.prototype.maxTimestep=0;var b2ManifoldPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ManifoldPoint.prototype.__constructor=function(){this.Reset()},b2ManifoldPoint.prototype.__varz=function(){this.m_localPoint=new b2Vec2,this.m_id=new b2ContactID},b2ManifoldPoint.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_tangentImpulse=this.m_normalImpulse=0,this.m_id.key=0},b2ManifoldPoint.prototype.Set=function(a){this.m_localPoint.SetV(a.m_localPoint),this.m_normalImpulse=a.m_normalImpulse,this.m_tangentImpulse=a.m_tangentImpulse,this.m_id.Set(a.m_id)},b2ManifoldPoint.prototype.m_localPoint=new b2Vec2,b2ManifoldPoint.prototype.m_normalImpulse=null,b2ManifoldPoint.prototype.m_tangentImpulse=null,b2ManifoldPoint.prototype.m_id=new b2ContactID;var b2PolygonShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolygonShape.prototype,b2Shape.prototype),b2PolygonShape.prototype._super=b2Shape.prototype,b2PolygonShape.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.m_type=b2Shape.e_polygonShape,this.m_centroid=new b2Vec2,this.m_vertices=[],this.m_normals=[]},b2PolygonShape.prototype.__varz=function(){},b2PolygonShape.AsArray=function(a,b){var c=new b2PolygonShape;return c.SetAsArray(a,b),c},b2PolygonShape.AsVector=function(a,b){var c=new b2PolygonShape;return c.SetAsVector(a,b),c},b2PolygonShape.AsBox=function(a,b){var c=new b2PolygonShape;return c.SetAsBox(a,b),c},b2PolygonShape.AsOrientedBox=function(a,b,c,d){var e=new b2PolygonShape;return e.SetAsOrientedBox(a,b,c,d),e},b2PolygonShape.AsEdge=function(a,b){var c=new b2PolygonShape;return c.SetAsEdge(a,b),c},b2PolygonShape.ComputeCentroid=function(a,b){for(var c=new b2Vec2,d=0,e=1/3,f=0;b>f;++f){var g=a[f],h=b>f+1?a[parseInt(f+1)]:a[0],i=.5*((g.x-0)*(h.y-0)-(g.y-0)*(h.x-0));d+=i,c.x+=i*e*(0+g.x+h.x),c.y+=i*e*(0+g.y+h.y)}return c.x*=1/d,c.y*=1/d,c},b2PolygonShape.ComputeOBB=function(a,b,c){var d=0,e=Array(c+1);for(d=0;c>d;++d)e[d]=b[d];for(e[c]=e[0],b=Number.MAX_VALUE,d=1;c>=d;++d){var f=e[parseInt(d-1)],g=e[d].x-f.x,h=e[d].y-f.y,i=Math.sqrt(g*g+h*h);g/=i,h/=i;for(var j=-h,k=g,l=i=Number.MAX_VALUE,m=-Number.MAX_VALUE,n=-Number.MAX_VALUE,o=0;c>o;++o){var p=e[o].x-f.x,q=e[o].y-f.y,r=g*p+h*q;p=j*p+k*q,i>r&&(i=r),l>p&&(l=p),r>m&&(m=r),p>n&&(n=p)}o=(m-i)*(n-l),.95*b>o&&(b=o,a.R.col1.x=g,a.R.col1.y=h,a.R.col2.x=j,a.R.col2.y=k,g=.5*(i+m),h=.5*(l+n),j=a.R,a.center.x=f.x+(j.col1.x*g+j.col2.x*h),a.center.y=f.y+(j.col1.y*g+j.col2.y*h),a.extents.x=.5*(m-i),a.extents.y=.5*(n-l))}},b2PolygonShape.s_mat=new b2Mat22,b2PolygonShape.prototype.Validate=function(){return!1},b2PolygonShape.prototype.Reserve=function(a){for(var b=this.m_vertices.length;a>b;b++)this.m_vertices[b]=new b2Vec2,this.m_normals[b]=new b2Vec2},b2PolygonShape.prototype.Copy=function(){var a=new b2PolygonShape;return a.Set(this),a},b2PolygonShape.prototype.Set=function(a){if(this._super.Set.apply(this,[a]),isInstanceOf(a,b2PolygonShape)){this.m_centroid.SetV(a.m_centroid),this.m_vertexCount=a.m_vertexCount,this.Reserve(this.m_vertexCount);for(var b=0;b<this.m_vertexCount;b++)this.m_vertices[b].SetV(a.m_vertices[b]),this.m_normals[b].SetV(a.m_normals[b])}},b2PolygonShape.prototype.SetAsArray=function(a,b){for(var c=[],d=0,e=null;e=a[d];d++)c.push(e);this.SetAsVector(c,b)},b2PolygonShape.prototype.SetAsVector=function(a,b){"undefined"==typeof b&&(b=a.length),b2Settings.b2Assert(b>=2),this.m_vertexCount=b,this.Reserve(b);var c=0;for(c=0;c<this.m_vertexCount;c++)this.m_vertices[c].SetV(a[c]);for(c=0;c<this.m_vertexCount;++c){var d=b2Math.SubtractVV(this.m_vertices[c+1<this.m_vertexCount?c+1:0],this.m_vertices[c]);b2Settings.b2Assert(d.LengthSquared()>Number.MIN_VALUE),this.m_normals[c].SetV(b2Math.CrossVF(d,1)),this.m_normals[c].Normalize()}this.m_centroid=b2PolygonShape.ComputeCentroid(this.m_vertices,this.m_vertexCount)},b2PolygonShape.prototype.SetAsBox=function(a,b){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},b2PolygonShape.prototype.SetAsOrientedBox=function(a,b,c,d){for(this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=c,a=new b2Transform,a.position=c,a.R.Set(d),c=0;c<this.m_vertexCount;++c)this.m_vertices[c]=b2Math.MulX(a,this.m_vertices[c]),this.m_normals[c]=b2Math.MulMV(a.R,this.m_normals[c])},b2PolygonShape.prototype.SetAsEdge=function(a,b){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(a),this.m_vertices[1].SetV(b),this.m_centroid.x=.5*(a.x+b.x),this.m_centroid.y=.5*(a.y+b.y),this.m_normals[0]=b2Math.CrossVF(b2Math.SubtractVV(b,a),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},b2PolygonShape.prototype.TestPoint=function(a,b){var c;c=a.R;for(var d=b.x-a.position.x,e=b.y-a.position.y,f=d*c.col1.x+e*c.col1.y,g=d*c.col2.x+e*c.col2.y,h=0;h<this.m_vertexCount;++h)if(c=this.m_vertices[h],d=f-c.x,e=g-c.y,c=this.m_normals[h],c.x*d+c.y*e>0)return!1;return!0},b2PolygonShape.prototype.RayCast=function(a,b,c){var d,e,f,g,h=0,i=b.maxFraction;d=b.p1.x-c.position.x,e=b.p1.y-c.position.y,f=c.R;var j=d*f.col1.x+e*f.col1.y,k=d*f.col2.x+e*f.col2.y;d=b.p2.x-c.position.x,e=b.p2.y-c.position.y,f=c.R,b=d*f.col1.x+e*f.col1.y-j,f=d*f.col2.x+e*f.col2.y-k;for(var l=-1,m=0;m<this.m_vertexCount;++m){if(g=this.m_vertices[m],d=g.x-j,e=g.y-k,g=this.m_normals[m],d=g.x*d+g.y*e,e=g.x*b+g.y*f,0==e){if(0>d)return!1}else 0>e&&h*e>d?(h=d/e,l=m):e>0&&i*e>d&&(i=d/e);if(i<h-Number.MIN_VALUE)return!1}return l>=0?(a.fraction=h,f=c.R,g=this.m_normals[l],a.normal.x=f.col1.x*g.x+f.col2.x*g.y,a.normal.y=f.col1.y*g.x+f.col2.y*g.y,!0):!1},b2PolygonShape.prototype.ComputeAABB=function(a,b){for(var c=b.R,d=this.m_vertices[0],e=b.position.x+(c.col1.x*d.x+c.col2.x*d.y),f=b.position.y+(c.col1.y*d.x+c.col2.y*d.y),g=e,h=f,i=1;i<this.m_vertexCount;++i){d=this.m_vertices[i];var j=b.position.x+(c.col1.x*d.x+c.col2.x*d.y);d=b.position.y+(c.col1.y*d.x+c.col2.y*d.y),e=j>e?e:j,f=d>f?f:d,g=g>j?g:j,h=h>d?h:d}a.lowerBound.x=e-this.m_radius,a.lowerBound.y=f-this.m_radius,a.upperBound.x=g+this.m_radius,a.upperBound.y=h+this.m_radius},b2PolygonShape.prototype.ComputeMass=function(a,b){if(2==this.m_vertexCount)a.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),a.mass=0,a.I=0;else{for(var c=0,d=0,e=0,f=0,g=1/3,h=0;h<this.m_vertexCount;++h){var i=this.m_vertices[h],j=h+1<this.m_vertexCount?this.m_vertices[parseInt(h+1)]:this.m_vertices[0],k=i.x-0,l=i.y-0,m=j.x-0,n=j.y-0,o=k*n-l*m,p=.5*o;e+=p,c+=p*g*(0+i.x+j.x),d+=p*g*(0+i.y+j.y),i=k,l=l,m=m,n=n,f+=o*(g*(.25*(i*i+m*i+m*m)+(0*i+0*m))+0+(g*(.25*(l*l+n*l+n*n)+(0*l+0*n))+0))}a.mass=b*e,c*=1/e,d*=1/e,a.center.Set(c,d),a.I=b*f}},b2PolygonShape.prototype.ComputeSubmergedArea=function(a,b,c,d){var e=b2Math.MulTMV(c.R,a),f=b-b2Math.Dot(a,c.position),g=[],h=0,i=-1;b=-1;var j=!1;for(a=a=0;a<this.m_vertexCount;++a){g[a]=b2Math.Dot(e,this.m_vertices[a])-f;var k=g[a]<-Number.MIN_VALUE;a>0&&(k?j||(i=a-1,h++):j&&(b=a-1,h++)),j=k}switch(h){case 0:return j?(a=new b2MassData,this.ComputeMass(a,1),d.SetV(b2Math.MulX(c,a.center)),a.mass):0;case 1:-1==i?i=this.m_vertexCount-1:b=this.m_vertexCount-1}for(a=(i+1)%this.m_vertexCount,e=(b+1)%this.m_vertexCount,f=(0-g[i])/(g[a]-g[i]),g=(0-g[b])/(g[e]-g[b]),i=new b2Vec2(this.m_vertices[i].x*(1-f)+this.m_vertices[a].x*f,this.m_vertices[i].y*(1-f)+this.m_vertices[a].y*f),b=new b2Vec2(this.m_vertices[b].x*(1-g)+this.m_vertices[e].x*g,this.m_vertices[b].y*(1-g)+this.m_vertices[e].y*g),g=0,f=new b2Vec2,h=this.m_vertices[a],a=a;a!=e;)a=(a+1)%this.m_vertexCount,j=a==e?b:this.m_vertices[a],k=.5*((h.x-i.x)*(j.y-i.y)-(h.y-i.y)*(j.x-i.x)),g+=k,f.x+=k*(i.x+h.x+j.x)/3,f.y+=k*(i.y+h.y+j.y)/3,h=j;return f.Multiply(1/g),d.SetV(b2Math.MulX(c,f)),g},b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount},b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices},b2PolygonShape.prototype.GetNormals=function(){return this.m_normals},b2PolygonShape.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},b2PolygonShape.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return this.m_vertices[b]},b2PolygonShape.prototype.m_centroid=null,b2PolygonShape.prototype.m_vertices=null,b2PolygonShape.prototype.m_normals=null,b2PolygonShape.prototype.m_vertexCount=0;var b2Fixture=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Fixture.prototype.__constructor=function(){this.m_aabb=new b2AABB,this.m_shape=this.m_next=this.m_body=this.m_userData=null,this.m_restitution=this.m_friction=this.m_density=0},b2Fixture.prototype.__varz=function(){this.m_filter=new b2FilterData},b2Fixture.prototype.Create=function(a,b,c){this.m_userData=c.userData,this.m_friction=c.friction,this.m_restitution=c.restitution,this.m_body=a,this.m_next=null,this.m_filter=c.filter.Copy(),this.m_isSensor=c.isSensor,this.m_shape=c.shape.Copy(),this.m_density=c.density},b2Fixture.prototype.Destroy=function(){this.m_shape=null},b2Fixture.prototype.CreateProxy=function(a,b){this.m_shape.ComputeAABB(this.m_aabb,b),this.m_proxy=a.CreateProxy(this.m_aabb,this)},b2Fixture.prototype.DestroyProxy=function(a){null!=this.m_proxy&&(a.DestroyProxy(this.m_proxy),this.m_proxy=null)},b2Fixture.prototype.Synchronize=function(a,b,c){if(this.m_proxy){var d=new b2AABB,e=new b2AABB;this.m_shape.ComputeAABB(d,b),this.m_shape.ComputeAABB(e,c),this.m_aabb.Combine(d,e),b=b2Math.SubtractVV(c.position,b.position),a.MoveProxy(this.m_proxy,this.m_aabb,b)}},b2Fixture.prototype.GetType=function(){return this.m_shape.GetType()},b2Fixture.prototype.GetShape=function(){return this.m_shape},b2Fixture.prototype.SetSensor=function(a){if(this.m_isSensor!=a&&(this.m_isSensor=a,null!=this.m_body))for(a=this.m_body.GetContactList();a;){var b=a.contact,c=b.GetFixtureA(),d=b.GetFixtureB();(c==this||d==this)&&b.SetSensor(c.IsSensor()||d.IsSensor()),a=a.next}},b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},b2Fixture.prototype.SetFilterData=function(a){if(this.m_filter=a.Copy(),!this.m_body)for(a=this.m_body.GetContactList();a;){var b=a.contact,c=b.GetFixtureA(),d=b.GetFixtureB();(c==this||d==this)&&b.FlagForFiltering(),a=a.next}},b2Fixture.prototype.GetFilterData=function(){return this.m_filter.Copy()},b2Fixture.prototype.GetBody=function(){return this.m_body},b2Fixture.prototype.GetNext=function(){return this.m_next},b2Fixture.prototype.GetUserData=function(){return this.m_userData},b2Fixture.prototype.SetUserData=function(a){this.m_userData=a},b2Fixture.prototype.TestPoint=function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)},b2Fixture.prototype.RayCast=function(a,b){return this.m_shape.RayCast(a,b,this.m_body.GetTransform())},b2Fixture.prototype.GetMassData=function(a){return null==a&&(a=new b2MassData),this.m_shape.ComputeMass(a,this.m_density),a},b2Fixture.prototype.SetDensity=function(a){this.m_density=a},b2Fixture.prototype.GetDensity=function(){return this.m_density},b2Fixture.prototype.GetFriction=function(){return this.m_friction},b2Fixture.prototype.SetFriction=function(a){this.m_friction=a},b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},b2Fixture.prototype.SetRestitution=function(a){this.m_restitution=a},b2Fixture.prototype.GetAABB=function(){return this.m_aabb},b2Fixture.prototype.m_massData=null,b2Fixture.prototype.m_aabb=null,b2Fixture.prototype.m_density=null,b2Fixture.prototype.m_next=null,b2Fixture.prototype.m_body=null,b2Fixture.prototype.m_shape=null,b2Fixture.prototype.m_friction=null,b2Fixture.prototype.m_restitution=null,b2Fixture.prototype.m_proxy=null,b2Fixture.prototype.m_filter=new b2FilterData,b2Fixture.prototype.m_isSensor=null,b2Fixture.prototype.m_userData=null;var b2DynamicTreeNode=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreeNode.prototype.__constructor=function(){},b2DynamicTreeNode.prototype.__varz=function(){this.aabb=new b2AABB},b2DynamicTreeNode.prototype.IsLeaf=function(){return null==this.child1},b2DynamicTreeNode.prototype.userData=null,b2DynamicTreeNode.prototype.aabb=new b2AABB,b2DynamicTreeNode.prototype.parent=null,b2DynamicTreeNode.prototype.child1=null,b2DynamicTreeNode.prototype.child2=null;var b2BodyDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BodyDef.prototype.__constructor=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularDamping=this.linearDamping=this.angularVelocity=0,this.awake=this.allowSleep=!0,this.bullet=this.fixedRotation=!1,this.type=b2Body.b2_staticBody,this.active=!0,this.inertiaScale=1},b2BodyDef.prototype.__varz=function(){this.position=new b2Vec2,this.linearVelocity=new b2Vec2},b2BodyDef.prototype.type=0,b2BodyDef.prototype.position=new b2Vec2,b2BodyDef.prototype.angle=null,b2BodyDef.prototype.linearVelocity=new b2Vec2,b2BodyDef.prototype.angularVelocity=null,b2BodyDef.prototype.linearDamping=null,b2BodyDef.prototype.angularDamping=null,b2BodyDef.prototype.allowSleep=null,b2BodyDef.prototype.awake=null,b2BodyDef.prototype.fixedRotation=null,b2BodyDef.prototype.bullet=null,b2BodyDef.prototype.active=null,b2BodyDef.prototype.userData=null,b2BodyDef.prototype.inertiaScale=null;var b2DynamicTreeBroadPhase=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreeBroadPhase.prototype.__constructor=function(){},b2DynamicTreeBroadPhase.prototype.__varz=function(){this.m_tree=new b2DynamicTree,this.m_moveBuffer=[],this.m_pairBuffer=[]},b2DynamicTreeBroadPhase.prototype.BufferMove=function(a){this.m_moveBuffer[this.m_moveBuffer.length]=a},b2DynamicTreeBroadPhase.prototype.UnBufferMove=function(a){this.m_moveBuffer.splice(this.m_moveBuffer.indexOf(a),1)},b2DynamicTreeBroadPhase.prototype.ComparePairs=function(){return 0},b2DynamicTreeBroadPhase.prototype.CreateProxy=function(a,b){var c=this.m_tree.CreateProxy(a,b);return++this.m_proxyCount,this.BufferMove(c),c},b2DynamicTreeBroadPhase.prototype.DestroyProxy=function(a){this.UnBufferMove(a),--this.m_proxyCount,this.m_tree.DestroyProxy(a)},b2DynamicTreeBroadPhase.prototype.MoveProxy=function(a,b,c){this.m_tree.MoveProxy(a,b,c)&&this.BufferMove(a)},b2DynamicTreeBroadPhase.prototype.TestOverlap=function(a,b){var c=this.m_tree.GetFatAABB(a),d=this.m_tree.GetFatAABB(b);return c.TestOverlap(d)},b2DynamicTreeBroadPhase.prototype.GetUserData=function(a){return this.m_tree.GetUserData(a)},b2DynamicTreeBroadPhase.prototype.GetFatAABB=function(a){return this.m_tree.GetFatAABB(a)},b2DynamicTreeBroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},b2DynamicTreeBroadPhase.prototype.UpdatePairs=function(a){for(var b=this.m_pairCount=0,c=null;c=this.m_moveBuffer[b];b++){var d=this;this.m_tree.Query(function(a){if(a==c)return!0;d.m_pairCount==d.m_pairBuffer.length&&(d.m_pairBuffer[d.m_pairCount]=new b2DynamicTreePair);var b=d.m_pairBuffer[d.m_pairCount];return b.proxyA=c>a?a:c,b.proxyB=a>=c?a:c,++d.m_pairCount,!0},this.m_tree.GetFatAABB(c))}for(b=this.m_moveBuffer.length=0;b<this.m_pairCount;){var e=this.m_pairBuffer[b],f=this.m_tree.GetUserData(e.proxyA),g=this.m_tree.GetUserData(e.proxyB);for(a(f,g),++b;b<this.m_pairCount&&(f=this.m_pairBuffer[b],f.proxyA==e.proxyA&&f.proxyB==e.proxyB);)++b}},b2DynamicTreeBroadPhase.prototype.Query=function(a,b){this.m_tree.Query(a,b)},b2DynamicTreeBroadPhase.prototype.RayCast=function(a,b){this.m_tree.RayCast(a,b)},b2DynamicTreeBroadPhase.prototype.Validate=function(){},b2DynamicTreeBroadPhase.prototype.Rebalance=function(a){this.m_tree.Rebalance(a)},b2DynamicTreeBroadPhase.prototype.m_tree=new b2DynamicTree,b2DynamicTreeBroadPhase.prototype.m_proxyCount=0,b2DynamicTreeBroadPhase.prototype.m_moveBuffer=[],b2DynamicTreeBroadPhase.prototype.m_pairBuffer=[],b2DynamicTreeBroadPhase.prototype.m_pairCount=0;var b2BroadPhase=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BroadPhase.prototype.__constructor=function(a){var b=0;for(this.m_pairManager.Initialize(this),this.m_worldAABB=a,this.m_proxyCount=0,this.m_bounds=[],b=0;2>b;b++)this.m_bounds[b]=[];b=a.upperBound.y-a.lowerBound.y,this.m_quantizationFactor.x=b2Settings.USHRT_MAX/(a.upperBound.x-a.lowerBound.x),this.m_quantizationFactor.y=b2Settings.USHRT_MAX/b,this.m_timeStamp=1,this.m_queryResultCount=0
},b2BroadPhase.prototype.__varz=function(){this.m_pairManager=new b2PairManager,this.m_proxyPool=[],this.m_querySortKeys=[],this.m_queryResults=[],this.m_quantizationFactor=new b2Vec2},b2BroadPhase.BinarySearch=function(a,b,c){var d=0;for(b-=1;b>=d;){var e=Math.round((d+b)/2),f=a[e];if(f.value>c)b=e-1;else{if(!(f.value<c))return parseInt(e);d=e+1}}return parseInt(d)},b2BroadPhase.s_validate=!1,b2BroadPhase.b2_invalid=b2Settings.USHRT_MAX,b2BroadPhase.b2_nullEdge=b2Settings.USHRT_MAX,b2BroadPhase.prototype.ComputeBounds=function(a,b,c){var d=c.lowerBound.x,e=c.lowerBound.y;d=b2Math.Min(d,this.m_worldAABB.upperBound.x),e=b2Math.Min(e,this.m_worldAABB.upperBound.y),d=b2Math.Max(d,this.m_worldAABB.lowerBound.x),e=b2Math.Max(e,this.m_worldAABB.lowerBound.y);var f=c.upperBound.x;c=c.upperBound.y,f=b2Math.Min(f,this.m_worldAABB.upperBound.x),c=b2Math.Min(c,this.m_worldAABB.upperBound.y),f=b2Math.Max(f,this.m_worldAABB.lowerBound.x),c=b2Math.Max(c,this.m_worldAABB.lowerBound.y),a[0]=parseInt(this.m_quantizationFactor.x*(d-this.m_worldAABB.lowerBound.x))&b2Settings.USHRT_MAX-1,b[0]=1|parseInt(this.m_quantizationFactor.x*(f-this.m_worldAABB.lowerBound.x))%65535,a[1]=parseInt(this.m_quantizationFactor.y*(e-this.m_worldAABB.lowerBound.y))&b2Settings.USHRT_MAX-1,b[1]=1|parseInt(this.m_quantizationFactor.y*(c-this.m_worldAABB.lowerBound.y))%65535},b2BroadPhase.prototype.TestOverlapValidate=function(a,b){for(var c=0;2>c;++c){var d=this.m_bounds[c],e=d[a.lowerBounds[c]],f=d[b.upperBounds[c]];if(e.value>f.value)return!1;if(e=d[a.upperBounds[c]],f=d[b.lowerBounds[c]],e.value<f.value)return!1}return!0},b2BroadPhase.prototype.QueryAxis=function(a,b,c,d,e,f,g){c=b2BroadPhase.BinarySearch(e,f,c),d=b2BroadPhase.BinarySearch(e,f,d);for(var h=c;d>h;++h)f=e[h],f.IsLower()&&this.IncrementOverlapCount(f.proxy);if(c>0){h=c-1,f=e[h];for(var i=f.stabbingCount;i;)f=e[h],f.IsLower()&&c<=f.proxy.upperBounds[g]&&(this.IncrementOverlapCount(f.proxy),--i),--h}a[0]=c,b[0]=d},b2BroadPhase.prototype.IncrementOverlapCount=function(a){a.timeStamp<this.m_timeStamp?(a.timeStamp=this.m_timeStamp,a.overlapCount=1):(a.overlapCount=2,this.m_queryResults[this.m_queryResultCount]=a,++this.m_queryResultCount)},b2BroadPhase.prototype.IncrementTimeStamp=function(){if(this.m_timeStamp==b2Settings.USHRT_MAX){for(var a=0;a<this.m_proxyPool.length;++a)this.m_proxyPool[a].timeStamp=0;this.m_timeStamp=1}else++this.m_timeStamp},b2BroadPhase.prototype.InRange=function(a){var b,c,d,e;return b=a.lowerBound.x,c=a.lowerBound.y,b-=this.m_worldAABB.upperBound.x,c-=this.m_worldAABB.upperBound.y,d=this.m_worldAABB.lowerBound.x,e=this.m_worldAABB.lowerBound.y,d-=a.upperBound.x,e-=a.upperBound.y,b=b2Math.Max(b,d),c=b2Math.Max(c,e),b2Math.Max(b,c)<0},b2BroadPhase.prototype.CreateProxy=function(a,b){var c,d=0,e=0;if(c=0,!this.m_freeProxy)for(this.m_freeProxy=this.m_proxyPool[this.m_proxyCount]=new b2Proxy,this.m_freeProxy.next=null,this.m_freeProxy.timeStamp=0,this.m_freeProxy.overlapCount=b2BroadPhase.b2_invalid,this.m_freeProxy.userData=null,e=0;2>e;e++)c=2*this.m_proxyCount,this.m_bounds[e][c++]=new b2Bound,this.m_bounds[e][c]=new b2Bound;c=this.m_freeProxy,this.m_freeProxy=c.next,c.overlapCount=0,c.userData=b,e=2*this.m_proxyCount;var f=[],g=[];this.ComputeBounds(f,g,a);for(var h=0;2>h;++h){var i=this.m_bounds[h],j=0,k=0,l=[];l.push(j),d=[],d.push(k),this.QueryAxis(l,d,f[h],g[h],i,e,h),j=l[0],k=d[0],i.splice(k,0,i[i.length-1]),i.length--,i.splice(j,0,i[i.length-1]),i.length--,++k,l=i[j],d=i[k],l.value=f[h],l.proxy=c,d.value=g[h],d.proxy=c;var m=i[parseInt(j-1)];for(l.stabbingCount=0==j?0:m.stabbingCount,m=i[parseInt(k-1)],d.stabbingCount=m.stabbingCount,d=j;k>d;++d)m=i[d],m.stabbingCount++;for(d=j;e+2>d;++d)l=i[d],j=l.proxy,l.IsLower()?j.lowerBounds[h]=d:j.upperBounds[h]=d}for(++this.m_proxyCount,e=0;e<this.m_queryResultCount;++e)this.m_pairManager.AddBufferedPair(c,this.m_queryResults[e]);return this.m_queryResultCount=0,this.IncrementTimeStamp(),c},b2BroadPhase.prototype.DestroyProxy=function(a){for(var b,c,d=2*this.m_proxyCount,e=0;2>e;++e){var f=this.m_bounds[e],g=a.lowerBounds[e],h=a.upperBounds[e];b=f[g];var i=b.value;c=f[h];var j=c.value;f.splice(h,1),f.splice(g,1),f.push(b),f.push(c),c=d-2;for(var k=g;c>k;++k){b=f[k];var l=b.proxy;b.IsLower()?l.lowerBounds[e]=k:l.upperBounds[e]=k}for(c=h-1,g=g;c>g;++g)b=f[g],b.stabbingCount--;b=[],this.QueryAxis(b,b,i,j,f,d-2,e)}for(d=0;d<this.m_queryResultCount;++d)this.m_pairManager.RemoveBufferedPair(a,this.m_queryResults[d]);this.m_queryResultCount=0,this.IncrementTimeStamp(),a.userData=null,a.overlapCount=b2BroadPhase.b2_invalid,a.lowerBounds[0]=b2BroadPhase.b2_invalid,a.lowerBounds[1]=b2BroadPhase.b2_invalid,a.upperBounds[0]=b2BroadPhase.b2_invalid,a.upperBounds[1]=b2BroadPhase.b2_invalid,a.next=this.m_freeProxy,this.m_freeProxy=a,--this.m_proxyCount},b2BroadPhase.prototype.MoveProxy=function(a,b){var c,d,e,f=0,g=0,h=0;if(null!=a&&0!=b.IsValid()){var i=2*this.m_proxyCount,j=new b2BoundValues;this.ComputeBounds(j.lowerValues,j.upperValues,b);var k=new b2BoundValues;for(g=0;2>g;++g)d=this.m_bounds[g][a.lowerBounds[g]],k.lowerValues[g]=d.value,d=this.m_bounds[g][a.upperBounds[g]],k.upperValues[g]=d.value;for(g=0;2>g;++g){var l=this.m_bounds[g],m=a.lowerBounds[g],n=a.upperBounds[g],o=j.lowerValues[g],p=j.upperValues[g];d=l[m];var q=o-d.value;d.value=o,d=l[n];var r=p-d.value;if(d.value=p,0>q)for(h=m;h>0&&o<l[parseInt(h-1)].value;)d=l[h],e=l[parseInt(h-1)],c=e.proxy,e.stabbingCount++,1==e.IsUpper()?(this.TestOverlapBound(j,c)&&this.m_pairManager.AddBufferedPair(a,c),c=c.upperBounds,f=c[g],f++,c[g]=f,d.stabbingCount++):(c=c.lowerBounds,f=c[g],f++,c[g]=f,d.stabbingCount--),c=a.lowerBounds,f=c[g],f--,c[g]=f,d.Swap(e),--h;if(r>0)for(h=n;i-1>h&&l[parseInt(h+1)].value<=p;)d=l[h],e=l[parseInt(h+1)],c=e.proxy,e.stabbingCount++,1==e.IsLower()?(this.TestOverlapBound(j,c)&&this.m_pairManager.AddBufferedPair(a,c),c=c.lowerBounds,f=c[g],f--,c[g]=f,d.stabbingCount++):(c=c.upperBounds,f=c[g],f--,c[g]=f,d.stabbingCount--),c=a.upperBounds,f=c[g],f++,c[g]=f,d.Swap(e),h++;if(q>0)for(h=m;i-1>h&&l[parseInt(h+1)].value<=o;)d=l[h],e=l[parseInt(h+1)],c=e.proxy,e.stabbingCount--,e.IsUpper()?(this.TestOverlapBound(k,c)&&this.m_pairManager.RemoveBufferedPair(a,c),c=c.upperBounds,f=c[g],f--,c[g]=f,d.stabbingCount--):(c=c.lowerBounds,f=c[g],f--,c[g]=f,d.stabbingCount++),c=a.lowerBounds,f=c[g],f++,c[g]=f,d.Swap(e),h++;if(0>r)for(h=n;h>0&&p<l[parseInt(h-1)].value;)d=l[h],e=l[parseInt(h-1)],c=e.proxy,e.stabbingCount--,1==e.IsLower()?(this.TestOverlapBound(k,c)&&this.m_pairManager.RemoveBufferedPair(a,c),c=c.lowerBounds,f=c[g],f++,c[g]=f,d.stabbingCount--):(c=c.upperBounds,f=c[g],f++,c[g]=f,d.stabbingCount++),c=a.upperBounds,f=c[g],f--,c[g]=f,d.Swap(e),h--}}},b2BroadPhase.prototype.UpdatePairs=function(a){this.m_pairManager.Commit(a)},b2BroadPhase.prototype.TestOverlap=function(a,b){return a.lowerBounds[0]>b.upperBounds[0]?!1:b.lowerBounds[0]>a.upperBounds[0]?!1:a.lowerBounds[1]>b.upperBounds[1]?!1:b.lowerBounds[1]>a.upperBounds[1]?!1:!0},b2BroadPhase.prototype.GetUserData=function(a){return a.userData},b2BroadPhase.prototype.GetFatAABB=function(a){var b=new b2AABB;return b.lowerBound.x=this.m_worldAABB.lowerBound.x+this.m_bounds[0][a.lowerBounds[0]].value/this.m_quantizationFactor.x,b.lowerBound.y=this.m_worldAABB.lowerBound.y+this.m_bounds[1][a.lowerBounds[1]].value/this.m_quantizationFactor.y,b.upperBound.x=this.m_worldAABB.lowerBound.x+this.m_bounds[0][a.upperBounds[0]].value/this.m_quantizationFactor.x,b.upperBound.y=this.m_worldAABB.lowerBound.y+this.m_bounds[1][a.upperBounds[1]].value/this.m_quantizationFactor.y,b},b2BroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},b2BroadPhase.prototype.Query=function(a,b){var c=[],d=[];this.ComputeBounds(c,d,b);var e=[];e.push(0);var f=[];for(f.push(0),this.QueryAxis(e,f,c[0],d[0],this.m_bounds[0],2*this.m_proxyCount,0),this.QueryAxis(e,f,c[1],d[1],this.m_bounds[1],2*this.m_proxyCount,1),c=0;c<this.m_queryResultCount&&a(this.m_queryResults[c]);++c);this.m_queryResultCount=0,this.IncrementTimeStamp()},b2BroadPhase.prototype.Validate=function(){for(var a=0;2>a;++a)for(var b=this.m_bounds[a],c=2*this.m_proxyCount,d=0,e=0;c>e;++e)1==b[e].IsLower()?d++:d--},b2BroadPhase.prototype.Rebalance=function(){},b2BroadPhase.prototype.RayCast=function(a,b){var c=new b2RayCastInput;c.p1.SetV(b.p1),c.p2.SetV(b.p2),c.maxFraction=b.maxFraction;var d=(b.p2.x-b.p1.x)*this.m_quantizationFactor.x,e=(b.p2.y-b.p1.y)*this.m_quantizationFactor.y,f=d<-Number.MIN_VALUE?-1:d>Number.MIN_VALUE?1:0,g=e<-Number.MIN_VALUE?-1:e>Number.MIN_VALUE?1:0,h=this.m_quantizationFactor.x*(b.p1.x-this.m_worldAABB.lowerBound.x),i=this.m_quantizationFactor.y*(b.p1.y-this.m_worldAABB.lowerBound.y),j=[],k=[];j[0]=parseInt(h)&b2Settings.USHRT_MAX-1,j[1]=parseInt(i)&b2Settings.USHRT_MAX-1,k[0]=j[0]+1,k[1]=j[1]+1;var l=0,m=0;m=[],m.push(0);var n=[];for(n.push(0),this.QueryAxis(m,n,j[0],k[0],this.m_bounds[0],2*this.m_proxyCount,0),l=f>=0?n[0]-1:m[0],this.QueryAxis(m,n,j[1],k[1],this.m_bounds[1],2*this.m_proxyCount,1),m=g>=0?n[0]-1:m[0],j=0;j<this.m_queryResultCount;j++)c.maxFraction=a(this.m_queryResults[j],c);for(;(n=k=0,l+=f>=0?1:-1,!(0>l||l>=2*this.m_proxyCount))&&(0!=f&&(k=(this.m_bounds[0][l].value-h)/d),m+=g>=0?1:-1,!(0>m||m>=2*this.m_proxyCount));){for(0!=g&&(n=(this.m_bounds[1][m].value-i)/e);;)if(0==g||0!=f&&n>k){if(k>c.maxFraction)break;if((f>0?this.m_bounds[0][l].IsLower():this.m_bounds[0][l].IsUpper())&&(j=this.m_bounds[0][l].proxy,g>=0?j.lowerBounds[1]<=m-1&&j.upperBounds[1]>=m&&(c.maxFraction=a(j,c)):j.lowerBounds[1]<=m&&j.upperBounds[1]>=m+1&&(c.maxFraction=a(j,c))),0==c.maxFraction)break;if(f>0){if(l++,l==2*this.m_proxyCount)break}else if(l--,0>l)break;k=(this.m_bounds[0][l].value-h)/d}else{if(n>c.maxFraction)break;if((g>0?this.m_bounds[1][m].IsLower():this.m_bounds[1][m].IsUpper())&&(j=this.m_bounds[1][m].proxy,f>=0?j.lowerBounds[0]<=l-1&&j.upperBounds[0]>=l&&(c.maxFraction=a(j,c)):j.lowerBounds[0]<=l&&j.upperBounds[0]>=l+1&&(c.maxFraction=a(j,c))),0==c.maxFraction)break;if(g>0){if(m++,m==2*this.m_proxyCount)break}else if(m--,0>m)break;n=(this.m_bounds[1][m].value-i)/e}break}this.m_queryResultCount=0,this.IncrementTimeStamp()},b2BroadPhase.prototype.TestOverlapBound=function(a,b){for(var c=0;2>c;++c){var d=this.m_bounds[c],e=d[b.upperBounds[c]];if(a.lowerValues[c]>e.value)return!1;if(e=d[b.lowerBounds[c]],a.upperValues[c]<e.value)return!1}return!0},b2BroadPhase.prototype.m_pairManager=new b2PairManager,b2BroadPhase.prototype.m_proxyPool=[],b2BroadPhase.prototype.m_freeProxy=null,b2BroadPhase.prototype.m_bounds=null,b2BroadPhase.prototype.m_querySortKeys=[],b2BroadPhase.prototype.m_queryResults=[],b2BroadPhase.prototype.m_queryResultCount=0,b2BroadPhase.prototype.m_worldAABB=null,b2BroadPhase.prototype.m_quantizationFactor=new b2Vec2,b2BroadPhase.prototype.m_proxyCount=0,b2BroadPhase.prototype.m_timeStamp=0;var b2Manifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Manifold.prototype.__constructor=function(){this.m_points=Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.m_points[a]=new b2ManifoldPoint;this.m_localPlaneNormal=new b2Vec2,this.m_localPoint=new b2Vec2},b2Manifold.prototype.__varz=function(){},b2Manifold.e_circles=1,b2Manifold.e_faceA=2,b2Manifold.e_faceB=4,b2Manifold.prototype.Reset=function(){for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.m_points[a].Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_pointCount=this.m_type=0},b2Manifold.prototype.Set=function(a){this.m_pointCount=a.m_pointCount;for(var b=0;b<b2Settings.b2_maxManifoldPoints;b++)this.m_points[b].Set(a.m_points[b]);this.m_localPlaneNormal.SetV(a.m_localPlaneNormal),this.m_localPoint.SetV(a.m_localPoint),this.m_type=a.m_type},b2Manifold.prototype.Copy=function(){var a=new b2Manifold;return a.Set(this),a},b2Manifold.prototype.m_points=null,b2Manifold.prototype.m_localPlaneNormal=null,b2Manifold.prototype.m_localPoint=null,b2Manifold.prototype.m_type=0,b2Manifold.prototype.m_pointCount=0;var b2CircleShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2CircleShape.prototype,b2Shape.prototype),b2CircleShape.prototype._super=b2Shape.prototype,b2CircleShape.prototype.__constructor=function(a){this._super.__constructor.apply(this,[]),this.m_type=b2Shape.e_circleShape,this.m_radius=a},b2CircleShape.prototype.__varz=function(){this.m_p=new b2Vec2},b2CircleShape.prototype.Copy=function(){var a=new b2CircleShape;return a.Set(this),a},b2CircleShape.prototype.Set=function(a){this._super.Set.apply(this,[a]),isInstanceOf(a,b2CircleShape)&&this.m_p.SetV(a.m_p)},b2CircleShape.prototype.TestPoint=function(a,b){var c=a.R,d=a.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y);return c=a.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y),d=b.x-d,c=b.y-c,d*d+c*c<=this.m_radius*this.m_radius},b2CircleShape.prototype.RayCast=function(a,b,c){var d=c.R,e=b.p1.x-(c.position.x+(d.col1.x*this.m_p.x+d.col2.x*this.m_p.y));c=b.p1.y-(c.position.y+(d.col1.y*this.m_p.x+d.col2.y*this.m_p.y)),d=b.p2.x-b.p1.x;var f=b.p2.y-b.p1.y,g=e*d+c*f,h=d*d+f*f,i=g*g-h*(e*e+c*c-this.m_radius*this.m_radius);return 0>i||h<Number.MIN_VALUE?!1:(g=-(g+Math.sqrt(i)),g>=0&&g<=b.maxFraction*h?(g/=h,a.fraction=g,a.normal.x=e+g*d,a.normal.y=c+g*f,a.normal.Normalize(),!0):!1)},b2CircleShape.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y);c=b.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y),a.lowerBound.Set(d-this.m_radius,c-this.m_radius),a.upperBound.Set(d+this.m_radius,c+this.m_radius)},b2CircleShape.prototype.ComputeMass=function(a,b){a.mass=b*b2Settings.b2_pi*this.m_radius*this.m_radius,a.center.SetV(this.m_p),a.I=a.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},b2CircleShape.prototype.ComputeSubmergedArea=function(a,b,c,d){c=b2Math.MulX(c,this.m_p);var e=-(b2Math.Dot(a,c)-b);if(e<-this.m_radius+Number.MIN_VALUE)return 0;if(e>this.m_radius)return d.SetV(c),Math.PI*this.m_radius*this.m_radius;b=this.m_radius*this.m_radius;var f=e*e;return e=b*(Math.asin(e/this.m_radius)+Math.PI/2)+e*Math.sqrt(b-f),b=-2/3*Math.pow(b-f,1.5)/e,d.x=c.x+a.x*b,d.y=c.y+a.y*b,e},b2CircleShape.prototype.GetLocalPosition=function(){return this.m_p},b2CircleShape.prototype.SetLocalPosition=function(a){this.m_p.SetV(a)},b2CircleShape.prototype.GetRadius=function(){return this.m_radius},b2CircleShape.prototype.SetRadius=function(a){this.m_radius=a},b2CircleShape.prototype.m_p=new b2Vec2;var b2Joint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Joint.prototype.__constructor=function(a){b2Settings.b2Assert(a.bodyA!=a.bodyB),this.m_type=a.type,this.m_next=this.m_prev=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_islandFlag=!1,this.m_userData=a.userData},b2Joint.prototype.__varz=function(){this.m_edgeA=new b2JointEdge,this.m_edgeB=new b2JointEdge,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2},b2Joint.Create=function(a){var b=null;switch(a.type){case b2Joint.e_distanceJoint:b=new b2DistanceJoint(a);break;case b2Joint.e_mouseJoint:b=new b2MouseJoint(a);break;case b2Joint.e_prismaticJoint:b=new b2PrismaticJoint(a);break;case b2Joint.e_revoluteJoint:b=new b2RevoluteJoint(a);break;case b2Joint.e_pulleyJoint:b=new b2PulleyJoint(a);break;case b2Joint.e_gearJoint:b=new b2GearJoint(a);break;case b2Joint.e_lineJoint:b=new b2LineJoint(a);break;case b2Joint.e_weldJoint:b=new b2WeldJoint(a);break;case b2Joint.e_frictionJoint:b=new b2FrictionJoint(a)}return b},b2Joint.Destroy=function(){},b2Joint.e_unknownJoint=0,b2Joint.e_revoluteJoint=1,b2Joint.e_prismaticJoint=2,b2Joint.e_distanceJoint=3,b2Joint.e_pulleyJoint=4,b2Joint.e_mouseJoint=5,b2Joint.e_gearJoint=6,b2Joint.e_lineJoint=7,b2Joint.e_weldJoint=8,b2Joint.e_frictionJoint=9,b2Joint.e_inactiveLimit=0,b2Joint.e_atLowerLimit=1,b2Joint.e_atUpperLimit=2,b2Joint.e_equalLimits=3,b2Joint.prototype.InitVelocityConstraints=function(){},b2Joint.prototype.SolveVelocityConstraints=function(){},b2Joint.prototype.FinalizeVelocityConstraints=function(){},b2Joint.prototype.SolvePositionConstraints=function(){return!1},b2Joint.prototype.GetType=function(){return this.m_type},b2Joint.prototype.GetAnchorA=function(){return null},b2Joint.prototype.GetAnchorB=function(){return null},b2Joint.prototype.GetReactionForce=function(){return null},b2Joint.prototype.GetReactionTorque=function(){return 0},b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},b2Joint.prototype.GetNext=function(){return this.m_next},b2Joint.prototype.GetUserData=function(){return this.m_userData},b2Joint.prototype.SetUserData=function(a){this.m_userData=a},b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},b2Joint.prototype.m_type=0,b2Joint.prototype.m_prev=null,b2Joint.prototype.m_next=null,b2Joint.prototype.m_edgeA=new b2JointEdge,b2Joint.prototype.m_edgeB=new b2JointEdge,b2Joint.prototype.m_bodyA=null,b2Joint.prototype.m_bodyB=null,b2Joint.prototype.m_islandFlag=null,b2Joint.prototype.m_collideConnected=null,b2Joint.prototype.m_userData=null,b2Joint.prototype.m_localCenterA=new b2Vec2,b2Joint.prototype.m_localCenterB=new b2Vec2,b2Joint.prototype.m_invMassA=null,b2Joint.prototype.m_invMassB=null,b2Joint.prototype.m_invIA=null,b2Joint.prototype.m_invIB=null;var b2LineJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2LineJoint.prototype,b2Joint.prototype),b2LineJoint.prototype._super=b2Joint.prototype,b2LineJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},b2LineJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_axis=new b2Vec2,this.m_perp=new b2Vec2,this.m_K=new b2Mat22,this.m_impulse=new b2Vec2},b2LineJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;this.m_localCenterA.SetV(d.GetLocalCenter()),this.m_localCenterB.SetV(e.GetLocalCenter());var f=d.GetTransform();e.GetTransform(),b=d.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;c=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=c,b=e.m_xf.R;var i=this.m_localAnchor2.x-this.m_localCenterB.x,j=this.m_localAnchor2.y-this.m_localCenterB.y;c=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=c,b=e.m_sweep.c.x+i-d.m_sweep.c.x-g,c=e.m_sweep.c.y+j-d.m_sweep.c.y-h,this.m_invMassA=d.m_invMass,this.m_invMassB=e.m_invMass,this.m_invIA=d.m_invI,this.m_invIB=e.m_invI,this.m_axis.SetV(b2Math.MulMV(f.R,this.m_localXAxis1)),this.m_a1=(b+g)*this.m_axis.y-(c+h)*this.m_axis.x,this.m_a2=i*this.m_axis.y-j*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(b2Math.MulMV(f.R,this.m_localYAxis1)),this.m_s1=(b+g)*this.m_perp.y-(c+h)*this.m_perp.x,this.m_s2=i*this.m_perp.y-j*this.m_perp.x,f=this.m_invMassA,g=this.m_invMassB,h=this.m_invIA,i=this.m_invIB,this.m_K.col1.x=f+g+h*this.m_s1*this.m_s1+i*this.m_s2*this.m_s2,this.m_K.col1.y=h*this.m_s1*this.m_a1+i*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=f+g+h*this.m_a1*this.m_a1+i*this.m_a2*this.m_a2,this.m_enableLimit?(b=this.m_axis.x*b+this.m_axis.y*c,b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:b<=this.m_lowerTranslation?this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitState=b2Joint.e_atLowerLimit,this.m_impulse.y=0):b>=this.m_upperTranslation?this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitState=b2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=b2Joint.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,c=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,f=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,d.m_linearVelocity.x-=this.m_invMassA*a,d.m_linearVelocity.y-=this.m_invMassA*b,d.m_angularVelocity-=this.m_invIA*c,e.m_linearVelocity.x+=this.m_invMassB*a,e.m_linearVelocity.y+=this.m_invMassB*b,e.m_angularVelocity+=this.m_invIB*f):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},b2LineJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d,e=this.m_bodyA,f=this.m_bodyB,g=e.m_linearVelocity,h=e.m_angularVelocity,i=f.m_linearVelocity,j=f.m_angularVelocity;this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits&&(d=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(i.x-g.x)+this.m_axis.y*(i.y-g.y)+this.m_a2*j-this.m_a1*h)),b=this.m_motorImpulse,a=a.dt*this.m_maxMotorForce,this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+d,-a,a),d=this.m_motorImpulse-b,b=d*this.m_axis.x,a=d*this.m_axis.y,c=d*this.m_a1,d*=this.m_a2,g.x-=this.m_invMassA*b,g.y-=this.m_invMassA*a,h-=this.m_invIA*c,i.x+=this.m_invMassB*b,i.y+=this.m_invMassB*a,j+=this.m_invIB*d),a=this.m_perp.x*(i.x-g.x)+this.m_perp.y*(i.y-g.y)+this.m_s2*j-this.m_s1*h,this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit?(c=this.m_axis.x*(i.x-g.x)+this.m_axis.y*(i.y-g.y)+this.m_a2*j-this.m_a1*h,b=this.m_impulse.Copy(),d=this.m_K.Solve(new b2Vec2,-a,-c),this.m_impulse.Add(d),this.m_limitState==b2Joint.e_atLowerLimit?this.m_impulse.y=b2Math.Max(this.m_impulse.y,0):this.m_limitState==b2Joint.e_atUpperLimit&&(this.m_impulse.y=b2Math.Min(this.m_impulse.y,0)),a=-a-(this.m_impulse.y-b.y)*this.m_K.col2.x,this.m_impulse.x=0!=this.m_K.col1.x?a/this.m_K.col1.x+b.x:b.x,d.x=this.m_impulse.x-b.x,d.y=this.m_impulse.y-b.y,b=d.x*this.m_perp.x+d.y*this.m_axis.x,a=d.x*this.m_perp.y+d.y*this.m_axis.y,c=d.x*this.m_s1+d.y*this.m_a1,d=d.x*this.m_s2+d.y*this.m_a2):(d=0!=this.m_K.col1.x?-a/this.m_K.col1.x:0,this.m_impulse.x+=d,b=d*this.m_perp.x,a=d*this.m_perp.y,c=d*this.m_s1,d*=this.m_s2),g.x-=this.m_invMassA*b,g.y-=this.m_invMassA*a,h-=this.m_invIA*c,i.x+=this.m_invMassB*b,i.y+=this.m_invMassB*a,j+=this.m_invIB*d,e.m_linearVelocity.SetV(g),e.m_angularVelocity=h,f.m_linearVelocity.SetV(i),f.m_angularVelocity=j},b2LineJoint.prototype.SolvePositionConstraints=function(){var a,b,c,d,e,f=this.m_bodyA,g=this.m_bodyB,h=f.m_sweep.c,i=f.m_sweep.a,j=g.m_sweep.c,k=g.m_sweep.a,l=0,m=0;c=!1;var n=0,o=b2Mat22.FromAngle(i);d=b2Mat22.FromAngle(k),a=o,m=this.m_localAnchor1.x-this.m_localCenterA.x;var p=this.m_localAnchor1.y-this.m_localCenterA.y;if(b=a.col1.x*m+a.col2.x*p,p=a.col1.y*m+a.col2.y*p,m=b,a=d,d=this.m_localAnchor2.x-this.m_localCenterB.x,e=this.m_localAnchor2.y-this.m_localCenterB.y,b=a.col1.x*d+a.col2.x*e,e=a.col1.y*d+a.col2.y*e,d=b,a=j.x+d-h.x-m,b=j.y+e-h.y-p,this.m_enableLimit){this.m_axis=b2Math.MulMV(o,this.m_localXAxis1),this.m_a1=(a+m)*this.m_axis.y-(b+p)*this.m_axis.x,this.m_a2=d*this.m_axis.y-e*this.m_axis.x;var q=this.m_axis.x*a+this.m_axis.y*b;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?(n=b2Math.Clamp(q,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),l=b2Math.Abs(q),c=!0):q<=this.m_lowerTranslation?(n=b2Math.Clamp(q-this.m_lowerTranslation+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),l=this.m_lowerTranslation-q,c=!0):q>=this.m_upperTranslation&&(n=b2Math.Clamp(q-this.m_upperTranslation+b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),l=q-this.m_upperTranslation,c=!0)}return this.m_perp=b2Math.MulMV(o,this.m_localYAxis1),this.m_s1=(a+m)*this.m_perp.y-(b+p)*this.m_perp.x,this.m_s2=d*this.m_perp.y-e*this.m_perp.x,o=new b2Vec2,p=this.m_perp.x*a+this.m_perp.y*b,l=b2Math.Max(l,b2Math.Abs(p)),m=0,c?(c=this.m_invMassA,d=this.m_invMassB,e=this.m_invIA,a=this.m_invIB,this.m_K.col1.x=c+d+e*this.m_s1*this.m_s1+a*this.m_s2*this.m_s2,this.m_K.col1.y=e*this.m_s1*this.m_a1+a*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=c+d+e*this.m_a1*this.m_a1+a*this.m_a2*this.m_a2,this.m_K.Solve(o,-p,-n)):(c=this.m_invMassA,d=this.m_invMassB,e=this.m_invIA,a=this.m_invIB,n=c+d+e*this.m_s1*this.m_s1+a*this.m_s2*this.m_s2,o.x=0!=n?-p/n:0,o.y=0),n=o.x*this.m_perp.x+o.y*this.m_axis.x,c=o.x*this.m_perp.y+o.y*this.m_axis.y,p=o.x*this.m_s1+o.y*this.m_a1,o=o.x*this.m_s2+o.y*this.m_a2,h.x-=this.m_invMassA*n,h.y-=this.m_invMassA*c,i-=this.m_invIA*p,j.x+=this.m_invMassB*n,j.y+=this.m_invMassB*c,k+=this.m_invIB*o,f.m_sweep.a=i,g.m_sweep.a=k,f.SynchronizeTransform(),g.SynchronizeTransform(),l<=b2Settings.b2_linearSlop&&m<=b2Settings.b2_angularSlop},b2LineJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2LineJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2LineJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},b2LineJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.y},b2LineJoint.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2);return b=d.x-c.x,c=d.y-c.y,a=a.GetWorldVector(this.m_localXAxis1),a.x*b+a.y*c},b2LineJoint.prototype.GetJointSpeed=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f,a=c.m_sweep.c.x+g-(b.m_sweep.c.x+d),f=c.m_sweep.c.y+h-(b.m_sweep.c.y+e);var i=b.GetWorldVector(this.m_localXAxis1),j=b.m_linearVelocity,k=c.m_linearVelocity;return b=b.m_angularVelocity,c=c.m_angularVelocity,a*-b*i.y+f*b*i.x+(i.x*(k.x+-c*h-j.x- -b*e)+i.y*(k.y+c*g-j.y-b*d))},b2LineJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2LineJoint.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},b2LineJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},b2LineJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},b2LineJoint.prototype.SetLimits=function(a,b){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},b2LineJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},b2LineJoint.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},b2LineJoint.prototype.SetMotorSpeed=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},b2LineJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2LineJoint.prototype.SetMaxMotorForce=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},b2LineJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},b2LineJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},b2LineJoint.prototype.m_localAnchor1=new b2Vec2,b2LineJoint.prototype.m_localAnchor2=new b2Vec2,b2LineJoint.prototype.m_localXAxis1=new b2Vec2,b2LineJoint.prototype.m_localYAxis1=new b2Vec2,b2LineJoint.prototype.m_axis=new b2Vec2,b2LineJoint.prototype.m_perp=new b2Vec2,b2LineJoint.prototype.m_s1=null,b2LineJoint.prototype.m_s2=null,b2LineJoint.prototype.m_a1=null,b2LineJoint.prototype.m_a2=null,b2LineJoint.prototype.m_K=new b2Mat22,b2LineJoint.prototype.m_impulse=new b2Vec2,b2LineJoint.prototype.m_motorMass=null,b2LineJoint.prototype.m_motorImpulse=null,b2LineJoint.prototype.m_lowerTranslation=null,b2LineJoint.prototype.m_upperTranslation=null,b2LineJoint.prototype.m_maxMotorForce=null,b2LineJoint.prototype.m_motorSpeed=null,b2LineJoint.prototype.m_enableLimit=null,b2LineJoint.prototype.m_enableMotor=null,b2LineJoint.prototype.m_limitState=0;var b2ContactSolver=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactSolver.prototype.__constructor=function(){},b2ContactSolver.prototype.__varz=function(){this.m_step=new b2TimeStep,this.m_constraints=[]},b2ContactSolver.s_worldManifold=new b2WorldManifold,b2ContactSolver.s_psm=new b2PositionSolverManifold,b2ContactSolver.prototype.Initialize=function(a,b,c,d){var e;for(this.m_step.Set(a),this.m_allocator=d,a=0,this.m_constraintCount=c;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new b2ContactConstraint;for(a=0;c>a;++a){e=b[a],d=e.m_fixtureA;var f=e.m_fixtureB,g=d.m_shape.m_radius,h=f.m_shape.m_radius,i=d.m_body,j=f.m_body,k=e.GetManifold(),l=b2Settings.b2MixFriction(d.GetFriction(),f.GetFriction()),m=b2Settings.b2MixRestitution(d.GetRestitution(),f.GetRestitution()),n=i.m_linearVelocity.x,o=i.m_linearVelocity.y,p=j.m_linearVelocity.x,q=j.m_linearVelocity.y,r=i.m_angularVelocity,s=j.m_angularVelocity;for(b2Settings.b2Assert(k.m_pointCount>0),b2ContactSolver.s_worldManifold.Initialize(k,i.m_xf,g,j.m_xf,h),f=b2ContactSolver.s_worldManifold.m_normal.x,e=b2ContactSolver.s_worldManifold.m_normal.y,d=this.m_constraints[a],d.bodyA=i,d.bodyB=j,d.manifold=k,d.normal.x=f,d.normal.y=e,d.pointCount=k.m_pointCount,d.friction=l,d.restitution=m,d.localPlaneNormal.x=k.m_localPlaneNormal.x,d.localPlaneNormal.y=k.m_localPlaneNormal.y,d.localPoint.x=k.m_localPoint.x,d.localPoint.y=k.m_localPoint.y,d.radius=g+h,d.type=k.m_type,g=0;g<d.pointCount;++g){l=k.m_points[g],h=d.points[g],h.normalImpulse=l.m_normalImpulse,h.tangentImpulse=l.m_tangentImpulse,h.localPoint.SetV(l.m_localPoint),l=h.rA.x=b2ContactSolver.s_worldManifold.m_points[g].x-i.m_sweep.c.x,m=h.rA.y=b2ContactSolver.s_worldManifold.m_points[g].y-i.m_sweep.c.y;var t=h.rB.x=b2ContactSolver.s_worldManifold.m_points[g].x-j.m_sweep.c.x,u=h.rB.y=b2ContactSolver.s_worldManifold.m_points[g].y-j.m_sweep.c.y,v=l*e-m*f,w=t*e-u*f;v*=v,w*=w,h.normalMass=1/(i.m_invMass+j.m_invMass+i.m_invI*v+j.m_invI*w);var x=i.m_mass*i.m_invMass+j.m_mass*j.m_invMass;x+=i.m_mass*i.m_invI*v+j.m_mass*j.m_invI*w,h.equalizedMass=1/x,w=e,x=-f,v=l*x-m*w,w=t*x-u*w,v*=v,w*=w,h.tangentMass=1/(i.m_invMass+j.m_invMass+i.m_invI*v+j.m_invI*w),h.velocityBias=0,l=d.normal.x*(p+-s*u-n- -r*m)+d.normal.y*(q+s*t-o-r*l),l<-b2Settings.b2_velocityThreshold&&(h.velocityBias+=-d.restitution*l)}2==d.pointCount&&(q=d.points[0],p=d.points[1],k=i.m_invMass,i=i.m_invI,n=j.m_invMass,j=j.m_invI,o=q.rA.x*e-q.rA.y*f,q=q.rB.x*e-q.rB.y*f,r=p.rA.x*e-p.rA.y*f,p=p.rB.x*e-p.rB.y*f,f=k+n+i*o*o+j*q*q,e=k+n+i*r*r+j*p*p,j=k+n+i*o*r+j*q*p,100*(f*e-j*j)>f*f?(d.K.col1.Set(f,j),d.K.col2.Set(j,e),d.K.GetInverse(d.normalMass)):d.pointCount=1)}},b2ContactSolver.prototype.InitVelocityConstraints=function(a){for(var b=0;b<this.m_constraintCount;++b){var c=this.m_constraints[b],d=c.bodyA,e=c.bodyB,f=d.m_invMass,g=d.m_invI,h=e.m_invMass,i=e.m_invI,j=c.normal.x,k=c.normal.y,l=k,m=-j,n=0,o=0;
if(a.warmStarting)for(o=c.pointCount,n=0;o>n;++n){var p=c.points[n];p.normalImpulse*=a.dtRatio,p.tangentImpulse*=a.dtRatio;var q=p.normalImpulse*j+p.tangentImpulse*l,r=p.normalImpulse*k+p.tangentImpulse*m;d.m_angularVelocity-=g*(p.rA.x*r-p.rA.y*q),d.m_linearVelocity.x-=f*q,d.m_linearVelocity.y-=f*r,e.m_angularVelocity+=i*(p.rB.x*r-p.rB.y*q),e.m_linearVelocity.x+=h*q,e.m_linearVelocity.y+=h*r}else for(o=c.pointCount,n=0;o>n;++n)d=c.points[n],d.normalImpulse=0,d.tangentImpulse=0}},b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var a,b,c,d,e,f,g,h,i,j=0,k=0;k<this.m_constraintCount;++k){d=this.m_constraints[k];var l=d.bodyA,m=d.bodyB,n=l.m_angularVelocity,o=m.m_angularVelocity,p=l.m_linearVelocity,q=m.m_linearVelocity,r=l.m_invMass,s=l.m_invI,t=m.m_invMass,u=m.m_invI;g=d.normal.x;var v=h=d.normal.y;for(i=-g,f=d.friction,j=0;j<d.pointCount;j++)a=d.points[j],b=q.x-o*a.rB.y-p.x+n*a.rA.y,c=q.y+o*a.rB.x-p.y-n*a.rA.x,b=b*v+c*i,b=a.tangentMass*-b,c=f*a.normalImpulse,c=b2Math.Clamp(a.tangentImpulse+b,-c,c),b=c-a.tangentImpulse,e=b*v,b*=i,p.x-=r*e,p.y-=r*b,n-=s*(a.rA.x*b-a.rA.y*e),q.x+=t*e,q.y+=t*b,o+=u*(a.rB.x*b-a.rB.y*e),a.tangentImpulse=c;if(1==d.pointCount)a=d.points[0],b=q.x+-o*a.rB.y-p.x- -n*a.rA.y,c=q.y+o*a.rB.x-p.y-n*a.rA.x,d=b*g+c*h,b=-a.normalMass*(d-a.velocityBias),c=a.normalImpulse+b,c=c>0?c:0,b=c-a.normalImpulse,e=b*g,b*=h,p.x-=r*e,p.y-=r*b,n-=s*(a.rA.x*b-a.rA.y*e),q.x+=t*e,q.y+=t*b,o+=u*(a.rB.x*b-a.rB.y*e),a.normalImpulse=c;else{a=d.points[0],j=d.points[1],b=a.normalImpulse,f=j.normalImpulse;var w=(q.x-o*a.rB.y-p.x+n*a.rA.y)*g+(q.y+o*a.rB.x-p.y-n*a.rA.x)*h,x=(q.x-o*j.rB.y-p.x+n*j.rA.y)*g+(q.y+o*j.rB.x-p.y-n*j.rA.x)*h;for(c=w-a.velocityBias,e=x-j.velocityBias,i=d.K,c-=i.col1.x*b+i.col2.x*f,e-=i.col1.y*b+i.col2.y*f;;){if(i=d.normalMass,v=-(i.col1.x*c+i.col2.x*e),i=-(i.col1.y*c+i.col2.y*e),v>=0&&i>=0){b=v-b,f=i-f,d=b*g,b*=h,g=f*g,h=f*h,p.x-=r*(d+g),p.y-=r*(b+h),n-=s*(a.rA.x*b-a.rA.y*d+j.rA.x*h-j.rA.y*g),q.x+=t*(d+g),q.y+=t*(b+h),o+=u*(a.rB.x*b-a.rB.y*d+j.rB.x*h-j.rB.y*g),a.normalImpulse=v,j.normalImpulse=i;break}if(v=-a.normalMass*c,i=0,x=d.K.col1.y*v+e,v>=0&&x>=0){b=v-b,f=i-f,d=b*g,b*=h,g=f*g,h=f*h,p.x-=r*(d+g),p.y-=r*(b+h),n-=s*(a.rA.x*b-a.rA.y*d+j.rA.x*h-j.rA.y*g),q.x+=t*(d+g),q.y+=t*(b+h),o+=u*(a.rB.x*b-a.rB.y*d+j.rB.x*h-j.rB.y*g),a.normalImpulse=v,j.normalImpulse=i;break}if(v=0,i=-j.normalMass*e,w=d.K.col2.x*i+c,i>=0&&w>=0){b=v-b,f=i-f,d=b*g,b*=h,g=f*g,h=f*h,p.x-=r*(d+g),p.y-=r*(b+h),n-=s*(a.rA.x*b-a.rA.y*d+j.rA.x*h-j.rA.y*g),q.x+=t*(d+g),q.y+=t*(b+h),o+=u*(a.rB.x*b-a.rB.y*d+j.rB.x*h-j.rB.y*g),a.normalImpulse=v,j.normalImpulse=i;break}if(i=v=0,w=c,x=e,w>=0&&x>=0){b=v-b,f=i-f,d=b*g,b*=h,g=f*g,h=f*h,p.x-=r*(d+g),p.y-=r*(b+h),n-=s*(a.rA.x*b-a.rA.y*d+j.rA.x*h-j.rA.y*g),q.x+=t*(d+g),q.y+=t*(b+h),o+=u*(a.rB.x*b-a.rB.y*d+j.rB.x*h-j.rB.y*g),a.normalImpulse=v,j.normalImpulse=i;break}break}}l.m_angularVelocity=n,m.m_angularVelocity=o}},b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var b=this.m_constraints[a],c=b.manifold,d=0;d<b.pointCount;++d){var e=c.m_points[d],f=b.points[d];e.m_normalImpulse=f.normalImpulse,e.m_tangentImpulse=f.tangentImpulse}},b2ContactSolver.prototype.SolvePositionConstraints=function(a){for(var b=0,c=0;c<this.m_constraintCount;c++){var d=this.m_constraints[c],e=d.bodyA,f=d.bodyB,g=e.m_mass*e.m_invMass,h=e.m_mass*e.m_invI,i=f.m_mass*f.m_invMass,j=f.m_mass*f.m_invI;b2ContactSolver.s_psm.Initialize(d);for(var k=b2ContactSolver.s_psm.m_normal,l=0;l<d.pointCount;l++){var m=d.points[l],n=b2ContactSolver.s_psm.m_points[l],o=b2ContactSolver.s_psm.m_separations[l],p=n.x-e.m_sweep.c.x,q=n.y-e.m_sweep.c.y,r=n.x-f.m_sweep.c.x;n=n.y-f.m_sweep.c.y,b=o>b?b:o,o=b2Math.Clamp(a*(o+b2Settings.b2_linearSlop),-b2Settings.b2_maxLinearCorrection,0),o=-m.equalizedMass*o,m=o*k.x,o*=k.y,e.m_sweep.c.x-=g*m,e.m_sweep.c.y-=g*o,e.m_sweep.a-=h*(p*o-q*m),e.SynchronizeTransform(),f.m_sweep.c.x+=i*m,f.m_sweep.c.y+=i*o,f.m_sweep.a+=j*(r*o-n*m),f.SynchronizeTransform()}}return b>-1.5*b2Settings.b2_linearSlop},b2ContactSolver.prototype.m_step=new b2TimeStep,b2ContactSolver.prototype.m_allocator=null,b2ContactSolver.prototype.m_constraints=[],b2ContactSolver.prototype.m_constraintCount=0;var b2Simplex=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Simplex.prototype.__constructor=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},b2Simplex.prototype.__varz=function(){this.m_v1=new b2SimplexVertex,this.m_v2=new b2SimplexVertex,this.m_v3=new b2SimplexVertex,this.m_vertices=Array(3)},b2Simplex.prototype.ReadCache=function(a,b,c,d,e){b2Settings.b2Assert(0<=a.count&&a.count<=3);var f,g;this.m_count=a.count;for(var h=this.m_vertices,i=0;i<this.m_count;i++){var j=h[i];j.indexA=a.indexA[i],j.indexB=a.indexB[i],f=b.GetVertex(j.indexA),g=d.GetVertex(j.indexB),j.wA=b2Math.MulX(c,f),j.wB=b2Math.MulX(e,g),j.w=b2Math.SubtractVV(j.wB,j.wA),j.a=0}this.m_count>1&&(a=a.metric,f=this.GetMetric(),(.5*a>f||f>2*a||f<Number.MIN_VALUE)&&(this.m_count=0)),0==this.m_count&&(j=h[0],j.indexA=0,j.indexB=0,f=b.GetVertex(0),g=d.GetVertex(0),j.wA=b2Math.MulX(c,f),j.wB=b2Math.MulX(e,g),j.w=b2Math.SubtractVV(j.wB,j.wA),this.m_count=1)},b2Simplex.prototype.WriteCache=function(a){a.metric=this.GetMetric(),a.count=parseInt(this.m_count);for(var b=this.m_vertices,c=0;c<this.m_count;c++)a.indexA[c]=parseInt(b[c].indexA),a.indexB[c]=parseInt(b[c].indexB)},b2Simplex.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var a=b2Math.SubtractVV(this.m_v2.w,this.m_v1.w);return b2Math.CrossVV(a,this.m_v1.w.GetNegative())>0?b2Math.CrossFV(1,a):b2Math.CrossVF(a,1);default:return b2Settings.b2Assert(!1),new b2Vec2}},b2Simplex.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return b2Settings.b2Assert(!1),new b2Vec2;case 1:return this.m_v1.w;case 2:return new b2Vec2(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return b2Settings.b2Assert(!1),new b2Vec2}},b2Simplex.prototype.GetWitnessPoints=function(a,b){switch(this.m_count){case 0:b2Settings.b2Assert(!1);break;case 1:a.SetV(this.m_v1.wA),b.SetV(this.m_v1.wB);break;case 2:a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,b.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,b.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:b.x=a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,b.y=a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:b2Settings.b2Assert(!1)}},b2Simplex.prototype.GetMetric=function(){switch(this.m_count){case 0:return b2Settings.b2Assert(!1),0;case 1:return 0;case 2:return b2Math.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return b2Math.CrossVV(b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),b2Math.SubtractVV(this.m_v3.w,this.m_v1.w));default:return b2Settings.b2Assert(!1),0}},b2Simplex.prototype.Solve2=function(){var a=this.m_v1.w,b=this.m_v2.w,c=b2Math.SubtractVV(b,a);a=-(a.x*c.x+a.y*c.y),0>=a?this.m_count=this.m_v1.a=1:(b=b.x*c.x+b.y*c.y,0>=b?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(c=1/(b+a),this.m_v1.a=b*c,this.m_v2.a=a*c,this.m_count=2))},b2Simplex.prototype.Solve3=function(){var a=this.m_v1.w,b=this.m_v2.w,c=this.m_v3.w,d=b2Math.SubtractVV(b,a),e=b2Math.Dot(a,d),f=b2Math.Dot(b,d);e=-e;var g=b2Math.SubtractVV(c,a),h=b2Math.Dot(a,g),i=b2Math.Dot(c,g);h=-h;var j=b2Math.SubtractVV(c,b),k=b2Math.Dot(b,j);j=b2Math.Dot(c,j),k=-k,g=b2Math.CrossVV(d,g),d=g*b2Math.CrossVV(b,c),c=g*b2Math.CrossVV(c,a),a=g*b2Math.CrossVV(a,b),0>=e&&0>=h?this.m_count=this.m_v1.a=1:f>0&&e>0&&0>=a?(i=1/(f+e),this.m_v1.a=f*i,this.m_v2.a=e*i,this.m_count=2):i>0&&h>0&&0>=c?(f=1/(i+h),this.m_v1.a=i*f,this.m_v3.a=h*f,this.m_count=2,this.m_v2.Set(this.m_v3)):0>=f&&0>=k?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):0>=i&&0>=j?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):j>0&&k>0&&0>=d?(f=1/(j+k),this.m_v2.a=j*f,this.m_v3.a=k*f,this.m_count=2,this.m_v1.Set(this.m_v3)):(f=1/(d+c+a),this.m_v1.a=d*f,this.m_v2.a=c*f,this.m_v3.a=a*f,this.m_count=3)},b2Simplex.prototype.m_v1=new b2SimplexVertex,b2Simplex.prototype.m_v2=new b2SimplexVertex,b2Simplex.prototype.m_v3=new b2SimplexVertex,b2Simplex.prototype.m_vertices=Array(3),b2Simplex.prototype.m_count=0;var b2WeldJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2WeldJoint.prototype,b2Joint.prototype),b2WeldJoint.prototype._super=b2Joint.prototype,b2WeldJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new b2Mat33},b2WeldJoint.prototype.__varz=function(){this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_impulse=new b2Vec3,this.m_mass=new b2Mat33},b2WeldJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c,b=d.m_invMass,c=e.m_invMass;var j=d.m_invI,k=e.m_invI;this.m_mass.col1.x=b+c+g*g*j+i*i*k,this.m_mass.col2.x=-g*f*j-i*h*k,this.m_mass.col3.x=-g*j-i*k,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=b+c+f*f*j+h*h*k,this.m_mass.col3.y=f*j+h*k,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=j+k,a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_impulse.z*=a.dtRatio,d.m_linearVelocity.x-=b*this.m_impulse.x,d.m_linearVelocity.y-=b*this.m_impulse.y,d.m_angularVelocity-=j*(f*this.m_impulse.y-g*this.m_impulse.x+this.m_impulse.z),e.m_linearVelocity.x+=c*this.m_impulse.x,e.m_linearVelocity.y+=c*this.m_impulse.y,e.m_angularVelocity+=k*(h*this.m_impulse.y-i*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},b2WeldJoint.prototype.SolveVelocityConstraints=function(){var a,b,c=this.m_bodyA,d=this.m_bodyB,e=c.m_linearVelocity,f=c.m_angularVelocity,g=d.m_linearVelocity,h=d.m_angularVelocity,i=c.m_invMass,j=d.m_invMass,k=c.m_invI,l=d.m_invI;a=c.m_xf.R;var m=this.m_localAnchorA.x-c.m_sweep.localCenter.x,n=this.m_localAnchorA.y-c.m_sweep.localCenter.y;b=a.col1.x*m+a.col2.x*n,n=a.col1.y*m+a.col2.y*n,m=b,a=d.m_xf.R;var o=this.m_localAnchorB.x-d.m_sweep.localCenter.x,p=this.m_localAnchorB.y-d.m_sweep.localCenter.y;b=a.col1.x*o+a.col2.x*p,p=a.col1.y*o+a.col2.y*p,o=b,a=g.x-h*p-e.x+f*n,b=g.y+h*o-e.y-f*m;var q=h-f,r=new b2Vec3;this.m_mass.Solve33(r,-a,-b,-q),this.m_impulse.Add(r),e.x-=i*r.x,e.y-=i*r.y,f-=k*(m*r.y-n*r.x+r.z),g.x+=j*r.x,g.y+=j*r.y,h+=l*(o*r.y-p*r.x+r.z),c.m_angularVelocity=f,d.m_angularVelocity=h},b2WeldJoint.prototype.SolvePositionConstraints=function(){var a,b,c=this.m_bodyA,d=this.m_bodyB;a=c.m_xf.R;var e=this.m_localAnchorA.x-c.m_sweep.localCenter.x,f=this.m_localAnchorA.y-c.m_sweep.localCenter.y;b=a.col1.x*e+a.col2.x*f,f=a.col1.y*e+a.col2.y*f,e=b,a=d.m_xf.R;var g=this.m_localAnchorB.x-d.m_sweep.localCenter.x,h=this.m_localAnchorB.y-d.m_sweep.localCenter.y;b=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=b,a=c.m_invMass,b=d.m_invMass;var i=c.m_invI,j=d.m_invI,k=d.m_sweep.c.x+g-c.m_sweep.c.x-e,l=d.m_sweep.c.y+h-c.m_sweep.c.y-f,m=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle,n=10*b2Settings.b2_linearSlop,o=Math.sqrt(k*k+l*l),p=b2Math.Abs(m);return o>n&&(i*=1,j*=1),this.m_mass.col1.x=a+b+f*f*i+h*h*j,this.m_mass.col2.x=-f*e*i-h*g*j,this.m_mass.col3.x=-f*i-h*j,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=a+b+e*e*i+g*g*j,this.m_mass.col3.y=e*i+g*j,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=i+j,n=new b2Vec3,this.m_mass.Solve33(n,-k,-l,-m),c.m_sweep.c.x-=a*n.x,c.m_sweep.c.y-=a*n.y,c.m_sweep.a-=i*(e*n.y-f*n.x+n.z),d.m_sweep.c.x+=b*n.x,d.m_sweep.c.y+=b*n.y,d.m_sweep.a+=j*(g*n.y-h*n.x+n.z),c.SynchronizeTransform(),d.SynchronizeTransform(),o<=b2Settings.b2_linearSlop&&p<=b2Settings.b2_angularSlop},b2WeldJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},b2WeldJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},b2WeldJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse.x,a*this.m_impulse.y)},b2WeldJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.z},b2WeldJoint.prototype.m_localAnchorA=new b2Vec2,b2WeldJoint.prototype.m_localAnchorB=new b2Vec2,b2WeldJoint.prototype.m_referenceAngle=null,b2WeldJoint.prototype.m_impulse=new b2Vec3,b2WeldJoint.prototype.m_mass=new b2Mat33;var b2Math=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Math.prototype.__constructor=function(){},b2Math.prototype.__varz=function(){},b2Math.IsValid=function(a){return isFinite(a)},b2Math.Dot=function(a,b){return a.x*b.x+a.y*b.y},b2Math.CrossVV=function(a,b){return a.x*b.y-a.y*b.x},b2Math.CrossVF=function(a,b){return new b2Vec2(b*a.y,-b*a.x)},b2Math.CrossFV=function(a,b){return new b2Vec2(-a*b.y,a*b.x)},b2Math.MulMV=function(a,b){return new b2Vec2(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y)},b2Math.MulTMV=function(a,b){return new b2Vec2(b2Math.Dot(b,a.col1),b2Math.Dot(b,a.col2))},b2Math.MulX=function(a,b){var c=b2Math.MulMV(a.R,b);return c.x+=a.position.x,c.y+=a.position.y,c},b2Math.MulXT=function(a,b){var c=b2Math.SubtractVV(b,a.position),d=c.x*a.R.col1.x+c.y*a.R.col1.y;return c.y=c.x*a.R.col2.x+c.y*a.R.col2.y,c.x=d,c},b2Math.AddVV=function(a,b){return new b2Vec2(a.x+b.x,a.y+b.y)},b2Math.SubtractVV=function(a,b){return new b2Vec2(a.x-b.x,a.y-b.y)},b2Math.Distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},b2Math.DistanceSquared=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},b2Math.MulFV=function(a,b){return new b2Vec2(a*b.x,a*b.y)},b2Math.AddMM=function(a,b){return b2Mat22.FromVV(b2Math.AddVV(a.col1,b.col1),b2Math.AddVV(a.col2,b.col2))},b2Math.MulMM=function(a,b){return b2Mat22.FromVV(b2Math.MulMV(a,b.col1),b2Math.MulMV(a,b.col2))},b2Math.MulTMM=function(a,b){var c=new b2Vec2(b2Math.Dot(a.col1,b.col1),b2Math.Dot(a.col2,b.col1)),d=new b2Vec2(b2Math.Dot(a.col1,b.col2),b2Math.Dot(a.col2,b.col2));return b2Mat22.FromVV(c,d)},b2Math.Abs=function(a){return a>0?a:-a},b2Math.AbsV=function(a){return new b2Vec2(b2Math.Abs(a.x),b2Math.Abs(a.y))},b2Math.AbsM=function(a){return b2Mat22.FromVV(b2Math.AbsV(a.col1),b2Math.AbsV(a.col2))},b2Math.Min=function(a,b){return b>a?a:b},b2Math.MinV=function(a,b){return new b2Vec2(b2Math.Min(a.x,b.x),b2Math.Min(a.y,b.y))},b2Math.Max=function(a,b){return a>b?a:b},b2Math.MaxV=function(a,b){return new b2Vec2(b2Math.Max(a.x,b.x),b2Math.Max(a.y,b.y))},b2Math.Clamp=function(a,b,c){return b>a?b:a>c?c:a},b2Math.ClampV=function(a,b,c){return b2Math.MaxV(b,b2Math.MinV(a,c))},b2Math.Swap=function(a,b){var c=a[0];a[0]=b[0],b[0]=c},b2Math.Random=function(){return 2*Math.random()-1},b2Math.RandomRange=function(a,b){var c=Math.random();return c=(b-a)*c+a},b2Math.NextPowerOfTwo=function(a){return a|=2147483647&a>>1,a|=1073741823&a>>2,a|=268435455&a>>4,a|=16777215&a>>8,a|=65535&a>>16,a+1},b2Math.IsPowerOfTwo=function(a){return a>0&&0==(a&a-1)},b2Math.b2Vec2_zero=new b2Vec2(0,0),b2Math.b2Mat22_identity=b2Mat22.FromVV(new b2Vec2(1,0),new b2Vec2(0,1)),b2Math.b2Transform_identity=new b2Transform(b2Math.b2Vec2_zero,b2Math.b2Mat22_identity);var b2PulleyJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PulleyJoint.prototype,b2Joint.prototype),b2PulleyJoint.prototype._super=b2Joint.prototype,b2PulleyJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_ratio=a.ratio,this.m_constant=a.lengthA+this.m_ratio*a.lengthB,this.m_maxLength1=b2Math.Min(a.maxLengthA,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=b2Math.Min(a.maxLengthB,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},b2PulleyJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u1=new b2Vec2,this.m_u2=new b2Vec2},b2PulleyJoint.b2_minPulleyLength=2,b2PulleyJoint.prototype.InitVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f,e=g,b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=g,b=d.m_sweep.c.x+h,g=d.m_sweep.c.y+i;var j=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,k=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(c.m_sweep.c.x+e-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),c.m_sweep.c.y+f-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y)),this.m_u2.Set(b-j,g-k),b=this.m_u1.Length(),g=this.m_u2.Length(),b>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero(),g>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/g):this.m_u2.SetZero(),this.m_constant-b-this.m_ratio*g>0?(this.m_state=b2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=b2Joint.e_atUpperLimit,b<this.m_maxLength1?(this.m_limitState1=b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=b2Joint.e_atUpperLimit,g<this.m_maxLength2?(this.m_limitState2=b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=b2Joint.e_atUpperLimit,b=e*this.m_u1.y-f*this.m_u1.x,g=h*this.m_u2.y-i*this.m_u2.x,this.m_limitMass1=c.m_invMass+c.m_invI*b*b,this.m_limitMass2=d.m_invMass+d.m_invI*g*g,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,a.warmStarting?(this.m_impulse*=a.dtRatio,this.m_limitImpulse1*=a.dtRatio,this.m_limitImpulse2*=a.dtRatio,a=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,b=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,g=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,j=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*a,c.m_linearVelocity.y+=c.m_invMass*b,c.m_angularVelocity+=c.m_invI*(e*b-f*a),d.m_linearVelocity.x+=d.m_invMass*g,d.m_linearVelocity.y+=d.m_invMass*j,d.m_angularVelocity+=d.m_invI*(h*j-i*g)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},b2PulleyJoint.prototype.SolveVelocityConstraints=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f;var i,j;this.m_state==b2Joint.e_atUpperLimit&&(a=b.m_linearVelocity.x+-b.m_angularVelocity*e,f=b.m_linearVelocity.y+b.m_angularVelocity*d,i=c.m_linearVelocity.x+-c.m_angularVelocity*h,j=c.m_linearVelocity.y+c.m_angularVelocity*g,a=-(this.m_u1.x*a+this.m_u1.y*f)-this.m_ratio*(this.m_u2.x*i+this.m_u2.y*j),j=this.m_pulleyMass*-a,a=this.m_impulse,this.m_impulse=b2Math.Max(0,this.m_impulse+j),j=this.m_impulse-a,a=-j*this.m_u1.x,f=-j*this.m_u1.y,i=-this.m_ratio*j*this.m_u2.x,j=-this.m_ratio*j*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*a,b.m_linearVelocity.y+=b.m_invMass*f,b.m_angularVelocity+=b.m_invI*(d*f-e*a),c.m_linearVelocity.x+=c.m_invMass*i,c.m_linearVelocity.y+=c.m_invMass*j,c.m_angularVelocity+=c.m_invI*(g*j-h*i)),this.m_limitState1==b2Joint.e_atUpperLimit&&(a=b.m_linearVelocity.x+-b.m_angularVelocity*e,f=b.m_linearVelocity.y+b.m_angularVelocity*d,a=-(this.m_u1.x*a+this.m_u1.y*f),j=-this.m_limitMass1*a,a=this.m_limitImpulse1,this.m_limitImpulse1=b2Math.Max(0,this.m_limitImpulse1+j),j=this.m_limitImpulse1-a,a=-j*this.m_u1.x,f=-j*this.m_u1.y,b.m_linearVelocity.x+=b.m_invMass*a,b.m_linearVelocity.y+=b.m_invMass*f,b.m_angularVelocity+=b.m_invI*(d*f-e*a)),this.m_limitState2==b2Joint.e_atUpperLimit&&(i=c.m_linearVelocity.x+-c.m_angularVelocity*h,j=c.m_linearVelocity.y+c.m_angularVelocity*g,a=-(this.m_u2.x*i+this.m_u2.y*j),j=-this.m_limitMass2*a,a=this.m_limitImpulse2,this.m_limitImpulse2=b2Math.Max(0,this.m_limitImpulse2+j),j=this.m_limitImpulse2-a,i=-j*this.m_u2.x,j=-j*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*i,c.m_linearVelocity.y+=c.m_invMass*j,c.m_angularVelocity+=c.m_invI*(g*j-h*i))},b2PulleyJoint.prototype.SolvePositionConstraints=function(){var a,b,c,d,e,f,g,h,i=this.m_bodyA,j=this.m_bodyB,k=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,l=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,m=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,n=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,o=0;return this.m_state==b2Joint.e_atUpperLimit&&(a=i.m_xf.R,b=this.m_localAnchor1.x-i.m_sweep.localCenter.x,c=this.m_localAnchor1.y-i.m_sweep.localCenter.y,f=a.col1.x*b+a.col2.x*c,c=a.col1.y*b+a.col2.y*c,b=f,a=j.m_xf.R,d=this.m_localAnchor2.x-j.m_sweep.localCenter.x,e=this.m_localAnchor2.y-j.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e,e=a.col1.y*d+a.col2.y*e,d=f,a=i.m_sweep.c.x+b,f=i.m_sweep.c.y+c,g=j.m_sweep.c.x+d,h=j.m_sweep.c.y+e,this.m_u1.Set(a-k,f-l),this.m_u2.Set(g-m,h-n),a=this.m_u1.Length(),f=this.m_u2.Length(),a>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/a):this.m_u1.SetZero(),f>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/f):this.m_u2.SetZero(),a=this.m_constant-a-this.m_ratio*f,o=b2Math.Max(o,-a),a=b2Math.Clamp(a+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),h=-this.m_pulleyMass*a,a=-h*this.m_u1.x,f=-h*this.m_u1.y,g=-this.m_ratio*h*this.m_u2.x,h=-this.m_ratio*h*this.m_u2.y,i.m_sweep.c.x+=i.m_invMass*a,i.m_sweep.c.y+=i.m_invMass*f,i.m_sweep.a+=i.m_invI*(b*f-c*a),j.m_sweep.c.x+=j.m_invMass*g,j.m_sweep.c.y+=j.m_invMass*h,j.m_sweep.a+=j.m_invI*(d*h-e*g),i.SynchronizeTransform(),j.SynchronizeTransform()),this.m_limitState1==b2Joint.e_atUpperLimit&&(a=i.m_xf.R,b=this.m_localAnchor1.x-i.m_sweep.localCenter.x,c=this.m_localAnchor1.y-i.m_sweep.localCenter.y,f=a.col1.x*b+a.col2.x*c,c=a.col1.y*b+a.col2.y*c,b=f,a=i.m_sweep.c.x+b,f=i.m_sweep.c.y+c,this.m_u1.Set(a-k,f-l),a=this.m_u1.Length(),a>b2Settings.b2_linearSlop?(this.m_u1.x*=1/a,this.m_u1.y*=1/a):this.m_u1.SetZero(),a=this.m_maxLength1-a,o=b2Math.Max(o,-a),a=b2Math.Clamp(a+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),h=-this.m_limitMass1*a,a=-h*this.m_u1.x,f=-h*this.m_u1.y,i.m_sweep.c.x+=i.m_invMass*a,i.m_sweep.c.y+=i.m_invMass*f,i.m_sweep.a+=i.m_invI*(b*f-c*a),i.SynchronizeTransform()),this.m_limitState2==b2Joint.e_atUpperLimit&&(a=j.m_xf.R,d=this.m_localAnchor2.x-j.m_sweep.localCenter.x,e=this.m_localAnchor2.y-j.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e,e=a.col1.y*d+a.col2.y*e,d=f,g=j.m_sweep.c.x+d,h=j.m_sweep.c.y+e,this.m_u2.Set(g-m,h-n),f=this.m_u2.Length(),f>b2Settings.b2_linearSlop?(this.m_u2.x*=1/f,this.m_u2.y*=1/f):this.m_u2.SetZero(),a=this.m_maxLength2-f,o=b2Math.Max(o,-a),a=b2Math.Clamp(a+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),h=-this.m_limitMass2*a,g=-h*this.m_u2.x,h=-h*this.m_u2.y,j.m_sweep.c.x+=j.m_invMass*g,j.m_sweep.c.y+=j.m_invMass*h,j.m_sweep.a+=j.m_invI*(d*h-e*g),j.SynchronizeTransform()),o<b2Settings.b2_linearSlop},b2PulleyJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2PulleyJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2PulleyJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)},b2PulleyJoint.prototype.GetReactionTorque=function(){return 0},b2PulleyJoint.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor1),a},b2PulleyJoint.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor2),a},b2PulleyJoint.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);return a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y),Math.sqrt(b*b+a*a)},b2PulleyJoint.prototype.GetLength2=function(){var a=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);return a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y),Math.sqrt(b*b+a*a)},b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},b2PulleyJoint.prototype.m_ground=null,b2PulleyJoint.prototype.m_groundAnchor1=new b2Vec2,b2PulleyJoint.prototype.m_groundAnchor2=new b2Vec2,b2PulleyJoint.prototype.m_localAnchor1=new b2Vec2,b2PulleyJoint.prototype.m_localAnchor2=new b2Vec2,b2PulleyJoint.prototype.m_u1=new b2Vec2,b2PulleyJoint.prototype.m_u2=new b2Vec2,b2PulleyJoint.prototype.m_constant=null,b2PulleyJoint.prototype.m_ratio=null,b2PulleyJoint.prototype.m_maxLength1=null,b2PulleyJoint.prototype.m_maxLength2=null,b2PulleyJoint.prototype.m_pulleyMass=null,b2PulleyJoint.prototype.m_limitMass1=null,b2PulleyJoint.prototype.m_limitMass2=null,b2PulleyJoint.prototype.m_impulse=null,b2PulleyJoint.prototype.m_limitImpulse1=null,b2PulleyJoint.prototype.m_limitImpulse2=null,b2PulleyJoint.prototype.m_state=0,b2PulleyJoint.prototype.m_limitState1=0,b2PulleyJoint.prototype.m_limitState2=0;var b2PrismaticJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PrismaticJoint.prototype,b2Joint.prototype),b2PrismaticJoint.prototype._super=b2Joint.prototype,b2PrismaticJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},b2PrismaticJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_axis=new b2Vec2,this.m_perp=new b2Vec2,this.m_K=new b2Mat33,this.m_impulse=new b2Vec3},b2PrismaticJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;this.m_localCenterA.SetV(d.GetLocalCenter()),this.m_localCenterB.SetV(e.GetLocalCenter());var f=d.GetTransform();e.GetTransform(),b=d.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;c=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=c,b=e.m_xf.R;var i=this.m_localAnchor2.x-this.m_localCenterB.x,j=this.m_localAnchor2.y-this.m_localCenterB.y;c=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=c,b=e.m_sweep.c.x+i-d.m_sweep.c.x-g,c=e.m_sweep.c.y+j-d.m_sweep.c.y-h,this.m_invMassA=d.m_invMass,this.m_invMassB=e.m_invMass,this.m_invIA=d.m_invI,this.m_invIB=e.m_invI,this.m_axis.SetV(b2Math.MulMV(f.R,this.m_localXAxis1)),this.m_a1=(b+g)*this.m_axis.y-(c+h)*this.m_axis.x,this.m_a2=i*this.m_axis.y-j*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(b2Math.MulMV(f.R,this.m_localYAxis1)),this.m_s1=(b+g)*this.m_perp.y-(c+h)*this.m_perp.x,this.m_s2=i*this.m_perp.y-j*this.m_perp.x,f=this.m_invMassA,g=this.m_invMassB,h=this.m_invIA,i=this.m_invIB,this.m_K.col1.x=f+g+h*this.m_s1*this.m_s1+i*this.m_s2*this.m_s2,this.m_K.col1.y=h*this.m_s1+i*this.m_s2,this.m_K.col1.z=h*this.m_s1*this.m_a1+i*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=h+i,this.m_K.col2.z=h*this.m_a1+i*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=f+g+h*this.m_a1*this.m_a1+i*this.m_a2*this.m_a2,this.m_enableLimit?(b=this.m_axis.x*b+this.m_axis.y*c,b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:b<=this.m_lowerTranslation?this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitState=b2Joint.e_atLowerLimit,this.m_impulse.z=0):b>=this.m_upperTranslation?this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitState=b2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=b2Joint.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,c=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,f=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,d.m_linearVelocity.x-=this.m_invMassA*a,d.m_linearVelocity.y-=this.m_invMassA*b,d.m_angularVelocity-=this.m_invIA*c,e.m_linearVelocity.x+=this.m_invMassB*a,e.m_linearVelocity.y+=this.m_invMassB*b,e.m_angularVelocity+=this.m_invIB*f):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},b2PrismaticJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d,e=this.m_bodyA,f=this.m_bodyB,g=e.m_linearVelocity,h=e.m_angularVelocity,i=f.m_linearVelocity,j=f.m_angularVelocity;this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits&&(d=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(i.x-g.x)+this.m_axis.y*(i.y-g.y)+this.m_a2*j-this.m_a1*h)),b=this.m_motorImpulse,a=a.dt*this.m_maxMotorForce,this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+d,-a,a),d=this.m_motorImpulse-b,b=d*this.m_axis.x,a=d*this.m_axis.y,c=d*this.m_a1,d*=this.m_a2,g.x-=this.m_invMassA*b,g.y-=this.m_invMassA*a,h-=this.m_invIA*c,i.x+=this.m_invMassB*b,i.y+=this.m_invMassB*a,j+=this.m_invIB*d),c=this.m_perp.x*(i.x-g.x)+this.m_perp.y*(i.y-g.y)+this.m_s2*j-this.m_s1*h,a=j-h,this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit?(d=this.m_axis.x*(i.x-g.x)+this.m_axis.y*(i.y-g.y)+this.m_a2*j-this.m_a1*h,b=this.m_impulse.Copy(),d=this.m_K.Solve33(new b2Vec3,-c,-a,-d),this.m_impulse.Add(d),this.m_limitState==b2Joint.e_atLowerLimit?this.m_impulse.z=b2Math.Max(this.m_impulse.z,0):this.m_limitState==b2Joint.e_atUpperLimit&&(this.m_impulse.z=b2Math.Min(this.m_impulse.z,0)),c=-c-(this.m_impulse.z-b.z)*this.m_K.col3.x,a=-a-(this.m_impulse.z-b.z)*this.m_K.col3.y,a=this.m_K.Solve22(new b2Vec2,c,a),a.x+=b.x,a.y+=b.y,this.m_impulse.x=a.x,this.m_impulse.y=a.y,d.x=this.m_impulse.x-b.x,d.y=this.m_impulse.y-b.y,d.z=this.m_impulse.z-b.z,b=d.x*this.m_perp.x+d.z*this.m_axis.x,a=d.x*this.m_perp.y+d.z*this.m_axis.y,c=d.x*this.m_s1+d.y+d.z*this.m_a1,d=d.x*this.m_s2+d.y+d.z*this.m_a2):(d=this.m_K.Solve22(new b2Vec2,-c,-a),this.m_impulse.x+=d.x,this.m_impulse.y+=d.y,b=d.x*this.m_perp.x,a=d.x*this.m_perp.y,c=d.x*this.m_s1+d.y,d=d.x*this.m_s2+d.y),g.x-=this.m_invMassA*b,g.y-=this.m_invMassA*a,h-=this.m_invIA*c,i.x+=this.m_invMassB*b,i.y+=this.m_invMassB*a,j+=this.m_invIB*d,e.m_linearVelocity.SetV(g),e.m_angularVelocity=h,f.m_linearVelocity.SetV(i),f.m_angularVelocity=j
},b2PrismaticJoint.prototype.SolvePositionConstraints=function(){var a,b,c,d,e=this.m_bodyA,f=this.m_bodyB,g=e.m_sweep.c,h=e.m_sweep.a,i=f.m_sweep.c,j=f.m_sweep.a,k=0,l=0;c=!1;var m=0,n=b2Mat22.FromAngle(h),o=b2Mat22.FromAngle(j);a=n,l=this.m_localAnchor1.x-this.m_localCenterA.x;var p=this.m_localAnchor1.y-this.m_localCenterA.y;if(b=a.col1.x*l+a.col2.x*p,p=a.col1.y*l+a.col2.y*p,l=b,a=o,o=this.m_localAnchor2.x-this.m_localCenterB.x,d=this.m_localAnchor2.y-this.m_localCenterB.y,b=a.col1.x*o+a.col2.x*d,d=a.col1.y*o+a.col2.y*d,o=b,a=i.x+o-g.x-l,b=i.y+d-g.y-p,this.m_enableLimit){this.m_axis=b2Math.MulMV(n,this.m_localXAxis1),this.m_a1=(a+l)*this.m_axis.y-(b+p)*this.m_axis.x,this.m_a2=o*this.m_axis.y-d*this.m_axis.x;var q=this.m_axis.x*a+this.m_axis.y*b;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?(m=b2Math.Clamp(q,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),k=b2Math.Abs(q),c=!0):q<=this.m_lowerTranslation?(m=b2Math.Clamp(q-this.m_lowerTranslation+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),k=this.m_lowerTranslation-q,c=!0):q>=this.m_upperTranslation&&(m=b2Math.Clamp(q-this.m_upperTranslation+b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),k=q-this.m_upperTranslation,c=!0)}return this.m_perp=b2Math.MulMV(n,this.m_localYAxis1),this.m_s1=(a+l)*this.m_perp.y-(b+p)*this.m_perp.x,this.m_s2=o*this.m_perp.y-d*this.m_perp.x,n=new b2Vec3,p=this.m_perp.x*a+this.m_perp.y*b,o=j-h-this.m_refAngle,k=b2Math.Max(k,b2Math.Abs(p)),l=b2Math.Abs(o),c?(c=this.m_invMassA,d=this.m_invMassB,a=this.m_invIA,b=this.m_invIB,this.m_K.col1.x=c+d+a*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,this.m_K.col1.y=a*this.m_s1+b*this.m_s2,this.m_K.col1.z=a*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=a+b,this.m_K.col2.z=a*this.m_a1+b*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=c+d+a*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2,this.m_K.Solve33(n,-p,-o,-m)):(c=this.m_invMassA,d=this.m_invMassB,a=this.m_invIA,b=this.m_invIB,m=a*this.m_s1+b*this.m_s2,q=a+b,this.m_K.col1.Set(c+d+a*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,m,0),this.m_K.col2.Set(m,q,0),m=this.m_K.Solve22(new b2Vec2,-p,-o),n.x=m.x,n.y=m.y,n.z=0),m=n.x*this.m_perp.x+n.z*this.m_axis.x,c=n.x*this.m_perp.y+n.z*this.m_axis.y,p=n.x*this.m_s1+n.y+n.z*this.m_a1,n=n.x*this.m_s2+n.y+n.z*this.m_a2,g.x-=this.m_invMassA*m,g.y-=this.m_invMassA*c,h-=this.m_invIA*p,i.x+=this.m_invMassB*m,i.y+=this.m_invMassB*c,j+=this.m_invIB*n,e.m_sweep.a=h,f.m_sweep.a=j,e.SynchronizeTransform(),f.SynchronizeTransform(),k<=b2Settings.b2_linearSlop&&l<=b2Settings.b2_angularSlop},b2PrismaticJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2PrismaticJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2PrismaticJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},b2PrismaticJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.y},b2PrismaticJoint.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2);return b=d.x-c.x,c=d.y-c.y,a=a.GetWorldVector(this.m_localXAxis1),a.x*b+a.y*c},b2PrismaticJoint.prototype.GetJointSpeed=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f,a=c.m_sweep.c.x+g-(b.m_sweep.c.x+d),f=c.m_sweep.c.y+h-(b.m_sweep.c.y+e);var i=b.GetWorldVector(this.m_localXAxis1),j=b.m_linearVelocity,k=c.m_linearVelocity;return b=b.m_angularVelocity,c=c.m_angularVelocity,a*-b*i.y+f*b*i.x+(i.x*(k.x+-c*h-j.x- -b*e)+i.y*(k.y+c*g-j.y-b*d))},b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2PrismaticJoint.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},b2PrismaticJoint.prototype.SetLimits=function(a,b){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},b2PrismaticJoint.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},b2PrismaticJoint.prototype.SetMotorSpeed=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2PrismaticJoint.prototype.SetMaxMotorForce=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},b2PrismaticJoint.prototype.m_localAnchor1=new b2Vec2,b2PrismaticJoint.prototype.m_localAnchor2=new b2Vec2,b2PrismaticJoint.prototype.m_localXAxis1=new b2Vec2,b2PrismaticJoint.prototype.m_localYAxis1=new b2Vec2,b2PrismaticJoint.prototype.m_refAngle=null,b2PrismaticJoint.prototype.m_axis=new b2Vec2,b2PrismaticJoint.prototype.m_perp=new b2Vec2,b2PrismaticJoint.prototype.m_s1=null,b2PrismaticJoint.prototype.m_s2=null,b2PrismaticJoint.prototype.m_a1=null,b2PrismaticJoint.prototype.m_a2=null,b2PrismaticJoint.prototype.m_K=new b2Mat33,b2PrismaticJoint.prototype.m_impulse=new b2Vec3,b2PrismaticJoint.prototype.m_motorMass=null,b2PrismaticJoint.prototype.m_motorImpulse=null,b2PrismaticJoint.prototype.m_lowerTranslation=null,b2PrismaticJoint.prototype.m_upperTranslation=null,b2PrismaticJoint.prototype.m_maxMotorForce=null,b2PrismaticJoint.prototype.m_motorSpeed=null,b2PrismaticJoint.prototype.m_enableLimit=null,b2PrismaticJoint.prototype.m_enableMotor=null,b2PrismaticJoint.prototype.m_limitState=0;var b2RevoluteJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2RevoluteJoint.prototype,b2Joint.prototype),b2RevoluteJoint.prototype._super=b2Joint.prototype,b2RevoluteJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=a.lowerAngle,this.m_upperAngle=a.upperAngle,this.m_maxMotorTorque=a.maxMotorTorque,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit},b2RevoluteJoint.prototype.__varz=function(){this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.K3=new b2Mat22,this.impulse3=new b2Vec3,this.impulse2=new b2Vec2,this.reduced=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_impulse=new b2Vec3,this.m_mass=new b2Mat33},b2RevoluteJoint.tImpulse=new b2Vec2,b2RevoluteJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchor1.x-d.m_sweep.localCenter.x,g=this.m_localAnchor1.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,i=this.m_localAnchor2.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c,b=d.m_invMass,c=e.m_invMass;var j=d.m_invI,k=e.m_invI;if(this.m_mass.col1.x=b+c+g*g*j+i*i*k,this.m_mass.col2.x=-g*f*j-i*h*k,this.m_mass.col3.x=-g*j-i*k,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=b+c+f*f*j+h*h*k,this.m_mass.col3.y=f*j+h*k,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=j+k,this.m_motorMass=1/(j+k),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var l=e.m_sweep.a-d.m_sweep.a-this.m_referenceAngle;b2Math.Abs(this.m_upperAngle-this.m_lowerAngle)<2*b2Settings.b2_angularSlop?this.m_limitState=b2Joint.e_equalLimits:l<=this.m_lowerAngle?(this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=b2Joint.e_atLowerLimit):l>=this.m_upperAngle?(this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=b2Joint.e_atUpperLimit):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=b2Joint.e_inactiveLimit;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x,l=this.m_impulse.y,d.m_linearVelocity.x-=b*a,d.m_linearVelocity.y-=b*l,d.m_angularVelocity-=j*(f*l-g*a+this.m_motorImpulse+this.m_impulse.z),e.m_linearVelocity.x+=c*a,e.m_linearVelocity.y+=c*l,e.m_angularVelocity+=k*(h*l-i*a+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},b2RevoluteJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d,e,f,g=this.m_bodyA,h=this.m_bodyB,i=g.m_linearVelocity,j=g.m_angularVelocity,k=h.m_linearVelocity,l=h.m_angularVelocity,m=g.m_invMass,n=h.m_invMass,o=g.m_invI,p=h.m_invI;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits&&(d=this.m_motorMass*-(l-j-this.m_motorSpeed),e=this.m_motorImpulse,a=a.dt*this.m_maxMotorTorque,this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+d,-a,a),d=this.m_motorImpulse-e,j-=o*d,l+=p*d),this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){b=g.m_xf.R,d=this.m_localAnchor1.x-g.m_sweep.localCenter.x,e=this.m_localAnchor1.y-g.m_sweep.localCenter.y,c=b.col1.x*d+b.col2.x*e,e=b.col1.y*d+b.col2.y*e,d=c,b=h.m_xf.R,a=this.m_localAnchor2.x-h.m_sweep.localCenter.x,f=this.m_localAnchor2.y-h.m_sweep.localCenter.y,c=b.col1.x*a+b.col2.x*f,f=b.col1.y*a+b.col2.y*f,a=c,c=k.x+-l*f-i.x- -j*e;var q=k.y+l*a-i.y-j*d;this.m_mass.Solve33(this.impulse3,-c,-q,-(l-j)),this.m_limitState==b2Joint.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==b2Joint.e_atLowerLimit?(b=this.m_impulse.z+this.impulse3.z,0>b&&(this.m_mass.Solve22(this.reduced,-c,-q),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==b2Joint.e_atUpperLimit&&(b=this.m_impulse.z+this.impulse3.z,b>0&&(this.m_mass.Solve22(this.reduced,-c,-q),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),i.x-=m*this.impulse3.x,i.y-=m*this.impulse3.y,j-=o*(d*this.impulse3.y-e*this.impulse3.x+this.impulse3.z),k.x+=n*this.impulse3.x,k.y+=n*this.impulse3.y,l+=p*(a*this.impulse3.y-f*this.impulse3.x+this.impulse3.z)}else b=g.m_xf.R,d=this.m_localAnchor1.x-g.m_sweep.localCenter.x,e=this.m_localAnchor1.y-g.m_sweep.localCenter.y,c=b.col1.x*d+b.col2.x*e,e=b.col1.y*d+b.col2.y*e,d=c,b=h.m_xf.R,a=this.m_localAnchor2.x-h.m_sweep.localCenter.x,f=this.m_localAnchor2.y-h.m_sweep.localCenter.y,c=b.col1.x*a+b.col2.x*f,f=b.col1.y*a+b.col2.y*f,a=c,this.m_mass.Solve22(this.impulse2,-(k.x+-l*f-i.x- -j*e),-(k.y+l*a-i.y-j*d)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,i.x-=m*this.impulse2.x,i.y-=m*this.impulse2.y,j-=o*(d*this.impulse2.y-e*this.impulse2.x),k.x+=n*this.impulse2.x,k.y+=n*this.impulse2.y,l+=p*(a*this.impulse2.y-f*this.impulse2.x);g.m_linearVelocity.SetV(i),g.m_angularVelocity=j,h.m_linearVelocity.SetV(k),h.m_angularVelocity=l},b2RevoluteJoint.prototype.SolvePositionConstraints=function(){var a,b,c=this.m_bodyA,d=this.m_bodyB,e=0;b=0;var f,g,h;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){a=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle;var i=0;this.m_limitState==b2Joint.e_equalLimits?(a=b2Math.Clamp(a-this.m_lowerAngle,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection),i=-this.m_motorMass*a,e=b2Math.Abs(a)):this.m_limitState==b2Joint.e_atLowerLimit?(a-=this.m_lowerAngle,e=-a,a=b2Math.Clamp(a+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0),i=-this.m_motorMass*a):this.m_limitState==b2Joint.e_atUpperLimit&&(e=a-=this.m_upperAngle,a=b2Math.Clamp(a-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection),i=-this.m_motorMass*a),c.m_sweep.a-=c.m_invI*i,d.m_sweep.a+=d.m_invI*i,c.SynchronizeTransform(),d.SynchronizeTransform()}b=c.m_xf.R,i=this.m_localAnchor1.x-c.m_sweep.localCenter.x,a=this.m_localAnchor1.y-c.m_sweep.localCenter.y,f=b.col1.x*i+b.col2.x*a,a=b.col1.y*i+b.col2.y*a,i=f,b=d.m_xf.R;var j=this.m_localAnchor2.x-d.m_sweep.localCenter.x,k=this.m_localAnchor2.y-d.m_sweep.localCenter.y;f=b.col1.x*j+b.col2.x*k,k=b.col1.y*j+b.col2.y*k,j=f,g=d.m_sweep.c.x+j-c.m_sweep.c.x-i,h=d.m_sweep.c.y+k-c.m_sweep.c.y-a;var l=g*g+h*h;b=Math.sqrt(l),f=c.m_invMass;var m=d.m_invMass,n=c.m_invI,o=d.m_invI,p=10*b2Settings.b2_linearSlop;return l>p*p&&(l=1/(f+m),g=l*-g,h=l*-h,c.m_sweep.c.x-=.5*f*g,c.m_sweep.c.y-=.5*f*h,d.m_sweep.c.x+=.5*m*g,d.m_sweep.c.y+=.5*m*h,g=d.m_sweep.c.x+j-c.m_sweep.c.x-i,h=d.m_sweep.c.y+k-c.m_sweep.c.y-a),this.K1.col1.x=f+m,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=f+m,this.K2.col1.x=n*a*a,this.K2.col2.x=-n*i*a,this.K2.col1.y=-n*i*a,this.K2.col2.y=n*i*i,this.K3.col1.x=o*k*k,this.K3.col2.x=-o*j*k,this.K3.col1.y=-o*j*k,this.K3.col2.y=o*j*j,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(b2RevoluteJoint.tImpulse,-g,-h),g=b2RevoluteJoint.tImpulse.x,h=b2RevoluteJoint.tImpulse.y,c.m_sweep.c.x-=c.m_invMass*g,c.m_sweep.c.y-=c.m_invMass*h,c.m_sweep.a-=c.m_invI*(i*h-a*g),d.m_sweep.c.x+=d.m_invMass*g,d.m_sweep.c.y+=d.m_invMass*h,d.m_sweep.a+=d.m_invI*(j*h-k*g),c.SynchronizeTransform(),d.SynchronizeTransform(),b<=b2Settings.b2_linearSlop&&e<=b2Settings.b2_angularSlop},b2RevoluteJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2RevoluteJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2RevoluteJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse.x,a*this.m_impulse.y)},b2RevoluteJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.z},b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2RevoluteJoint.prototype.EnableLimit=function(a){this.m_enableLimit=a},b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},b2RevoluteJoint.prototype.SetLimits=function(a,b){this.m_lowerAngle=a,this.m_upperAngle=b},b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},b2RevoluteJoint.prototype.EnableMotor=function(a){this.m_enableMotor=a},b2RevoluteJoint.prototype.SetMotorSpeed=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2RevoluteJoint.prototype.SetMaxMotorTorque=function(a){this.m_maxMotorTorque=a},b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},b2RevoluteJoint.prototype.K=new b2Mat22,b2RevoluteJoint.prototype.K1=new b2Mat22,b2RevoluteJoint.prototype.K2=new b2Mat22,b2RevoluteJoint.prototype.K3=new b2Mat22,b2RevoluteJoint.prototype.impulse3=new b2Vec3,b2RevoluteJoint.prototype.impulse2=new b2Vec2,b2RevoluteJoint.prototype.reduced=new b2Vec2,b2RevoluteJoint.prototype.m_localAnchor1=new b2Vec2,b2RevoluteJoint.prototype.m_localAnchor2=new b2Vec2,b2RevoluteJoint.prototype.m_impulse=new b2Vec3,b2RevoluteJoint.prototype.m_motorImpulse=null,b2RevoluteJoint.prototype.m_mass=new b2Mat33,b2RevoluteJoint.prototype.m_motorMass=null,b2RevoluteJoint.prototype.m_enableMotor=null,b2RevoluteJoint.prototype.m_maxMotorTorque=null,b2RevoluteJoint.prototype.m_motorSpeed=null,b2RevoluteJoint.prototype.m_enableLimit=null,b2RevoluteJoint.prototype.m_referenceAngle=null,b2RevoluteJoint.prototype.m_lowerAngle=null,b2RevoluteJoint.prototype.m_upperAngle=null,b2RevoluteJoint.prototype.m_limitState=0;var b2JointDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2JointDef.prototype.__constructor=function(){this.type=b2Joint.e_unknownJoint,this.bodyB=this.bodyA=this.userData=null,this.collideConnected=!1},b2JointDef.prototype.__varz=function(){},b2JointDef.prototype.type=0,b2JointDef.prototype.userData=null,b2JointDef.prototype.bodyA=null,b2JointDef.prototype.bodyB=null,b2JointDef.prototype.collideConnected=null;var b2LineJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2LineJointDef.prototype,b2JointDef.prototype),b2LineJointDef.prototype._super=b2JointDef.prototype,b2LineJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},b2LineJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.localAxisA=new b2Vec2},b2LineJointDef.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d)},b2LineJointDef.prototype.localAnchorA=new b2Vec2,b2LineJointDef.prototype.localAnchorB=new b2Vec2,b2LineJointDef.prototype.localAxisA=new b2Vec2,b2LineJointDef.prototype.enableLimit=null,b2LineJointDef.prototype.lowerTranslation=null,b2LineJointDef.prototype.upperTranslation=null,b2LineJointDef.prototype.enableMotor=null,b2LineJointDef.prototype.maxMotorForce=null,b2LineJointDef.prototype.motorSpeed=null;var b2DistanceJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2DistanceJoint.prototype,b2Joint.prototype),b2DistanceJoint.prototype._super=b2Joint.prototype,b2DistanceJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_length=a.length,this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio,this.m_bias=this.m_gamma=this.m_impulse=0},b2DistanceJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u=new b2Vec2},b2DistanceJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchor1.x-d.m_sweep.localCenter.x,g=this.m_localAnchor1.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,i=this.m_localAnchor2.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c,this.m_u.x=e.m_sweep.c.x+h-d.m_sweep.c.x-f,this.m_u.y=e.m_sweep.c.y+i-d.m_sweep.c.y-g,c=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),c>b2Settings.b2_linearSlop?this.m_u.Multiply(1/c):this.m_u.SetZero(),b=f*this.m_u.y-g*this.m_u.x;var j=h*this.m_u.y-i*this.m_u.x;if(b=d.m_invMass+d.m_invI*b*b+e.m_invMass+e.m_invI*j*j,this.m_mass=0!=b?1/b:0,this.m_frequencyHz>0){c-=this.m_length,j=2*Math.PI*this.m_frequencyHz;var k=this.m_mass*j*j;this.m_gamma=a.dt*(2*this.m_mass*this.m_dampingRatio*j+a.dt*k),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=c*a.dt*k*this.m_gamma,this.m_mass=b+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}a.warmStarting?(this.m_impulse*=a.dtRatio,a=this.m_impulse*this.m_u.x,b=this.m_impulse*this.m_u.y,d.m_linearVelocity.x-=d.m_invMass*a,d.m_linearVelocity.y-=d.m_invMass*b,d.m_angularVelocity-=d.m_invI*(f*b-g*a),e.m_linearVelocity.x+=e.m_invMass*a,e.m_linearVelocity.y+=e.m_invMass*b,e.m_angularVelocity+=e.m_invI*(h*b-i*a)):this.m_impulse=0},b2DistanceJoint.prototype.SolveVelocityConstraints=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f,f=-this.m_mass*(this.m_u.x*(c.m_linearVelocity.x+-c.m_angularVelocity*h-(b.m_linearVelocity.x+-b.m_angularVelocity*e))+this.m_u.y*(c.m_linearVelocity.y+c.m_angularVelocity*g-(b.m_linearVelocity.y+b.m_angularVelocity*d))+this.m_bias+this.m_gamma*this.m_impulse),this.m_impulse+=f,a=f*this.m_u.x,f*=this.m_u.y,b.m_linearVelocity.x-=b.m_invMass*a,b.m_linearVelocity.y-=b.m_invMass*f,b.m_angularVelocity-=b.m_invI*(d*f-e*a),c.m_linearVelocity.x+=c.m_invMass*a,c.m_linearVelocity.y+=c.m_invMass*f,c.m_angularVelocity+=c.m_invI*(g*f-h*a)},b2DistanceJoint.prototype.SolvePositionConstraints=function(){var a;if(this.m_frequencyHz>0)return!0;var b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f,f=c.m_sweep.c.x+g-b.m_sweep.c.x-d;var i=c.m_sweep.c.y+h-b.m_sweep.c.y-e;a=Math.sqrt(f*f+i*i),f/=a,i/=a,a-=this.m_length,a=b2Math.Clamp(a,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var j=-this.m_mass*a;return this.m_u.Set(f,i),f=j*this.m_u.x,i=j*this.m_u.y,b.m_sweep.c.x-=b.m_invMass*f,b.m_sweep.c.y-=b.m_invMass*i,b.m_sweep.a-=b.m_invI*(d*i-e*f),c.m_sweep.c.x+=c.m_invMass*f,c.m_sweep.c.y+=c.m_invMass*i,c.m_sweep.a+=c.m_invI*(g*i-h*f),b.SynchronizeTransform(),c.SynchronizeTransform(),b2Math.Abs(a)<b2Settings.b2_linearSlop},b2DistanceJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2DistanceJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2DistanceJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)},b2DistanceJoint.prototype.GetReactionTorque=function(){return 0},b2DistanceJoint.prototype.GetLength=function(){return this.m_length},b2DistanceJoint.prototype.SetLength=function(a){this.m_length=a},b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},b2DistanceJoint.prototype.SetFrequency=function(a){this.m_frequencyHz=a},b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b2DistanceJoint.prototype.SetDampingRatio=function(a){this.m_dampingRatio=a},b2DistanceJoint.prototype.m_localAnchor1=new b2Vec2,b2DistanceJoint.prototype.m_localAnchor2=new b2Vec2,b2DistanceJoint.prototype.m_u=new b2Vec2,b2DistanceJoint.prototype.m_frequencyHz=null,b2DistanceJoint.prototype.m_dampingRatio=null,b2DistanceJoint.prototype.m_gamma=null,b2DistanceJoint.prototype.m_bias=null,b2DistanceJoint.prototype.m_impulse=null,b2DistanceJoint.prototype.m_mass=null,b2DistanceJoint.prototype.m_length=null;var b2PulleyJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PulleyJointDef.prototype,b2JointDef.prototype),b2PulleyJointDef.prototype._super=b2JointDef.prototype,b2PulleyJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0,this.ratio=1,this.collideConnected=!0},b2PulleyJointDef.prototype.__varz=function(){this.groundAnchorA=new b2Vec2,this.groundAnchorB=new b2Vec2,this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2PulleyJointDef.prototype.Initialize=function(a,b,c,d,e,f,g){this.bodyA=a,this.bodyB=b,this.groundAnchorA.SetV(c),this.groundAnchorB.SetV(d),this.localAnchorA=this.bodyA.GetLocalPoint(e),this.localAnchorB=this.bodyB.GetLocalPoint(f),a=e.x-c.x,c=e.y-c.y,this.lengthA=Math.sqrt(a*a+c*c),c=f.x-d.x,d=f.y-d.y,this.lengthB=Math.sqrt(c*c+d*d),this.ratio=g,g=this.lengthA+this.ratio*this.lengthB,this.maxLengthA=g-this.ratio*b2PulleyJoint.b2_minPulleyLength,this.maxLengthB=(g-b2PulleyJoint.b2_minPulleyLength)/this.ratio},b2PulleyJointDef.prototype.groundAnchorA=new b2Vec2,b2PulleyJointDef.prototype.groundAnchorB=new b2Vec2,b2PulleyJointDef.prototype.localAnchorA=new b2Vec2,b2PulleyJointDef.prototype.localAnchorB=new b2Vec2,b2PulleyJointDef.prototype.lengthA=null,b2PulleyJointDef.prototype.maxLengthA=null,b2PulleyJointDef.prototype.lengthB=null,b2PulleyJointDef.prototype.maxLengthB=null,b2PulleyJointDef.prototype.ratio=null;var b2DistanceJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2DistanceJointDef.prototype,b2JointDef.prototype),b2DistanceJointDef.prototype._super=b2JointDef.prototype,b2DistanceJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_distanceJoint,this.length=1,this.dampingRatio=this.frequencyHz=0},b2DistanceJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2DistanceJointDef.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d)),a=d.x-c.x,c=d.y-c.y,this.length=Math.sqrt(a*a+c*c),this.dampingRatio=this.frequencyHz=0},b2DistanceJointDef.prototype.localAnchorA=new b2Vec2,b2DistanceJointDef.prototype.localAnchorB=new b2Vec2,b2DistanceJointDef.prototype.length=null,b2DistanceJointDef.prototype.frequencyHz=null,b2DistanceJointDef.prototype.dampingRatio=null;var b2FrictionJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2FrictionJointDef.prototype,b2JointDef.prototype),b2FrictionJointDef.prototype._super=b2JointDef.prototype,b2FrictionJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_frictionJoint,this.maxTorque=this.maxForce=0},b2FrictionJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2FrictionJointDef.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c))},b2FrictionJointDef.prototype.localAnchorA=new b2Vec2,b2FrictionJointDef.prototype.localAnchorB=new b2Vec2,b2FrictionJointDef.prototype.maxForce=null,b2FrictionJointDef.prototype.maxTorque=null;var b2WeldJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2WeldJointDef.prototype,b2JointDef.prototype),b2WeldJointDef.prototype._super=b2JointDef.prototype,b2WeldJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_weldJoint,this.referenceAngle=0},b2WeldJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2WeldJointDef.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2WeldJointDef.prototype.localAnchorA=new b2Vec2,b2WeldJointDef.prototype.localAnchorB=new b2Vec2,b2WeldJointDef.prototype.referenceAngle=null;var b2GearJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GearJointDef.prototype,b2JointDef.prototype),b2GearJointDef.prototype._super=b2JointDef.prototype,b2GearJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_gearJoint,this.joint2=this.joint1=null,this.ratio=1},b2GearJointDef.prototype.__varz=function(){},b2GearJointDef.prototype.joint1=null,b2GearJointDef.prototype.joint2=null,b2GearJointDef.prototype.ratio=null;var b2Color=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Color.prototype.__constructor=function(a,b,c){this._r=parseInt(255*b2Math.Clamp(a,0,1)),this._g=parseInt(255*b2Math.Clamp(b,0,1)),this._b=parseInt(255*b2Math.Clamp(c,0,1))},b2Color.prototype.__varz=function(){},b2Color.prototype.Set=function(a,b,c){this._r=parseInt(255*b2Math.Clamp(a,0,1)),this._g=parseInt(255*b2Math.Clamp(b,0,1)),this._b=parseInt(255*b2Math.Clamp(c,0,1))},b2Color.prototype.__defineGetter__("r",function(){return this._r}),b2Color.prototype.__defineSetter__("r",function(a){this._r=parseInt(255*b2Math.Clamp(a,0,1))}),b2Color.prototype.__defineGetter__("g",function(){return this._g}),b2Color.prototype.__defineSetter__("g",function(a){this._g=parseInt(255*b2Math.Clamp(a,0,1))}),b2Color.prototype.__defineGetter__("b",function(){return this._b}),b2Color.prototype.__defineSetter__("b",function(a){this._b=parseInt(255*b2Math.Clamp(a,0,1))}),b2Color.prototype.__defineGetter__("color",function(){return this._r<<16|this._g<<8|this._b}),b2Color.prototype._r=0,b2Color.prototype._g=0,b2Color.prototype._b=0;var b2FrictionJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2FrictionJoint.prototype,b2Joint.prototype),b2FrictionJoint.prototype._super=b2Joint.prototype,b2FrictionJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=a.maxForce,this.m_maxTorque=a.maxTorque},b2FrictionJoint.prototype.__varz=function(){this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_linearImpulse=new b2Vec2,this.m_linearMass=new b2Mat22},b2FrictionJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c,b=d.m_invMass,c=e.m_invMass;var j=d.m_invI,k=e.m_invI,l=new b2Mat22;l.col1.x=b+c,l.col2.x=0,l.col1.y=0,l.col2.y=b+c,l.col1.x+=j*g*g,l.col2.x+=-j*f*g,l.col1.y+=-j*f*g,l.col2.y+=j*f*f,l.col1.x+=k*i*i,l.col2.x+=-k*h*i,l.col1.y+=-k*h*i,l.col2.y+=k*h*h,l.GetInverse(this.m_linearMass),this.m_angularMass=j+k,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),a.warmStarting?(this.m_linearImpulse.x*=a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio,a=this.m_linearImpulse,d.m_linearVelocity.x-=b*a.x,d.m_linearVelocity.y-=b*a.y,d.m_angularVelocity-=j*(f*a.y-g*a.x+this.m_angularImpulse),e.m_linearVelocity.x+=c*a.x,e.m_linearVelocity.y+=c*a.y,e.m_angularVelocity+=k*(h*a.y-i*a.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},b2FrictionJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB,f=d.m_linearVelocity,g=d.m_angularVelocity,h=e.m_linearVelocity,i=e.m_angularVelocity,j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;
b=d.m_xf.R;var n=this.m_localAnchorA.x-d.m_sweep.localCenter.x,o=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*n+b.col2.x*o,o=b.col1.y*n+b.col2.y*o,n=c,b=e.m_xf.R;var p=this.m_localAnchorB.x-e.m_sweep.localCenter.x,q=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*p+b.col2.x*q,q=b.col1.y*p+b.col2.y*q,p=c,c=-this.m_angularMass*(i-g);var r=this.m_angularImpulse;b=a.dt*this.m_maxTorque,this.m_angularImpulse=b2Math.Clamp(this.m_angularImpulse+c,-b,b),c=this.m_angularImpulse-r,g-=l*c,i+=m*c,b=b2Math.MulMV(this.m_linearMass,new b2Vec2(-(h.x-i*q-f.x+g*o),-(h.y+i*p-f.y-g*n))),c=this.m_linearImpulse.Copy(),this.m_linearImpulse.Add(b),b=a.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(b)),b=b2Math.SubtractVV(this.m_linearImpulse,c),f.x-=j*b.x,f.y-=j*b.y,g-=l*(n*b.y-o*b.x),h.x+=k*b.x,h.y+=k*b.y,i+=m*(p*b.y-q*b.x),d.m_angularVelocity=g,e.m_angularVelocity=i},b2FrictionJoint.prototype.SolvePositionConstraints=function(){return!0},b2FrictionJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},b2FrictionJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},b2FrictionJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_linearImpulse.x,a*this.m_linearImpulse.y)},b2FrictionJoint.prototype.GetReactionTorque=function(a){return a*this.m_angularImpulse},b2FrictionJoint.prototype.SetMaxForce=function(a){this.m_maxForce=a},b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},b2FrictionJoint.prototype.SetMaxTorque=function(a){this.m_maxTorque=a},b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},b2FrictionJoint.prototype.m_localAnchorA=new b2Vec2,b2FrictionJoint.prototype.m_localAnchorB=new b2Vec2,b2FrictionJoint.prototype.m_linearImpulse=new b2Vec2,b2FrictionJoint.prototype.m_angularImpulse=null,b2FrictionJoint.prototype.m_maxForce=null,b2FrictionJoint.prototype.m_maxTorque=null,b2FrictionJoint.prototype.m_linearMass=new b2Mat22,b2FrictionJoint.prototype.m_angularMass=null;var b2Distance=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Distance.prototype.__constructor=function(){},b2Distance.prototype.__varz=function(){},b2Distance.Distance=function(a,b,c){++b2Distance.b2_gjkCalls;var d=c.proxyA,e=c.proxyB,f=c.transformA,g=c.transformB,h=b2Distance.s_simplex;h.ReadCache(b,d,f,e,g);var i=h.m_vertices,j=b2Distance.s_saveA,k=b2Distance.s_saveB,l=0;h.GetClosestPoint().LengthSquared();for(var m,n=0,o=0;20>o;){for(l=h.m_count,n=0;l>n;n++)j[n]=i[n].indexA,k[n]=i[n].indexB;switch(h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3();break;default:b2Settings.b2Assert(!1)}if(3==h.m_count)break;if(m=h.GetClosestPoint(),m.LengthSquared(),n=h.GetSearchDirection(),n.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;m=i[h.m_count],m.indexA=d.GetSupport(b2Math.MulTMV(f.R,n.GetNegative())),m.wA=b2Math.MulX(f,d.GetVertex(m.indexA)),m.indexB=e.GetSupport(b2Math.MulTMV(g.R,n)),m.wB=b2Math.MulX(g,e.GetVertex(m.indexB)),m.w=b2Math.SubtractVV(m.wB,m.wA),++o,++b2Distance.b2_gjkIters;var p=!1;for(n=0;l>n;n++)if(m.indexA==j[n]&&m.indexB==k[n]){p=!0;break}if(p)break;++h.m_count}b2Distance.b2_gjkMaxIters=b2Math.Max(b2Distance.b2_gjkMaxIters,o),h.GetWitnessPoints(a.pointA,a.pointB),a.distance=b2Math.SubtractVV(a.pointA,a.pointB).Length(),a.iterations=o,h.WriteCache(b),c.useRadii&&(b=d.m_radius,e=e.m_radius,a.distance>b+e&&a.distance>Number.MIN_VALUE?(a.distance-=b+e,c=b2Math.SubtractVV(a.pointB,a.pointA),c.Normalize(),a.pointA.x+=b*c.x,a.pointA.y+=b*c.y,a.pointB.x-=e*c.x,a.pointB.y-=e*c.y):(m=new b2Vec2,m.x=.5*(a.pointA.x+a.pointB.x),m.y=.5*(a.pointA.y+a.pointB.y),a.pointA.x=a.pointB.x=m.x,a.pointA.y=a.pointB.y=m.y,a.distance=0))},b2Distance.b2_gjkCalls=0,b2Distance.b2_gjkIters=0,b2Distance.b2_gjkMaxIters=0,b2Distance.s_simplex=new b2Simplex,b2Distance.s_saveA=Array(3),b2Distance.s_saveB=Array(3);var b2MouseJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2MouseJoint.prototype,b2Joint.prototype),b2MouseJoint.prototype._super=b2Joint.prototype,b2MouseJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_target.SetV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,c=this.m_target.y-this.m_bodyB.m_xf.position.y,d=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*d.col1.x+c*d.col1.y,this.m_localAnchor.y=b*d.col2.x+c*d.col2.y,this.m_maxForce=a.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio,this.m_gamma=this.m_beta=0},b2MouseJoint.prototype.__varz=function(){this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.m_localAnchor=new b2Vec2,this.m_target=new b2Vec2,this.m_impulse=new b2Vec2,this.m_mass=new b2Mat22,this.m_C=new b2Vec2},b2MouseJoint.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyB,c=b.GetMass(),d=2*Math.PI*this.m_frequencyHz,e=c*d*d;this.m_gamma=a.dt*(2*c*this.m_dampingRatio*d+a.dt*e),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=a.dt*e*this.m_gamma,e=b.m_xf.R,c=this.m_localAnchor.x-b.m_sweep.localCenter.x,d=this.m_localAnchor.y-b.m_sweep.localCenter.y;var f=e.col1.x*c+e.col2.x*d;d=e.col1.y*c+e.col2.y*d,c=f,e=b.m_invMass,f=b.m_invI,this.K1.col1.x=e,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=e,this.K2.col1.x=f*d*d,this.K2.col2.x=-f*c*d,this.K2.col1.y=-f*c*d,this.K2.col2.y=f*c*c,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=b.m_sweep.c.x+c-this.m_target.x,this.m_C.y=b.m_sweep.c.y+d-this.m_target.y,b.m_angularVelocity*=.98,this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,b.m_linearVelocity.x+=e*this.m_impulse.x,b.m_linearVelocity.y+=e*this.m_impulse.y,b.m_angularVelocity+=f*(c*this.m_impulse.y-d*this.m_impulse.x)},b2MouseJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d,e=this.m_bodyB;b=e.m_xf.R;var f=this.m_localAnchor.x-e.m_sweep.localCenter.x,g=this.m_localAnchor.y-e.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,c=e.m_linearVelocity.x+-e.m_angularVelocity*g;var h=e.m_linearVelocity.y+e.m_angularVelocity*f;b=this.m_mass,c=c+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,d=h+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y,h=-(b.col1.x*c+b.col2.x*d),d=-(b.col1.y*c+b.col2.y*d),b=this.m_impulse.x,c=this.m_impulse.y,this.m_impulse.x+=h,this.m_impulse.y+=d,a=a.dt*this.m_maxForce,this.m_impulse.LengthSquared()>a*a&&this.m_impulse.Multiply(a/this.m_impulse.Length()),h=this.m_impulse.x-b,d=this.m_impulse.y-c,e.m_linearVelocity.x+=e.m_invMass*h,e.m_linearVelocity.y+=e.m_invMass*d,e.m_angularVelocity+=e.m_invI*(f*d-g*h)},b2MouseJoint.prototype.SolvePositionConstraints=function(){return!0},b2MouseJoint.prototype.GetAnchorA=function(){return this.m_target},b2MouseJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},b2MouseJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse.x,a*this.m_impulse.y)},b2MouseJoint.prototype.GetReactionTorque=function(){return 0},b2MouseJoint.prototype.GetTarget=function(){return this.m_target},b2MouseJoint.prototype.SetTarget=function(a){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=a},b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce},b2MouseJoint.prototype.SetMaxForce=function(a){this.m_maxForce=a},b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},b2MouseJoint.prototype.SetFrequency=function(a){this.m_frequencyHz=a},b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b2MouseJoint.prototype.SetDampingRatio=function(a){this.m_dampingRatio=a},b2MouseJoint.prototype.K=new b2Mat22,b2MouseJoint.prototype.K1=new b2Mat22,b2MouseJoint.prototype.K2=new b2Mat22,b2MouseJoint.prototype.m_localAnchor=new b2Vec2,b2MouseJoint.prototype.m_target=new b2Vec2,b2MouseJoint.prototype.m_impulse=new b2Vec2,b2MouseJoint.prototype.m_mass=new b2Mat22,b2MouseJoint.prototype.m_C=new b2Vec2,b2MouseJoint.prototype.m_maxForce=null,b2MouseJoint.prototype.m_frequencyHz=null,b2MouseJoint.prototype.m_dampingRatio=null,b2MouseJoint.prototype.m_beta=null,b2MouseJoint.prototype.m_gamma=null;var b2PrismaticJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PrismaticJointDef.prototype,b2JointDef.prototype),b2PrismaticJointDef.prototype._super=b2JointDef.prototype,b2PrismaticJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},b2PrismaticJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.localAxisA=new b2Vec2},b2PrismaticJointDef.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2PrismaticJointDef.prototype.localAnchorA=new b2Vec2,b2PrismaticJointDef.prototype.localAnchorB=new b2Vec2,b2PrismaticJointDef.prototype.localAxisA=new b2Vec2,b2PrismaticJointDef.prototype.referenceAngle=null,b2PrismaticJointDef.prototype.enableLimit=null,b2PrismaticJointDef.prototype.lowerTranslation=null,b2PrismaticJointDef.prototype.upperTranslation=null,b2PrismaticJointDef.prototype.enableMotor=null,b2PrismaticJointDef.prototype.maxMotorForce=null,b2PrismaticJointDef.prototype.motorSpeed=null;var b2TimeOfImpact=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TimeOfImpact.prototype.__constructor=function(){},b2TimeOfImpact.prototype.__varz=function(){},b2TimeOfImpact.TimeOfImpact=function(a){++b2TimeOfImpact.b2_toiCalls;var b=a.proxyA,c=a.proxyB,d=a.sweepA,e=a.sweepB;b2Settings.b2Assert(d.t0==e.t0),b2Settings.b2Assert(1-d.t0>Number.MIN_VALUE);var f=b.m_radius+c.m_radius;a=a.tolerance;var g=0,h=0,i=0;for(b2TimeOfImpact.s_cache.count=0,b2TimeOfImpact.s_distanceInput.useRadii=!1;;){if(d.GetTransform(b2TimeOfImpact.s_xfA,g),e.GetTransform(b2TimeOfImpact.s_xfB,g),b2TimeOfImpact.s_distanceInput.proxyA=b,b2TimeOfImpact.s_distanceInput.proxyB=c,b2TimeOfImpact.s_distanceInput.transformA=b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_distanceInput.transformB=b2TimeOfImpact.s_xfB,b2Distance.Distance(b2TimeOfImpact.s_distanceOutput,b2TimeOfImpact.s_cache,b2TimeOfImpact.s_distanceInput),b2TimeOfImpact.s_distanceOutput.distance<=0){g=1;break}b2TimeOfImpact.s_fcn.Initialize(b2TimeOfImpact.s_cache,b,b2TimeOfImpact.s_xfA,c,b2TimeOfImpact.s_xfB);var j=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(0>=j){g=1;break}if(0==h&&(i=j>f?b2Math.Max(f-a,.75*f):b2Math.Max(j-a,.02*f)),.5*a>j-i){if(0==h){g=1;break}break}var k=g,l=g,m=1;j=j,d.GetTransform(b2TimeOfImpact.s_xfA,m),e.GetTransform(b2TimeOfImpact.s_xfB,m);var n=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(n>=i){g=1;break}for(var o=0;;){var p;p=1&o?l+(i-j)*(m-l)/(n-j):.5*(l+m),d.GetTransform(b2TimeOfImpact.s_xfA,p),e.GetTransform(b2TimeOfImpact.s_xfB,p);var q=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(b2Math.Abs(q-i)<.025*a){k=p;break}if(q>i?(l=p,j=q):(m=p,n=q),++o,++b2TimeOfImpact.b2_toiRootIters,50==o)break}if(b2TimeOfImpact.b2_toiMaxRootIters=b2Math.Max(b2TimeOfImpact.b2_toiMaxRootIters,o),k<(1+100*Number.MIN_VALUE)*g)break;if(g=k,h++,++b2TimeOfImpact.b2_toiIters,1e3==h)break}return b2TimeOfImpact.b2_toiMaxIters=b2Math.Max(b2TimeOfImpact.b2_toiMaxIters,h),g},b2TimeOfImpact.b2_toiCalls=0,b2TimeOfImpact.b2_toiIters=0,b2TimeOfImpact.b2_toiMaxIters=0,b2TimeOfImpact.b2_toiRootIters=0,b2TimeOfImpact.b2_toiMaxRootIters=0,b2TimeOfImpact.s_cache=new b2SimplexCache,b2TimeOfImpact.s_distanceInput=new b2DistanceInput,b2TimeOfImpact.s_xfA=new b2Transform,b2TimeOfImpact.s_xfB=new b2Transform,b2TimeOfImpact.s_fcn=new b2SeparationFunction,b2TimeOfImpact.s_distanceOutput=new b2DistanceOutput;var b2GearJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GearJoint.prototype,b2Joint.prototype),b2GearJoint.prototype._super=b2Joint.prototype,b2GearJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]);var b=a.joint1.m_type,c=a.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null,this.m_ground1=a.joint1.GetBodyA(),this.m_bodyA=a.joint1.GetBodyB(),b==b2Joint.e_revoluteJoint?(this.m_revolute1=a.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),b=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),b=this.m_prismatic1.GetJointTranslation()),this.m_ground2=a.joint2.GetBodyA(),this.m_bodyB=a.joint2.GetBodyB(),c==b2Joint.e_revoluteJoint?(this.m_revolute2=a.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),c=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),c=this.m_prismatic2.GetJointTranslation()),this.m_ratio=a.ratio,this.m_constant=b+this.m_ratio*c,this.m_impulse=0},b2GearJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_J=new b2Jacobian},b2GearJoint.prototype.InitVelocityConstraints=function(a){var b,c,d,e,f,g=this.m_ground1,h=this.m_ground2,i=this.m_bodyA,j=this.m_bodyB,k=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,k+=i.m_invI):(e=g.m_xf.R,b=this.m_prismatic1.m_localXAxis1,g=e.col1.x*b.x+e.col2.x*b.y,b=e.col1.y*b.x+e.col2.y*b.y,e=i.m_xf.R,c=this.m_localAnchor1.x-i.m_sweep.localCenter.x,d=this.m_localAnchor1.y-i.m_sweep.localCenter.y,f=e.col1.x*c+e.col2.x*d,d=e.col1.y*c+e.col2.y*d,c=f,e=c*b-d*g,this.m_J.linearA.Set(-g,-b),this.m_J.angularA=-e,k+=i.m_invMass+i.m_invI*e*e),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,k+=this.m_ratio*this.m_ratio*j.m_invI):(e=h.m_xf.R,b=this.m_prismatic2.m_localXAxis1,g=e.col1.x*b.x+e.col2.x*b.y,b=e.col1.y*b.x+e.col2.y*b.y,e=j.m_xf.R,c=this.m_localAnchor2.x-j.m_sweep.localCenter.x,d=this.m_localAnchor2.y-j.m_sweep.localCenter.y,f=e.col1.x*c+e.col2.x*d,d=e.col1.y*c+e.col2.y*d,c=f,e=c*b-d*g,this.m_J.linearB.Set(-this.m_ratio*g,-this.m_ratio*b),this.m_J.angularB=-this.m_ratio*e,k+=this.m_ratio*this.m_ratio*(j.m_invMass+j.m_invI*e*e)),this.m_mass=k>0?1/k:0,a.warmStarting?(i.m_linearVelocity.x+=i.m_invMass*this.m_impulse*this.m_J.linearA.x,i.m_linearVelocity.y+=i.m_invMass*this.m_impulse*this.m_J.linearA.y,i.m_angularVelocity+=i.m_invI*this.m_impulse*this.m_J.angularA,j.m_linearVelocity.x+=j.m_invMass*this.m_impulse*this.m_J.linearB.x,j.m_linearVelocity.y+=j.m_invMass*this.m_impulse*this.m_J.linearB.y,j.m_angularVelocity+=j.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},b2GearJoint.prototype.SolveVelocityConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,c=-this.m_mass*this.m_J.Compute(a.m_linearVelocity,a.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity);this.m_impulse+=c,a.m_linearVelocity.x+=a.m_invMass*c*this.m_J.linearA.x,a.m_linearVelocity.y+=a.m_invMass*c*this.m_J.linearA.y,a.m_angularVelocity+=a.m_invI*c*this.m_J.angularA,b.m_linearVelocity.x+=b.m_invMass*c*this.m_J.linearB.x,b.m_linearVelocity.y+=b.m_invMass*c*this.m_J.linearB.y,b.m_angularVelocity+=b.m_invI*c*this.m_J.angularB},b2GearJoint.prototype.SolvePositionConstraints=function(){var a,b,c=this.m_bodyA,d=this.m_bodyB;return a=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),b=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),a=-this.m_mass*(this.m_constant-(a+this.m_ratio*b)),c.m_sweep.c.x+=c.m_invMass*a*this.m_J.linearA.x,c.m_sweep.c.y+=c.m_invMass*a*this.m_J.linearA.y,c.m_sweep.a+=c.m_invI*a*this.m_J.angularA,d.m_sweep.c.x+=d.m_invMass*a*this.m_J.linearB.x,d.m_sweep.c.y+=d.m_invMass*a*this.m_J.linearB.y,d.m_sweep.a+=d.m_invI*a*this.m_J.angularB,c.SynchronizeTransform(),d.SynchronizeTransform(),0<b2Settings.b2_linearSlop},b2GearJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2GearJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2GearJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)},b2GearJoint.prototype.GetReactionTorque=function(a){var b=this.m_bodyB.m_xf.R,c=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,d=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,e=b.col1.x*c+b.col2.x*d;return d=b.col1.y*c+b.col2.y*d,c=e,a*(this.m_impulse*this.m_J.angularB-c*this.m_impulse*this.m_J.linearB.y+d*this.m_impulse*this.m_J.linearB.x)},b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},b2GearJoint.prototype.SetRatio=function(a){this.m_ratio=a},b2GearJoint.prototype.m_ground1=null,b2GearJoint.prototype.m_ground2=null,b2GearJoint.prototype.m_revolute1=null,b2GearJoint.prototype.m_prismatic1=null,b2GearJoint.prototype.m_revolute2=null,b2GearJoint.prototype.m_prismatic2=null,b2GearJoint.prototype.m_groundAnchor1=new b2Vec2,b2GearJoint.prototype.m_groundAnchor2=new b2Vec2,b2GearJoint.prototype.m_localAnchor1=new b2Vec2,b2GearJoint.prototype.m_localAnchor2=new b2Vec2,b2GearJoint.prototype.m_J=new b2Jacobian,b2GearJoint.prototype.m_constant=null,b2GearJoint.prototype.m_ratio=null,b2GearJoint.prototype.m_mass=null,b2GearJoint.prototype.m_impulse=null;var b2TOIInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TOIInput.prototype.__constructor=function(){},b2TOIInput.prototype.__varz=function(){this.proxyA=new b2DistanceProxy,this.proxyB=new b2DistanceProxy,this.sweepA=new b2Sweep,this.sweepB=new b2Sweep},b2TOIInput.prototype.proxyA=new b2DistanceProxy,b2TOIInput.prototype.proxyB=new b2DistanceProxy,b2TOIInput.prototype.sweepA=new b2Sweep,b2TOIInput.prototype.sweepB=new b2Sweep,b2TOIInput.prototype.tolerance=null;var b2RevoluteJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2RevoluteJointDef.prototype,b2JointDef.prototype),b2RevoluteJointDef.prototype._super=b2JointDef.prototype,b2RevoluteJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0,this.enableMotor=this.enableLimit=!1},b2RevoluteJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2RevoluteJointDef.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2RevoluteJointDef.prototype.localAnchorA=new b2Vec2,b2RevoluteJointDef.prototype.localAnchorB=new b2Vec2,b2RevoluteJointDef.prototype.referenceAngle=null,b2RevoluteJointDef.prototype.enableLimit=null,b2RevoluteJointDef.prototype.lowerAngle=null,b2RevoluteJointDef.prototype.upperAngle=null,b2RevoluteJointDef.prototype.enableMotor=null,b2RevoluteJointDef.prototype.motorSpeed=null,b2RevoluteJointDef.prototype.maxMotorTorque=null;var b2MouseJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2MouseJointDef.prototype,b2JointDef.prototype),b2MouseJointDef.prototype._super=b2JointDef.prototype,b2MouseJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},b2MouseJointDef.prototype.__varz=function(){this.target=new b2Vec2},b2MouseJointDef.prototype.target=new b2Vec2,b2MouseJointDef.prototype.maxForce=null,b2MouseJointDef.prototype.frequencyHz=null,b2MouseJointDef.prototype.dampingRatio=null;var b2Contact=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Contact.prototype.__constructor=function(){},b2Contact.prototype.__varz=function(){this.m_nodeA=new b2ContactEdge,this.m_nodeB=new b2ContactEdge,this.m_manifold=new b2Manifold,this.m_oldManifold=new b2Manifold},b2Contact.s_input=new b2TOIInput,b2Contact.e_sensorFlag=1,b2Contact.e_continuousFlag=2,b2Contact.e_islandFlag=4,b2Contact.e_toiFlag=8,b2Contact.e_touchingFlag=16,b2Contact.e_enabledFlag=32,b2Contact.e_filterFlag=64,b2Contact.prototype.Reset=function(a,b){if(this.m_flags=b2Contact.e_enabledFlag,a&&b){(a.IsSensor()||b.IsSensor())&&(this.m_flags|=b2Contact.e_sensorFlag);var c=a.GetBody(),d=b.GetBody();(c.GetType()!=b2Body.b2_dynamicBody||c.IsBullet()||d.GetType()!=b2Body.b2_dynamicBody||d.IsBullet())&&(this.m_flags|=b2Contact.e_continuousFlag),this.m_fixtureA=a,this.m_fixtureB=b,this.m_manifold.m_pointCount=0,this.m_next=this.m_prev=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null}else this.m_fixtureB=this.m_fixtureA=null},b2Contact.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=b,this.m_flags|=b2Contact.e_enabledFlag;var c=!1;b=(this.m_flags&b2Contact.e_touchingFlag)==b2Contact.e_touchingFlag;var d=this.m_fixtureA.m_body,e=this.m_fixtureB.m_body,f=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&b2Contact.e_sensorFlag)f&&(c=this.m_fixtureA.GetShape(),f=this.m_fixtureB.GetShape(),d=d.GetTransform(),e=e.GetTransform(),c=b2Shape.TestOverlap(c,d,f,e)),this.m_manifold.m_pointCount=0;else{if(d.GetType()!=b2Body.b2_dynamicBody||d.IsBullet()||e.GetType()!=b2Body.b2_dynamicBody||e.IsBullet()?this.m_flags|=b2Contact.e_continuousFlag:this.m_flags&=~b2Contact.e_continuousFlag,f)for(this.Evaluate(),c=this.m_manifold.m_pointCount>0,f=0;f<this.m_manifold.m_pointCount;++f){var g=this.m_manifold.m_points[f];g.m_normalImpulse=0,g.m_tangentImpulse=0;for(var h=g.m_id,i=0;i<this.m_oldManifold.m_pointCount;++i){var j=this.m_oldManifold.m_points[i];if(j.m_id.key==h.key){g.m_normalImpulse=j.m_normalImpulse,g.m_tangentImpulse=j.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;c!=b&&(d.SetAwake(!0),e.SetAwake(!0))}c?this.m_flags|=b2Contact.e_touchingFlag:this.m_flags&=~b2Contact.e_touchingFlag,0==b&&1==c&&a.BeginContact(this),1==b&&0==c&&a.EndContact(this),0==(this.m_flags&b2Contact.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)},b2Contact.prototype.Evaluate=function(){},b2Contact.prototype.ComputeTOI=function(a,b){return b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape()),b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape()),b2Contact.s_input.sweepA=a,b2Contact.s_input.sweepB=b,b2Contact.s_input.tolerance=b2Settings.b2_linearSlop,b2TimeOfImpact.TimeOfImpact(b2Contact.s_input)},b2Contact.prototype.GetManifold=function(){return this.m_manifold},b2Contact.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},b2Contact.prototype.IsTouching=function(){return(this.m_flags&b2Contact.e_touchingFlag)==b2Contact.e_touchingFlag},b2Contact.prototype.IsContinuous=function(){return(this.m_flags&b2Contact.e_continuousFlag)==b2Contact.e_continuousFlag},b2Contact.prototype.SetSensor=function(a){a?this.m_flags|=b2Contact.e_sensorFlag:this.m_flags&=~b2Contact.e_sensorFlag},b2Contact.prototype.IsSensor=function(){return(this.m_flags&b2Contact.e_sensorFlag)==b2Contact.e_sensorFlag},b2Contact.prototype.SetEnabled=function(a){a?this.m_flags|=b2Contact.e_enabledFlag:this.m_flags&=~b2Contact.e_enabledFlag},b2Contact.prototype.IsEnabled=function(){return(this.m_flags&b2Contact.e_enabledFlag)==b2Contact.e_enabledFlag},b2Contact.prototype.GetNext=function(){return this.m_next},b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},b2Contact.prototype.FlagForFiltering=function(){this.m_flags|=b2Contact.e_filterFlag},b2Contact.prototype.m_flags=0,b2Contact.prototype.m_prev=null,b2Contact.prototype.m_next=null,b2Contact.prototype.m_nodeA=new b2ContactEdge,b2Contact.prototype.m_nodeB=new b2ContactEdge,b2Contact.prototype.m_fixtureA=null,b2Contact.prototype.m_fixtureB=null,b2Contact.prototype.m_manifold=new b2Manifold,b2Contact.prototype.m_oldManifold=new b2Manifold,b2Contact.prototype.m_toi=null;var b2ContactConstraint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactConstraint.prototype.__constructor=function(){this.points=Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.points[a]=new b2ContactConstraintPoint},b2ContactConstraint.prototype.__varz=function(){this.localPlaneNormal=new b2Vec2,this.localPoint=new b2Vec2,this.normal=new b2Vec2,this.normalMass=new b2Mat22,this.K=new b2Mat22},b2ContactConstraint.prototype.points=null,b2ContactConstraint.prototype.localPlaneNormal=new b2Vec2,b2ContactConstraint.prototype.localPoint=new b2Vec2,b2ContactConstraint.prototype.normal=new b2Vec2,b2ContactConstraint.prototype.normalMass=new b2Mat22,b2ContactConstraint.prototype.K=new b2Mat22,b2ContactConstraint.prototype.bodyA=null,b2ContactConstraint.prototype.bodyB=null,b2ContactConstraint.prototype.type=0,b2ContactConstraint.prototype.radius=null,b2ContactConstraint.prototype.friction=null,b2ContactConstraint.prototype.restitution=null,b2ContactConstraint.prototype.pointCount=0,b2ContactConstraint.prototype.manifold=null;var b2ContactResult=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactResult.prototype.__constructor=function(){},b2ContactResult.prototype.__varz=function(){this.position=new b2Vec2,this.normal=new b2Vec2,this.id=new b2ContactID},b2ContactResult.prototype.shape1=null,b2ContactResult.prototype.shape2=null,b2ContactResult.prototype.position=new b2Vec2,b2ContactResult.prototype.normal=new b2Vec2,b2ContactResult.prototype.normalImpulse=null,b2ContactResult.prototype.tangentImpulse=null,b2ContactResult.prototype.id=new b2ContactID;var b2PolygonContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolygonContact.prototype,b2Contact.prototype),b2PolygonContact.prototype._super=b2Contact.prototype,b2PolygonContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolygonContact.prototype.__varz=function(){},b2PolygonContact.Create=function(){return new b2PolygonContact},b2PolygonContact.Destroy=function(){},b2PolygonContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();b2Collision.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2PolygonContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b])};var ClipVertex=function(){this.__varz(),this.__constructor.apply(this,arguments)};ClipVertex.prototype.__constructor=function(){},ClipVertex.prototype.__varz=function(){this.v=new b2Vec2,this.id=new b2ContactID},ClipVertex.prototype.Set=function(a){this.v.SetV(a.v),this.id.Set(a.id)},ClipVertex.prototype.v=new b2Vec2,ClipVertex.prototype.id=new b2ContactID;var b2ContactFilter=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactFilter.prototype.__constructor=function(){},b2ContactFilter.prototype.__varz=function(){},b2ContactFilter.b2_defaultFilter=new b2ContactFilter,b2ContactFilter.prototype.ShouldCollide=function(a,b){var c=a.GetFilterData(),d=b.GetFilterData();return c.groupIndex==d.groupIndex&&0!=c.groupIndex?c.groupIndex>0:0!=(c.maskBits&d.categoryBits)&&0!=(c.categoryBits&d.maskBits)},b2ContactFilter.prototype.RayCollide=function(a,b){return a?this.ShouldCollide(a,b):!0};var b2NullContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2NullContact.prototype,b2Contact.prototype),b2NullContact.prototype._super=b2Contact.prototype,b2NullContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2NullContact.prototype.__varz=function(){},b2NullContact.prototype.Evaluate=function(){};var b2ContactListener=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactListener.prototype.__constructor=function(){},b2ContactListener.prototype.__varz=function(){},b2ContactListener.b2_defaultListener=new b2ContactListener,b2ContactListener.prototype.BeginContact=function(){},b2ContactListener.prototype.EndContact=function(){},b2ContactListener.prototype.PreSolve=function(){},b2ContactListener.prototype.PostSolve=function(){};var b2Island=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Island.prototype.__constructor=function(){this.m_bodies=[],this.m_contacts=[],this.m_joints=[]},b2Island.prototype.__varz=function(){},b2Island.s_impulse=new b2ContactImpulse,b2Island.prototype.Initialize=function(a,b,c,d,e,f){var g=0;for(this.m_bodyCapacity=a,this.m_contactCapacity=b,this.m_jointCapacity=c,this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,this.m_allocator=d,this.m_listener=e,this.m_contactSolver=f,g=this.m_bodies.length;a>g;g++)this.m_bodies[g]=null;for(g=this.m_contacts.length;b>g;g++)this.m_contacts[g]=null;for(g=this.m_joints.length;c>g;g++)this.m_joints[g]=null},b2Island.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0},b2Island.prototype.Solve=function(a,b,c){var d,e=0,f=0;for(e=0;e<this.m_bodyCount;++e)f=this.m_bodies[e],f.GetType()==b2Body.b2_dynamicBody&&(f.m_linearVelocity.x+=a.dt*(b.x+f.m_invMass*f.m_force.x),f.m_linearVelocity.y+=a.dt*(b.y+f.m_invMass*f.m_force.y),f.m_angularVelocity+=a.dt*f.m_invI*f.m_torque,f.m_linearVelocity.Multiply(b2Math.Clamp(1-a.dt*f.m_linearDamping,0,1)),f.m_angularVelocity*=b2Math.Clamp(1-a.dt*f.m_angularDamping,0,1));for(this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator),b=this.m_contactSolver,b.InitVelocityConstraints(a),e=0;e<this.m_jointCount;++e)d=this.m_joints[e],d.InitVelocityConstraints(a);for(e=0;e<a.velocityIterations;++e){for(f=0;f<this.m_jointCount;++f)d=this.m_joints[f],d.SolveVelocityConstraints(a);b.SolveVelocityConstraints()}for(e=0;e<this.m_jointCount;++e)d=this.m_joints[e],d.FinalizeVelocityConstraints();for(b.FinalizeVelocityConstraints(),e=0;e<this.m_bodyCount;++e)if(f=this.m_bodies[e],f.GetType()!=b2Body.b2_staticBody){var g=a.dt*f.m_linearVelocity.x,h=a.dt*f.m_linearVelocity.y;g*g+h*h>b2Settings.b2_maxTranslationSquared&&(f.m_linearVelocity.Normalize(),f.m_linearVelocity.x*=b2Settings.b2_maxTranslation*a.inv_dt,f.m_linearVelocity.y*=b2Settings.b2_maxTranslation*a.inv_dt),g=a.dt*f.m_angularVelocity,g*g>b2Settings.b2_maxRotationSquared&&(f.m_angularVelocity=f.m_angularVelocity<0?-b2Settings.b2_maxRotation*a.inv_dt:b2Settings.b2_maxRotation*a.inv_dt),f.m_sweep.c0.SetV(f.m_sweep.c),f.m_sweep.a0=f.m_sweep.a,f.m_sweep.c.x+=a.dt*f.m_linearVelocity.x,f.m_sweep.c.y+=a.dt*f.m_linearVelocity.y,f.m_sweep.a+=a.dt*f.m_angularVelocity,f.SynchronizeTransform()}for(e=0;e<a.positionIterations;++e){for(g=b.SolvePositionConstraints(b2Settings.b2_contactBaumgarte),h=!0,f=0;f<this.m_jointCount;++f)d=this.m_joints[f],d=d.SolvePositionConstraints(b2Settings.b2_contactBaumgarte),h=h&&d;
if(g&&h)break}if(this.Report(b.m_constraints),c){for(c=Number.MAX_VALUE,b=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance,g=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance,e=0;e<this.m_bodyCount;++e)f=this.m_bodies[e],f.GetType()!=b2Body.b2_staticBody&&(0==(f.m_flags&b2Body.e_allowSleepFlag)&&(c=f.m_sleepTime=0),0==(f.m_flags&b2Body.e_allowSleepFlag)||f.m_angularVelocity*f.m_angularVelocity>g||b2Math.Dot(f.m_linearVelocity,f.m_linearVelocity)>b?c=f.m_sleepTime=0:(f.m_sleepTime+=a.dt,c=b2Math.Min(c,f.m_sleepTime)));if(c>=b2Settings.b2_timeToSleep)for(e=0;e<this.m_bodyCount;++e)f=this.m_bodies[e],f.SetAwake(!1)}},b2Island.prototype.SolveTOI=function(a){var b=0,c=0;this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);var d=this.m_contactSolver;for(b=0;b<this.m_jointCount;++b)this.m_joints[b].InitVelocityConstraints(a);for(b=0;b<a.velocityIterations;++b)for(d.SolveVelocityConstraints(),c=0;c<this.m_jointCount;++c)this.m_joints[c].SolveVelocityConstraints(a);for(b=0;b<this.m_bodyCount;++b)if(c=this.m_bodies[b],c.GetType()!=b2Body.b2_staticBody){var e=a.dt*c.m_linearVelocity.x,f=a.dt*c.m_linearVelocity.y;e*e+f*f>b2Settings.b2_maxTranslationSquared&&(c.m_linearVelocity.Normalize(),c.m_linearVelocity.x*=b2Settings.b2_maxTranslation*a.inv_dt,c.m_linearVelocity.y*=b2Settings.b2_maxTranslation*a.inv_dt),e=a.dt*c.m_angularVelocity,e*e>b2Settings.b2_maxRotationSquared&&(c.m_angularVelocity=c.m_angularVelocity<0?-b2Settings.b2_maxRotation*a.inv_dt:b2Settings.b2_maxRotation*a.inv_dt),c.m_sweep.c0.SetV(c.m_sweep.c),c.m_sweep.a0=c.m_sweep.a,c.m_sweep.c.x+=a.dt*c.m_linearVelocity.x,c.m_sweep.c.y+=a.dt*c.m_linearVelocity.y,c.m_sweep.a+=a.dt*c.m_angularVelocity,c.SynchronizeTransform()}for(b=0;b<a.positionIterations;++b){for(e=d.SolvePositionConstraints(.75),f=!0,c=0;c<this.m_jointCount;++c){var g=this.m_joints[c].SolvePositionConstraints(b2Settings.b2_contactBaumgarte);f=f&&g}if(e&&f)break}this.Report(d.m_constraints)},b2Island.prototype.Report=function(a){if(null!=this.m_listener)for(var b=0;b<this.m_contactCount;++b){for(var c=this.m_contacts[b],d=a[b],e=0;e<d.pointCount;++e)b2Island.s_impulse.normalImpulses[e]=d.points[e].normalImpulse,b2Island.s_impulse.tangentImpulses[e]=d.points[e].tangentImpulse;this.m_listener.PostSolve(c,b2Island.s_impulse)}},b2Island.prototype.AddBody=function(a){a.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=a},b2Island.prototype.AddContact=function(a){this.m_contacts[this.m_contactCount++]=a},b2Island.prototype.AddJoint=function(a){this.m_joints[this.m_jointCount++]=a},b2Island.prototype.m_allocator=null,b2Island.prototype.m_listener=null,b2Island.prototype.m_contactSolver=null,b2Island.prototype.m_bodies=null,b2Island.prototype.m_contacts=null,b2Island.prototype.m_joints=null,b2Island.prototype.m_bodyCount=0,b2Island.prototype.m_jointCount=0,b2Island.prototype.m_contactCount=0,b2Island.prototype.m_bodyCapacity=0,b2Island.prototype.m_contactCapacity=0,b2Island.prototype.m_jointCapacity=0;var b2PolyAndEdgeContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolyAndEdgeContact.prototype,b2Contact.prototype),b2PolyAndEdgeContact.prototype._super=b2Contact.prototype,b2PolyAndEdgeContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolyAndEdgeContact.prototype.__varz=function(){},b2PolyAndEdgeContact.Create=function(){return new b2PolyAndEdgeContact},b2PolyAndEdgeContact.Destroy=function(){},b2PolyAndEdgeContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge=function(){},b2PolyAndEdgeContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b]),b2Settings.b2Assert(a.GetType()==b2Shape.e_polygonShape),b2Settings.b2Assert(b.GetType()==b2Shape.e_edgeShape)};var b2Collision=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Collision.prototype.__constructor=function(){},b2Collision.prototype.__varz=function(){},b2Collision.MakeClipPointVector=function(){var a=Array(2);return a[0]=new ClipVertex,a[1]=new ClipVertex,a},b2Collision.ClipSegmentToLine=function(a,b,c,d){var e,f=0;e=b[0];var g=e.v;e=b[1];var h=e.v,i=c.x*g.x+c.y*g.y-d;return e=c.x*h.x+c.y*h.y-d,0>=i&&a[f++].Set(b[0]),0>=e&&a[f++].Set(b[1]),0>i*e&&(c=i/(i-e),e=a[f],e=e.v,e.x=g.x+c*(h.x-g.x),e.y=g.y+c*(h.y-g.y),e=a[f],e.id=(i>0?b[0]:b[1]).id,++f),f},b2Collision.EdgeSeparation=function(a,b,c,d,e){var f=a.m_vertices;a=a.m_normals;var g,h,i=d.m_vertexCount,j=d.m_vertices;g=b.R,h=a[c],a=g.col1.x*h.x+g.col2.x*h.y,d=g.col1.y*h.x+g.col2.y*h.y,g=e.R;var k=g.col1.x*a+g.col1.y*d;g=g.col2.x*a+g.col2.y*d;for(var l=0,m=Number.MAX_VALUE,n=0;i>n;++n)h=j[n],h=h.x*k+h.y*g,m>h&&(m=h,l=n);return h=f[c],g=b.R,c=b.position.x+(g.col1.x*h.x+g.col2.x*h.y),b=b.position.y+(g.col1.y*h.x+g.col2.y*h.y),h=j[l],g=e.R,f=e.position.x+(g.col1.x*h.x+g.col2.x*h.y),e=e.position.y+(g.col1.y*h.x+g.col2.y*h.y),f-=c,e-=b,f*a+e*d},b2Collision.FindMaxSeparation=function(a,b,c,d,e){var f,g,h=b.m_vertexCount,i=b.m_normals;g=e.R,f=d.m_centroid;var j=e.position.x+(g.col1.x*f.x+g.col2.x*f.y),k=e.position.y+(g.col1.y*f.x+g.col2.y*f.y);g=c.R,f=b.m_centroid,j-=c.position.x+(g.col1.x*f.x+g.col2.x*f.y),k-=c.position.y+(g.col1.y*f.x+g.col2.y*f.y),g=j*c.R.col1.x+k*c.R.col1.y,k=j*c.R.col2.x+k*c.R.col2.y,j=0;for(var l=-Number.MAX_VALUE,m=0;h>m;++m)f=i[m],f=f.x*g+f.y*k,f>l&&(l=f,j=m);i=b2Collision.EdgeSeparation(b,c,j,d,e),k=j-1>=0?j-1:h-1,l=b2Collision.EdgeSeparation(b,c,k,d,e),m=h>j+1?j+1:0;var n=b2Collision.EdgeSeparation(b,c,m,d,e);if(g=f=0,l>i&&l>n)g=-1,f=k,k=l;else{if(!(n>i))return a[0]=j,i;g=1,f=m,k=n}for(;j=-1==g?f-1>=0?f-1:h-1:h>f+1?f+1:0,i=b2Collision.EdgeSeparation(b,c,j,d,e),i>k;)f=j,k=i;return a[0]=f,k},b2Collision.FindIncidentEdge=function(a,b,c,d,e,f){var g=b.m_normals,h=e.m_vertexCount;b=e.m_vertices,e=e.m_normals;var i;i=c.R,c=g[d],g=i.col1.x*c.x+i.col2.x*c.y;var j=i.col1.y*c.x+i.col2.y*c.y;i=f.R,c=i.col1.x*g+i.col1.y*j,j=i.col2.x*g+i.col2.y*j,g=c,i=0;for(var k=Number.MAX_VALUE,l=0;h>l;++l)c=e[l],c=g*c.x+j*c.y,k>c&&(k=c,i=l);e=i,g=h>e+1?e+1:0,h=a[0],c=b[e],i=f.R,h.v.x=f.position.x+(i.col1.x*c.x+i.col2.x*c.y),h.v.y=f.position.y+(i.col1.y*c.x+i.col2.y*c.y),h.id.features.referenceEdge=d,h.id.features.incidentEdge=e,h.id.features.incidentVertex=0,h=a[1],c=b[g],i=f.R,h.v.x=f.position.x+(i.col1.x*c.x+i.col2.x*c.y),h.v.y=f.position.y+(i.col1.y*c.x+i.col2.y*c.y),h.id.features.referenceEdge=d,h.id.features.incidentEdge=g,h.id.features.incidentVertex=1},b2Collision.CollidePolygons=function(a,b,c,d,e){var f;a.m_pointCount=0;var g=b.m_radius+d.m_radius;f=0,b2Collision.s_edgeAO[0]=f;var h=b2Collision.FindMaxSeparation(b2Collision.s_edgeAO,b,c,d,e);if(f=b2Collision.s_edgeAO[0],!(h>g)){var i=0;b2Collision.s_edgeBO[0]=i;var j=b2Collision.FindMaxSeparation(b2Collision.s_edgeBO,d,e,b,c);if(i=b2Collision.s_edgeBO[0],!(j>g)){var k=0,l=0;j>.98*h+.001?(h=d,d=b,b=e,c=c,k=i,a.m_type=b2Manifold.e_faceB,l=1):(h=b,d=d,b=c,c=e,k=f,a.m_type=b2Manifold.e_faceA,l=0),f=b2Collision.s_incidentEdge,b2Collision.FindIncidentEdge(f,h,b,k,d,c),e=h.m_vertices,i=e[k];var m;m=k+1<h.m_vertexCount?e[parseInt(k+1)]:e[0],k=b2Collision.s_localTangent,k.Set(m.x-i.x,m.y-i.y),k.Normalize(),e=b2Collision.s_localNormal,e.x=k.y,e.y=-k.x,d=b2Collision.s_planePoint,d.Set(.5*(i.x+m.x),.5*(i.y+m.y)),j=b2Collision.s_tangent,h=b.R,j.x=h.col1.x*k.x+h.col2.x*k.y,j.y=h.col1.y*k.x+h.col2.y*k.y;var n=b2Collision.s_tangent2;n.x=-j.x,n.y=-j.y,k=b2Collision.s_normal,k.x=j.y,k.y=-j.x;var o=b2Collision.s_v11,p=b2Collision.s_v12;if(o.x=b.position.x+(h.col1.x*i.x+h.col2.x*i.y),o.y=b.position.y+(h.col1.y*i.x+h.col2.y*i.y),p.x=b.position.x+(h.col1.x*m.x+h.col2.x*m.y),p.y=b.position.y+(h.col1.y*m.x+h.col2.y*m.y),b=k.x*o.x+k.y*o.y,h=j.x*p.x+j.y*p.y+g,m=b2Collision.s_clipPoints1,i=b2Collision.s_clipPoints2,p=0,p=b2Collision.ClipSegmentToLine(m,f,n,-j.x*o.x-j.y*o.y+g),!(2>p||(p=b2Collision.ClipSegmentToLine(i,m,j,h),2>p))){for(a.m_localPlaneNormal.SetV(e),a.m_localPoint.SetV(d),d=e=0;d<b2Settings.b2_maxManifoldPoints;++d)f=i[d],k.x*f.v.x+k.y*f.v.y-b<=g&&(j=a.m_points[e],h=c.R,n=f.v.x-c.position.x,o=f.v.y-c.position.y,j.m_localPoint.x=n*h.col1.x+o*h.col1.y,j.m_localPoint.y=n*h.col2.x+o*h.col2.y,j.m_id.Set(f.id),j.m_id.features.flip=l,++e);a.m_pointCount=e}}}},b2Collision.CollideCircles=function(a,b,c,d,e){a.m_pointCount=0;var f,g;f=c.R,g=b.m_p;var h=c.position.x+(f.col1.x*g.x+f.col2.x*g.y);c=c.position.y+(f.col1.y*g.x+f.col2.y*g.y),f=e.R,g=d.m_p,h=e.position.x+(f.col1.x*g.x+f.col2.x*g.y)-h,e=e.position.y+(f.col1.y*g.x+f.col2.y*g.y)-c,f=b.m_radius+d.m_radius,h*h+e*e>f*f||(a.m_type=b2Manifold.e_circles,a.m_localPoint.SetV(b.m_p),a.m_localPlaneNormal.SetZero(),a.m_pointCount=1,a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0)},b2Collision.CollidePolygonAndCircle=function(a,b,c,d,e){a.m_pointCount=0;var f,g,h,i;i=e.R,h=d.m_p;var j=e.position.y+(i.col1.y*h.x+i.col2.y*h.y);f=e.position.x+(i.col1.x*h.x+i.col2.x*h.y)-c.position.x,g=j-c.position.y,i=c.R,c=f*i.col1.x+g*i.col1.y,i=f*i.col2.x+g*i.col2.y;var k=0;e=-Number.MAX_VALUE,j=b.m_radius+d.m_radius;var l=b.m_vertexCount,m=b.m_vertices;b=b.m_normals;for(var n=0;l>n;++n){if(h=m[n],f=c-h.x,g=i-h.y,h=b[n],h=h.x*f+h.y*g,h>j)return;h>e&&(e=h,k=n)}if(h=k,f=m[h],l=m[l>h+1?h+1:0],e<Number.MIN_VALUE)a.m_pointCount=1,a.m_type=b2Manifold.e_faceA,a.m_localPlaneNormal.SetV(b[k]),a.m_localPoint.x=.5*(f.x+l.x),a.m_localPoint.y=.5*(f.y+l.y);else if(e=(c-l.x)*(f.x-l.x)+(i-l.y)*(f.y-l.y),(c-f.x)*(l.x-f.x)+(i-f.y)*(l.y-f.y)<=0){if((c-f.x)*(c-f.x)+(i-f.y)*(i-f.y)>j*j)return;a.m_pointCount=1,a.m_type=b2Manifold.e_faceA,a.m_localPlaneNormal.x=c-f.x,a.m_localPlaneNormal.y=i-f.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(f)}else if(0>=e){if((c-l.x)*(c-l.x)+(i-l.y)*(i-l.y)>j*j)return;a.m_pointCount=1,a.m_type=b2Manifold.e_faceA,a.m_localPlaneNormal.x=c-l.x,a.m_localPlaneNormal.y=i-l.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(l)}else{if(k=.5*(f.x+l.x),f=.5*(f.y+l.y),e=(c-k)*b[h].x+(i-f)*b[h].y,e>j)return;a.m_pointCount=1,a.m_type=b2Manifold.e_faceA,a.m_localPlaneNormal.x=b[h].x,a.m_localPlaneNormal.y=b[h].y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.Set(k,f)}a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0},b2Collision.TestOverlap=function(a,b){var c=b.lowerBound,d=a.upperBound,e=c.x-d.x,f=c.y-d.y;c=a.lowerBound,d=b.upperBound;var g=c.y-d.y;return e>0||f>0?!1:c.x-d.x>0||g>0?!1:!0},b2Collision.b2_nullFeature=255,b2Collision.s_incidentEdge=b2Collision.MakeClipPointVector(),b2Collision.s_clipPoints1=b2Collision.MakeClipPointVector(),b2Collision.s_clipPoints2=b2Collision.MakeClipPointVector(),b2Collision.s_edgeAO=Array(1),b2Collision.s_edgeBO=Array(1),b2Collision.s_localTangent=new b2Vec2,b2Collision.s_localNormal=new b2Vec2,b2Collision.s_planePoint=new b2Vec2,b2Collision.s_normal=new b2Vec2,b2Collision.s_tangent=new b2Vec2,b2Collision.s_tangent2=new b2Vec2,b2Collision.s_v11=new b2Vec2,b2Collision.s_v12=new b2Vec2,b2Collision.b2CollidePolyTempVec=new b2Vec2;var b2PolyAndCircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolyAndCircleContact.prototype,b2Contact.prototype),b2PolyAndCircleContact.prototype._super=b2Contact.prototype,b2PolyAndCircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolyAndCircleContact.prototype.__varz=function(){},b2PolyAndCircleContact.Create=function(){return new b2PolyAndCircleContact},b2PolyAndCircleContact.Destroy=function(){},b2PolyAndCircleContact.prototype.Evaluate=function(){var a=this.m_fixtureA.m_body,b=this.m_fixtureB.m_body;b2Collision.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2PolyAndCircleContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b]),b2Settings.b2Assert(a.GetType()==b2Shape.e_polygonShape),b2Settings.b2Assert(b.GetType()==b2Shape.e_circleShape)};var b2ContactPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactPoint.prototype.__constructor=function(){},b2ContactPoint.prototype.__varz=function(){this.position=new b2Vec2,this.velocity=new b2Vec2,this.normal=new b2Vec2,this.id=new b2ContactID},b2ContactPoint.prototype.shape1=null,b2ContactPoint.prototype.shape2=null,b2ContactPoint.prototype.position=new b2Vec2,b2ContactPoint.prototype.velocity=new b2Vec2,b2ContactPoint.prototype.normal=new b2Vec2,b2ContactPoint.prototype.separation=null,b2ContactPoint.prototype.friction=null,b2ContactPoint.prototype.restitution=null,b2ContactPoint.prototype.id=new b2ContactID;var b2CircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2CircleContact.prototype,b2Contact.prototype),b2CircleContact.prototype._super=b2Contact.prototype,b2CircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2CircleContact.prototype.__varz=function(){},b2CircleContact.Create=function(){return new b2CircleContact},b2CircleContact.Destroy=function(){},b2CircleContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();b2Collision.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2CircleContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b])};var b2EdgeAndCircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2EdgeAndCircleContact.prototype,b2Contact.prototype),b2EdgeAndCircleContact.prototype._super=b2Contact.prototype,b2EdgeAndCircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2EdgeAndCircleContact.prototype.__varz=function(){},b2EdgeAndCircleContact.Create=function(){return new b2EdgeAndCircleContact},b2EdgeAndCircleContact.Destroy=function(){},b2EdgeAndCircleContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle=function(){},b2EdgeAndCircleContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b])};var b2ContactManager=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactManager.prototype.__constructor=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=b2ContactFilter.b2_defaultFilter,this.m_contactListener=b2ContactListener.b2_defaultListener,this.m_contactFactory=new b2ContactFactory(this.m_allocator),this.m_broadPhase=new b2DynamicTreeBroadPhase},b2ContactManager.prototype.__varz=function(){},b2ContactManager.s_evalCP=new b2ContactPoint,b2ContactManager.prototype.AddPair=function(a,b){var c=a,d=b,e=c.GetBody(),f=d.GetBody();if(e!=f){for(var g=f.GetContactList();g;){if(g.other==e){var h=g.contact.GetFixtureA(),i=g.contact.GetFixtureB();if(h==c&&i==d)return;if(h==d&&i==c)return}g=g.next}0!=f.ShouldCollide(e)&&0!=this.m_contactFilter.ShouldCollide(c,d)&&(g=this.m_contactFactory.Create(c,d),c=g.GetFixtureA(),d=g.GetFixtureB(),e=c.m_body,f=d.m_body,g.m_prev=null,g.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=g),this.m_world.m_contactList=g,g.m_nodeA.contact=g,g.m_nodeA.other=f,g.m_nodeA.prev=null,g.m_nodeA.next=e.m_contactList,null!=e.m_contactList&&(e.m_contactList.prev=g.m_nodeA),e.m_contactList=g.m_nodeA,g.m_nodeB.contact=g,g.m_nodeB.other=e,g.m_nodeB.prev=null,g.m_nodeB.next=f.m_contactList,null!=f.m_contactList&&(f.m_contactList.prev=g.m_nodeB),f.m_contactList=g.m_nodeB,++this.m_world.m_contactCount)}},b2ContactManager.prototype.FindNewContacts=function(){var a=this;this.m_broadPhase.UpdatePairs(function(b,c){return a.AddPair(b,c)})},b2ContactManager.prototype.Destroy=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB();b=b.GetBody(),c=c.GetBody(),a.IsTouching()&&this.m_contactListener.EndContact(a),a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_world.m_contactList&&(this.m_world.m_contactList=a.m_next),a.m_nodeA.prev&&(a.m_nodeA.prev.next=a.m_nodeA.next),a.m_nodeA.next&&(a.m_nodeA.next.prev=a.m_nodeA.prev),a.m_nodeA==b.m_contactList&&(b.m_contactList=a.m_nodeA.next),a.m_nodeB.prev&&(a.m_nodeB.prev.next=a.m_nodeB.next),a.m_nodeB.next&&(a.m_nodeB.next.prev=a.m_nodeB.prev),a.m_nodeB==c.m_contactList&&(c.m_contactList=a.m_nodeB.next),this.m_contactFactory.Destroy(a),--this.m_contactCount},b2ContactManager.prototype.Collide=function(){for(var a=this.m_world.m_contactList;a;){var b=a.GetFixtureA(),c=a.GetFixtureB(),d=b.GetBody(),e=c.GetBody();if(0==d.IsAwake()&&0==e.IsAwake())a=a.GetNext();else{if(a.m_flags&b2Contact.e_filterFlag){if(0==e.ShouldCollide(d)){b=a,a=b.GetNext(),this.Destroy(b);continue}if(0==this.m_contactFilter.ShouldCollide(b,c)){b=a,a=b.GetNext(),this.Destroy(b);continue}a.m_flags&=~b2Contact.e_filterFlag}0==this.m_broadPhase.TestOverlap(b.m_proxy,c.m_proxy)?(b=a,a=b.GetNext(),this.Destroy(b)):(a.Update(this.m_contactListener),a=a.GetNext())}}},b2ContactManager.prototype.m_world=null,b2ContactManager.prototype.m_broadPhase=null,b2ContactManager.prototype.m_contactList=null,b2ContactManager.prototype.m_contactCount=0,b2ContactManager.prototype.m_contactFilter=null,b2ContactManager.prototype.m_contactListener=null,b2ContactManager.prototype.m_contactFactory=null,b2ContactManager.prototype.m_allocator=null;var b2World=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2World.prototype.__constructor=function(a,b){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null,this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,b2World.m_warmStarting=!0,b2World.m_continuousPhysics=!0,this.m_allowSleep=b,this.m_gravity=a,this.m_inv_dt0=0,this.m_contactManager.m_world=this,this.m_groundBody=this.CreateBody(new b2BodyDef)},b2World.prototype.__varz=function(){this.s_stack=[],this.m_contactManager=new b2ContactManager,this.m_contactSolver=new b2ContactSolver,this.m_island=new b2Island},b2World.s_timestep2=new b2TimeStep,b2World.s_backupA=new b2Sweep,b2World.s_backupB=new b2Sweep,b2World.s_timestep=new b2TimeStep,b2World.s_queue=[],b2World.e_newFixture=1,b2World.e_locked=2,b2World.s_xf=new b2Transform,b2World.s_jointColor=new b2Color(.5,.8,.8),b2World.m_warmStarting=null,b2World.m_continuousPhysics=null,b2World.prototype.Solve=function(a){for(var b,c=this.m_controllerList;c;c=c.m_next)c.Step(a);for(c=this.m_island,c.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~b2Body.e_islandFlag;for(var d=this.m_contactList;d;d=d.m_next)d.m_flags&=~b2Contact.e_islandFlag;for(d=this.m_jointList;d;d=d.m_next)d.m_islandFlag=!1;d=this.s_stack;for(var e=this.m_bodyList;e;e=e.m_next)if(!(e.m_flags&b2Body.e_islandFlag)&&0!=e.IsAwake()&&0!=e.IsActive()&&e.GetType()!=b2Body.b2_staticBody){c.Clear();var f=0;for(d[f++]=e,e.m_flags|=b2Body.e_islandFlag;f>0;)if(b=d[--f],c.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()!=b2Body.b2_staticBody){for(var g,h=b.m_contactList;h;h=h.next)h.contact.m_flags&b2Contact.e_islandFlag||1!=h.contact.IsSensor()&&0!=h.contact.IsEnabled()&&0!=h.contact.IsTouching()&&(c.AddContact(h.contact),h.contact.m_flags|=b2Contact.e_islandFlag,g=h.other,g.m_flags&b2Body.e_islandFlag||(d[f++]=g,g.m_flags|=b2Body.e_islandFlag));for(b=b.m_jointList;b;b=b.next)1!=b.joint.m_islandFlag&&(g=b.other,0!=g.IsActive()&&(c.AddJoint(b.joint),b.joint.m_islandFlag=!0,g.m_flags&b2Body.e_islandFlag||(d[f++]=g,g.m_flags|=b2Body.e_islandFlag)))}for(c.Solve(a,this.m_gravity,this.m_allowSleep),f=0;f<c.m_bodyCount;++f)b=c.m_bodies[f],b.GetType()==b2Body.b2_staticBody&&(b.m_flags&=~b2Body.e_islandFlag)}for(f=0;f<d.length&&d[f];++f)d[f]=null;for(b=this.m_bodyList;b;b=b.m_next)0==b.IsAwake()||0==b.IsActive()||b.GetType()!=b2Body.b2_staticBody&&b.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},b2World.prototype.SolveTOI=function(a){var b,c,d,e=this.m_island;e.Initialize(this.m_bodyCount,b2Settings.b2_maxTOIContactsPerIsland,b2Settings.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var f=b2World.s_queue;for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~b2Body.e_islandFlag,b.m_sweep.t0=0;for(d=this.m_contactList;d;d=d.m_next)d.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(d=this.m_jointList;d;d=d.m_next)d.m_islandFlag=!1;for(;;){var g=null,h=1;for(d=this.m_contactList;d;d=d.m_next)if(1!=d.IsSensor()&&0!=d.IsEnabled()&&0!=d.IsContinuous()){if(b=1,d.m_flags&b2Contact.e_toiFlag)b=d.m_toi;else{if(b=d.m_fixtureA,c=d.m_fixtureB,b=b.m_body,c=c.m_body,!(b.GetType()==b2Body.b2_dynamicBody&&0!=b.IsAwake()||c.GetType()==b2Body.b2_dynamicBody&&0!=c.IsAwake()))continue;var i=b.m_sweep.t0;b.m_sweep.t0<c.m_sweep.t0?(i=c.m_sweep.t0,b.m_sweep.Advance(i)):c.m_sweep.t0<b.m_sweep.t0&&(i=b.m_sweep.t0,c.m_sweep.Advance(i)),b=d.ComputeTOI(b.m_sweep,c.m_sweep),b2Settings.b2Assert(b>=0&&1>=b),b>0&&1>b&&(b=(1-b)*i+b,b>1&&(b=1)),d.m_toi=b,d.m_flags|=b2Contact.e_toiFlag}Number.MIN_VALUE<b&&h>b&&(g=d,h=b)}if(null==g||1-100*Number.MIN_VALUE<h)break;if(b=g.m_fixtureA,c=g.m_fixtureB,b=b.m_body,c=c.m_body,b2World.s_backupA.Set(b.m_sweep),b2World.s_backupB.Set(c.m_sweep),b.Advance(h),c.Advance(h),g.Update(this.m_contactManager.m_contactListener),g.m_flags&=~b2Contact.e_toiFlag,1==g.IsSensor()||0==g.IsEnabled())b.m_sweep.Set(b2World.s_backupA),c.m_sweep.Set(b2World.s_backupB),b.SynchronizeTransform(),c.SynchronizeTransform();else if(0!=g.IsTouching()){for(b=b,b.GetType()!=b2Body.b2_dynamicBody&&(b=c),e.Clear(),g=d=0,f[d+g++]=b,b.m_flags|=b2Body.e_islandFlag;g>0;)if(b=f[d++],--g,e.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()==b2Body.b2_dynamicBody){for(c=b.m_contactList;c&&e.m_contactCount!=e.m_contactCapacity;c=c.next)c.contact.m_flags&b2Contact.e_islandFlag||1!=c.contact.IsSensor()&&0!=c.contact.IsEnabled()&&0!=c.contact.IsTouching()&&(e.AddContact(c.contact),c.contact.m_flags|=b2Contact.e_islandFlag,i=c.other,i.m_flags&b2Body.e_islandFlag||(i.GetType()!=b2Body.b2_staticBody&&(i.Advance(h),i.SetAwake(!0)),f[d+g]=i,++g,i.m_flags|=b2Body.e_islandFlag));for(b=b.m_jointList;b;b=b.next)e.m_jointCount!=e.m_jointCapacity&&1!=b.joint.m_islandFlag&&(i=b.other,0!=i.IsActive()&&(e.AddJoint(b.joint),b.joint.m_islandFlag=!0,i.m_flags&b2Body.e_islandFlag||(i.GetType()!=b2Body.b2_staticBody&&(i.Advance(h),i.SetAwake(!0)),f[d+g]=i,++g,i.m_flags|=b2Body.e_islandFlag)))}for(d=b2World.s_timestep,d.warmStarting=!1,d.dt=(1-h)*a.dt,d.inv_dt=1/d.dt,d.dtRatio=0,d.velocityIterations=a.velocityIterations,d.positionIterations=a.positionIterations,e.SolveTOI(d),h=h=0;h<e.m_bodyCount;++h)if(b=e.m_bodies[h],b.m_flags&=~b2Body.e_islandFlag,0!=b.IsAwake()&&b.GetType()==b2Body.b2_dynamicBody)for(b.SynchronizeFixtures(),c=b.m_contactList;c;c=c.next)c.contact.m_flags&=~b2Contact.e_toiFlag;for(h=0;h<e.m_contactCount;++h)d=e.m_contacts[h],d.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(h=0;h<e.m_jointCount;++h)d=e.m_joints[h],d.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}},b2World.prototype.DrawJoint=function(a){var b=a.GetBodyA(),c=a.GetBodyB(),d=b.m_xf.position,e=c.m_xf.position,f=a.GetAnchorA(),g=a.GetAnchorB(),h=b2World.s_jointColor;switch(a.m_type){case b2Joint.e_distanceJoint:this.m_debugDraw.DrawSegment(f,g,h);break;case b2Joint.e_pulleyJoint:b=a.GetGroundAnchorA(),a=a.GetGroundAnchorB(),this.m_debugDraw.DrawSegment(b,f,h),this.m_debugDraw.DrawSegment(a,g,h),this.m_debugDraw.DrawSegment(b,a,h);break;case b2Joint.e_mouseJoint:this.m_debugDraw.DrawSegment(f,g,h);break;default:b!=this.m_groundBody&&this.m_debugDraw.DrawSegment(d,f,h),this.m_debugDraw.DrawSegment(f,g,h),c!=this.m_groundBody&&this.m_debugDraw.DrawSegment(e,g,h)}},b2World.prototype.DrawShape=function(a,b,c){switch(a.m_type){case b2Shape.e_circleShape:this.m_debugDraw.DrawSolidCircle(b2Math.MulX(b,a.m_p),a.m_radius,b.R.col1,c);break;case b2Shape.e_polygonShape:var d=0,e=a.GetVertexCount();a=a.GetVertices();var f=Array(e);for(d=0;e>d;++d)f[d]=b2Math.MulX(b,a[d]);this.m_debugDraw.DrawSolidPolygon(f,e,c);break;case b2Shape.e_edgeShape:this.m_debugDraw.DrawSegment(b2Math.MulX(b,a.GetVertex1()),b2Math.MulX(b,a.GetVertex2()),c)}},b2World.prototype.SetDestructionListener=function(a){this.m_destructionListener=a},b2World.prototype.SetContactFilter=function(a){this.m_contactManager.m_contactFilter=a},b2World.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a},b2World.prototype.SetDebugDraw=function(a){this.m_debugDraw=a},b2World.prototype.SetBroadPhase=function(a){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var c=this.m_bodyList;c;c=c.m_next)for(var d=c.m_fixtureList;d;d=d.m_next)d.m_proxy=a.CreateProxy(b.GetFatAABB(d.m_proxy),d)},b2World.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},b2World.prototype.CreateBody=function(a){return 1==this.IsLocked()?null:(a=new b2Body(a,this),a.m_prev=null,(a.m_next=this.m_bodyList)&&(this.m_bodyList.m_prev=a),this.m_bodyList=a,++this.m_bodyCount,a)},b2World.prototype.DestroyBody=function(a){if(1!=this.IsLocked()){for(var b=a.m_jointList;b;){var c=b;b=b.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint),this.DestroyJoint(c.joint)}for(b=a.m_controllerList;b;)c=b,b=b.nextController,c.controller.RemoveBody(a);for(b=a.m_contactList;b;)c=b,b=b.next,this.m_contactManager.Destroy(c.contact);for(a.m_contactList=null,b=a.m_fixtureList;b;)c=b,b=b.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(c),c.DestroyProxy(this.m_contactManager.m_broadPhase),c.Destroy();a.m_fixtureList=null,a.m_fixtureCount=0,a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_bodyList&&(this.m_bodyList=a.m_next),--this.m_bodyCount}},b2World.prototype.CreateJoint=function(a){var b=b2Joint.Create(a,null);b.m_prev=null,(b.m_next=this.m_jointList)&&(this.m_jointList.m_prev=b),this.m_jointList=b,++this.m_jointCount,b.m_edgeA.joint=b,b.m_edgeA.other=b.m_bodyB,b.m_edgeA.prev=null,(b.m_edgeA.next=b.m_bodyA.m_jointList)&&(b.m_bodyA.m_jointList.prev=b.m_edgeA),b.m_bodyA.m_jointList=b.m_edgeA,b.m_edgeB.joint=b,b.m_edgeB.other=b.m_bodyA,b.m_edgeB.prev=null,(b.m_edgeB.next=b.m_bodyB.m_jointList)&&(b.m_bodyB.m_jointList.prev=b.m_edgeB),b.m_bodyB.m_jointList=b.m_edgeB;var c=a.bodyA,d=a.bodyB;if(0==a.collideConnected)for(a=d.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),a=a.next;return b},b2World.prototype.DestroyJoint=function(a){var b=a.m_collideConnected;a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_jointList&&(this.m_jointList=a.m_next);var c=a.m_bodyA,d=a.m_bodyB;if(c.SetAwake(!0),d.SetAwake(!0),a.m_edgeA.prev&&(a.m_edgeA.prev.next=a.m_edgeA.next),a.m_edgeA.next&&(a.m_edgeA.next.prev=a.m_edgeA.prev),a.m_edgeA==c.m_jointList&&(c.m_jointList=a.m_edgeA.next),a.m_edgeA.prev=null,a.m_edgeA.next=null,a.m_edgeB.prev&&(a.m_edgeB.prev.next=a.m_edgeB.next),a.m_edgeB.next&&(a.m_edgeB.next.prev=a.m_edgeB.prev),a.m_edgeB==d.m_jointList&&(d.m_jointList=a.m_edgeB.next),a.m_edgeB.prev=null,a.m_edgeB.next=null,b2Joint.Destroy(a,null),--this.m_jointCount,0==b)for(a=d.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),a=a.next},b2World.prototype.AddController=function(a){return a.m_next=this.m_controllerList,a.m_prev=null,this.m_controllerList=a,a.m_world=this,this.m_controllerCount++,a},b2World.prototype.RemoveController=function(a){a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),this.m_controllerList==a&&(this.m_controllerList=a.m_next),this.m_controllerCount--},b2World.prototype.CreateController=function(a){if(a.m_world!=this)throw Error("Controller can only be a member of one world");return a.m_next=this.m_controllerList,a.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=a),this.m_controllerList=a,++this.m_controllerCount,a.m_world=this,a},b2World.prototype.DestroyController=function(a){a.Clear(),a.m_next&&(a.m_next.m_prev=a.m_prev),a.m_prev&&(a.m_prev.m_next=a.m_next),a==this.m_controllerList&&(this.m_controllerList=a.m_next),--this.m_controllerCount},b2World.prototype.SetWarmStarting=function(a){b2World.m_warmStarting=a},b2World.prototype.SetContinuousPhysics=function(a){b2World.m_continuousPhysics=a},b2World.prototype.GetBodyCount=function(){return this.m_bodyCount},b2World.prototype.GetJointCount=function(){return this.m_jointCount},b2World.prototype.GetContactCount=function(){return this.m_contactCount},b2World.prototype.SetGravity=function(a){this.m_gravity=a},b2World.prototype.GetGravity=function(){return this.m_gravity},b2World.prototype.GetGroundBody=function(){return this.m_groundBody},b2World.prototype.Step=function(a,b,c){this.m_flags&b2World.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~b2World.e_newFixture),this.m_flags|=b2World.e_locked;var d=b2World.s_timestep2;d.dt=a,d.velocityIterations=b,d.positionIterations=c,d.inv_dt=a>0?1/a:0,d.dtRatio=this.m_inv_dt0*a,d.warmStarting=b2World.m_warmStarting,this.m_contactManager.Collide(),d.dt>0&&this.Solve(d),b2World.m_continuousPhysics&&d.dt>0&&this.SolveTOI(d),d.dt>0&&(this.m_inv_dt0=d.inv_dt),this.m_flags&=~b2World.e_locked},b2World.prototype.ClearForces=function(){for(var a=this.m_bodyList;a;a=a.m_next)a.m_force.SetZero(),a.m_torque=0},b2World.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.Clear();var a,b,c,d=this.m_debugDraw.GetFlags();new b2Vec2,new b2Vec2,new b2Vec2;var e;new b2AABB,new b2AABB,e=[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2];var f=new b2Color(0,0,0);if(d&b2DebugDraw.e_shapeBit)for(a=this.m_bodyList;a;a=a.m_next)for(e=a.m_xf,b=a.GetFixtureList();b;b=b.m_next)c=b.GetShape(),0==a.IsActive()?f.Set(.5,.5,.3):a.GetType()==b2Body.b2_staticBody?f.Set(.5,.9,.5):a.GetType()==b2Body.b2_kinematicBody?f.Set(.5,.5,.9):0==a.IsAwake()?f.Set(.6,.6,.6):f.Set(.9,.7,.7),this.DrawShape(c,e,f);if(d&b2DebugDraw.e_jointBit)for(a=this.m_jointList;a;a=a.m_next)this.DrawJoint(a);if(d&b2DebugDraw.e_controllerBit)for(a=this.m_controllerList;a;a=a.m_next)a.Draw(this.m_debugDraw);if(d&b2DebugDraw.e_pairBit)for(f.Set(.3,.9,.9),a=this.m_contactManager.m_contactList;a;a=a.GetNext())c=a.GetFixtureA(),b=a.GetFixtureB(),c=c.GetAABB().GetCenter(),b=b.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(c,b,f);if(d&b2DebugDraw.e_aabbBit)for(c=this.m_contactManager.m_broadPhase,e=[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2],a=this.m_bodyList;a;a=a.GetNext())if(0!=a.IsActive())for(b=a.GetFixtureList();b;b=b.GetNext()){var g=c.GetFatAABB(b.m_proxy);e[0].Set(g.lowerBound.x,g.lowerBound.y),e[1].Set(g.upperBound.x,g.lowerBound.y),e[2].Set(g.upperBound.x,g.upperBound.y),e[3].Set(g.lowerBound.x,g.upperBound.y),this.m_debugDraw.DrawPolygon(e,4,f)}if(d&b2DebugDraw.e_centerOfMassBit)for(a=this.m_bodyList;a;a=a.m_next)e=b2World.s_xf,e.R=a.m_xf.R,e.position=a.GetWorldCenter(),this.m_debugDraw.DrawTransform(e)}},b2World.prototype.QueryAABB=function(a,b){var c=this.m_contactManager.m_broadPhase;c.Query(function(b){return a(c.GetUserData(b))},b)},b2World.prototype.QueryShape=function(a,b,c){null==c&&(c=new b2Transform,c.SetIdentity());var d=this.m_contactManager.m_broadPhase,e=new b2AABB;b.ComputeAABB(e,c),d.Query(function(e){return e=d.GetUserData(e),b2Shape.TestOverlap(b,c,e.GetShape(),e.GetBody().GetTransform())?a(e):!0},e)},b2World.prototype.QueryPoint=function(a,b){var c=this.m_contactManager.m_broadPhase,d=new b2AABB;
d.lowerBound.Set(b.x-b2Settings.b2_linearSlop,b.y-b2Settings.b2_linearSlop),d.upperBound.Set(b.x+b2Settings.b2_linearSlop,b.y+b2Settings.b2_linearSlop),c.Query(function(d){return d=c.GetUserData(d),d.TestPoint(b)?a(d):!0},d)},b2World.prototype.RayCast=function(a,b,c){var d=this.m_contactManager.m_broadPhase,e=new b2RayCastOutput,f=new b2RayCastInput(b,c);d.RayCast(function(f,g){var h=d.GetUserData(g);if(h.RayCast(e,f)){var i=e.fraction,j=new b2Vec2((1-i)*b.x+i*c.x,(1-i)*b.y+i*c.y);return a(h,j,e.normal,i)}return f.maxFraction},f)},b2World.prototype.RayCastOne=function(a,b){var c;return this.RayCast(function(a,b,d,e){return c=a,e},a,b),c},b2World.prototype.RayCastAll=function(a,b){var c=[];return this.RayCast(function(a){return c[c.length]=a,1},a,b),c},b2World.prototype.GetBodyList=function(){return this.m_bodyList},b2World.prototype.GetJointList=function(){return this.m_jointList},b2World.prototype.GetContactList=function(){return this.m_contactList},b2World.prototype.IsLocked=function(){return(this.m_flags&b2World.e_locked)>0},b2World.prototype.s_stack=[],b2World.prototype.m_flags=0,b2World.prototype.m_contactManager=new b2ContactManager,b2World.prototype.m_contactSolver=new b2ContactSolver,b2World.prototype.m_island=new b2Island,b2World.prototype.m_bodyList=null,b2World.prototype.m_jointList=null,b2World.prototype.m_contactList=null,b2World.prototype.m_bodyCount=0,b2World.prototype.m_contactCount=0,b2World.prototype.m_jointCount=0,b2World.prototype.m_controllerList=null,b2World.prototype.m_controllerCount=0,b2World.prototype.m_gravity=null,b2World.prototype.m_allowSleep=null,b2World.prototype.m_groundBody=null,b2World.prototype.m_destructionListener=null,b2World.prototype.m_debugDraw=null,b2World.prototype.m_inv_dt0=null,"undefined"!=typeof exports&&(exports.b2BoundValues=b2BoundValues,exports.b2Math=b2Math,exports.b2DistanceOutput=b2DistanceOutput,exports.b2Mat33=b2Mat33,exports.b2ContactPoint=b2ContactPoint,exports.b2PairManager=b2PairManager,exports.b2PositionSolverManifold=b2PositionSolverManifold,exports.b2OBB=b2OBB,exports.b2CircleContact=b2CircleContact,exports.b2PulleyJoint=b2PulleyJoint,exports.b2Pair=b2Pair,exports.b2TimeStep=b2TimeStep,exports.b2FixtureDef=b2FixtureDef,exports.b2World=b2World,exports.b2PrismaticJoint=b2PrismaticJoint,exports.b2Controller=b2Controller,exports.b2ContactID=b2ContactID,exports.b2RevoluteJoint=b2RevoluteJoint,exports.b2JointDef=b2JointDef,exports.b2Transform=b2Transform,exports.b2GravityController=b2GravityController,exports.b2EdgeAndCircleContact=b2EdgeAndCircleContact,exports.b2EdgeShape=b2EdgeShape,exports.b2BuoyancyController=b2BuoyancyController,exports.b2LineJointDef=b2LineJointDef,exports.b2Contact=b2Contact,exports.b2DistanceJoint=b2DistanceJoint,exports.b2Body=b2Body,exports.b2DestructionListener=b2DestructionListener,exports.b2PulleyJointDef=b2PulleyJointDef,exports.b2ContactEdge=b2ContactEdge,exports.b2ContactConstraint=b2ContactConstraint,exports.b2ContactImpulse=b2ContactImpulse,exports.b2DistanceJointDef=b2DistanceJointDef,exports.b2ContactResult=b2ContactResult,exports.b2EdgeChainDef=b2EdgeChainDef,exports.b2Vec2=b2Vec2,exports.b2Vec3=b2Vec3,exports.b2DistanceProxy=b2DistanceProxy,exports.b2FrictionJointDef=b2FrictionJointDef,exports.b2PolygonContact=b2PolygonContact,exports.b2TensorDampingController=b2TensorDampingController,exports.b2ContactFactory=b2ContactFactory,exports.b2WeldJointDef=b2WeldJointDef,exports.b2ConstantAccelController=b2ConstantAccelController,exports.b2GearJointDef=b2GearJointDef,exports.ClipVertex=ClipVertex,exports.b2SeparationFunction=b2SeparationFunction,exports.b2ManifoldPoint=b2ManifoldPoint,exports.b2Color=b2Color,exports.b2PolygonShape=b2PolygonShape,exports.b2DynamicTreePair=b2DynamicTreePair,exports.b2ContactConstraintPoint=b2ContactConstraintPoint,exports.b2FrictionJoint=b2FrictionJoint,exports.b2ContactFilter=b2ContactFilter,exports.b2ControllerEdge=b2ControllerEdge,exports.b2Distance=b2Distance,exports.b2Fixture=b2Fixture,exports.b2DynamicTreeNode=b2DynamicTreeNode,exports.b2MouseJoint=b2MouseJoint,exports.b2DistanceInput=b2DistanceInput,exports.b2BodyDef=b2BodyDef,exports.b2DynamicTreeBroadPhase=b2DynamicTreeBroadPhase,exports.b2Settings=b2Settings,exports.b2Proxy=b2Proxy,exports.b2Point=b2Point,exports.b2BroadPhase=b2BroadPhase,exports.b2Manifold=b2Manifold,exports.b2WorldManifold=b2WorldManifold,exports.b2PrismaticJointDef=b2PrismaticJointDef,exports.b2RayCastOutput=b2RayCastOutput,exports.b2ConstantForceController=b2ConstantForceController,exports.b2TimeOfImpact=b2TimeOfImpact,exports.b2CircleShape=b2CircleShape,exports.b2MassData=b2MassData,exports.b2Joint=b2Joint,exports.b2GearJoint=b2GearJoint,exports.b2DynamicTree=b2DynamicTree,exports.b2JointEdge=b2JointEdge,exports.b2LineJoint=b2LineJoint,exports.b2NullContact=b2NullContact,exports.b2ContactListener=b2ContactListener,exports.b2RayCastInput=b2RayCastInput,exports.b2TOIInput=b2TOIInput,exports.Features=Features,exports.b2FilterData=b2FilterData,exports.b2Island=b2Island,exports.b2ContactManager=b2ContactManager,exports.b2ContactSolver=b2ContactSolver,exports.b2Simplex=b2Simplex,exports.b2AABB=b2AABB,exports.b2Jacobian=b2Jacobian,exports.b2Bound=b2Bound,exports.b2RevoluteJointDef=b2RevoluteJointDef,exports.b2PolyAndEdgeContact=b2PolyAndEdgeContact,exports.b2SimplexVertex=b2SimplexVertex,exports.b2WeldJoint=b2WeldJoint,exports.b2Collision=b2Collision,exports.b2Mat22=b2Mat22,exports.b2SimplexCache=b2SimplexCache,exports.b2PolyAndCircleContact=b2PolyAndCircleContact,exports.b2MouseJointDef=b2MouseJointDef,exports.b2Shape=b2Shape,exports.b2Segment=b2Segment,exports.b2ContactRegister=b2ContactRegister,exports.b2DebugDraw=b2DebugDraw,exports.b2Sweep=b2Sweep),this.createjs=this.createjs||{},function(){var a=function(){throw"UID cannot be instantiated"};a._nextID=0,a.get=function(){return a._nextID++},createjs.UID=a}(),this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype;a.initialize=function(a){a.addEventListener=b.addEventListener,a.removeEventListener=b.removeEventListener,a.removeAllEventListeners=b.removeAllEventListeners,a.hasEventListener=b.hasEventListener,a.dispatchEvent=b.dispatchEvent},b._listeners=null,b.initialize=function(){},b.addEventListener=function(a,b){var c=this._listeners;c?this.removeEventListener(a,b):c=this._listeners={};var d=c[a];return d||(d=c[a]=[]),d.push(b),b},b.removeEventListener=function(a,b){var c=this._listeners;if(c){var d=c[a];if(d)for(var e=0,f=d.length;f>e;e++)if(d[e]==b){1==f?delete c[a]:d.splice(e,1);break}}},b.removeAllEventListeners=function(a){a?this._listeners&&delete this._listeners[a]:this._listeners=null},b.dispatchEvent=function(a,b){var c=!1,d=this._listeners;if(a&&d){if("string"==typeof a&&(a={type:a}),d=d[a.type],!d)return c;a.target=b||this;for(var d=d.slice(),e=0,f=d.length;f>e;e++)var g=d[e],c=g.handleEvent?c||g.handleEvent(a):c||g(a)}return!!c},b.hasEventListener=function(a){var b=this._listeners;return!(!b||!b[a])},b.toString=function(){return"[EventDispatcher]"},createjs.EventDispatcher=a}(),this.createjs=this.createjs||{},function(){var a=function(){throw"Ticker cannot be instantiated."};a.useRAF=!1,a.addEventListener=null,a.removeEventListener=null,a.removeAllEventListeners=null,a.dispatchEvent=null,a.hasEventListener=null,a._listeners=null,createjs.EventDispatcher.initialize(a),a._listeners=null,a._pauseable=null,a._paused=!1,a._inited=!1,a._startTime=0,a._pausedTime=0,a._ticks=0,a._pausedTicks=0,a._interval=50,a._lastTime=0,a._times=null,a._tickTimes=null,a._rafActive=!1,a._timeoutID=null,a.addListener=function(b,c){null!=b&&(a.removeListener(b),a._pauseable[a._listeners.length]=null==c?!0:c,a._listeners.push(b))},a.init=function(){a._inited=!0,a._times=[],a._tickTimes=[],a._pauseable=[],a._listeners=[],a._times.push(a._lastTime=a._startTime=a._getTime()),a.setInterval(a._interval)},a.removeListener=function(b){var c=a._listeners;c&&(b=c.indexOf(b),-1!=b&&(c.splice(b,1),a._pauseable.splice(b,1)))},a.removeAllListeners=function(){a._listeners=[],a._pauseable=[]},a.setInterval=function(b){a._interval=b,a._inited&&a._setupTick()},a.getInterval=function(){return a._interval},a.setFPS=function(b){a.setInterval(1e3/b)},a.getFPS=function(){return 1e3/a._interval},a.getMeasuredFPS=function(b){return 2>a._times.length?-1:(null==b&&(b=0|a.getFPS()),b=Math.min(a._times.length-1,b),1e3/((a._times[0]-a._times[b])/b))},a.setPaused=function(b){a._paused=b},a.getPaused=function(){return a._paused},a.getTime=function(b){return a._getTime()-a._startTime-(b?a._pausedTime:0)},a.getTicks=function(b){return a._ticks-(b?a._pausedTicks:0)},a._handleAF=function(){a._rafActive=!1,a._setupTick(),a._getTime()-a._lastTime>=.97*(a._interval-1)&&a._tick()},a._handleTimeout=function(){a.timeoutID=null,a._setupTick(),a._tick()},a._setupTick=function(){if(!a._rafActive&&null==a.timeoutID){if(a.useRAF){var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(b)return b(a._handleAF),a._rafActive=!0,void 0}a.timeoutID=setTimeout(a._handleTimeout,a._interval)}},a._tick=function(){var b=a._getTime();a._ticks++;var c=b-a._lastTime,d=a._paused;d&&(a._pausedTicks++,a._pausedTime+=c),a._lastTime=b;for(var e=a._pauseable,f=a._listeners.slice(),g=f?f.length:0,h=0;g>h;h++){var i=f[h];null==i||d&&e[h]||(i.tick?i.tick(c,d):i instanceof Function&&i(c,d))}for(a.dispatchEvent({type:"tick",paused:d,delta:c,time:b,runTime:b-a._pausedTime}),a._tickTimes.unshift(a._getTime()-b);100<a._tickTimes.length;)a._tickTimes.pop();for(a._times.unshift(b);100<a._times.length;)a._times.pop()};var b=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);a._getTime=function(){return b&&b.call(performance)||(new Date).getTime()},a.init(),createjs.Ticker=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c,d,e,f,g,h,i){this.initialize(a,b,c,d,e,f,g,h,i)},b=a.prototype;b.stageX=0,b.stageY=0,b.rawX=0,b.rawY=0,b.type=null,b.nativeEvent=null,b.onMouseMove=null,b.onMouseUp=null,b.target=null,b.pointerID=0,b.primary=!1,b.addEventListener=null,b.removeEventListener=null,b.removeAllEventListeners=null,b.dispatchEvent=null,b.hasEventListener=null,b._listeners=null,createjs.EventDispatcher.initialize(b),b.initialize=function(a,b,c,d,e,f,g,h,i){this.type=a,this.stageX=b,this.stageY=c,this.target=d,this.nativeEvent=e,this.pointerID=f,this.primary=g,this.rawX=null==h?b:h,this.rawY=null==i?c:i},b.clone=function(){return new a(this.type,this.stageX,this.stageY,this.target,this.nativeEvent,this.pointerID,this.primary,this.rawX,this.rawY)},b.toString=function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"},createjs.MouseEvent=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c,d,e,f){this.initialize(a,b,c,d,e,f)},b=a.prototype;a.identity=null,a.DEG_TO_RAD=Math.PI/180,b.a=1,b.b=0,b.c=0,b.d=1,b.tx=0,b.ty=0,b.alpha=1,b.shadow=null,b.compositeOperation=null,b.initialize=function(a,b,c,d,e,f){return null!=a&&(this.a=a),this.b=b||0,this.c=c||0,null!=d&&(this.d=d),this.tx=e||0,this.ty=f||0,this},b.prepend=function(a,b,c,d,e,f){var g=this.tx;if(1!=a||0!=b||0!=c||1!=d){var h=this.a,i=this.c;this.a=h*a+this.b*c,this.b=h*b+this.b*d,this.c=i*a+this.d*c,this.d=i*b+this.d*d}return this.tx=g*a+this.ty*c+e,this.ty=g*b+this.ty*d+f,this},b.append=function(a,b,c,d,e,f){var g=this.a,h=this.b,i=this.c,j=this.d;return this.a=a*g+b*i,this.b=a*h+b*j,this.c=c*g+d*i,this.d=c*h+d*j,this.tx=e*g+f*i+this.tx,this.ty=e*h+f*j+this.ty,this},b.prependMatrix=function(a){return this.prepend(a.a,a.b,a.c,a.d,a.tx,a.ty),this.prependProperties(a.alpha,a.shadow,a.compositeOperation),this},b.appendMatrix=function(a){return this.append(a.a,a.b,a.c,a.d,a.tx,a.ty),this.appendProperties(a.alpha,a.shadow,a.compositeOperation),this},b.prependTransform=function(b,c,d,e,f,g,h,i,j){if(f%360){var k=f*a.DEG_TO_RAD;f=Math.cos(k),k=Math.sin(k)}else f=1,k=0;return(i||j)&&(this.tx-=i,this.ty-=j),g||h?(g*=a.DEG_TO_RAD,h*=a.DEG_TO_RAD,this.prepend(f*d,k*d,-k*e,f*e,0,0),this.prepend(Math.cos(h),Math.sin(h),-Math.sin(g),Math.cos(g),b,c)):this.prepend(f*d,k*d,-k*e,f*e,b,c),this},b.appendTransform=function(b,c,d,e,f,g,h,i,j){if(f%360){var k=f*a.DEG_TO_RAD;f=Math.cos(k),k=Math.sin(k)}else f=1,k=0;return g||h?(g*=a.DEG_TO_RAD,h*=a.DEG_TO_RAD,this.append(Math.cos(h),Math.sin(h),-Math.sin(g),Math.cos(g),b,c),this.append(f*d,k*d,-k*e,f*e,0,0)):this.append(f*d,k*d,-k*e,f*e,b,c),(i||j)&&(this.tx-=i*this.a+j*this.c,this.ty-=i*this.b+j*this.d),this},b.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.a,d=this.c,e=this.tx;return this.a=c*b-this.b*a,this.b=c*a+this.b*b,this.c=d*b-this.d*a,this.d=d*a+this.d*b,this.tx=e*b-this.ty*a,this.ty=e*a+this.ty*b,this},b.skew=function(b,c){return b*=a.DEG_TO_RAD,c*=a.DEG_TO_RAD,this.append(Math.cos(c),Math.sin(c),-Math.sin(b),Math.cos(b),0,0),this},b.scale=function(a,b){return this.a*=a,this.d*=b,this.c*=a,this.b*=b,this.tx*=a,this.ty*=b,this},b.translate=function(a,b){return this.tx+=a,this.ty+=b,this},b.identity=function(){return this.alpha=this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.shadow=this.compositeOperation=null,this},b.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=a*d-b*c;return this.a=d/f,this.b=-b/f,this.c=-c/f,this.d=a/f,this.tx=(c*this.ty-d*e)/f,this.ty=-(a*this.ty-b*e)/f,this},b.isIdentity=function(){return 0==this.tx&&0==this.ty&&1==this.a&&0==this.b&&0==this.c&&1==this.d},b.decompose=function(b){null==b&&(b={}),b.x=this.tx,b.y=this.ty,b.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),b.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var c=Math.atan2(-this.c,this.d),d=Math.atan2(this.b,this.a);return c==d?(b.rotation=d/a.DEG_TO_RAD,0>this.a&&0<=this.d&&(b.rotation+=0>=b.rotation?180:-180),b.skewX=b.skewY=0):(b.skewX=c/a.DEG_TO_RAD,b.skewY=d/a.DEG_TO_RAD),b},b.reinitialize=function(a,b,c,d,e,f,g,h,i){return this.initialize(a,b,c,d,e,f),this.alpha=g||1,this.shadow=h,this.compositeOperation=i,this},b.appendProperties=function(a,b,c){return this.alpha*=a,this.shadow=b||this.shadow,this.compositeOperation=c||this.compositeOperation,this},b.prependProperties=function(a,b,c){return this.alpha*=a,this.shadow=this.shadow||b,this.compositeOperation=this.compositeOperation||c,this},b.clone=function(){var b=new a(this.a,this.b,this.c,this.d,this.tx,this.ty);return b.shadow=this.shadow,b.alpha=this.alpha,b.compositeOperation=this.compositeOperation,b},b.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},a.identity=new a(1,0,0,1,0,0),createjs.Matrix2D=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b){this.initialize(a,b)},b=a.prototype;b.x=0,b.y=0,b.initialize=function(a,b){this.x=null==a?0:a,this.y=null==b?0:b},b.clone=function(){return new a(this.x,this.y)},b.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},createjs.Point=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c,d){this.initialize(a,b,c,d)},b=a.prototype;b.x=0,b.y=0,b.width=0,b.height=0,b.initialize=function(a,b,c,d){this.x=null==a?0:a,this.y=null==b?0:b,this.width=null==c?0:c,this.height=null==d?0:d},b.clone=function(){return new a(this.x,this.y,this.width,this.height)},b.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"},createjs.Rectangle=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c,d,e,f,g){this.initialize(a,b,c,d,e,f,g)},b=a.prototype;b.target=null,b.overLabel=null,b.outLabel=null,b.downLabel=null,b.play=!1,b._isPressed=!1,b._isOver=!1,b.initialize=function(a,b,c,d,e,f,g){a.addEventListener&&(this.target=a,a.cursor="pointer",this.overLabel=null==c?"over":c,this.outLabel=null==b?"out":b,this.downLabel=null==d?"down":d,this.play=e,this.setEnabled(!0),this.handleEvent({}),f&&(g&&(f.actionsEnabled=!1,f.gotoAndStop&&f.gotoAndStop(g)),a.hitArea=f))},b.setEnabled=function(a){var b=this.target;a?(b.addEventListener("mouseover",this),b.addEventListener("mouseout",this),b.addEventListener("mousedown",this)):(b.removeEventListener("mouseover",this),b.removeEventListener("mouseout",this),b.removeEventListener("mousedown",this))},b.toString=function(){return"[ButtonHelper]"},b.handleEvent=function(a){var b=this.target,c=a.type;"mousedown"==c?(a.addEventListener("mouseup",this),this._isPressed=!0,a=this.downLabel):"mouseup"==c?(this._isPressed=!1,a=this._isOver?this.overLabel:this.outLabel):"mouseover"==c?(this._isOver=!0,a=this._isPressed?this.downLabel:this.overLabel):(this._isOver=!1,a=this._isPressed?this.overLabel:this.outLabel),this.play?b.gotoAndPlay&&b.gotoAndPlay(a):b.gotoAndStop&&b.gotoAndStop(a)},createjs.ButtonHelper=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c,d){this.initialize(a,b,c,d)},b=a.prototype;a.identity=null,b.color=null,b.offsetX=0,b.offsetY=0,b.blur=0,b.initialize=function(a,b,c,d){this.color=a,this.offsetX=b,this.offsetY=c,this.blur=d},b.toString=function(){return"[Shadow]"},b.clone=function(){return new a(this.color,this.offsetX,this.offsetY,this.blur)},a.identity=new a("transparent",0,0,0),createjs.Shadow=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype;b.complete=!0,b.onComplete=null,b.addEventListener=null,b.removeEventListener=null,b.removeAllEventListeners=null,b.dispatchEvent=null,b.hasEventListener=null,b._listeners=null,createjs.EventDispatcher.initialize(b),b._animations=null,b._frames=null,b._images=null,b._data=null,b._loadCount=0,b._frameHeight=0,b._frameWidth=0,b._numFrames=0,b._regX=0,b._regY=0,b.initialize=function(a){var b,c,d;if(null!=a){if(a.images&&0<(c=a.images.length))for(d=this._images=[],b=0;c>b;b++){var e=a.images[b];if("string"==typeof e){var f=e,e=new Image;e.src=f}d.push(e),!e.getContext&&!e.complete&&(this._loadCount++,this.complete=!1,function(a){e.onload=function(){a._handleImageLoad()}}(this))}if(null!=a.frames)if(a.frames instanceof Array)for(this._frames=[],d=a.frames,b=0,c=d.length;c>b;b++)f=d[b],this._frames.push({image:this._images[f[4]?f[4]:0],rect:new createjs.Rectangle(f[0],f[1],f[2],f[3]),regX:f[5]||0,regY:f[6]||0});else c=a.frames,this._frameWidth=c.width,this._frameHeight=c.height,this._regX=c.regX||0,this._regY=c.regY||0,this._numFrames=c.count,0==this._loadCount&&this._calculateFrames();if(null!=(c=a.animations)){this._animations=[],this._data={};for(var g in c){if(a={name:g},f=c[g],"number"==typeof f)d=a.frames=[f];else if(f instanceof Array)if(1==f.length)a.frames=[f[0]];else for(a.frequency=f[3],a.next=f[2],d=a.frames=[],b=f[0];b<=f[1];b++)d.push(b);else a.frequency=f.frequency,a.next=f.next,b=f.frames,d=a.frames="number"==typeof b?[b]:b.slice(0);a.next=2>d.length||0==a.next?null:null==a.next||1==a.next?g:a.next,a.frequency||(a.frequency=1),this._animations.push(g),this._data[g]=a}}}},b.getNumFrames=function(a){return null==a?this._frames?this._frames.length:this._numFrames:(a=this._data[a],null==a?0:a.frames.length)},b.getAnimations=function(){return this._animations.slice(0)},b.getAnimation=function(a){return this._data[a]},b.getFrame=function(a){var b;return this.complete&&this._frames&&(b=this._frames[a])?b:null},b.getFrameBounds=function(a){return(a=this.getFrame(a))?new createjs.Rectangle(-a.regX,-a.regY,a.rect.width,a.rect.height):null},b.toString=function(){return"[SpriteSheet]"},b.clone=function(){var b=new a;return b.complete=this.complete,b._animations=this._animations,b._frames=this._frames,b._images=this._images,b._data=this._data,b._frameHeight=this._frameHeight,b._frameWidth=this._frameWidth,b._numFrames=this._numFrames,b._loadCount=this._loadCount,b},b._handleImageLoad=function(){0==--this._loadCount&&(this._calculateFrames(),this.complete=!0,this.onComplete&&this.onComplete(),this.dispatchEvent("complete"))},b._calculateFrames=function(){if(!this._frames&&0!=this._frameWidth){this._frames=[];for(var a=0,b=this._frameWidth,c=this._frameHeight,d=0,e=this._images;d<e.length;d++){for(var f=e[d],g=0|(f.width+1)/b,h=0|(f.height+1)/c,h=0<this._numFrames?Math.min(this._numFrames-a,g*h):g*h,i=0;h>i;i++)this._frames.push({image:f,rect:new createjs.Rectangle(i%g*b,(0|i/g)*c,b,c),regX:this._regX,regY:this._regY});a+=h}this._numFrames=a}},createjs.SpriteSheet=a}(),this.createjs=this.createjs||{},function(){function a(a,b,c){this.f=a,this.params=b,this.path=null==c?!0:c}a.prototype.exec=function(a){this.f.apply(a,this.params)};var b=function(){this.initialize()},c=b.prototype;b.getRGB=function(a,b,c,d){return null!=a&&null==c&&(d=b,c=255&a,b=255&a>>8,a=255&a>>16),null==d?"rgb("+a+","+b+","+c+")":"rgba("+a+","+b+","+c+","+d+")"},b.getHSL=function(a,b,c,d){return null==d?"hsl("+a%360+","+b+"%,"+c+"%)":"hsla("+a%360+","+b+"%,"+c+"%,"+d+")"},b.BASE_64={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63},b.STROKE_CAPS_MAP=["butt","round","square"],b.STROKE_JOINTS_MAP=["miter","round","bevel"],b._ctx=(createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")).getContext("2d"),b.beginCmd=new a(b._ctx.beginPath,[],!1),b.fillCmd=new a(b._ctx.fill,[],!1),b.strokeCmd=new a(b._ctx.stroke,[],!1),c._strokeInstructions=null,c._strokeStyleInstructions=null,c._ignoreScaleStroke=!1,c._fillInstructions=null,c._instructions=null,c._oldInstructions=null,c._activeInstructions=null,c._active=!1,c._dirty=!1,c.initialize=function(){this.clear(),this._ctx=b._ctx},c.isEmpty=function(){return!(this._instructions.length||this._oldInstructions.length||this._activeInstructions.length)},c.draw=function(a){this._dirty&&this._updateInstructions();for(var b=this._instructions,c=0,d=b.length;d>c;c++)b[c].exec(a)},c.drawAsPath=function(a){this._dirty&&this._updateInstructions();for(var b,c=this._instructions,d=0,e=c.length;e>d;d++)((b=c[d]).path||0==d)&&b.exec(a)},c.moveTo=function(b,c){return this._activeInstructions.push(new a(this._ctx.moveTo,[b,c])),this},c.lineTo=function(b,c){return this._dirty=this._active=!0,this._activeInstructions.push(new a(this._ctx.lineTo,[b,c])),this},c.arcTo=function(b,c,d,e,f){return this._dirty=this._active=!0,this._activeInstructions.push(new a(this._ctx.arcTo,[b,c,d,e,f])),this},c.arc=function(b,c,d,e,f,g){return this._dirty=this._active=!0,null==g&&(g=!1),this._activeInstructions.push(new a(this._ctx.arc,[b,c,d,e,f,g])),this},c.quadraticCurveTo=function(b,c,d,e){return this._dirty=this._active=!0,this._activeInstructions.push(new a(this._ctx.quadraticCurveTo,[b,c,d,e])),this},c.bezierCurveTo=function(b,c,d,e,f,g){return this._dirty=this._active=!0,this._activeInstructions.push(new a(this._ctx.bezierCurveTo,[b,c,d,e,f,g])),this},c.rect=function(b,c,d,e){return this._dirty=this._active=!0,this._activeInstructions.push(new a(this._ctx.rect,[b,c,d,e])),this},c.closePath=function(){return this._active&&(this._dirty=!0,this._activeInstructions.push(new a(this._ctx.closePath,[]))),this},c.clear=function(){return this._instructions=[],this._oldInstructions=[],this._activeInstructions=[],this._strokeStyleInstructions=this._strokeInstructions=this._fillInstructions=null,this._active=this._dirty=!1,this},c.beginFill=function(c){return this._active&&this._newPath(),this._fillInstructions=c?[new a(this._setProp,["fillStyle",c],!1),b.fillCmd]:null,this},c.beginLinearGradientFill=function(c,d,e,f,g,h){for(this._active&&this._newPath(),e=this._ctx.createLinearGradient(e,f,g,h),f=0,g=c.length;g>f;f++)e.addColorStop(d[f],c[f]);return this._fillInstructions=[new a(this._setProp,["fillStyle",e],!1),b.fillCmd],this},c.beginRadialGradientFill=function(c,d,e,f,g,h,i,j){for(this._active&&this._newPath(),e=this._ctx.createRadialGradient(e,f,g,h,i,j),f=0,g=c.length;g>f;f++)e.addColorStop(d[f],c[f]);return this._fillInstructions=[new a(this._setProp,["fillStyle",e],!1),b.fillCmd],this},c.beginBitmapFill=function(c,d,e){return this._active&&this._newPath(),c=this._ctx.createPattern(c,d||""),c=new a(this._setProp,["fillStyle",c],!1),this._fillInstructions=e?[c,new a(this._ctx.save,[],!1),new a(this._ctx.transform,[e.a,e.b,e.c,e.d,e.tx,e.ty],!1),b.fillCmd,new a(this._ctx.restore,[],!1)]:[c,b.fillCmd],this},c.endFill=function(){return this.beginFill()},c.setStrokeStyle=function(c,d,e,f,g){return this._active&&this._newPath(),this._strokeStyleInstructions=[new a(this._setProp,["lineWidth",null==c?"1":c],!1),new a(this._setProp,["lineCap",null==d?"butt":isNaN(d)?d:b.STROKE_CAPS_MAP[d]],!1),new a(this._setProp,["lineJoin",null==e?"miter":isNaN(e)?e:b.STROKE_JOINTS_MAP[e]],!1),new a(this._setProp,["miterLimit",null==f?"10":f],!1)],this._ignoreScaleStroke=g,this},c.beginStroke=function(b){return this._active&&this._newPath(),this._strokeInstructions=b?[new a(this._setProp,["strokeStyle",b],!1)]:null,this},c.beginLinearGradientStroke=function(b,c,d,e,f,g){for(this._active&&this._newPath(),d=this._ctx.createLinearGradient(d,e,f,g),e=0,f=b.length;f>e;e++)d.addColorStop(c[e],b[e]);return this._strokeInstructions=[new a(this._setProp,["strokeStyle",d],!1)],this},c.beginRadialGradientStroke=function(b,c,d,e,f,g,h,i){for(this._active&&this._newPath(),d=this._ctx.createRadialGradient(d,e,f,g,h,i),e=0,f=b.length;f>e;e++)d.addColorStop(c[e],b[e]);return this._strokeInstructions=[new a(this._setProp,["strokeStyle",d],!1)],this},c.beginBitmapStroke=function(b,c){this._active&&this._newPath();var d=this._ctx.createPattern(b,c||"");return this._strokeInstructions=[new a(this._setProp,["strokeStyle",d],!1)],this},c.endStroke=function(){return this.beginStroke(),this},c.curveTo=c.quadraticCurveTo,c.drawRect=c.rect,c.drawRoundRect=function(a,b,c,d,e){return this.drawRoundRectComplex(a,b,c,d,e,e,e,e),this},c.drawRoundRectComplex=function(b,c,d,e,f,g,h,i){var j=(e>d?d:e)/2,k=0,l=0,m=0,n=0;0>f&&(f*=k=-1),f>j&&(f=j),0>g&&(g*=l=-1),g>j&&(g=j),0>h&&(h*=m=-1),h>j&&(h=j),0>i&&(i*=n=-1),i>j&&(i=j),this._dirty=this._active=!0;var j=this._ctx.arcTo,o=this._ctx.lineTo;return this._activeInstructions.push(new a(this._ctx.moveTo,[b+d-g,c]),new a(j,[b+d+g*l,c-g*l,b+d,c+g,g]),new a(o,[b+d,c+e-h]),new a(j,[b+d+h*m,c+e+h*m,b+d-h,c+e,h]),new a(o,[b+i,c+e]),new a(j,[b-i*n,c+e+i*n,b,c+e-i,i]),new a(o,[b,c+f]),new a(j,[b-f*k,c-f*k,b+f,c,f]),new a(this._ctx.closePath)),this},c.drawCircle=function(a,b,c){return this.arc(a,b,c,0,2*Math.PI),this},c.drawEllipse=function(b,c,d,e){this._dirty=this._active=!0;var f=.5522848*(d/2),g=.5522848*(e/2),h=b+d,i=c+e;return d=b+d/2,e=c+e/2,this._activeInstructions.push(new a(this._ctx.moveTo,[b,e]),new a(this._ctx.bezierCurveTo,[b,e-g,d-f,c,d,c]),new a(this._ctx.bezierCurveTo,[d+f,c,h,e-g,h,e]),new a(this._ctx.bezierCurveTo,[h,e+g,d+f,i,d,i]),new a(this._ctx.bezierCurveTo,[d-f,i,b,e+g,b,e])),this},c.drawPolyStar=function(b,c,d,e,f,g){this._dirty=this._active=!0,null==f&&(f=0),f=1-f,g=null==g?0:g/(180/Math.PI);var h=Math.PI/e;this._activeInstructions.push(new a(this._ctx.moveTo,[b+Math.cos(g)*d,c+Math.sin(g)*d]));for(var i=0;e>i;i++)g+=h,1!=f&&this._activeInstructions.push(new a(this._ctx.lineTo,[b+Math.cos(g)*d*f,c+Math.sin(g)*d*f])),g+=h,this._activeInstructions.push(new a(this._ctx.lineTo,[b+Math.cos(g)*d,c+Math.sin(g)*d]));return this},c.decodePath=function(a){for(var c=[this.moveTo,this.lineTo,this.quadraticCurveTo,this.bezierCurveTo,this.closePath],d=[2,2,4,6,0],e=0,f=a.length,g=[],h=0,i=0,j=b.BASE_64;f>e;){var k=a.charAt(e),l=j[k],m=l>>3,n=c[m];if(!n||3&l)throw"bad path data (@"+e+"): "+k;for(k=d[m],m||(h=i=0),g.length=0,e++,l=(1&l>>2)+2,m=0;k>m;m++){var o=j[a.charAt(e)],p=o>>5?-1:1,o=(31&o)<<6|j[a.charAt(e+1)];3==l&&(o=o<<6|j[a.charAt(e+2)]),o=p*o/10,m%2?h=o+=h:i=o+=i,g[m]=o,e+=l}n.apply(this,g)}return this},c.clone=function(){var a=new b;return a._instructions=this._instructions.slice(),a._activeInstructions=this._activeInstructions.slice(),a._oldInstructions=this._oldInstructions.slice(),this._fillInstructions&&(a._fillInstructions=this._fillInstructions.slice()),this._strokeInstructions&&(a._strokeInstructions=this._strokeInstructions.slice()),this._strokeStyleInstructions&&(a._strokeStyleInstructions=this._strokeStyleInstructions.slice()),a._active=this._active,a._dirty=this._dirty,a},c.toString=function(){return"[Graphics]"},c.mt=c.moveTo,c.lt=c.lineTo,c.at=c.arcTo,c.bt=c.bezierCurveTo,c.qt=c.quadraticCurveTo,c.a=c.arc,c.r=c.rect,c.cp=c.closePath,c.c=c.clear,c.f=c.beginFill,c.lf=c.beginLinearGradientFill,c.rf=c.beginRadialGradientFill,c.bf=c.beginBitmapFill,c.ef=c.endFill,c.ss=c.setStrokeStyle,c.s=c.beginStroke,c.ls=c.beginLinearGradientStroke,c.rs=c.beginRadialGradientStroke,c.bs=c.beginBitmapStroke,c.es=c.endStroke,c.dr=c.drawRect,c.rr=c.drawRoundRect,c.rc=c.drawRoundRectComplex,c.dc=c.drawCircle,c.de=c.drawEllipse,c.dp=c.drawPolyStar,c.p=c.decodePath,c._updateInstructions=function(){this._instructions=this._oldInstructions.slice(),this._instructions.push(b.beginCmd),this._instructions.push.apply(this._instructions,this._activeInstructions),this._fillInstructions&&this._instructions.push.apply(this._instructions,this._fillInstructions),this._strokeInstructions&&(this._strokeStyleInstructions&&this._instructions.push.apply(this._instructions,this._strokeStyleInstructions),this._instructions.push.apply(this._instructions,this._strokeInstructions),this._ignoreScaleStroke?this._instructions.push(new a(this._ctx.save,[],!1),new a(this._ctx.setTransform,[1,0,0,1,0,0],!1),b.strokeCmd,new a(this._ctx.restore,[],!1)):this._instructions.push(b.strokeCmd))},c._newPath=function(){this._dirty&&this._updateInstructions(),this._oldInstructions=this._instructions,this._activeInstructions=[],this._active=this._dirty=!1},c._setProp=function(a,b){this[a]=b},createjs.Graphics=b}(),this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype;a.suppressCrossDomainErrors=!1,a._hitTestCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),a._hitTestCanvas.width=a._hitTestCanvas.height=1,a._hitTestContext=a._hitTestCanvas.getContext("2d"),a._nextCacheID=1,b.alpha=1,b.cacheCanvas=null,b.id=-1,b.mouseEnabled=!0,b.name=null,b.parent=null,b.regX=0,b.regY=0,b.rotation=0,b.scaleX=1,b.scaleY=1,b.skewX=0,b.skewY=0,b.shadow=null,b.visible=!0,b.x=0,b.y=0,b.compositeOperation=null,b.snapToPixel=!1,b.onPress=null,b.onClick=null,b.onDoubleClick=null,b.onMouseOver=null,b.onMouseOut=null,b.onTick=null,b.filters=null,b.cacheID=0,b.mask=null,b.hitArea=null,b.cursor=null,b.addEventListener=null,b.removeEventListener=null,b.removeAllEventListeners=null,b.dispatchEvent=null,b.hasEventListener=null,b._listeners=null,createjs.EventDispatcher.initialize(b),b._cacheOffsetX=0,b._cacheOffsetY=0,b._cacheScale=1,b._cacheDataURLID=0,b._cacheDataURL=null,b._matrix=null,b.initialize=function(){this.id=createjs.UID.get(),this._matrix=new createjs.Matrix2D},b.isVisible=function(){return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY)},b.draw=function(a,b){var c=this.cacheCanvas;if(b||!c)return!1;var d=this._cacheScale;return a.drawImage(c,this._cacheOffsetX,this._cacheOffsetY,c.width/d,c.height/d),!0},b.updateContext=function(a){var b,c=this.mask;c&&c.graphics&&!c.graphics.isEmpty()&&(b=c.getMatrix(c._matrix),a.transform(b.a,b.b,b.c,b.d,b.tx,b.ty),c.graphics.drawAsPath(a),a.clip(),b.invert(),a.transform(b.a,b.b,b.c,b.d,b.tx,b.ty)),b=this._matrix.identity().appendTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY),createjs.Stage._snapToPixelEnabled&&this.snapToPixel?a.transform(b.a,b.b,b.c,b.d,0|b.tx+.5,0|b.ty+.5):a.transform(b.a,b.b,b.c,b.d,b.tx,b.ty),a.globalAlpha*=this.alpha,this.compositeOperation&&(a.globalCompositeOperation=this.compositeOperation),this.shadow&&this._applyShadow(a,this.shadow)},b.cache=function(a,b,c,d,e){e=e||1,this.cacheCanvas||(this.cacheCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),this.cacheCanvas.width=Math.ceil(c*e),this.cacheCanvas.height=Math.ceil(d*e),this._cacheOffsetX=a,this._cacheOffsetY=b,this._cacheScale=e||1,this.updateCache()
},b.updateCache=function(b){var c=this.cacheCanvas,d=this._cacheScale,e=this._cacheOffsetX*d,f=this._cacheOffsetY*d;if(!c)throw"cache() must be called before updateCache()";var g=c.getContext("2d");g.save(),b||g.clearRect(0,0,c.width+1,c.height+1),g.globalCompositeOperation=b,g.setTransform(d,0,0,d,-e,-f),this.draw(g,!0),this._applyFilters(),g.restore(),this.cacheID=a._nextCacheID++},b.uncache=function(){this._cacheDataURL=this.cacheCanvas=null,this.cacheID=this._cacheOffsetX=this._cacheOffsetY=0,this._cacheScale=1},b.getCacheDataURL=function(){return this.cacheCanvas?(this.cacheID!=this._cacheDataURLID&&(this._cacheDataURL=this.cacheCanvas.toDataURL()),this._cacheDataURL):null},b.getStage=function(){for(var a=this;a.parent;)a=a.parent;return a instanceof createjs.Stage?a:null},b.localToGlobal=function(a,b){var c=this.getConcatenatedMatrix(this._matrix);return null==c?null:(c.append(1,0,0,1,a,b),new createjs.Point(c.tx,c.ty))},b.globalToLocal=function(a,b){var c=this.getConcatenatedMatrix(this._matrix);return null==c?null:(c.invert(),c.append(1,0,0,1,a,b),new createjs.Point(c.tx,c.ty))},b.localToLocal=function(a,b,c){return a=this.localToGlobal(a,b),c.globalToLocal(a.x,a.y)},b.setTransform=function(a,b,c,d,e,f,g,h,i){return this.x=a||0,this.y=b||0,this.scaleX=null==c?1:c,this.scaleY=null==d?1:d,this.rotation=e||0,this.skewX=f||0,this.skewY=g||0,this.regX=h||0,this.regY=i||0,this},b.getMatrix=function(a){return(a?a.identity():new createjs.Matrix2D).appendTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY).appendProperties(this.alpha,this.shadow,this.compositeOperation)},b.getConcatenatedMatrix=function(a){a?a.identity():a=new createjs.Matrix2D;for(var b=this;null!=b;)a.prependTransform(b.x,b.y,b.scaleX,b.scaleY,b.rotation,b.skewX,b.skewY,b.regX,b.regY).prependProperties(b.alpha,b.shadow,b.compositeOperation),b=b.parent;return a},b.hitTest=function(b,c){var d=a._hitTestContext;d.setTransform(1,0,0,1,-b,-c),this.draw(d);var e=this._testHit(d);return d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,2,2),e},b.set=function(a){for(var b in a)this[b]=a[b];return this},b.clone=function(){var b=new a;return this.cloneProps(b),b},b.toString=function(){return"[DisplayObject (name="+this.name+")]"},b.cloneProps=function(a){a.alpha=this.alpha,a.name=this.name,a.regX=this.regX,a.regY=this.regY,a.rotation=this.rotation,a.scaleX=this.scaleX,a.scaleY=this.scaleY,a.shadow=this.shadow,a.skewX=this.skewX,a.skewY=this.skewY,a.visible=this.visible,a.x=this.x,a.y=this.y,a.mouseEnabled=this.mouseEnabled,a.compositeOperation=this.compositeOperation,this.cacheCanvas&&(a.cacheCanvas=this.cacheCanvas.cloneNode(!0),a.cacheCanvas.getContext("2d").putImageData(this.cacheCanvas.getContext("2d").getImageData(0,0,this.cacheCanvas.width,this.cacheCanvas.height),0,0))},b._applyShadow=function(a,b){b=b||Shadow.identity,a.shadowColor=b.color,a.shadowOffsetX=b.offsetX,a.shadowOffsetY=b.offsetY,a.shadowBlur=b.blur},b._tick=function(a){this.onTick&&this.onTick.apply(this,a);var b=this._listeners;b&&b.tick&&this.dispatchEvent({type:"tick",params:a})},b._testHit=function(b){try{var c=1<b.getImageData(0,0,1,1).data[3]}catch(d){if(!a.suppressCrossDomainErrors)throw"An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images."}return c},b._applyFilters=function(){if(this.filters&&0!=this.filters.length&&this.cacheCanvas)for(var a=this.filters.length,b=this.cacheCanvas.getContext("2d"),c=this.cacheCanvas.width,d=this.cacheCanvas.height,e=0;a>e;e++)this.filters[e].applyFilter(b,0,0,c,d)},b._hasMouseHandler=function(a){var b=this._listeners;return!!(1&a&&(this.onPress||this.onClick||this.onDoubleClick||b&&(this.hasEventListener("mousedown")||this.hasEventListener("click")||this.hasEventListener("dblclick")))||2&a&&(this.onMouseOver||this.onMouseOut||this.cursor||b&&(this.hasEventListener("mouseover")||this.hasEventListener("mouseout"))))},createjs.DisplayObject=a}(),this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype=new createjs.DisplayObject;b.children=null,b.DisplayObject_initialize=b.initialize,b.initialize=function(){this.DisplayObject_initialize(),this.children=[]},b.isVisible=function(){var a=this.cacheCanvas||this.children.length;return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&a)},b.DisplayObject_draw=b.draw,b.draw=function(a,b){if(this.DisplayObject_draw(a,b))return!0;for(var c=this.children.slice(0),d=0,e=c.length;e>d;d++){var f=c[d];f.isVisible()&&(a.save(),f.updateContext(a),f.draw(a),a.restore())}return!0},b.addChild=function(a){if(null==a)return a;var b=arguments.length;if(b>1){for(var c=0;b>c;c++)this.addChild(arguments[c]);return arguments[b-1]}return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.push(a),a},b.addChildAt=function(a,b){var c=arguments.length,d=arguments[c-1];if(0>d||d>this.children.length)return arguments[c-2];if(c>2){for(var e=0;c-1>e;e++)this.addChildAt(arguments[e],d+e);return arguments[c-2]}return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),a},b.removeChild=function(a){var b=arguments.length;if(b>1){for(var c=!0,d=0;b>d;d++)c=c&&this.removeChild(arguments[d]);return c}return this.removeChildAt(this.children.indexOf(a))},b.removeChildAt=function(a){var b=arguments.length;if(b>1){for(var c=[],d=0;b>d;d++)c[d]=arguments[d];c.sort(function(a,b){return b-a});for(var e=!0,d=0;b>d;d++)e=e&&this.removeChildAt(c[d]);return e}return 0>a||a>this.children.length-1?!1:((b=this.children[a])&&(b.parent=null),this.children.splice(a,1),!0)},b.removeAllChildren=function(){for(var a=this.children;a.length;)a.pop().parent=null},b.getChildAt=function(a){return this.children[a]},b.getChildByName=function(a){for(var b=this.children,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},b.sortChildren=function(a){this.children.sort(a)},b.getChildIndex=function(a){return this.children.indexOf(a)},b.getNumChildren=function(){return this.children.length},b.swapChildrenAt=function(a,b){var c=this.children,d=c[a],e=c[b];d&&e&&(c[a]=e,c[b]=d)},b.swapChildren=function(a,b){for(var c,d,e=this.children,f=0,g=e.length;g>f&&(e[f]==a&&(c=f),e[f]==b&&(d=f),!(null!=c&&null!=d));f++);f!=g&&(e[c]=b,e[d]=a)},b.setChildIndex=function(a,b){var c=this.children,d=c.length;if(!(a.parent!=this||0>b||b>=d)){for(var e=0;d>e&&c[e]!=a;e++);e==d||e==b||(c.splice(e,1),e>b&&b--,c.splice(b,0,a))}},b.contains=function(a){for(;a;){if(a==this)return!0;a=a.parent}return!1},b.hitTest=function(a,b){return null!=this.getObjectUnderPoint(a,b)},b.getObjectsUnderPoint=function(a,b){var c=[],d=this.localToGlobal(a,b);return this._getObjectsUnderPoint(d.x,d.y,c),c},b.getObjectUnderPoint=function(a,b){var c=this.localToGlobal(a,b);return this._getObjectsUnderPoint(c.x,c.y)},b.clone=function(b){var c=new a;if(this.cloneProps(c),b)for(var d=c.children=[],e=0,f=this.children.length;f>e;e++){var g=this.children[e].clone(b);g.parent=c,d.push(g)}return c},b.toString=function(){return"[Container (name="+this.name+")]"},b.DisplayObject__tick=b._tick,b._tick=function(a){for(var b=this.children.length-1;b>=0;b--){var c=this.children[b];c._tick&&c._tick(a)}this.DisplayObject__tick(a)},b._getObjectsUnderPoint=function(b,c,d,e){var f=createjs.DisplayObject._hitTestContext,g=this._matrix,h=this._hasMouseHandler(e);if(!this.hitArea&&this.cacheCanvas&&h&&(this.getConcatenatedMatrix(g),f.setTransform(g.a,g.b,g.c,g.d,g.tx-b,g.ty-c),f.globalAlpha=g.alpha,this.draw(f),this._testHit(f)))return f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,2,2),this;for(var i=this.children.length-1;i>=0;i--){var j=this.children[i],k=j.hitArea;if(j.visible&&(k||j.isVisible())&&(!e||j.mouseEnabled)){var l=e&&j._hasMouseHandler(e);if(!(j instanceof a)||k&&l){if((!e||h||l)&&(j.getConcatenatedMatrix(g),k&&(g.appendTransform(k.x,k.y,k.scaleX,k.scaleY,k.rotation,k.skewX,k.skewY,k.regX,k.regY),g.alpha=k.alpha),f.globalAlpha=g.alpha,f.setTransform(g.a,g.b,g.c,g.d,g.tx-b,g.ty-c),(k||j).draw(f),this._testHit(f))){if(f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,2,2),h)return this;if(!d)return j;d.push(j)}}else if(h){if(j=j._getObjectsUnderPoint(b,c))return this}else if(j=j._getObjectsUnderPoint(b,c,d,e),!d&&j)return j}}return null},createjs.Container=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype=new createjs.Container;a._snapToPixelEnabled=!1,b.autoClear=!0,b.canvas=null,b.mouseX=0,b.mouseY=0,b.onMouseMove=null,b.onMouseUp=null,b.onMouseDown=null,b.snapToPixelEnabled=!1,b.mouseInBounds=!1,b.tickOnUpdate=!0,b.mouseMoveOutside=!1,b._pointerData=null,b._pointerCount=0,b._primaryPointerID=null,b._mouseOverIntervalID=null,b.Container_initialize=b.initialize,b.initialize=function(a){this.Container_initialize(),this.canvas="string"==typeof a?document.getElementById(a):a,this._pointerData={},this.enableDOMEvents(!0)},b.update=function(){if(this.canvas){this.autoClear&&this.clear(),a._snapToPixelEnabled=this.snapToPixelEnabled,this.tickOnUpdate&&this._tick(arguments.length?arguments:null);var b=this.canvas.getContext("2d");b.save(),this.updateContext(b),this.draw(b,!1),b.restore()}},b.tick=b.update,b.handleEvent=function(a){"tick"==a.type&&this.update(a)},b.clear=function(){if(this.canvas){var a=this.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)}},b.toDataURL=function(a,b){b||(b="image/png");var c,d=this.canvas.getContext("2d"),e=this.canvas.width,f=this.canvas.height;if(a){c=d.getImageData(0,0,e,f);var g=d.globalCompositeOperation;d.globalCompositeOperation="destination-over",d.fillStyle=a,d.fillRect(0,0,e,f)}var h=this.canvas.toDataURL(b);return a&&(d.clearRect(0,0,e+1,f+1),d.putImageData(c,0,0),d.globalCompositeOperation=g),h},b.enableMouseOver=function(a){if(this._mouseOverIntervalID&&(clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=null),null==a)a=20;else if(0>=a)return;var b=this;this._mouseOverIntervalID=setInterval(function(){b._testMouseOver()},1e3/Math.min(50,a))},b.enableDOMEvents=function(a){null==a&&(a=!0);var b,c=this._eventListeners;if(!a&&c){for(b in c)a=c[b],a.t.removeEventListener(b,a.f);this._eventListeners=null}else if(a&&!c&&this.canvas){a=window.addEventListener?window:document;var d=this,c=this._eventListeners={};c.mouseup={t:a,f:function(a){d._handleMouseUp(a)}},c.mousemove={t:a,f:function(a){d._handleMouseMove(a)}},c.dblclick={t:a,f:function(a){d._handleDoubleClick(a)}},c.mousedown={t:this.canvas,f:function(a){d._handleMouseDown(a)}};for(b in c)a=c[b],a.t.addEventListener(b,a.f)}},b.clone=function(){var b=new a(null);return this.cloneProps(b),b},b.toString=function(){return"[Stage (name="+this.name+")]"},b._getPointerData=function(a){var b=this._pointerData[a];return b||(b=this._pointerData[a]={x:0,y:0},null!=this._primaryPointerID&&-1!=this._primaryPointerID)||(this._primaryPointerID=a),b},b._handleMouseMove=function(a){a||(a=window.event),this._handlePointerMove(-1,a,a.pageX,a.pageY)},b._handlePointerMove=function(a,b,c,d){if(this.canvas){var e=this._getPointerData(a),f=e.inBounds;this._updatePointerPosition(a,c,d),(f||e.inBounds||this.mouseMoveOutside)&&((this.onMouseMove||this.hasEventListener("stagemousemove"))&&(c=new createjs.MouseEvent("stagemousemove",e.x,e.y,this,b,a,a==this._primaryPointerID,e.rawX,e.rawY),this.onMouseMove&&this.onMouseMove(c),this.dispatchEvent(c)),(d=e.event)&&(d.onMouseMove||d.hasEventListener("mousemove"))&&(c=new createjs.MouseEvent("mousemove",e.x,e.y,d.target,b,a,a==this._primaryPointerID,e.rawX,e.rawY),d.onMouseMove&&d.onMouseMove(c),d.dispatchEvent(c,d.target)))}},b._updatePointerPosition=function(a,b,c){var d=this._getElementRect(this.canvas);b-=d.left,c-=d.top;var e=this.canvas.width,f=this.canvas.height;b/=(d.right-d.left)/e,c/=(d.bottom-d.top)/f,d=this._getPointerData(a),(d.inBounds=b>=0&&c>=0&&e-1>=b&&f-1>=c)?(d.x=b,d.y=c):this.mouseMoveOutside&&(d.x=0>b?0:b>e-1?e-1:b,d.y=0>c?0:c>f-1?f-1:c),d.rawX=b,d.rawY=c,a==this._primaryPointerID&&(this.mouseX=d.x,this.mouseY=d.y,this.mouseInBounds=d.inBounds)},b._getElementRect=function(a){var b;try{b=a.getBoundingClientRect()}catch(c){b={top:a.offsetTop,left:a.offsetLeft,width:a.offsetWidth,height:a.offsetHeight}}var d=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0),e=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0),f=window.getComputedStyle?getComputedStyle(a):a.currentStyle;a=parseInt(f.paddingLeft)+parseInt(f.borderLeftWidth);var g=parseInt(f.paddingTop)+parseInt(f.borderTopWidth),h=parseInt(f.paddingRight)+parseInt(f.borderRightWidth),f=parseInt(f.paddingBottom)+parseInt(f.borderBottomWidth);return{left:b.left+d+a,right:b.right+d-h,top:b.top+e+g,bottom:b.bottom+e-f}},b._handleMouseUp=function(a){this._handlePointerUp(-1,a,!1)},b._handlePointerUp=function(a,b,c){var d,e=this._getPointerData(a);(this.onMouseMove||this.hasEventListener("stagemouseup"))&&(d=new createjs.MouseEvent("stagemouseup",e.x,e.y,this,b,a,a==this._primaryPointerID,e.rawX,e.rawY),this.onMouseUp&&this.onMouseUp(d),this.dispatchEvent(d));var f=e.event;f&&(f.onMouseUp||f.hasEventListener("mouseup"))&&(d=new createjs.MouseEvent("mouseup",e.x,e.y,f.target,b,a,a==this._primaryPointerID,e.rawX,e.rawY),f.onMouseUp&&f.onMouseUp(d),f.dispatchEvent(d,f.target)),(f=e.target)&&(f.onClick||f.hasEventListener("click"))&&this._getObjectsUnderPoint(e.x,e.y,null,!0,this._mouseOverIntervalID?3:1)==f&&(d=new createjs.MouseEvent("click",e.x,e.y,f,b,a,a==this._primaryPointerID,e.rawX,e.rawY),f.onClick&&f.onClick(d),f.dispatchEvent(d)),c?(a==this._primaryPointerID&&(this._primaryPointerID=null),delete this._pointerData[a]):e.event=e.target=null},b._handleMouseDown=function(a){this._handlePointerDown(-1,a,!1)},b._handlePointerDown=function(a,b,c,d){var e=this._getPointerData(a);null!=d&&this._updatePointerPosition(a,c,d),(this.onMouseDown||this.hasEventListener("stagemousedown"))&&(c=new createjs.MouseEvent("stagemousedown",e.x,e.y,this,b,a,a==this._primaryPointerID,e.rawX,e.rawY),this.onMouseDown&&this.onMouseDown(c),this.dispatchEvent(c)),(d=this._getObjectsUnderPoint(e.x,e.y,null,this._mouseOverIntervalID?3:1))&&(e.target=d,(d.onPress||d.hasEventListener("mousedown"))&&(c=new createjs.MouseEvent("mousedown",e.x,e.y,d,b,a,a==this._primaryPointerID,e.rawX,e.rawY),d.onPress&&d.onPress(c),d.dispatchEvent(c),(c.onMouseMove||c.onMouseUp||c.hasEventListener("mousemove")||c.hasEventListener("mouseup"))&&(e.event=c)))},b._testMouseOver=function(){if(-1==this._primaryPointerID&&(this.mouseX!=this._mouseOverX||this.mouseY!=this._mouseOverY||!this.mouseInBounds)){var a=null;this.mouseInBounds&&(a=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,3),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY);var b=this._mouseOverTarget;if(b!=a){var c=this._getPointerData(-1);if(b&&(b.onMouseOut||b.hasEventListener("mouseout"))){var d=new createjs.MouseEvent("mouseout",c.x,c.y,b,null,-1,c.rawX,c.rawY);b.onMouseOut&&b.onMouseOut(d),b.dispatchEvent(d)}b&&(this.canvas.style.cursor=""),a&&(a.onMouseOver||a.hasEventListener("mouseover"))&&(d=new createjs.MouseEvent("mouseover",c.x,c.y,a,null,-1,c.rawX,c.rawY),a.onMouseOver&&a.onMouseOver(d),a.dispatchEvent(d)),a&&(this.canvas.style.cursor=a.cursor||""),this._mouseOverTarget=a}}},b._handleDoubleClick=function(a){var b=this._getPointerData(-1),c=this._getObjectsUnderPoint(b.x,b.y,null,this._mouseOverIntervalID?3:1);c&&(c.onDoubleClick||c.hasEventListener("dblclick"))&&(evt=new createjs.MouseEvent("dblclick",b.x,b.y,c,a,-1,!0,b.rawX,b.rawY),c.onDoubleClick&&c.onDoubleClick(evt),c.dispatchEvent(evt))},createjs.Stage=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype=new createjs.DisplayObject;b.image=null,b.snapToPixel=!0,b.sourceRect=null,b.DisplayObject_initialize=b.initialize,b.initialize=function(a){this.DisplayObject_initialize(),"string"==typeof a?(this.image=new Image,this.image.src=a):this.image=a},b.isVisible=function(){var a=this.cacheCanvas||this.image&&(this.image.complete||this.image.getContext||2<=this.image.readyState);return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&a)},b.DisplayObject_draw=b.draw,b.draw=function(a,b){if(this.DisplayObject_draw(a,b))return!0;var c=this.sourceRect;return c?a.drawImage(this.image,c.x,c.y,c.width,c.height,0,0,c.width,c.height):a.drawImage(this.image,0,0),!0},b.clone=function(){var b=new a(this.image);return this.sourceRect&&(b.sourceRect=this.sourceRect.clone()),this.cloneProps(b),b},b.toString=function(){return"[Bitmap (name="+this.name+")]"},createjs.Bitmap=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype=new createjs.DisplayObject;b.onAnimationEnd=null,b.currentFrame=-1,b.currentAnimation=null,b.paused=!0,b.spriteSheet=null,b.snapToPixel=!0,b.offset=0,b.currentAnimationFrame=0,b.addEventListener=null,b.removeEventListener=null,b.removeAllEventListeners=null,b.dispatchEvent=null,b.hasEventListener=null,b._listeners=null,createjs.EventDispatcher.initialize(b),b._advanceCount=0,b._animation=null,b.DisplayObject_initialize=b.initialize,b.initialize=function(a){this.DisplayObject_initialize(),this.spriteSheet=a},b.isVisible=function(){var a=this.cacheCanvas||this.spriteSheet.complete&&0<=this.currentFrame;return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&a)},b.DisplayObject_draw=b.draw,b.draw=function(a,b){if(this.DisplayObject_draw(a,b))return!0;this._normalizeFrame();var c=this.spriteSheet.getFrame(this.currentFrame);if(c){var d=c.rect;return a.drawImage(c.image,d.x,d.y,d.width,d.height,-c.regX,-c.regY,d.width,d.height),!0}},b.play=function(){this.paused=!1},b.stop=function(){this.paused=!0},b.gotoAndPlay=function(a){this.paused=!1,this._goto(a)},b.gotoAndStop=function(a){this.paused=!0,this._goto(a)},b.advance=function(){this._animation?this.currentAnimationFrame++:this.currentFrame++,this._normalizeFrame()},b.getBounds=function(){return this.spriteSheet.getFrameBounds(this.currentFrame)},b.clone=function(){var b=new a(this.spriteSheet);return this.cloneProps(b),b},b.toString=function(){return"[BitmapAnimation (name="+this.name+")]"},b.DisplayObject__tick=b._tick,b._tick=function(a){var b=this._animation?this._animation.frequency:1;!this.paused&&0==(++this._advanceCount+this.offset)%b&&this.advance(),this.DisplayObject__tick(a)},b._normalizeFrame=function(){var a,b=this._animation,c=this.currentFrame,d=this.paused;if(b)if(a=b.frames.length,this.currentAnimationFrame>=a){var e=b.next;this._dispatchAnimationEnd(b,c,d,e,a-1)||(e?this._goto(e):(this.paused=!0,this.currentAnimationFrame=b.frames.length-1,this.currentFrame=b.frames[this.currentAnimationFrame]))}else this.currentFrame=b.frames[this.currentAnimationFrame];else a=this.spriteSheet.getNumFrames(),c>=a&&!this._dispatchAnimationEnd(b,c,d,a-1)&&(this.currentFrame=0)},b._dispatchAnimationEnd=function(a,b,c,d,e){var f=a?a.name:null;return this.onAnimationEnd&&this.onAnimationEnd(this,f,d),this.dispatchEvent({type:"animationend",name:f,next:d}),!c&&this.paused&&(this.currentAnimationFrame=e),this.paused!=c||this._animation!=a||this.currentFrame!=b},b.DisplayObject_cloneProps=b.cloneProps,b.cloneProps=function(a){this.DisplayObject_cloneProps(a),a.onAnimationEnd=this.onAnimationEnd,a.currentFrame=this.currentFrame,a.currentAnimation=this.currentAnimation,a.paused=this.paused,a.offset=this.offset,a._animation=this._animation,a.currentAnimationFrame=this.currentAnimationFrame},b._goto=function(a){if(isNaN(a)){var b=this.spriteSheet.getAnimation(a);b&&(this.currentAnimationFrame=0,this._animation=b,this.currentAnimation=a,this._normalizeFrame())}else this.currentAnimation=this._animation=null,this.currentFrame=a},createjs.BitmapAnimation=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype=new createjs.DisplayObject;b.graphics=null,b.DisplayObject_initialize=b.initialize,b.initialize=function(a){this.DisplayObject_initialize(),this.graphics=a?a:new createjs.Graphics},b.isVisible=function(){var a=this.cacheCanvas||this.graphics&&!this.graphics.isEmpty();return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&a)},b.DisplayObject_draw=b.draw,b.draw=function(a,b){return this.DisplayObject_draw(a,b)?!0:(this.graphics.draw(a),!0)},b.clone=function(b){return b=new a(b&&this.graphics?this.graphics.clone():this.graphics),this.cloneProps(b),b},b.toString=function(){return"[Shape (name="+this.name+")]"},createjs.Shape=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c){this.initialize(a,b,c)},b=a.prototype=new createjs.DisplayObject;a._workingContext=(createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")).getContext("2d"),b.text="",b.font=null,b.color="#000",b.textAlign="left",b.textBaseline="top",b.maxWidth=null,b.outline=!1,b.lineHeight=0,b.lineWidth=null,b.DisplayObject_initialize=b.initialize,b.initialize=function(a,b,c){this.DisplayObject_initialize(),this.text=a,this.font=b,this.color=c?c:"#000"},b.isVisible=function(){var a=this.cacheCanvas||null!=this.text&&""!==this.text;return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&a)},b.DisplayObject_draw=b.draw,b.draw=function(a,b){return this.DisplayObject_draw(a,b)?!0:(this.outline?a.strokeStyle=this.color:a.fillStyle=this.color,a.font=this.font,a.textAlign=this.textAlign||"start",a.textBaseline=this.textBaseline||"alphabetic",this._drawText(a),!0)},b.getMeasuredWidth=function(){return this._getWorkingContext().measureText(this.text).width},b.getMeasuredLineHeight=function(){return 1.2*this._getWorkingContext().measureText("M").width},b.getMeasuredHeight=function(){return this._drawText()*(this.lineHeight||this.getMeasuredLineHeight())},b.clone=function(){var b=new a(this.text,this.font,this.color);return this.cloneProps(b),b},b.toString=function(){return"[Text (text="+(20<this.text.length?this.text.substr(0,17)+"...":this.text)+")]"},b.DisplayObject_cloneProps=b.cloneProps,b.cloneProps=function(a){this.DisplayObject_cloneProps(a),a.textAlign=this.textAlign,a.textBaseline=this.textBaseline,a.maxWidth=this.maxWidth,a.outline=this.outline,a.lineHeight=this.lineHeight,a.lineWidth=this.lineWidth},b._getWorkingContext=function(){var b=a._workingContext;return b.font=this.font,b.textAlign=this.textAlign||"start",b.textBaseline=this.textBaseline||"alphabetic",b},b._drawText=function(a){var b=!!a;b||(a=this._getWorkingContext());for(var c=String(this.text).split(/(?:\r\n|\r|\n)/),d=this.lineHeight||this.getMeasuredLineHeight(),e=0,f=0,g=c.length;g>f;f++){var h=a.measureText(c[f]).width;if(null==this.lineWidth||h<this.lineWidth)b&&this._drawTextLine(a,c[f],e*d);else{for(var h=c[f].split(/(\s)/),i=h[0],j=1,k=h.length;k>j;j+=2)a.measureText(i+h[j]+h[j+1]).width>this.lineWidth?(b&&this._drawTextLine(a,i,e*d),e++,i=h[j+1]):i+=h[j]+h[j+1];b&&this._drawTextLine(a,i,e*d)}e++}return e},b._drawTextLine=function(a,b,c){this.outline?a.strokeText(b,0,c,this.maxWidth||65535):a.fillText(b,0,c,this.maxWidth||65535)},createjs.Text=a}(),this.createjs=this.createjs||{},function(){var a=function(){throw"SpriteSheetUtils cannot be instantiated"};a._workingCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),a._workingContext=a._workingCanvas.getContext("2d"),a.addFlippedFrames=function(b,c,d,e){if(c||d||e){var f=0;c&&a._flip(b,++f,!0,!1),d&&a._flip(b,++f,!1,!0),e&&a._flip(b,++f,!0,!0)}},a.extractFrame=function(b,c){isNaN(c)&&(c=b.getAnimation(c).frames[0]);var d=b.getFrame(c);if(!d)return null;var e=d.rect,f=a._workingCanvas;return f.width=e.width,f.height=e.height,a._workingContext.drawImage(d.image,e.x,e.y,e.width,e.height,0,0,e.width,e.height),d=new Image,d.src=f.toDataURL("image/png"),d},a.mergeAlpha=function(a,b,c){c||(c=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),c.width=Math.max(b.width,a.width),c.height=Math.max(b.height,a.height);var d=c.getContext("2d");return d.save(),d.drawImage(a,0,0),d.globalCompositeOperation="destination-in",d.drawImage(b,0,0),d.restore(),c},a._flip=function(b,c,d,e){for(var f=b._images,g=a._workingCanvas,h=a._workingContext,i=f.length/c,j=0;i>j;j++){var k=f[j];k.__tmp=j,h.setTransform(1,0,0,1,0,0),h.clearRect(0,0,g.width+1,g.height+1),g.width=k.width,g.height=k.height,h.setTransform(d?-1:1,0,0,e?-1:1,d?k.width:0,e?k.height:0),h.drawImage(k,0,0);var l=new Image;l.src=g.toDataURL("image/png"),l.width=k.width,l.height=k.height,f.push(l)}for(h=b._frames,g=h.length/c,j=0;g>j;j++){var k=h[j],m=k.rect.clone(),l=f[k.image.__tmp+i*c],n={image:l,rect:m,regX:k.regX,regY:k.regY};d&&(m.x=l.width-m.x-m.width,n.regX=m.width-k.regX),e&&(m.y=l.height-m.y-m.height,n.regY=m.height-k.regY),h.push(n)}for(d="_"+(d?"h":"")+(e?"v":""),e=b._animations,b=b._data,f=e.length/c,j=0;f>j;j++){for(h=e[j],k=b[h],i={name:h+d,frequency:k.frequency,next:k.next,frames:[]},k.next&&(i.next+=d),h=k.frames,k=0,l=h.length;l>k;k++)i.frames.push(h[k]+g*c);b[i.name]=i,e.push(i.name)}},createjs.SpriteSheetUtils=a}(),this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype;a.ERR_DIMENSIONS="frame dimensions exceed max spritesheet dimensions",a.ERR_RUNNING="a build is already running",b.maxWidth=2048,b.maxHeight=2048,b.spriteSheet=null,b.scale=1,b.padding=1,b.timeSlice=.3,b.progress=-1,b.onComplete=null,b.onProgress=null,b.addEventListener=null,b.removeEventListener=null,b.removeAllEventListeners=null,b.dispatchEvent=null,b.hasEventListener=null,b._listeners=null,createjs.EventDispatcher.initialize(b),b._frames=null,b._animations=null,b._data=null,b._nextFrameIndex=0,b._index=0,b._timerID=null,b._scale=1,b.initialize=function(){this._frames=[],this._animations={}},b.addFrame=function(b,c,d,e,f,g){if(this._data)throw a.ERR_RUNNING;return c=c||b.bounds||b.nominalBounds,!c&&b.getBounds&&(c=b.getBounds()),c?(d=d||1,this._frames.push({source:b,sourceRect:c,scale:d,funct:e,params:f,scope:g,index:this._frames.length,height:c.height*d})-1):null},b.addAnimation=function(b,c,d,e){if(this._data)throw a.ERR_RUNNING;this._animations[b]={frames:c,next:d,frequency:e}},b.addMovieClip=function(b,c,d){if(this._data)throw a.ERR_RUNNING;var e=b.frameBounds,f=c||b.bounds||b.nominalBounds;if(!f&&b.getBounds&&(f=b.getBounds()),!f&&!e)return null;c=this._frames.length;for(var g=b.timeline.duration,h=0;g>h;h++)this.addFrame(b,e&&e[h]?e[h]:f,d,function(a){var b=this.actionsEnabled;this.actionsEnabled=!1,this.gotoAndStop(a),this.actionsEnabled=b},[h],b);h=b.timeline._labels,b=[];for(var i in h)b.push({index:h[i],label:i});if(b.length)for(b.sort(function(a,b){return a.index-b.index}),h=0,i=b.length;i>h;h++){d=b[h].label;for(var e=c+(h==i-1?g:b[h+1].index),f=[],j=c+b[h].index;e>j;j++)f.push(j);this.addAnimation(d,f,!0)}},b.build=function(){if(this._data)throw a.ERR_RUNNING;for(this._startBuild();this._drawNext(););return this._endBuild(),this.spriteSheet},b.buildAsync=function(b){if(this._data)throw a.ERR_RUNNING;this.timeSlice=b,this._startBuild();var c=this;this._timerID=setTimeout(function(){c._run()},50-50*Math.max(.01,Math.min(.99,this.timeSlice||.3)))},b.stopAsync=function(){clearTimeout(this._timerID),this._data=null},b.clone=function(){throw"SpriteSheetBuilder cannot be cloned."},b.toString=function(){return"[SpriteSheetBuilder]"},b._startBuild=function(){var b=this.padding||0;this.progress=0,this.spriteSheet=null,this._index=0,this._scale=this.scale;var c=[];this._data={images:[],frames:c,animations:this._animations};var d=this._frames.slice();if(d.sort(function(a,b){return a.height<=b.height?-1:1}),d[d.length-1].height+2*b>this.maxHeight)throw a.ERR_DIMENSIONS;for(var e=0,f=0,g=0;d.length;){var h=this._fillRow(d,e,g,c,b);if(h.w>f&&(f=h.w),e+=h.h,!h.h||!d.length){var i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");i.width=this._getSize(f,this.maxWidth),i.height=this._getSize(e,this.maxHeight),this._data.images[g]=i,h.h||(f=e=0,g++)}}},b._getSize=function(a,b){for(var c=4;Math.pow(2,++c)<a;);return Math.min(b,Math.pow(2,c))},b._fillRow=function(b,c,d,e,f){var g=this.maxWidth,h=this.maxHeight;c+=f;for(var h=h-c,i=f,j=0,k=b.length-1;k>=0;k--){var l=b[k],m=this._scale*l.scale,n=l.sourceRect,o=l.source,p=Math.floor(m*n.x-f),q=Math.floor(m*n.y-f),r=Math.ceil(m*n.height+2*f),n=Math.ceil(m*n.width+2*f);if(n>g)throw a.ERR_DIMENSIONS;r>h||i+n>g||(l.img=d,l.rect=new createjs.Rectangle(i,c,n,r),j=j||r,b.splice(k,1),e[l.index]=[i,c,n,r,d,Math.round(-p+m*o.regX-f),Math.round(-q+m*o.regY-f)],i+=n)}return{w:i,h:j}},b._endBuild=function(){this.spriteSheet=new createjs.SpriteSheet(this._data),this._data=null,this.progress=1,this.onComplete&&this.onComplete(this),this.dispatchEvent("complete")},b._run=function(){for(var a=50*Math.max(.01,Math.min(.99,this.timeSlice||.3)),b=(new Date).getTime()+a,c=!1;b>(new Date).getTime();)if(!this._drawNext()){c=!0;break}if(c)this._endBuild();else{var d=this;this._timerID=setTimeout(function(){d._run()},50-a)}a=this.progress=this._index/this._frames.length,this.onProgress&&this.onProgress(this,a),this.dispatchEvent({type:"progress",progress:a})},b._drawNext=function(){var a=this._frames[this._index],b=a.scale*this._scale,c=a.rect,d=a.sourceRect,e=this._data.images[a.img].getContext("2d");return a.funct&&a.funct.apply(a.scope,a.params),e.save(),e.beginPath(),e.rect(c.x,c.y,c.width,c.height),e.clip(),e.translate(Math.ceil(c.x-d.x*b),Math.ceil(c.y-d.y*b)),e.scale(b,b),a.source.draw(e),e.restore(),++this._index<this._frames.length},createjs.SpriteSheetBuilder=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype=new createjs.DisplayObject;b.htmlElement=null,b._oldMtx=null,b.DisplayObject_initialize=b.initialize,b.initialize=function(a){"string"==typeof a&&(a=document.getElementById(a)),this.DisplayObject_initialize(),this.mouseEnabled=!1,this.htmlElement=a,a=a.style,a.position="absolute",a.transformOrigin=a.WebkitTransformOrigin=a.msTransformOrigin=a.MozTransformOrigin=a.OTransformOrigin="0% 0%"},b.isVisible=function(){return null!=this.htmlElement},b.draw=function(){if(null!=this.htmlElement){var a=this.getConcatenatedMatrix(this._matrix),b=this.htmlElement.style;if(!this.visible)return!0;b.visibility="visible";var c=this._oldMtx||{};return c.alpha!=a.alpha&&(b.opacity=""+a.alpha,c.alpha=a.alpha),(c.tx!=a.tx||c.ty!=a.ty||c.a!=a.a||c.b!=a.b||c.c!=a.c||c.d!=a.d)&&(b.transform=b.WebkitTransform=b.OTransform=b.msTransform=["matrix("+a.a,a.b,a.c,a.d,0|a.tx+.5,(0|a.ty+.5)+")"].join(),b.MozTransform=["matrix("+a.a,a.b,a.c,a.d,(0|a.tx+.5)+"px",(0|a.ty+.5)+"px)"].join(),this._oldMtx=a.clone()),!0}},b.cache=function(){},b.uncache=function(){},b.updateCache=function(){},b.hitTest=function(){},b.localToGlobal=function(){},b.globalToLocal=function(){},b.localToLocal=function(){},b.clone=function(){throw"DOMElement cannot be cloned."},b.toString=function(){return"[DOMElement (name="+this.name+")]"},b.DisplayObject__tick=b._tick,b._tick=function(a){this.htmlElement.style.visibility="hidden",this.DisplayObject__tick(a)},createjs.DOMElement=a}(),this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype;b.initialize=function(){},b.getBounds=function(){return new createjs.Rectangle(0,0,0,0)},b.applyFilter=function(){},b.toString=function(){return"[Filter]"},b.clone=function(){return new a},createjs.Filter=a}(),this.createjs=this.createjs||{},function(){var a=function(){throw"Touch cannot be instantiated"};a.isSupported=function(){return"ontouchstart"in window||window.navigator.msPointerEnabled},a.enable=function(b,c,d){return b&&b.canvas&&a.isSupported()?(b.__touch={pointers:{},multitouch:!c,preventDefault:!d,count:0},"ontouchstart"in window?a._IOS_enable(b):window.navigator.msPointerEnabled&&a._IE_enable(b),!0):!1},a.disable=function(b){b&&("ontouchstart"in window?a._IOS_disable(b):window.navigator.msPointerEnabled&&a._IE_disable(b))
},a._IOS_enable=function(b){var c=b.canvas,d=b.__touch.f=function(c){a._IOS_handleEvent(b,c)};c.addEventListener("touchstart",d,!1),c.addEventListener("touchmove",d,!1),c.addEventListener("touchend",d,!1),c.addEventListener("touchcancel",d,!1)},a._IOS_disable=function(a){var b=a.canvas;b&&(a=a.__touch.f,b.removeEventListener("touchstart",a,!1),b.removeEventListener("touchmove",a,!1),b.removeEventListener("touchend",a,!1),b.removeEventListener("touchcancel",a,!1))},a._IOS_handleEvent=function(a,b){if(a){a.__touch.preventDefault&&b.preventDefault&&b.preventDefault();for(var c=b.changedTouches,d=b.type,e=0,f=c.length;f>e;e++){var g=c[e],h=g.identifier;g.target==a.canvas&&("touchstart"==d?this._handleStart(a,h,b,g.pageX,g.pageY):"touchmove"==d?this._handleMove(a,h,b,g.pageX,g.pageY):("touchend"==d||"touchcancel"==d)&&this._handleEnd(a,h,b))}}},a._IE_enable=function(b){var c=b.canvas,d=b.__touch.f=function(c){a._IE_handleEvent(b,c)};c.addEventListener("MSPointerDown",d,!1),window.addEventListener("MSPointerMove",d,!1),window.addEventListener("MSPointerUp",d,!1),window.addEventListener("MSPointerCancel",d,!1),b.__touch.preventDefault&&(c.style.msTouchAction="none"),b.__touch.activeIDs={}},a._IE_disable=function(a){var b=a.__touch.f;window.removeEventListener("MSPointerMove",b,!1),window.removeEventListener("MSPointerUp",b,!1),window.removeEventListener("MSPointerCancel",b,!1),a.canvas&&a.canvas.removeEventListener("MSPointerDown",b,!1)},a._IE_handleEvent=function(a,b){if(a){a.__touch.preventDefault&&b.preventDefault&&b.preventDefault();var c=b.type,d=b.pointerId,e=a.__touch.activeIDs;"MSPointerDown"==c?b.srcElement==a.canvas&&(e[d]=!0,this._handleStart(a,d,b,b.pageX,b.pageY)):e[d]&&("MSPointerMove"==c?this._handleMove(a,d,b,b.pageX,b.pageY):("MSPointerUp"==c||"MSPointerCancel"==c)&&(delete e[d],this._handleEnd(a,d,b)))}},a._handleStart=function(a,b,c,d,e){var f=a.__touch;if(f.multitouch||!f.count){var g=f.pointers;g[b]||(g[b]=!0,f.count++,a._handlePointerDown(b,c,d,e))}},a._handleMove=function(a,b,c,d,e){a.__touch.pointers[b]&&a._handlePointerMove(b,c,d,e)},a._handleEnd=function(a,b,c){var d=a.__touch,e=d.pointers;e[b]&&(d.count--,a._handlePointerUp(b,c,!0),delete e[b])},createjs.Touch=a}(),function(){var a=this.createjs=this.createjs||{},a=a.EaselJS=a.EaselJS||{};a.version="0.6.1",a.buildDate="Tue, 14 May 2013 21:43:02 GMT"}();var Kibo=function(a){this.element=a||window.document,this.initialize()};Kibo.KEY_NAMES_BY_CODE={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"caps_lock",27:"esc",32:"space",33:"page_up",34:"page_down",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"num_lock"},Kibo.KEY_CODES_BY_NAME={},function(){for(var a in Kibo.KEY_NAMES_BY_CODE)Object.prototype.hasOwnProperty.call(Kibo.KEY_NAMES_BY_CODE,a)&&(Kibo.KEY_CODES_BY_NAME[Kibo.KEY_NAMES_BY_CODE[a]]=+a)}(),Kibo.MODIFIERS=["shift","ctrl","alt"],Kibo.WILDCARD_TYPES=["arrow","number","letter","f"],Kibo.WILDCARDS={arrow:[37,38,39,40],number:[48,49,50,51,52,53,54,55,56,57],letter:[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90],f:[112,113,114,115,116,117,118,119,120,121,122,123]},Kibo.assert=function(a,b){b=b||{},b.name=b.name||"Exception raised",b.message=b.message||"an error has occurred.";try{if(!a)throw b}catch(c){"undefined"!=typeof console&&console.log?console.log(c.name+": "+c.message):window.alert(c.name+": "+c.message)}},Kibo.registerEvent=function(){return document.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?function(a,b,c){a.attachEvent("on"+b,c)}:void 0}(),Kibo.unregisterEvent=function(){return document.removeEventListener?function(a,b,c){a.removeEventListener(b,c,!1)}:document.detachEvent?function(a,b,c){a.detachEvent("on"+b,c)}:void 0}(),Kibo.isArray=function(a){return!(!a||!a.splice)},Kibo.isString=function(a){return"string"==typeof a},Kibo.arrayIncludes=function(){return Array.prototype.indexOf?function(a,b){return-1!==a.indexOf(b)}:function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1}}(),Kibo.trimString=function(a){return a.replace(/^\s+|\s+$/g,"")},Kibo.neatString=function(a){return Kibo.trimString(a).replace(/\s+/g," ")},Kibo.capitalize=function(a){return a.toLowerCase().replace(/^./,function(a){return a.toUpperCase()})},Kibo.isModifier=function(a){return Kibo.arrayIncludes(Kibo.MODIFIERS,a)},Kibo.prototype.initialize=function(){var a,b=this;for(this.lastKeyCode=-1,this.lastModifiers={},a=0;a<Kibo.MODIFIERS.length;a++)this.lastModifiers[Kibo.MODIFIERS[a]]=!1;for(this.keysDown={any:[]},this.keysUp={any:[]},a=0;a<Kibo.WILDCARD_TYPES.length;a++)this.keysDown["any "+Kibo.WILDCARD_TYPES[a]]=[],this.keysUp["any "+Kibo.WILDCARD_TYPES[a]]=[];this.downHandler=this.handler("down"),this.upHandler=this.handler("up"),Kibo.registerEvent(this.element,"keydown",this.downHandler),Kibo.registerEvent(this.element,"keyup",this.upHandler),Kibo.registerEvent(window,"unload",function c(){Kibo.unregisterEvent(b.element,"keydown",b.downHandler),Kibo.unregisterEvent(b.element,"keyup",b.upHandler),Kibo.unregisterEvent(window,"unload",c)})},Kibo.prototype.matchingKeys=function(a){var b,c,d,e=[];for(var f in a)if(Object.prototype.hasOwnProperty.call(a,f)&&(c=Kibo.trimString(f).split(" "),c.length&&"any"!==c[0])){for(d=!0,b=0;b<c.length;b++)d=d&&(Kibo.isModifier(c[b])?this.lastKey(c[b]):this.lastKey()===c[b]);d&&e.push(f)}return e},Kibo.prototype.handler=function(a){var b=this;return function(c){var d,e,f,g;for(c=c||window.event,b.lastKeyCode=c.keyCode,d=0;d<Kibo.MODIFIERS.length;d++)b.lastModifiers[Kibo.MODIFIERS[d]]=c[Kibo.MODIFIERS[d]+"Key"];for(Kibo.arrayIncludes(Kibo.MODIFIERS,Kibo.keyName(b.lastKeyCode))&&(b.lastModifiers[Kibo.keyName(b.lastKeyCode)]=!0),g=b["keys"+Kibo.capitalize(a)],f=b.matchingKeys(g),d=0;d<g.any.length;d++)g.any[d](c)===!1&&c.preventDefault&&c.preventDefault();for(d=0;d<Kibo.WILDCARD_TYPES.length;d++)if(Kibo.arrayIncludes(Kibo.WILDCARDS[Kibo.WILDCARD_TYPES[d]],b.lastKeyCode))for(e=0;e<g["any "+Kibo.WILDCARD_TYPES[d]].length;e++)g["any "+Kibo.WILDCARD_TYPES[d]][e](c)===!1&&c.preventDefault&&c.preventDefault();for(d=0;d<f.length;d++)for(e=0;e<g[f[d]].length;e++)g[f[d]][e](c)===!1&&c.preventDefault&&c.preventDefault()}},Kibo.prototype.registerKeys=function(a,b,c){var d,e=this["keys"+Kibo.capitalize(a)];for(Kibo.isArray(b)||(b=[b]),d=0;d<b.length;d++)Kibo.assert(Kibo.isString(b[d]),{name:"Type error",message:"expected string or array of strings."}),b[d]=Kibo.neatString(b[d]),Kibo.isArray(e[b[d]])?e[b[d]].push(c):e[b[d]]=[c];return this},Kibo.prototype.unregisterKeys=function(a,b,c){var d,e,f=this["keys"+Kibo.capitalize(a)];for(Kibo.isArray(b)||(b=[b]),d=0;d<b.length;d++)if(Kibo.assert(Kibo.isString(b[d]),{name:"Type error",message:"expected string or array of strings."}),b[d]=Kibo.neatString(b[d]),null===c)delete f[b[d]];else if(Kibo.isArray(f[b[d]]))for(e=0;e<f[b[d]].length;e++)if(String(f[b[d]][e])===String(c)){f[b[d]].splice(e,1);break}return this},Kibo.prototype.delegate=function(a,b,c){return null!==c?this.registerKeys(a,b,c):this.unregisterKeys(a,b,c)},Kibo.prototype.down=function(a,b){return this.delegate("down",a,b)},Kibo.prototype.up=function(a,b){return this.delegate("up",a,b)},Kibo.keyName=function(a){return Kibo.KEY_NAMES_BY_CODE[a+""]},Kibo.keyCode=function(a){return+Kibo.KEY_CODES_BY_NAME[a]},Kibo.prototype.lastKey=function(a){return a?(Kibo.assert(Kibo.arrayIncludes(Kibo.MODIFIERS,a),{name:"Modifier error",message:"invalid modifier "+a+" (valid modifiers are: "+Kibo.MODIFIERS.join(", ")+")."}),this.lastModifiers[a]):Kibo.keyName(this.lastKeyCode)},function(){var a=this.createjs=this.createjs||{},a=a.PreloadJS=a.PreloadJS||{};a.version="0.3.1",a.buildDate="Thu, 09 May 2013 22:04:32 GMT"}(),this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype;a.initialize=function(a){a.addEventListener=b.addEventListener,a.removeEventListener=b.removeEventListener,a.removeAllEventListeners=b.removeAllEventListeners,a.hasEventListener=b.hasEventListener,a.dispatchEvent=b.dispatchEvent},b._listeners=null,b.initialize=function(){},b.addEventListener=function(a,b){var c=this._listeners;c?this.removeEventListener(a,b):c=this._listeners={};var d=c[a];return d||(d=c[a]=[]),d.push(b),b},b.removeEventListener=function(a,b){var c=this._listeners;if(c){var d=c[a];if(d)for(var e=0,f=d.length;f>e;e++)if(d[e]==b){1==f?delete c[a]:d.splice(e,1);break}}},b.removeAllEventListeners=function(a){a?this._listeners&&delete this._listeners[a]:this._listeners=null},b.dispatchEvent=function(a,b){var c=!1,d=this._listeners;if(a&&d){if("string"==typeof a&&(a={type:a}),d=d[a.type],!d)return c;a.target=b||this;for(var d=d.slice(),e=0,f=d.length;f>e;e++)var g=d[e],c=g.handleEvent?c||g.handleEvent(a):c||g(a)}return!!c},b.hasEventListener=function(a){var b=this._listeners;return!(!b||!b[a])},b.toString=function(){return"[EventDispatcher]"},createjs.EventDispatcher=a}(),this.createjs=this.createjs||{},function(){var a=function(){this.init()};a.prototype={};var b=a.prototype;a.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/,b.loaded=!1,b.canceled=!1,b.progress=0,b._item=null,b._basePath=null,b.onProgress=null,b.onLoadStart=null,b.onComplete=null,b.onError=null,b.addEventListener=null,b.removeEventListener=null,b.removeAllEventListeners=null,b.dispatchEvent=null,b.hasEventListener=null,b._listeners=null,createjs.EventDispatcher.initialize(b),b.getItem=function(){return this._item},b.init=function(){},b.load=function(){},b.close=function(){},b._sendLoadStart=function(){this._isCanceled()||(this.onLoadStart&&this.onLoadStart({target:this}),this.dispatchEvent("loadStart"),this.dispatchEvent("loadstart"))},b._sendProgress=function(a){if(!this._isCanceled()){var b=null;"number"==typeof a?(this.progress=a,b={loaded:this.progress,total:1}):(b=a,this.progress=a.loaded/a.total,(isNaN(this.progress)||1/0==this.progress)&&(this.progress=0)),b.target=this,b.type="progress",b.progress=this.progress,this.onProgress&&this.onProgress(b),this.dispatchEvent(b)}},b._sendComplete=function(){this._isCanceled()||(this.onComplete&&this.onComplete({target:this}),this.dispatchEvent("complete"))},b._sendError=function(a){this._isCanceled()||(null==a&&(a={}),a.target=this,a.type="error",this.onError&&this.onError(a),this.dispatchEvent(a))},b._isCanceled=function(){return null==window.createjs||this.canceled?!0:!1},b._parseURI=function(b){return b?b.match(a.FILE_PATTERN):null},b._formatQueryString=function(a,b){if(null==a)throw Error("You must specify data.");var c,d=[];for(c in a)d.push(c+"="+escape(a[c]));return b&&(d=d.concat(b)),d.join("&")},b.buildPath=function(a,b,c){if(null!=b){var d=this._parseURI(a);(null==d[1]||""==d[1])&&(a=b+a)}if(null==c)return a;if(b=[],d=a.indexOf("?"),-1!=d)var e=a.slice(d+1),b=b.concat(e.split("&"));return-1!=d?a.slice(0,d)+"?"+this._formatQueryString(c,b):a+"?"+this._formatQueryString(c,b)},b.toString=function(){return"[PreloadJS AbstractLoader]"},createjs.AbstractLoader=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b){this.init(a,b)},b=a.prototype=new createjs.AbstractLoader;a.LOAD_TIMEOUT=8e3,a.BINARY="binary",a.CSS="css",a.IMAGE="image",a.JAVASCRIPT="javascript",a.JSON="json",a.JSONP="jsonp",a.SOUND="sound",a.SVG="svg",a.TEXT="text",a.XML="xml",a.POST="POST",a.GET="GET",b.useXHR=!0,b.stopOnError=!1,b.maintainScriptOrder=!0,b.next=null,b.onFileLoad=null,b.onFileProgress=null,b._typeCallbacks=null,b._extensionCallbacks=null,b._loadStartWasDispatched=!1,b._maxConnections=1,b._currentlyLoadingScript=null,b._currentLoads=null,b._loadQueue=null,b._loadQueueBackup=null,b._loadItemsById=null,b._loadItemsBySrc=null,b._loadedResults=null,b._loadedRawResults=null,b._numItems=0,b._numItemsLoaded=0,b._scriptOrder=null,b._loadedScripts=null,b.init=function(a,b){this._numItems=this._numItemsLoaded=0,this._loadStartWasDispatched=this._paused=!1,this._currentLoads=[],this._loadQueue=[],this._loadQueueBackup=[],this._scriptOrder=[],this._loadedScripts=[],this._loadItemsById={},this._loadItemsBySrc={},this._loadedResults={},this._loadedRawResults={},this._typeCallbacks={},this._extensionCallbacks={},this._basePath=b,this.setUseXHR(a)},b.setUseXHR=function(a){return this.useXHR=0!=a&&null!=window.XMLHttpRequest},b.removeAll=function(){this.remove()},b.remove=function(a){var b=null;if(!a||a instanceof Array?a&&(b=a):b=[a],a=!1,b){for(;b.length;){for(var c=b.pop(),d=this.getResult(c),e=this._loadQueue.length-1;e>=0;e--)if(f=this._loadQueue[e].getItem(),f.id==c||f.src==c){this._loadQueue.splice(e,1)[0].cancel();break}for(e=this._loadQueueBackup.length-1;e>=0;e--)if(f=this._loadQueueBackup[e].getItem(),f.id==c||f.src==c){this._loadQueueBackup.splice(e,1)[0].cancel();break}if(d)delete this._loadItemsById[d.id],delete this._loadItemsBySrc[d.src],this._disposeItem(d);else for(var e=this._currentLoads.length-1;e>=0;e--){var f=this._currentLoads[e].getItem();if(f.id==c||f.src==c){this._currentLoads.splice(e,1)[0].cancel(),a=!0;break}}}a&&this._loadNext()}else{this.close();for(c in this._loadItemsById)this._disposeItem(this._loadItemsById[c]);this.init(this.useXHR)}},b.reset=function(){this.close();for(var a in this._loadItemsById)this._disposeItem(this._loadItemsById[a]);for(a=[],i=0,l=this._loadQueueBackup.length;l>i;i++)a.push(this._loadQueueBackup[i].getItem());this.loadManifest(a,!1)},a.isBinary=function(a){switch(a){case createjs.LoadQueue.IMAGE:case createjs.LoadQueue.BINARY:return!0;default:return!1}},b.installPlugin=function(a){if(null!=a&&null!=a.getPreloadHandlers){if(a=a.getPreloadHandlers(),null!=a.types)for(var b=0,c=a.types.length;c>b;b++)this._typeCallbacks[a.types[b]]=a.callback;if(null!=a.extensions)for(b=0,c=a.extensions.length;c>b;b++)this._extensionCallbacks[a.extensions[b]]=a.callback}},b.setMaxConnections=function(a){this._maxConnections=a,!this._paused&&this._loadQueue.length>0&&this._loadNext()},b.loadFile=function(a,b,c){null==a?this._sendError({text:"PRELOAD_NO_FILE"}):(this._addItem(a,c),b!==!1?this.setPaused(!1):this.setPaused(!0))},b.loadManifest=function(a,b,c){var d=null;if(a instanceof Array){if(0==a.length)return this._sendError({text:"PRELOAD_MANIFEST_EMPTY"}),void 0;d=a}else{if(null==a)return this._sendError({text:"PRELOAD_MANIFEST_NULL"}),void 0;d=[a]}for(var a=0,e=d.length;e>a;a++)this._addItem(d[a],c);b!==!1?this.setPaused(!1):this.setPaused(!0)},b.load=function(){this.setPaused(!1)},b.getItem=function(a){return this._loadItemsById[a]||this._loadItemsBySrc[a]},b.getResult=function(a,b){var c=this._loadItemsById[a]||this._loadItemsBySrc[a];return null==c?null:(c=c.id,b&&this._loadedRawResults[c]?this._loadedRawResults[c]:this._loadedResults[c])},b.setPaused=function(a){(this._paused=a)||this._loadNext()},b.close=function(){for(;this._currentLoads.length;)this._currentLoads.pop().cancel();this._scriptOrder.length=0,this._loadedScripts.length=0,this.loadStartWasDispatched=!1},b._addItem=function(a,b){var c=this._createLoadItem(a);if(null!=c){var d=this._createLoader(c,b);null!=d&&(this._loadQueue.push(d),this._loadQueueBackup.push(d),this._numItems++,this._updateProgress(),this.maintainScriptOrder&&c.type==createjs.LoadQueue.JAVASCRIPT&&d instanceof createjs.XHRLoader&&(this._scriptOrder.push(c),this._loadedScripts.push(null)))}},b._createLoadItem=function(a){var b=null;switch(typeof a){case"string":b={src:a};break;case"object":b=window.HTMLAudioElement&&a instanceof HTMLAudioElement?{tag:a,src:b.tag.src,type:createjs.LoadQueue.SOUND}:a}if(a=this._parseURI(b.src),null!=a&&(b.ext=a[5]),null==b.type&&(b.type=this._getTypeByExtension(b.ext)),b.type==createjs.LoadQueue.JSON&&null!=b.callback&&(b.type=createjs.LoadQueue.JSONP),b.type==createjs.LoadQueue.JSONP&&null==b.callback)throw Error("callback is required for loading JSONP requests.");if(null==b.tag&&(b.tag=this._createTag(b.type)),(null==b.id||""==b.id)&&(b.id=b.src),a=this._typeCallbacks[b.type]||this._extensionCallbacks[b.ext]){if(a=a(b.src,b.type,b.id,b.data),a===!1)return null;a!==!0&&(null!=a.src&&(b.src=a.src),null!=a.id&&(b.id=a.id),null!=a.tag&&a.tag.load instanceof Function&&(b.tag=a.tag),null!=a.completeHandler&&(b.completeHandler=a.completeHandler)),a.type&&(b.type=a.type),a=this._parseURI(b.src),null!=a&&null!=a[5]&&(b.ext=a[5].toLowerCase())}return this._loadItemsById[b.id]=b,this._loadItemsBySrc[b.src]=b},b._createLoader=function(a,b){var c=this.useXHR;switch(a.type){case createjs.LoadQueue.JSON:case createjs.LoadQueue.XML:case createjs.LoadQueue.TEXT:c=!0;break;case createjs.LoadQueue.SOUND:case createjs.LoadQueue.JSONP:c=!1}return null==b&&(b=this._basePath),c?new createjs.XHRLoader(a,b):new createjs.TagLoader(a,b)},b._loadNext=function(){if(!this._paused){this._loadStartWasDispatched||(this._sendLoadStart(),this._loadStartWasDispatched=!0),this._numItems==this._numItemsLoaded&&(this.loaded=!0,this._sendComplete(),this.next&&this.next.load&&this.next.load());for(var a=0,b=this._loadQueue.length;b>a&&!(this._currentLoads.length>=this._maxConnections);a++){var c=this._loadQueue[a];if(this.maintainScriptOrder&&c instanceof createjs.TagLoader&&c.getItem().type==createjs.LoadQueue.JAVASCRIPT){if(this._currentlyLoadingScript)continue;this._currentlyLoadingScript=!0}this._loadQueue.splice(a,1),a--,b--,this._loadItem(c)}}},b._loadItem=function(a){a.addEventListener("progress",createjs.proxy(this._handleProgress,this)),a.addEventListener("complete",createjs.proxy(this._handleFileComplete,this)),a.addEventListener("error",createjs.proxy(this._handleFileError,this)),this._currentLoads.push(a),this._sendFileStart(a.getItem()),a.load()},b._handleFileError=function(a){var b=a.target;this._numItemsLoaded++,this._updateProgress(),a={item:b.getItem()},this._sendError(a),this.stopOnError||(this._removeLoadItem(b),this._loadNext())},b._handleFileComplete=function(a){var a=a.target,b=a.getItem();if(this._loadedResults[b.id]=a.getResult(),a instanceof createjs.XHRLoader&&(this._loadedRawResults[b.id]=a.getResult(!0)),this._removeLoadItem(a),this.maintainScriptOrder&&b.type==createjs.LoadQueue.JAVASCRIPT){if(!(a instanceof createjs.TagLoader))return this._loadedScripts[this._scriptOrder.indexOf(b)]=b,this._checkScriptLoadOrder(a),void 0;this._currentlyLoadingScript=!1}this._processFinishedLoad(b,a)},b._processFinishedLoad=function(a,b){this._numItemsLoaded++,this._updateProgress(),this._sendFileComplete(a,b),this._loadNext()},b._checkScriptLoadOrder=function(){for(var a=this._loadedScripts.length,b=0;a>b;b++){var c=this._loadedScripts[b];if(null===c)break;c!==!0&&(this._processFinishedLoad(c),this._loadedScripts[b]=!0,b--,a--)}},b._removeLoadItem=function(a){for(var b=this._currentLoads.length,c=0;b>c;c++)if(this._currentLoads[c]==a){this._currentLoads.splice(c,1);break}},b._handleProgress=function(a){a=a.target,this._sendFileProgress(a.getItem(),a.progress),this._updateProgress()},b._updateProgress=function(){var a=this._numItemsLoaded/this._numItems,b=this._numItems-this._numItemsLoaded;if(b>0){for(var c=0,d=0,e=this._currentLoads.length;e>d;d++)c+=this._currentLoads[d].progress;a+=c/b*(b/this._numItems)}this._sendProgress(a)},b._disposeItem=function(a){delete this._loadedResults[a.id],delete this._loadedRawResults[a.id],delete this._loadItemsById[a.id],delete this._loadItemsBySrc[a.src]},b._createTag=function(a){var b=null;switch(a){case createjs.LoadQueue.IMAGE:return document.createElement("img");case createjs.LoadQueue.SOUND:return b=document.createElement("audio"),b.autoplay=!1,b;case createjs.LoadQueue.JSONP:case createjs.LoadQueue.JAVASCRIPT:return b=document.createElement("script"),b.type="text/javascript",b;case createjs.LoadQueue.CSS:return b=this.useXHR?document.createElement("style"):document.createElement("link"),b.rel="stylesheet",b.type="text/css",b;case createjs.LoadQueue.SVG:return this.useXHR?b=document.createElement("svg"):(b=document.createElement("object"),b.type="image/svg+xml"),b}return null},b._getTypeByExtension=function(a){switch(a.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.LoadQueue.IMAGE;case"ogg":case"mp3":case"wav":return createjs.LoadQueue.SOUND;case"json":return createjs.LoadQueue.JSON;case"xml":return createjs.LoadQueue.XML;case"css":return createjs.LoadQueue.CSS;case"js":return createjs.LoadQueue.JAVASCRIPT;case"svg":return createjs.LoadQueue.SVG;default:return createjs.LoadQueue.TEXT}},b._sendFileProgress=function(a,b){if(this._isCanceled())this._cleanUp();else{var c={target:this,type:"fileprogress",progress:b,loaded:b,total:1,item:a};this.onFileProgress&&this.onFileProgress(c),this.dispatchEvent(c)}},b._sendFileComplete=function(a,b){if(!this._isCanceled()){var c={target:this,type:"fileload",loader:b,item:a,result:this._loadedResults[a.id],rawResult:this._loadedRawResults[a.id]};a.completeHandler&&a.completeHandler(c),this.onFileLoad&&this.onFileLoad(c),this.dispatchEvent(c)}},b._sendFileStart=function(a){this.dispatchEvent({target:this,type:"filestart",item:a})},b.toString=function(){return"[PreloadJS LoadQueue]"},a.proxy=function(a,b){return function(){return a.apply(b,arguments)}},createjs.LoadQueue=a,createjs.proxy||(createjs.proxy=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){return a.apply(b,Array.prototype.slice.call(arguments,0).concat(c))}});var c=function(){};c.init=function(){var a=navigator.userAgent;c.isFirefox=a.indexOf("Firefox")>-1,c.isOpera=null!=window.opera,c.isChrome=a.indexOf("Chrome")>-1,c.isIOS=a.indexOf("iPod")>-1||a.indexOf("iPhone")>-1||a.indexOf("iPad")>-1},c.init(),createjs.LoadQueue.BrowserDetect=c,Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>1&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&1/0!=d&&d!=-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(d=d>=0?d:Math.max(c-Math.abs(d),0);c>d;d++)if(d in b&&b[d]===a)return d;return-1})}(),this.createjs=this.createjs||{},function(){var a=function(a,b){this.init(a,b)},b=a.prototype=new createjs.AbstractLoader;b._loadTimeout=null,b._tagCompleteProxy=null,b._isAudio=!1,b._tag=null,b._jsonResult=null,b.init=function(a,b){this._item=a,this._basePath=b,this._tag=a.tag,this._isAudio=window.HTMLAudioElement&&a.tag instanceof HTMLAudioElement,this._tagCompleteProxy=createjs.proxy(this._handleLoad,this)},b.getResult=function(){return this._item.type==createjs.LoadQueue.JSONP?this._jsonResult:this._tag},b.cancel=function(){this.canceled=!0,this._clean(),this.getItem()},b.load=function(){var a=this._item,b=this._tag;clearTimeout(this._loadTimeout),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),createjs.LoadQueue.LOAD_TIMEOUT),this._isAudio&&(b.src=null,b.preload="auto"),b.onerror=createjs.proxy(this._handleError,this),this._isAudio?(b.onstalled=createjs.proxy(this._handleStalled,this),b.addEventListener("canplaythrough",this._tagCompleteProxy,!1)):(b.onload=createjs.proxy(this._handleLoad,this),b.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this));var c=this.buildPath(a.src,this._basePath,a.values);switch(a.type){case createjs.LoadQueue.CSS:b.href=c;break;case createjs.LoadQueue.SVG:b.data=c;break;default:b.src=c}if(a.type==createjs.LoadQueue.JSONP){if(null==a.callback)throw Error("callback is required for loading JSONP requests.");if(null!=window[a.callback])throw Error('JSONP callback "'+a.callback+'" already exists on window. You need to specify a different callback. Or re-name the current one.');window[a.callback]=createjs.proxy(this._handleJSONPLoad,this)}(a.type==createjs.LoadQueue.SVG||a.type==createjs.LoadQueue.JSONP||a.type==createjs.LoadQueue.JSON||a.type==createjs.LoadQueue.JAVASCRIPT||a.type==createjs.LoadQueue.CSS)&&(this._startTagVisibility=b.style.visibility,b.style.visibility="hidden",(document.body||document.getElementsByTagName("body")[0]).appendChild(b)),null!=b.load&&b.load()},b._handleJSONPLoad=function(a){this._jsonResult=a},b._handleTimeout=function(){this._clean(),this._sendError({reason:"PRELOAD_TIMEOUT"})},b._handleStalled=function(){},b._handleError=function(){this._clean(),this._sendError()},b._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var a=this.getItem().tag;("loaded"==a.readyState||"complete"==a.readyState)&&this._handleLoad()},b._handleLoad=function(){if(!this._isCanceled()){var a=this.getItem(),b=a.tag;if(!(this.loaded||this.isAudio&&4!==b.readyState)){switch(this.loaded=!0,a.type){case createjs.LoadQueue.SVG:case createjs.LoadQueue.JSONP:b.style.visibility=this._startTagVisibility,(document.body||document.getElementsByTagName("body")[0]).removeChild(b)}this._clean(),this._sendComplete()}}},b._clean=function(){clearTimeout(this._loadTimeout);var a=this.getItem().tag;a.onload=null,a.removeEventListener&&a.removeEventListener("canplaythrough",this._tagCompleteProxy,!1),a.onstalled=null,a.onprogress=null,a.onerror=null,a.parentNode&&a.parentNode.removeChild(a),a=this.getItem(),a.type==createjs.LoadQueue.JSONP&&(window[a.callback]=null)},b.toString=function(){return"[PreloadJS TagLoader]"},createjs.TagLoader=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b){this.init(a,b)},b=a.prototype=new createjs.AbstractLoader;b._request=null,b._loadTimeout=null,b._xhrLevel=1,b._response=null,b._rawResponse=null,b.init=function(a,b){this._item=a,this._basePath=b,this._createXHR(a)},b.getResult=function(a){return a&&this._rawResponse?this._rawResponse:this._response},b.cancel=function(){this.canceled=!0,this._clean(),this._request.abort()},b.load=function(){if(null==this._request)this._handleError();else{this._request.onloadstart=createjs.proxy(this._handleLoadStart,this),this._request.onprogress=createjs.proxy(this._handleProgress,this),this._request.onabort=createjs.proxy(this._handleAbort,this),this._request.onerror=createjs.proxy(this._handleError,this),this._request.ontimeout=createjs.proxy(this._handleTimeout,this),1==this._xhrLevel&&(this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),createjs.LoadQueue.LOAD_TIMEOUT)),this._request.onload=createjs.proxy(this._handleLoad,this),this._request.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this);try{this._item.values&&this._item.method!=createjs.LoadQueue.GET?this._item.method==createjs.LoadQueue.POST&&this._request.send(this._formatQueryString(this._item.values)):this._request.send()}catch(a){this._sendError({source:a})}}},b.getAllResponseHeaders=function(){return this._request.getAllResponseHeaders instanceof Function?this._request.getAllResponseHeaders():null},b.getResponseHeader=function(a){return this._request.getResponseHeader instanceof Function?this._request.getResponseHeader(a):null},b._handleProgress=function(a){a.loaded>0&&0==a.total||this._sendProgress({loaded:a.loaded,total:a.total})},b._handleLoadStart=function(){clearTimeout(this._loadTimeout),this._sendLoadStart()},b._handleAbort=function(){this._clean(),this._sendError()},b._handleError=function(){this._clean(),this._sendError()},b._handleReadyStateChange=function(){4==this._request.readyState&&this._handleLoad()},b._handleLoad=function(){this.loaded||(this.loaded=!0,this._checkError()?(this._response=this._getResponse(),this._clean(),this._generateTag()&&this._sendComplete()):this._handleError())},b._handleTimeout=function(){this._clean(),this._sendError({reason:"PRELOAD_TIMEOUT"})},b._checkError=function(){switch(parseInt(this._request.status)){case 404:case 0:return!1}return!0},b._getResponse=function(){if(null!=this._response)return this._response;if(null!=this._request.response)return this._request.response;try{if(null!=this._request.responseText)return this._request.responseText}catch(a){}try{if(null!=this._request.responseXML)return this._request.responseXML}catch(b){}return null},b._createXHR=function(a){var b=document.createElement("a");b.href=this.buildPath(a.src,this._basePath);var c=document.createElement("a");if(c.href=location.href,b=""!=b.hostname&&(b.port!=c.port||b.protocol!=c.protocol||b.hostname!=c.hostname),c=null,b&&window.XDomainRequest)c=new XDomainRequest;else if(window.XMLHttpRequest)c=new XMLHttpRequest;else try{c=new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(d){try{c=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){try{c=new ActiveXObject("Msxml2.XMLHTTP")}catch(f){return!1}}}a.type==createjs.LoadQueue.TEXT&&c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined"),this._xhrLevel="string"==typeof c.responseType?2:1;var g=null,g=a.method==createjs.LoadQueue.GET?this.buildPath(a.src,this._basePath,a.values):this.buildPath(a.src,this._basePath);return c.open(a.method||createjs.LoadQueue.GET,g,!0),b&&c instanceof XMLHttpRequest&&1==this._xhrLevel&&c.setRequestHeader("Origin",location.origin),a.values&&a.method==createjs.LoadQueue.POST&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),createjs.LoadQueue.isBinary(a.type)&&(c.responseType="arraybuffer"),this._request=c,!0},b._clean=function(){clearTimeout(this._loadTimeout);var a=this._request;a.onloadstart=null,a.onprogress=null,a.onabort=null,a.onerror=null,a.onload=null,a.ontimeout=null,a.onloadend=null,a.onreadystatechange=null},b._generateTag=function(){var a=this._item.tag;switch(this._item.type){case createjs.LoadQueue.IMAGE:return a.onload=createjs.proxy(this._handleTagReady,this),a.src=this.buildPath(this._item.src,this._basePath,this._item.values),this._rawResponse=this._response,this._response=a,!1;case createjs.LoadQueue.JAVASCRIPT:a=document.createElement("script"),this._rawResponse=a.text=this._response,this._response=a;break;case createjs.LoadQueue.CSS:if(document.getElementsByTagName("head")[0].appendChild(a),a.styleSheet)a.styleSheet.cssText=this._response;else{var b=document.createTextNode(this._response);a.appendChild(b)}this._rawResponse=this._response,this._response=a;break;case createjs.LoadQueue.XML:this._response=b=this._parseXML(this._response,"text/xml");break;case createjs.LoadQueue.SVG:b=this._parseXML(this._response,"image/svg+xml"),this._rawResponse=this._response,null!=b.documentElement?(a.appendChild(b.documentElement),this._response=a):this._response=b;break;case createjs.LoadQueue.JSON:a={};try{a=JSON.parse(this._response)}catch(c){a=c}this._rawResponse=this._response,this._response=a}return!0},b._parseXML=function(a,b){var c=null;return window.DOMParser?c=(new DOMParser).parseFromString(a,b):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(a)),c},b._handleTagReady=function(){this._sendComplete()},b.toString=function(){return"[PreloadJS XHRLoader]"},createjs.XHRLoader=a}(),"object"!=typeof JSON&&(JSON={}),function(){function c(a){return 10>a?"0"+a:a}function a(a){return e.lastIndex=0,e.test(a)?'"'+a.replace(e,function(a){var b=o[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(b,c){var e,g,i,k,l,m=j,n=c[b];switch(n&&"object"==typeof n&&"function"==typeof n.toJSON&&(n=n.toJSON(b)),"function"==typeof h&&(n=h.call(c,b,n)),typeof n){case"string":return a(n);case"number":return isFinite(n)?String(n):"null";case"boolean":case"null":return String(n);case"object":if(!n)return"null";if(j+=f,l=[],"[object Array]"===Object.prototype.toString.apply(n)){for(k=n.length,e=0;k>e;e+=1)l[e]=d(e,n)||"null";return i=0===l.length?"[]":j?"[\n"+j+l.join(",\n"+j)+"\n"+m+"]":"["+l.join(",")+"]",j=m,i}if(h&&"object"==typeof h)for(k=h.length,e=0;k>e;e+=1)"string"==typeof h[e]&&(g=h[e],(i=d(g,n))&&l.push(a(g)+(j?": ":":")+i));else for(g in n)Object.prototype.hasOwnProperty.call(n,g)&&(i=d(g,n))&&l.push(a(g)+(j?": ":":")+i);
return i=0===l.length?"{}":j?"{\n"+j+l.join(",\n"+j)+"\n"+m+"}":"{"+l.join(",")+"}",j=m,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j,f,o={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var e;if(f=j="","number"==typeof c)for(e=0;c>e;e+=1)f+=" ";else"string"==typeof c&&(f=c);if((h=b)&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw Error("JSON.stringify");return d("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(a,c){function d(a,b){var e,f,g=a[b];if(g&&"object"==typeof g)for(e in g)Object.prototype.hasOwnProperty.call(g,e)&&(f=d(g,e),void 0!==f?g[e]=f:delete g[e]);return c.call(a,b,g)}var e,a=String(a);if(b.lastIndex=0,b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),"function"==typeof c?d({"":e},""):e;throw new SyntaxError("JSON.parse")})}(),trolley=function(){function a(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function b(a,b){var c;for(c in b)b.hasOwnProperty(c)&&"undefined"==typeof a[c]&&(a[c]=b[c]);return a}function c(a,b){var c,d=0;for(a=[].concat(a),c=0;c<a.length;c++)"undefined"!=typeof a[c]&&(b(a[c],d),d++)}function d(a,b,c){return a+b/2-c/2}function e(a){return j=a,j||(j=new b2World(new b2Vec2(0,-9.81),!0),j.SetWarmStarting(!0)),j}function f(b,e,f){function g(a,b,c){a.x=Math.abs(a.x),a.y=Math.abs(a.y),a.x+b>h.width&&(h.width=a.x+b),a.y+c>h.height&&(h.height=a.y+c)}var h={boxes:[],circles:[],width:0,height:0,bodyDef:new b2BodyDef};return 1===arguments.length&&(a(h.bodyDef,b.options),f=b.isStatic,e=b.y,b=b.x),h.bodyDef.type="boolean"==typeof f&&f?b2Body.b2_staticBody:b2Body.b2_dynamicBody,"object"==typeof f&&a(h.bodyDef,f),h.box=function(a,b,c,d,e){var f;if(arguments.length<1)throw"box must have arguments, at least object or width, height";return 1===arguments.length&&(f=a),arguments.length<4&&(e=c,c=a,d=b,a=b=0),f||(f={x:a,y:b,width:c,height:d,options:e}),h.boxes.push(f),g(f,f.width,f.height),h},h.circle=function(a,b,c,d){var e;if(arguments.length<1)throw"circle must have arguments, at least object or size";return 1===arguments.length&&"number"!=typeof a&&(e=a),arguments.length<3&&(d=b,c=a,a=b=0),e||(e={x:a,y:b,size:c,options:d}),h.circles.push(e),g(e,e.size,e.size),h},h.create=function(){function f(b,c){fixtureDef=new b2FixtureDef,a(fixtureDef,{density:1}),a(fixtureDef,c),fixtureDef.shape=b,g.CreateFixture(fixtureDef)}var g,i=h.width/2,k=h.height/2;return h.bodyDef.position.Set(b+i,e+k),g=j.CreateBody(h.bodyDef),c(h.boxes,function(a){var b=new b2PolygonShape.AsBox(a.width/2,a.height/2),c=d(a.x,a.width,h.width),e=d(a.y,a.height,h.height);b.m_vertices.forEach(function(a){a.x+=c,a.y+=e}),f(b,a.options)}),c(h.circles,function(a){var b=new b2CircleShape(a.size/2),c=d(a.x,a.size,h.width),e=d(a.y,a.size,h.height);b.SetLocalPosition(new b2Vec2(c,e)),f(b,a.options)}),g.width=h.width,g.height=h.height,g},h.b=h.box,h.c=h.circle,h}function g(){function a(a,f,g){var h,i,k=a.GetPosition();return 1===arguments.length&&(f=g=0),f=d(f,0,a.width),g=d(g,0,a.width),f+=k.x,g+=k.y,c.push([a,f,g]),2===c.length&&(h=new b2Vec2(c[0][1],c[0][2]),i=new b2Vec2(c[1][1],c[1][2]),b.joint=e.Initialize(c[0][0],c[1][0],h,i),j.CreateJoint(e)),b}var b={},c=[],e=new b2DistanceJointDef;return b.a=b.b=a,b}function h(a){var b=a.GetPosition();return("undefined"==typeof a.width||"undefined"==typeof a.height)&&(a.width=0,a.height=0),{x:b.x-a.width/2,y:b.y-a.height/2,origo:{x:b.x,y:b.y},width:a.width,height:a.height}}function i(a){var d={bodyWraps:[]};return d.create=function(){var a=[];return c(d.bodyWraps,function(b){a.push(b.create())}),a},c(a,function(a){var e;a=b(a,{x:0,y:0,isStatic:!1,options:{}}),e=f(a),c(a.boxes,function(a){a=b(a,{x:0,y:0,width:1,height:1,options:{}}),e.box(a)}),c(a.circles,function(a){a=b(a,{x:0,y:0,size:1,options:{}}),e.circle(a)}),d.bodyWraps.push(e)}),d}var j;return{init:e,body:f,b:f,joint:g,position:h,pos:h,build:i}}(),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=(d.unshift,e.toString),k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?(this._wrapped=a,void 0):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.4.2";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(x.has(a,g)&&b.call(d,a[g],g,a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)},x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError("Reduce of empty array with no initial value");return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),arguments.length>2?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError("Reduce of empty array with no initial value");return c},x.find=x.detect=function(a,b,c){var d;return z(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},x.reject=function(a,b,c){var d=[];return null==a?d:(y(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var z=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){var c=!1;return null==a?c:s&&a.indexOf===s?-1!=a.indexOf(b):c=z(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2);return x.map(a,function(a){return(x.isFunction(b)?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b){return x.isEmpty(b)?[]:x.filter(a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d};var A=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=A(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var B=function(a,b,c,d){var e={},f=A(b);return y(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};x.groupBy=function(a,b,c){return B(a,b,c,function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)})},x.countBy=function(a,b,c){return B(a,b,c,function(a,b){x.has(a,b)||(a[b]=0),a[b]++})},x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:A(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?a.length===+a.length?h.call(a):x.values(a):[]},x.size=function(a){return a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,function(a){return!!a})};var C=function(a,b,c){return y(a,function(a){x.isArray(a)?b?g.apply(c,a):C(a,b,c):c.push(a)}),c};x.flatten=function(a,b){return C(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(i.apply(d,arguments))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=h.call(arguments),b=x.max(x.pluck(a,"length")),c=new Array(b),d=0;b>d;d++)c[d]=x.pluck(a,""+d);return c},x.object=function(a,b){for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var D=function(){};x.bind=function(a,b){var c,d;if(a.bind===w&&w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return d=h.call(arguments,2),c=function(){if(!(this instanceof c))return a.apply(b,d.concat(h.call(arguments)));D.prototype=a.prototype;var e=new D,f=a.apply(e,d.concat(h.call(arguments)));return Object(f)===f?f:e}},x.bindAll=function(a){var b=h.call(arguments,1);return 0==b.length&&(b=x.functions(a)),y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b){var c,d,e,f,g,h,i=x.debounce(function(){g=f=!1},b);return function(){c=this,d=arguments;var j=function(){e=null,g&&(h=a.apply(c,d)),i()};return e||(e=setTimeout(j,b)),f?g=!0:(f=!0,h=a.apply(c,d)),i(),h}},x.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return 0>=a?b():function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&(b[b.length]=c);return b},x.values=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push(a[c]);return b},x.pairs=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push([c,a[c]]);return b},x.invert=function(a){var b={};for(var c in a)x.has(a,c)&&(b[a[c]]=c);return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){for(var c in b)null==a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var E=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if("[object Array]"==e){if(g=a.length,h=g==b.length)for(;g--&&(h=E(a[g],b[g],c,d)););}else{var i=a.constructor,k=b.constructor;if(i!==k&&!(x.isFunction(i)&&i instanceof i&&x.isFunction(k)&&k instanceof k))return!1;for(var l in a)if(x.has(a,l)&&(g++,!(h=x.has(b,l)&&E(a[l],b[l],c,d))))break;if(h){for(l in b)if(x.has(b,l)&&!g--)break;h=!g}}return c.pop(),d.pop(),h};x.isEqual=function(a,b){return E(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return x.isNumber(a)&&isFinite(a)},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=0;a>d;d++)b.call(c,d)},x.random=function(a,b){return null==b&&(b=a,a=0),a+(0|Math.random()*(b-a+1))};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};F.unescape=x.invert(F.escape);var G={escape:new RegExp("["+x.keys(F.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(F.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(G[a],function(b){return F[a][b]})}}),x.result=function(a,b){if(null==a)return null;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),L.call(this,c.apply(x,a))}})};var H=0;x.uniqueId=function(a){var b=H++;return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){c=x.defaults({},c,x.templateSettings);var d=new RegExp([(c.escape||I).source,(c.interpolate||I).source,(c.evaluate||I).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){f+=a.slice(e,h).replace(K,function(a){return"\\"+J[a]}),f+=c?"'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?"'+\n((__t=("+d+"))==null?'':__t)+\n'":g?"';\n"+g+"\n__p+='":"",e=h+b.length}),f+="';\n",c.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(c.variable||"obj","_",f)}catch(h){throw h.source=f,h}if(b)return g(b,x);var i=function(a){return g.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+f+"}",i},x.chain=function(a){return x(a).chain()};var L=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],L.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return L.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),xybox=function(){function a(a){var b={};a.on=function(a,c,d){2===arguments.length&&(d=c,c=1),b[a]||(b[a]=[]),b[a].push({priority:c,callback:d}),b[a].sort(function(a,b){return a.priority>b.priority})},a.trigger=function(a){var c,d=_.toArray(arguments).slice(1);return _.each(b[a],function(a){var b;b=a.callback.apply(null,d),"undefined"!=typeof b&&(c=b)}),c}}function b(a){function b(b){var c=a.pos(b);_.each(b.graphics,function(a){a.x=c.x+a.regX,a.y=c.y+a.regY,a.paddX&&(a.x+=a.paddX),a.paddY&&(a.y+=a.paddY),b.body&&(a.rotation=-(180*b.body.GetAngle()/Math.PI))})}function c(b){var c=[];_.each(b.graphics,function(e){var f,g;if(b.body?(f=b.body.width*a.scale,g=b.body.height*a.scale):(f=e.width,g=e.height),!e.image)throw new Error("Missing graphics image: "+b.def);var h=a.assets[e.image];if(!h)throw new Error("Unknown graphics image: "+e.image);var i;if(e.animations){e.images=[h.src];var j=new createjs.SpriteSheet(e);i=new createjs.BitmapAnimation(j),b.animation&&(e.animation=b.animation),e.animation||(e.animation="default");var k=e.animations[e.animation];k=k&&k.length>1;var l="gotoAnd"+(k?"Play":"Stop");i[l](e.animation)}else{i=new createjs.Shape;var m=i.graphics;f||(f=h.width),g||(g=h.height),m.beginBitmapFill(h),m.drawRect(0,0,f,g),i.cache(0,0,f,g)}b.rotation&&(i.rotation=b.rotation),i.paddX=e.paddX,i.paddY=e.paddY,i.regX=f/2,i.regY=g/2,i.loop=e.loop,i.width=f,i.height=g,e.zindex?d.addChildAt(i,e.zindex):d.addChild(i),c.push(i),e.name&&(c[e.name]=i)}),b.graphics=c}var d;a.pos=function(b){var c;return b.body?(c=trolley.pos(b.body),{x:c.x*a.scale,y:a.height-c.y*a.scale-b.body.height*a.scale}):b},this.createItem=function(e){c(e),_.each(e.graphics,function(b){b.loop&&(b.onAnimationEnd=function(){return b.loop--,0===b.loop?(e.body?a.destroyItem(e):d.removeChild(b),void 0):(b.gotoAndPlay(b.currentAnimation),void 0)})}),b(e)},this.init=function(){a.width=a.canvas.width,a.height=a.canvas.height,a.center={x:a.width/2,y:a.height/2},d=a.stage=new createjs.Stage(a.canvas),d.onMouseMove=function(b){a.trigger("mouseMove",b)},d.onMouseDown=function(b){a.trigger("mouseDown",b)},d.onMouseUp=function(b){a.trigger("mouseUp",b)}},this.itemDestroy=function(a){_.each(a.graphics,function(a){d.removeChild(a)})},a.on("tick",2,function(){_.each(a.actives,b);for(var c=0;c<d.getNumChildren();c++){var e=d.getChildAt(c),f=e.x+d.x,g=e.y+d.y;e.visible=f>=0&&f<a.canvas.width+e.width&&g>=0&&g<a.canvas.height+e.height}d.update()})}function c(){var c=this;c.events=new a(c),c.graphics=new b(c),c.keys=new Kibo,c.fps=30,c.defs={},c.assets={},c.items=[],c.actives=[],c.version="1.0.2",c.createItem=function(a){var b;return a.def&&(b=c.defs[a.def]),b&&d.deepDefaults(a,b),a.name&&(c[a.name]=a),c.items.push(a),b&&b.body&&!b.body.isStatic&&c.actives.push(a),c.graphics.createItem(a),a},c.destroyItem=function(a){c.items=_.without(c.items,a)},c.overlapping=function(a){var b=physics.overlapping(a.body);return _.chain(b).compact().map(function(a){return a.item}).value()},c.init=function(a,b){c.canvas=document.getElementById(a);var d,e=new createjs.LoadQueue,f=new createjs.LoadQueue;f.addEventListener("fileload",function(a){c.assets[a.item.id]=a.result}),f.addEventListener("complete",function(){c.graphics.init(),_.each(d.items,function(a){c.createItem(a)}),c.start()}),e.addEventListener("fileload",function(a){d=a.result,c.defs=d.defs;var b=_.compact(_.toArray(d.defs).concat(d.items)),e=[];_.each(b,function(a){_.each(a.graphics,function(a){var b=a.image;b&&e.push({id:b,src:b})})}),f.loadManifest(e)}),e.loadFile({id:b,src:b})},c.start=function(){createjs.Ticker.addListener(function(){c.trigger("tick")})}}var d={deepDefaults:function(a,b){_.isObject(a)&&_.isObject(b)&&(_.defaults(a,b),_.each(a,function(a,c){d.deepDefaults(a,b[c])}))}};return preload=function(){function a(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.src=a;var e=!1;b&&(d.onload=d.onreadystatechange=function(){e||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(e=!0,b(),d.onload=d.onreadystatechange=null,c.removeChild(d))}),c.appendChild(d)}function b(c,j,k){2===arguments.length&&(k=j,j=c,c=""),j=_.without(j,f),f=f.concat(j),j=_.map(j,function(a){return a.id||(a={id:a,src:a}),a.src=c+a.src,a});var l=[],m=new createjs.PreloadJS;e+=j.length,m.onFileLoad=function(a){l.push(a)},m.onComplete=function(){_.each(l,function(c){switch(h.push(c),c.type){case createjs.PreloadJS.JAVASCRIPT:a(c.result.src,function(){k(++i,e,g,h)});break;case createjs.PreloadJS.JSON:try{var j=c.src.match(/.*\//);j=j?j[0]:"",c=JSON.parse(c.result),_.each(c.preload,function(a){_.contains(f,a)||b(j,[a],k)}),delete c.preload,d.deepDefaults(g,c)}catch(l){throw console.error("Unable to parse "+c.src),l}k(++i,e,g,h);break;default:k(++i,e,g,h)}})},m.loadManifest(j)}var c={},e=0,f=[],g={},h=[],i=0;return c.recursiveLoad=function(a,c){e=0,g={},h=[],b(a,c)},c}(),physics=function(){var a={};a.world=trolley.init(),Date.now()}(),{Game:c}}();