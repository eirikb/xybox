xybox=function(){function a(a){var b={};a.on=function(a,c,d){2===arguments.length&&(d=c,c=1),b[a]||(b[a]=[]),b[a].push({priority:c,callback:d}),b[a].sort(function(a,b){return a.priority>b.priority})},a.trigger=function(a){var c,d=_.toArray(arguments).slice(1);return _.each(b[a],function(a){var b;b=a.callback.apply(null,d),"undefined"!=typeof b&&(c=b)}),c}}function b(a,b){function c(a,b){function d(a){var b=f.match(/.*\//);return b=b?b[0]:"",b+=a,b.match(/\.json$/i)||(b+=".json"),b}a=_.flatten([a]);var f,g=new createjs.LoadQueue,h=[];g.addEventListener("fileload",function(a){f=a.item.src,h.push(a.result),e.push(a.result)}),g.addEventListener("complete",function(){var a=_.reduce(h,function(a,b){return _.flatten([b.includes]).length+a},0);_.each(h,function(e){e.includes?(e.includes=_.map(e.includes,d),c(e.includes,b)):(a--,0===a&&b())})}),g.loadManifest(a)}function d(a,c){var d=new createjs.LoadQueue,e=_.compact(_.toArray(a.defs).concat(a.items)),f=[];b.assets={},d.addEventListener("fileload",function(a){b.assets[a.item.id]=a.result}),d.addEventListener("complete",c),_.each(e,function(a){_.each(a.graphics,function(a){var b=a.image;b&&f.push(b)})}),d.loadManifest(f)}var e,g=this;g.init=function(a,g){e=[],c(a,function(){var a=e[0];_.each(e.slice(1),function(b){f.deepDefaults(a,b)}),b.items=a.items,b.defs=a.defs,d(a,g)})}}function c(a,b){function c(b){var c=a.pos(b);_.each(b.graphics,function(a){a.x=c.x+a.regX,a.y=c.y+a.regY,a.paddX&&(a.x+=a.paddX),a.paddY&&(a.y+=a.paddY),b.body&&(a.rotation=-(180*b.body.GetAngle()/Math.PI))})}function d(c){var d=[];_.each(c.graphics,function(f){var g,h;if(c.body?(g=c.body.width*a.scale,h=c.body.height*a.scale):(g=f.width,h=f.height),!f.image)throw new Error("Missing graphics image: "+c.def);var i=b.assets[f.image];if(!i)throw new Error("Unknown graphics image: "+f.image);var j;if(g||(g=i.width),h||(h=i.height),f.animations){console.log(1),f.images=[i.src];var k=new createjs.SpriteSheet(f);j=new createjs.BitmapAnimation(k),c.animation&&(f.animation=c.animation),f.animation||(f.animation="default");var l=!!f.animations[f.animation],m="gotoAnd"+(l?"Play":"Stop");j[m](f.animation)}else{j=new createjs.Shape;var n=j.graphics;n.beginBitmapFill(i),n.drawRect(0,0,g,h),j.cache(0,0,g,h)}c.rotation&&(j.rotation=c.rotation),j.paddX=f.paddX,j.paddY=f.paddY,j.regX=g/2,j.regY=h/2,j.loop=f.loop,j.width=g,j.height=h,f.zindex?e.addChildAt(j,f.zindex):e.addChild(j),d.push(j),f.name&&(d[f.name]=j)}),c.graphics=d}var e,f=this;a.pos=function(b){var c;return b.body?(c=trolley.pos(b.body),{x:c.x*a.scale,y:a.height-c.y*a.scale-b.body.height*a.scale}):b},f.createItem=function(b){d(b),_.each(b.graphics,function(c){c.loop&&(c.onAnimationEnd=function(){return c.loop--,0===c.loop?(b.body?a.destroyItem(b):e.removeChild(c),void 0):(c.gotoAndPlay(c.currentAnimation),void 0)})}),c(b)},f.init=function(){a.width=a.canvas.width,a.height=a.canvas.height,a.center={x:a.width/2,y:a.height/2},e=a.stage=new createjs.Stage(a.canvas),e.onMouseMove=function(b){a.trigger("mouseMove",b)},e.onMouseDown=function(b){a.trigger("mouseDown",b)},e.onMouseUp=function(b){a.trigger("mouseUp",b)}},f.itemDestroy=function(a){_.each(a.graphics,function(a){e.removeChild(a)})},a.on("tick",2,function(){_.each(a.actives,c);for(var b=0;b<e.getNumChildren();b++){var d=e.getChildAt(b),f=d.x+e.x,g=d.y+e.y;d.visible=f>=0&&f<a.canvas.width+d.width&&g>=0&&g<a.canvas.height+d.height}e.update()})}function d(){function d(){createjs.Ticker.addListener(function(){g.trigger("tick")})}var g=this,h={};g.version=e.version,g.items=[],g.actives=[],h.keys=new Kibo,h.events=new a(g,h),h.graphics=new c(g,h),h.preload=new b(g,h),g.createItem=function(a){var b;return a.def&&(b=h.defs[a.def]),b&&f.deepDefaults(a,b),a.name&&(g[a.name]=a),g.items.push(a),b&&b.body&&!b.body.isStatic&&g.actives.push(a),h.graphics.createItem(a),a},g.destroyItem=function(a){g.items=_.without(g.items,a)},g.overlapping=function(a){var b=physics.overlapping(a.body);return _.chain(b).compact().map(function(a){return a.item}).value()},g.init=function(a,b){g.canvas=document.getElementById(a),h.graphics.init(),h.preload.init(b,function(){_.each(h.items,function(a){g.createItem(a)}),d()})}}var e={name:"xybox",author:{name:"Eirik BrandtzÃ¦g"},version:"1.0.2",devDependencies:{grunt:"~0.4.1","grunt-contrib":"~0.7.0"}},f={deepDefaults:function(a,b){_.isObject(a)&&_.isObject(b)&&(_.defaults(a,b),_.each(a,function(a,c){f.deepDefaults(a,b[c])}))}};return physics=function(){var a={};a.world=trolley.init(),Date.now()}(),{Game:d,version:e.version}}();